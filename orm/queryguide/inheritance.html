<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">



<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />

        <title>
            
    
    编写继承映射的SELECT语句
 &mdash;
    SQLAlchemy 2.0 Documentation

        </title>

        
            <!-- begin iterate through site-imported + sphinx environment css_files -->
                <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
                <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
                <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
                <link rel="stylesheet" href="../../_static/copybutton.css" type="text/css" />
                <link rel="stylesheet" href="../../_static/docs.css" type="text/css" />
                <link rel="stylesheet" href="../../_static/sphinx_paramlinks.css" type="text/css" />
            <!-- end iterate through site-imported + sphinx environment css_files -->
        

        

    

    <!-- begin layout.mako headers -->

    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
        <link rel="copyright" title="Copyright" href="../../copyright.html" />
    <link rel="top" title="SQLAlchemy 2.0 Documentation" href="../../index.html" />
        <link rel="up" title="ORM查询指南" href="index.html" />
        <link rel="next" title="支持 ORM 的 INSERT、UPDATE 和 DELETE 语句" href="dml.html" />
        <link rel="prev" title="用ORM Mapper类编写SELECT语句" href="select.html" />
    <!-- end layout.mako headers -->


    </head>
    <body>
        
















<div id="docs-container">





<div id="docs-top-navigation-container" class="body-background">
<div id="docs-header">
    <div id="docs-version-header">
        Release: <span class="version-num">2.0.19</span>


        | Release Date: July 15, 2023

    </div>

    <h1><a href="../../index.html">SQLAlchemy 2.0 Documentation</a></h1>

</div>
</div>

<div id="docs-body-container">

    <div id="fixed-sidebar" class="withsidebar">



        <div id="docs-sidebar-popout">
            <h3><a href="../../index.html">SQLAlchemy 2.0 Documentation</a></h3>
            <p id="sidebar-topnav">
                <a href="../../index.html">Home</a>
            </p>

            <div id="sidebar-search">
                <form class="search" action="../../search.html" method="get">
                  <label>
                  Search terms:
                  <input type="text" placeholder="search..." name="q" size="12" />
                  </label>
                  <input type="hidden" name="check_keywords" value="yes" />
                  <input type="hidden" name="area" value="default" />
                </form>
            </div>

        </div>

        <div id="docs-sidebar">

        <div id="sidebar-banner">
            
        </div>

        <div id="docs-sidebar-inner">

        
        <h3>
            <a href="../index.html" title="SQLAlchemy ORM">SQLAlchemy ORM</a>
        </h3>

        <ul>
<li><span class="link-container"><a class="reference external" href="../quickstart.html">ORM快速入门</a></span></li>
<li><span class="link-container"><a class="reference external" href="../mapper_config.html">ORM映射类配置</a></span></li>
<li><span class="link-container"><a class="reference external" href="../relationships.html">关系配置</a></span></li>
<li><span class="link-container"><a class="reference external" href="index.html">ORM查询指南</a></span><ul>
<li><span class="link-container"><a class="reference external" href="select.html">用ORM Mapper类编写SELECT语句</a></span></li>
<li class="selected"><span class="link-container"><strong>编写继承映射的SELECT语句</strong><a class="paramlink headerlink reference internal" href="#">¶</a></span><ul>
<li><span class="link-container"><a class="reference external" href="#id1">从基类或特定子类中进行查询</a></span></li>
<li><span class="link-container"><a class="reference external" href="#selectin-polymorphic">使用 selectin_polymorphic()</a></span><ul>
<li><span class="link-container"><a class="reference external" href="#polymorphic-selectin-w-loader-options">将其他加载器选项与 selectin_polymorphic() 子类加载项结合使用</a></span></li>
<li><span class="link-container"><a class="reference external" href="#polymorphic-selectin-as-loader-option-target">将 selectin_polymorphic() 应用于现有急切加载</a></span></li>
<li><span class="link-container"><a class="reference external" href="#id6">将选择 selectin_polymorphic() 工具配置到映射器上</a></span></li>
</ul>
</li>
<li><span class="link-container"><a class="reference external" href="#api">继承加载API</a></span><ul>
<li><span class="link-container"><a class="reference external" href="#sqlalchemy.orm.with_polymorphic"><code class="docutils literal notranslate"><span class="pre">with_polymorphic()</span></code></a></span></li>
<li><span class="link-container"><a class="reference external" href="#sqlalchemy.orm.selectin_polymorphic"><code class="docutils literal notranslate"><span class="pre">selectin_polymorphic()</span></code></a></span></li>
</ul>
</li>
</ul>
</li>
<li><span class="link-container"><a class="reference external" href="dml.html">支持 ORM 的 INSERT、UPDATE 和 DELETE 语句</a></span></li>
<li><span class="link-container"><a class="reference external" href="columns.html">列载入选项</a></span></li>
<li><span class="link-container"><a class="reference external" href="relationships.html">关系属性加载技术</a></span></li>
<li><span class="link-container"><a class="reference external" href="api.html">用于查询的ORM API特性</a></span></li>
<li><span class="link-container"><a class="reference external" href="query.html">旧版查询API</a></span></li>
</ul>
</li>
<li><span class="link-container"><a class="reference external" href="../session.html">使用Session</a></span></li>
<li><span class="link-container"><a class="reference external" href="../extending.html">事件和内部实现</a></span></li>
<li><span class="link-container"><a class="reference external" href="../extensions/index.html">ORM扩展</a></span></li>
<li><span class="link-container"><a class="reference external" href="../examples.html">ORM Examples</a></span></li>
</ul>



        </div>

        </div>

    </div>

    <div id="narrow-index-nav">
        <form class="search" action="../../search.html" method="get">
            <label>
                Search terms:
            <input type="text" placeholder="search..." name="q" size="12" />
            </label>
            <input type="submit" value="Search" />
            <input type="hidden" name="check_keywords" value="yes" />
            <input type="hidden" name="area" value="default" />
        </form>

        <p>
        <a href="../../index.html">Home</a>
        </p>

    </div>


        <div id="docs-narrow-top-navigation">
            <ul>
                <li><b>Previous:</b>
                <a href="select.html" title="previous chapter">用ORM Mapper类编写SELECT语句</a></li>
                <li><b>Next:</b>
                <a href="dml.html" title="next chapter">支持 ORM 的 INSERT、UPDATE 和 DELETE 语句</a></li>

            <li><b>Up:</b> <a href="../../index.html">Home</a></li>
                    <ul><li><a href="../index.html" title="SQLAlchemy ORM">SQLAlchemy ORM</a></li>
                    <ul><li><a href="index.html" title="ORM查询指南">ORM查询指南</a></li>
                </ul>
                </ul>



            <li><b>On this page:</b></li>
            <ul>
<li><a class="reference internal" href="#select">编写继承映射的SELECT语句</a><ul>
<li><a class="reference internal" href="#id1">从基类或特定子类中进行查询</a></li>
<li><a class="reference internal" href="#selectin-polymorphic">使用 selectin_polymorphic()</a><ul>
<li><a class="reference internal" href="#polymorphic-selectin-w-loader-options">将其他加载器选项与 selectin_polymorphic() 子类加载项结合使用</a></li>
<li><a class="reference internal" href="#polymorphic-selectin-as-loader-option-target">将 selectin_polymorphic() 应用于现有急切加载</a></li>
<li><a class="reference internal" href="#id6">将选择 selectin_polymorphic() 工具配置到映射器上</a></li>
</ul>
</li>
<li><a class="reference internal" href="#api">继承加载API</a><ul>
<li><a class="reference internal" href="#sqlalchemy.orm.with_polymorphic"><code class="docutils literal notranslate"><span class="pre">with_polymorphic()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.selectin_polymorphic"><code class="docutils literal notranslate"><span class="pre">selectin_polymorphic()</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>


            </ul>

        </div>



    <div id="docs-body" role="main" class="withsidebar orm-queryguide-inheritance" >
        
<section id="select">
<span id="loading-joined-inheritance"></span><span id="inheritance-loading-toplevel"></span><h1>编写继承映射的SELECT语句<a class="headerlink" href="#select" title="Permalink to this heading">¶</a></h1>
<div class="admonition- admonition">
<p class="admonition-title">关于此文档</p>
<p>本文档使用了：使用 <span class="xref std std-ref">ORM Inheritance</span> 功能来配置的 ORM 映射，
描述于 <span class="xref std std-ref">inheritance_toplevel</span>。笔者将重点介绍 <a class="reference internal" href="../inheritance.html#joined-inheritance"><span class="std std-ref">联接表继承</span></a> ，因为这是最复杂的 ORM 查询案例。</p>
<p><a class="reference internal" href="_inheritance_setup.html"><span class="doc">查看此页面的 ORM 设置</span></a>。</p>
</div>
<section id="id1">
<h2>从基类或特定子类中进行查询<a class="headerlink" href="#id1" title="Permalink to this heading">¶</a></h2>
<p>在查询连接的继承层次结构中的一个类的情况下，SELECT语句将针对类映射到的表以及任何超级表（如果存在），使用JOIN将它们链接在一起。因此，查询将返回所请求类型的对象以及请求类型的任何子类型，使用每行中的 <span class="xref std std-term">discriminator</span> 值来确定正确的类型。下面的查询建立在 <code class="docutils literal notranslate"><span class="pre">Manager</span></code> 子类的 <code class="docutils literal notranslate"><span class="pre">Employee</span></code> 上，然后返回一个结果，其中仅包含类型为Manager的对象:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">select</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">Manager</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">Manager</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">managers</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">scalars</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<div class='show_sql'><span class="k">BEGIN</span><span class="w"> </span><span class="p">(</span><span class="k">implicit</span><span class="p">)</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">manager</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">employee</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">id_1</span><span class="p">,</span><span class="w"> </span><span class="n">employee</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">employee</span><span class="p">.</span><span class="k">type</span><span class="p">,</span><span class="w"> </span><span class="n">employee</span><span class="p">.</span><span class="n">company_id</span><span class="p">,</span><span class="w"> </span><span class="n">manager</span><span class="p">.</span><span class="n">manager_name</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">employee</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">manager</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">employee</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">manager</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">manager</span><span class="p">.</span><span class="n">id</span>
<span class="p">[...]</span><span class="w"> </span><span class="p">()</span>
</div><span class="gp">&gt;&gt;&gt; </span><span class="n">print</span><span class="p">(</span><span class="n">managers</span><span class="p">)</span>
<span class="go">[Manager(&#39;Mr. Krabs&#39;)]</span></pre></div>
</div>
<p>当SELECT语句针对继承层次结构中的基类时，默认情况下，只有该类的表将包括在生成的SQL中，而JOIN不会被使用。在所有情况下， <span class="xref std std-term">discriminator</span> 列用于区分不同的请求子类型，这会导致返回任何可能的子类型的对象。返回的对象将具有对应基表的属性，子表对应属性的状态将从未加载状态开始，访问时自动加载。加载子属性是可配置的，可以以多种方式更加 “eager” 进行，稍后在本节中讨论。</p>
<p>下面的示例创建一个针对 <code class="docutils literal notranslate"><span class="pre">Employee</span></code> 超类的查询。这表明结果集中可能包含任何类型的对象，包括 <code class="docutils literal notranslate"><span class="pre">Manager</span></code>、<code class="docutils literal notranslate"><span class="pre">Engineer</span></code> 和 <code class="docutils literal notranslate"><span class="pre">Employee</span></code> 。</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">select</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">Employee</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">Employee</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">objects</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">scalars</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="go">{execsql}BEGIN (implicit)</span>
<span class="go">SELECT employee.id, employee.name, employee.type, employee.company_id</span>
<span class="go">FROM employee ORDER BY employee.id</span>
<span class="go">[...] ()</span>
<span class="go">{stop}&gt;&gt;&gt; print(objects)</span>
<span class="go">[Manager(&#39;Mr. Krabs&#39;), Engineer(&#39;SpongeBob&#39;), Engineer(&#39;Squidward&#39;)]</span></pre></div>
</div>
<p>在上面的语句中， <code class="docutils literal notranslate"><span class="pre">manager</span></code> 和 <code class="docutils literal notranslate"><span class="pre">engineer</span></code> 的其他表未包含在SELECT中，这意味着返回的对象将不包含代表来自这些表的数据，在本示例中是 <code class="docutils literal notranslate"><span class="pre">.manager_name</span></code> 属性和 <code class="docutils literal notranslate"><span class="pre">.engineer_info</span></code> 属性。这些属性的状态从未加载状态开始，并在访问时自动填充。如果加载的数据很多，则惰性加载并不合适，因为在使用 N+1 问题 时，这会导致每行额外的SQL被访问子类特定的属性。这会影响性能，还与使用 <a class="reference internal" href="../extensions/asyncio.html"><span class="std std-ref">asyncio</span></a> 的方法不兼容。另外，在我们的 <code class="docutils literal notranslate"><span class="pre">Employee</span></code> 对象的查询中，由于查询针对的是基表，我们没有办法以 <code class="docutils literal notranslate"><span class="pre">Manager</span></code> 或 <code class="docutils literal notranslate"><span class="pre">Engineer</span></code> 的术语添加涉及子类特定属性的SQL条件。接下来的两个部分将详细介绍两个构造，它们以不同的方式提供解决这两个问题的解决方案：使用 <code class="xref py py-func docutils literal notranslate"><span class="pre">with_polymorphic()</span></code> 实体构造。</p>
</section>
<section id="selectin-polymorphic">
<span id="polymorphic-selectin"></span><h2>使用 selectin_polymorphic()<a class="headerlink" href="#selectin-polymorphic" title="Permalink to this heading">¶</a></h2>
<p>为了解决访问子类时的性能问题， <code class="xref py py-func docutils literal notranslate"><span class="pre">selectin_polymorphic`加载器选项可用于提前一次性</span> <span class="pre">:term:`eagerly</span> <span class="pre">load()</span></code> 许多对象的额外属性。此加载选项的工作方式类似于 <code class="xref py py-func docutils literal notranslate"><span class="pre">selectinload()</span></code> 关系加载器策略，它对于接收到的行将发出针对子表的额外SELECT语句，使用主键基于WHERE IN查询其他行。</p>
<p>:func:<a href="#id2"><span class="problematic" id="id3">`</span></a>_orm.selectinload`接受查询的基本实体，后跟应为其加载特定属性的该实体的子类所组成的序列:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">selectin_polymorphic</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">loader_opt</span> <span class="o">=</span> <span class="n">selectin_polymorphic</span><span class="p">(</span><span class="n">Employee</span><span class="p">,</span> <span class="p">[</span><span class="n">Manager</span><span class="p">,</span> <span class="n">Engineer</span><span class="p">])</span></pre></div>
</div>
<p>然后将 <a class="reference internal" href="#sqlalchemy.orm.selectin_polymorphic" title="sqlalchemy.orm.selectin_polymorphic"><code class="xref py py-func docutils literal notranslate"><span class="pre">selectin_polymorphic()</span></code></a> 用作加载选项，将其传递到 <a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.Select" title="sqlalchemy.sql.expression.Select"><code class="xref py py-class docutils literal notranslate"><span class="pre">Select</span></code></a> 的: meth:<cite>.Select.options</cite> 方法。示例说明使用 <a class="reference internal" href="#sqlalchemy.orm.selectin_polymorphic" title="sqlalchemy.orm.selectin_polymorphic"><code class="xref py py-func docutils literal notranslate"><span class="pre">selectin_polymorphic()</span></code></a> 来立即加载本地对于 <code class="docutils literal notranslate"><span class="pre">Manager</span></code> 和 <code class="docutils literal notranslate"><span class="pre">Engineer</span></code> 子类的列:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">selectin_polymorphic</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">loader_opt</span> <span class="o">=</span> <span class="n">selectin_polymorphic</span><span class="p">(</span><span class="n">Employee</span><span class="p">,</span> <span class="p">[</span><span class="n">Manager</span><span class="p">,</span> <span class="n">Engineer</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">Employee</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">Employee</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">loader_opt</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">objects</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">scalars</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<div class='show_sql'><span class="k">BEGIN</span><span class="w"> </span><span class="p">(</span><span class="k">implicit</span><span class="p">)</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">employee</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">employee</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">employee</span><span class="p">.</span><span class="k">type</span><span class="p">,</span><span class="w"> </span><span class="n">employee</span><span class="p">.</span><span class="n">company_id</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">employee</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">employee</span><span class="p">.</span><span class="n">id</span>
<span class="p">[...]</span><span class="w"> </span><span class="p">()</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">manager</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">manager_id</span><span class="p">,</span><span class="w"> </span><span class="n">employee</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">employee_id</span><span class="p">,</span>
<span class="n">employee</span><span class="p">.</span><span class="k">type</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">employee_type</span><span class="p">,</span><span class="w"> </span><span class="n">manager</span><span class="p">.</span><span class="n">manager_name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">manager_manager_name</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">employee</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">manager</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">employee</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">manager</span><span class="p">.</span><span class="n">id</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">employee</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="o">?</span><span class="p">)</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">employee</span><span class="p">.</span><span class="n">id</span>
<span class="p">[...]</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,)</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">engineer</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">engineer_id</span><span class="p">,</span><span class="w"> </span><span class="n">employee</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">employee_id</span><span class="p">,</span>
<span class="n">employee</span><span class="p">.</span><span class="k">type</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">employee_type</span><span class="p">,</span><span class="w"> </span><span class="n">engineer</span><span class="p">.</span><span class="n">engineer_info</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">engineer_engineer_info</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">employee</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">engineer</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">employee</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">engineer</span><span class="p">.</span><span class="n">id</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">employee</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="o">?</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="p">)</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">employee</span><span class="p">.</span><span class="n">id</span>
<span class="p">[...]</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span>
</div><span class="gp">&gt;&gt;&gt; </span><span class="n">print</span><span class="p">(</span><span class="n">objects</span><span class="p">)</span>
<span class="go">[Manager(&#39;Mr. Krabs&#39;), Engineer(&#39;SpongeBob&#39;), Engineer(&#39;Squidward&#39;)]</span></pre></div>
</div>
<p>上面的示例说明，为了及时获取额外的属性，发出了两个额外的SELECT语句，例如 <code class="docutils literal notranslate"><span class="pre">Engineer.engineer_info</span></code> ，以及 <code class="docutils literal notranslate"><span class="pre">Manager.manager_name</span></code> 。我们现在可以在加载的对象上访问这些子属性，而不必发出任何其他的SQL语句:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">print</span><span class="p">(</span><span class="n">objects</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">manager_name</span><span class="p">)</span>
<span class="go">Eugene H. Krabs</span></pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p><a class="reference internal" href="#sqlalchemy.orm.selectin_polymorphic" title="sqlalchemy.orm.selectin_polymorphic"><code class="xref py py-func docutils literal notranslate"><span class="pre">selectin_polymorphic()</span></code></a> 加载器选项还未优化基表 <code class="docutils literal notranslate"><span class="pre">employee</span></code> 不需要包含到第二个“eager load”查询中，因此在上面的例子中我们看到从 <code class="docutils literal notranslate"><span class="pre">employee</span></code> 到 <code class="docutils literal notranslate"><span class="pre">manager</span></code> 和 <code class="docutils literal notranslate"><span class="pre">engineer</span></code> 的 JOIN，尽管已经加载了 <code class="docutils literal notranslate"><span class="pre">employee</span></code> 的列。这与 <code class="xref py py-func docutils literal notranslate"><span class="pre">selectinload()</span></code> 关系策略形成对比，在这种情况下，后者更加复杂，可以在不需要时删除JOIN。</p>
</div>
<section id="polymorphic-selectin-w-loader-options">
<span id="id4"></span><h3>将其他加载器选项与 selectin_polymorphic() 子类加载项结合使用<a class="headerlink" href="#polymorphic-selectin-w-loader-options" title="Permalink to this heading">¶</a></h3>
<p>由于 <a class="reference internal" href="#sqlalchemy.orm.selectin_polymorphic" title="sqlalchemy.orm.selectin_polymorphic"><code class="xref py py-func docutils literal notranslate"><span class="pre">selectin_polymorphic()</span></code></a> 生成的SELECT语句本身是ORM语句，因此我们还可以添加其他加载器选项（例如那些在 <span class="xref std std-ref">orm_queryguide_relationship_loaders</span> 中记录的选择器）来更具体地加载子类。例如，如果我们认为 <code class="docutils literal notranslate"><span class="pre">Manager</span></code> 映射有一个 <a class="reference internal" href="../basic_relationships.html#relationship-patterns-o2m"><span class="std std-ref">one to many</span></a> 关系，引用一个名为 <code class="docutils literal notranslate"><span class="pre">Paperwork</span></code> 的实体，我们可以结合使用 <a class="reference internal" href="#sqlalchemy.orm.selectin_polymorphic" title="sqlalchemy.orm.selectin_polymorphic"><code class="xref py py-func docutils literal notranslate"><span class="pre">selectin_polymorphic()</span></code></a> 和 <code class="xref py py-func docutils literal notranslate"><span class="pre">selectinload()</span></code> 来在所有 <code class="docutils literal notranslate"><span class="pre">Manager</span></code> 对象上急切地加载此集合。当情况如此，子属性的加载是特别“急切”的，示例如下:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">selectinload</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">selectin_polymorphic</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="p">(</span>
<span class="go">...     select(Employee)</span>
<span class="go">...     .order_by(Employee.id)</span>
<span class="go">...     .options(</span>
<span class="go">...         selectin_polymorphic(Employee, [Manager, Engineer]),</span>
<span class="go">...         selectinload(Manager.paperwork),</span>
<span class="go">...     )</span>
<span class="go">... )</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">objects</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">scalars</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<div class='show_sql'><span class="k">BEGIN</span><span class="w"> </span><span class="p">(</span><span class="k">implicit</span><span class="p">)</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">employee</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">employee</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">employee</span><span class="p">.</span><span class="k">type</span><span class="p">,</span><span class="w"> </span><span class="n">employee</span><span class="p">.</span><span class="n">company_id</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">employee</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">employee</span><span class="p">.</span><span class="n">id</span>
<span class="p">[...]</span><span class="w"> </span><span class="p">()</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">manager</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">manager_id</span><span class="p">,</span><span class="w"> </span><span class="n">employee</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">employee_id</span><span class="p">,</span><span class="w"> </span><span class="n">employee</span><span class="p">.</span><span class="k">type</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">employee_type</span><span class="p">,</span>
<span class="n">manager</span><span class="p">.</span><span class="n">manager_name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">manager_manager_name</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">employee</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">manager</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">employee</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">manager</span><span class="p">.</span><span class="n">id</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">employee</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="o">?</span><span class="p">)</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">employee</span><span class="p">.</span><span class="n">id</span>
<span class="p">[...]</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,)</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">paperwork</span><span class="p">.</span><span class="n">manager_id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">paperwork_manager_id</span><span class="p">,</span><span class="w"> </span><span class="n">paperwork</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">paperwork_id</span><span class="p">,</span>
<span class="n">paperwork</span><span class="p">.</span><span class="n">document_name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">paperwork_document_name</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">paperwork</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">paperwork</span><span class="p">.</span><span class="n">manager_id</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="o">?</span><span class="p">)</span>
<span class="p">[...]</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,)</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">engineer</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">engineer_id</span><span class="p">,</span>
<span class="n">employee</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">employee_id</span><span class="p">,</span><span class="w"> </span><span class="n">employee</span><span class="p">.</span><span class="k">type</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">employee_type</span><span class="p">,</span>
<span class="n">engineer</span><span class="p">.</span><span class="n">engineer_info</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">engineer_engineer_info</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">employee</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">engineer</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">employee</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">engineer</span><span class="p">.</span><span class="n">id</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">employee</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="o">?</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="p">)</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">employee</span><span class="p">.</span><span class="n">id</span>
<span class="p">[...]</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span>
</div><span class="gp">&gt;&gt;&gt; </span><span class="n">print</span><span class="p">(</span><span class="n">objects</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="go">Manager(&#39;Mr. Krabs&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">print</span><span class="p">(</span><span class="n">objects</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">paperwork</span><span class="p">)</span>
<span class="go">[Paperwork(&#39;Secret Recipes&#39;), Paperwork(&#39;Krabby Patty Orders&#39;)]</span></pre></div>
</div>
</section>
<section id="polymorphic-selectin-as-loader-option-target">
<span id="id5"></span><h3>将 selectin_polymorphic() 应用于现有急切加载<a class="headerlink" href="#polymorphic-selectin-as-loader-option-target" title="Permalink to this heading">¶</a></h3>
<p>除了能够在 <a class="reference internal" href="#sqlalchemy.orm.selectin_polymorphic" title="sqlalchemy.orm.selectin_polymorphic"><code class="xref py py-func docutils literal notranslate"><span class="pre">selectin_polymorphic()</span></code></a> 加载之后添加加载器选项之外，我们还可以指示将 <a class="reference internal" href="#sqlalchemy.orm.selectin_polymorphic" title="sqlalchemy.orm.selectin_polymorphic"><code class="xref py py-func docutils literal notranslate"><span class="pre">selectin_polymorphic()</span></code></a> 应用于现有加载器的目标。在我们的 <a class="reference internal" href="_inheritance_setup.html"><span class="doc">setup</span></a> 映射中包括一个名为 <code class="docutils literal notranslate"><span class="pre">Company</span></code> 的父实体，其 <code class="docutils literal notranslate"><span class="pre">Company.employees</span></code> <code class="xref py py-func docutils literal notranslate"><span class="pre">relationship()</span></code> 引用 <code class="docutils literal notranslate"><span class="pre">Employee</span></code> 实体，我们可以将SELECT针对 <code class="docutils literal notranslate"><span class="pre">公司</span></code> 实体的查询的所有 <code class="docutils literal notranslate"><span class="pre">Employee</span></code> 对象及其子类型的所有属性立即加载，如下所示，使用 <code class="xref py py-meth docutils literal notranslate"><span class="pre">Load.selectin_polymorphic()</span></code> 作为一个链接的加载器选项； 在这种形式中，第一个参数是由前面的加载选项（在这种情况下为 <code class="xref py py-func docutils literal notranslate"><span class="pre">selectinload()</span></code> ）隐含地表示的，因此我们只指定我们希望加载的附加目标子类:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">Company</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span>
<span class="go">...     selectinload(Company.employees).selectin_polymorphic([Manager, Engineer])</span>
<span class="go">... )</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">company</span> <span class="ow">in</span> <span class="n">session</span><span class="o">.</span><span class="n">scalars</span><span class="p">(</span><span class="n">stmt</span><span class="p">):</span>
<span class="go">...     print(f&quot;company: {company.name}&quot;)</span>
<span class="go">...     print(f&quot;employees: {company.employees}&quot;)</span>
<div class='show_sql'><span class="k">SELECT</span><span class="w"> </span><span class="n">company</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">company</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">company</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">company</span><span class="p">.</span><span class="n">id</span>
<span class="p">[...]</span><span class="w"> </span><span class="p">()</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">employee</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">employee_id</span><span class="p">,</span><span class="w"> </span><span class="n">employee</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">employee_name</span><span class="p">,</span>
<span class="n">employee</span><span class="p">.</span><span class="k">type</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">employee_type</span><span class="p">,</span><span class="w"> </span><span class="n">employee</span><span class="p">.</span><span class="n">company_id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">employee_company_id</span><span class="p">,</span>
<span class="n">manager</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">id_1</span><span class="p">,</span><span class="w"> </span><span class="n">manager</span><span class="p">.</span><span class="n">manager_name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">manager_manager_name</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">employee</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">manager</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">employee</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">manager</span><span class="p">.</span><span class="n">id</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">employee</span><span class="p">.</span><span class="n">company_id</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="o">?</span><span class="p">)</span>
<span class="p">[...]</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,)</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">paperwork</span><span class="p">.</span><span class="n">manager_id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">paperwork_manager_id</span><span class="p">,</span><span class="w"> </span><span class="n">paperwork</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">paperwork_id</span><span class="p">,</span>
<span class="n">paperwork</span><span class="p">.</span><span class="n">document_name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">paperwork_document_name</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">paperwork</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">paperwork</span><span class="p">.</span><span class="n">manager_id</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="o">?</span><span class="p">)</span>
<span class="p">[...]</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,)</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">engineer</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">engineer_id</span><span class="p">,</span><span class="w"> </span><span class="n">employee</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">employee_id</span><span class="p">,</span>
<span class="n">employee</span><span class="p">.</span><span class="k">type</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">employee_type</span><span class="p">,</span><span class="w"> </span><span class="n">engineer</span><span class="p">.</span><span class="n">engineer_info</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">engineer_engineer_info</span><span class="p">,</span>
<span class="n">employee</span><span class="p">.</span><span class="n">company_id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">employee_company_id</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">employee</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">engineer</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">employee</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">engineer</span><span class="p">.</span><span class="n">id</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">employee</span><span class="p">.</span><span class="n">company_id</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="o">?</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="p">)</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">employee</span><span class="p">.</span><span class="n">id</span>
<span class="p">[...]</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span>
</div><span class="go">company: Krusty Krab</span>
<span class="go">employees: [Manager(&#39;Mr. Krabs&#39;), Engineer(&#39;SpongeBob&#39;), Engineer(&#39;Squidward&#39;)]</span></pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><span class="xref std std-ref">eagerloading_polymorphic_subtypes</span> - 演示使用 <a class="reference internal" href="#sqlalchemy.orm.with_polymorphic" title="sqlalchemy.orm.with_polymorphic"><code class="xref py py-func docutils literal notranslate"><span class="pre">with_polymorphic()</span></code></a> 配置的等效示例。</p>
</div>
</section>
<section id="id6">
<h3>将选择 selectin_polymorphic() 工具配置到映射器上<a class="headerlink" href="#id6" title="Permalink to this heading">¶</a></h3>
<p><a class="reference internal" href="#sqlalchemy.orm.selectin_polymorphic" title="sqlalchemy.orm.selectin_polymorphic"><code class="xref py py-func docutils literal notranslate"><span class="pre">selectin_polymorphic()</span></code></a> 的行为可以在$特定映射器上进行配置，以便默认情况下进行，使用 <code class="xref py py-paramref docutils literal notranslate"><span class="pre">mapper.with_polymorphic</span></code> 参数，在基类上进行配置或使用每个子类的 <code class="xref py py-paramref docutils literal notranslate"><span class="pre">Mapper.polymorphic_load</span></code> 参数，传递值 <code class="docutils literal notranslate"><span class="pre">&quot;selectin&quot;</span></code> 。</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>对于加入的映射，更喜欢在查询中显式使用
<a class="reference internal" href="#sqlalchemy.orm.with_polymorphic" title="sqlalchemy.orm.with_polymorphic"><code class="xref py py-func docutils literal notranslate"><span class="pre">with_polymorphic()</span></code></a> 或在 <code class="xref py py-paramref docutils literal notranslate"><span class="pre">Mapper.polymorphic_load</span></code> 中使用值为 <code class="docutils literal notranslate"><span class="pre">&quot;selectin&quot;</span></code> 的方式进行隐式子类加载，而不是在本节中描述的映射器级：paramref:<cite>.mapper.with_polymorphic</cite> 参数的方法。此参数会调用旨在重写SELECT语句中的FROM子句的复杂启发式方法，可能会干扰构造更复杂的语句，特别是对于引用相同映射实体的嵌套子查询。</p>
</div>
<p>例如，我们可以在以下情况下表示我们的“Employee”映射，使用 <code class="docutils literal notranslate"><span class="pre">&quot;inline&quot;</span></code>：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Employee</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;employee&quot;</span>
    <span class="n">id</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">))</span>
    <span class="n">type</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">))</span>

    <span class="n">__mapper_args__</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;polymorphic_identity&quot;</span><span class="p">:</span> <span class="s2">&quot;employee&quot;</span><span class="p">,</span> <span class="s2">&quot;polymorphic_on&quot;</span><span class="p">:</span> <span class="n">type</span><span class="p">}</span>


<span class="k">class</span> <span class="nc">Engineer</span><span class="p">(</span><span class="n">Employee</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;engineer&quot;</span>
    <span class="n">id</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">ForeignKey</span><span class="p">(</span><span class="s2">&quot;employee.id&quot;</span><span class="p">),</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">engineer_info</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">30</span><span class="p">))</span>

    <span class="n">__mapper_args__</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;polymorphic_load&quot;</span><span class="p">:</span> <span class="s2">&quot;inline&quot;</span><span class="p">,</span>
        <span class="s2">&quot;polymorphic_identity&quot;</span><span class="p">:</span> <span class="s2">&quot;engineer&quot;</span><span class="p">,</span>
    <span class="p">}</span>


<span class="k">class</span> <span class="nc">Manager</span><span class="p">(</span><span class="n">Employee</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;manager&quot;</span>
    <span class="n">id</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">ForeignKey</span><span class="p">(</span><span class="s2">&quot;employee.id&quot;</span><span class="p">),</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">manager_name</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">30</span><span class="p">))</span>

    <span class="n">__mapper_args__</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;polymorphic_load&quot;</span><span class="p">:</span> <span class="s2">&quot;inline&quot;</span><span class="p">,</span>
        <span class="s2">&quot;polymorphic_identity&quot;</span><span class="p">:</span> <span class="s2">&quot;manager&quot;</span><span class="p">,</span>
    <span class="p">}</span></pre><div class="code-non-annotations-key"></div></div>
</div>
<p>在上述映射中，对于 <code class="docutils literal notranslate"><span class="pre">Employee</span></code> 类型的SELECT语句将自动在发出语句时使用 <code class="docutils literal notranslate"><span class="pre">with_polymorphic(Employee,</span> <span class="pre">[Engineer,</span> <span class="pre">Manager])</span></code> 作为主实体。:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="go">print(select(Employee))</span>
<div class='show_sql_print'><span class="k">SELECT</span><span class="w"> </span><span class="n">employee</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">employee</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">employee</span><span class="p">.</span><span class="k">type</span><span class="p">,</span><span class="w"> </span><span class="n">engineer</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">id_1</span><span class="p">,</span>
<span class="n">engineer</span><span class="p">.</span><span class="n">engineer_info</span><span class="p">,</span><span class="w"> </span><span class="n">manager</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">id_2</span><span class="p">,</span><span class="w"> </span><span class="n">manager</span><span class="p">.</span><span class="n">manager_name</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">employee</span>
<span class="k">LEFT</span><span class="w"> </span><span class="k">OUTER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">engineer</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">employee</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">engineer</span><span class="p">.</span><span class="n">id</span>
<span class="k">LEFT</span><span class="w"> </span><span class="k">OUTER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">manager</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">employee</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">manager</span><span class="p">.</span><span class="n">id</span>
</div></pre></div>
</div>
<p>当使用映射器级“with polymorphic”时，查询还可以直接引用子类实体，其中它们隐式地表示多态查询中的连接表。在上述示例中，我们可以自由地引用 <code class="docutils literal notranslate"><span class="pre">Manager</span></code> 和 <code class="docutils literal notranslate"><span class="pre">Engineer</span></code> 直接返回默认 <code class="docutils literal notranslate"><span class="pre">Employee</span></code> 实体:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="go">print(</span>
<span class="go">    select(Employee).where(</span>
<span class="go">        or_(Manager.manager_name == &quot;x&quot;, Engineer.engineer_info == &quot;y&quot;)</span>
<span class="go">    )</span>
<span class="go">)</span></pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">`{printsql}SELECT</span> <span class="pre">employee.id,</span> <span class="pre">employee.name,</span> <span class="pre">employee.type,</span> <span class="pre">engineer.id</span> <span class="pre">AS</span> <span class="pre">id_1,</span>
<span class="pre">engineer.engineer_info,</span> <span class="pre">manager.id</span> <span class="pre">AS</span> <span class="pre">id_2,</span> <span class="pre">manager.manager_name</span> <span class="pre">FROM</span> <span class="pre">employee</span>
<span class="pre">LEFT</span> <span class="pre">OUTER</span> <span class="pre">JOIN</span> <span class="pre">engineer</span> <span class="pre">ON</span> <span class="pre">employee.id</span> <span class="pre">=</span> <span class="pre">engineer.id</span>
<span class="pre">LEFT</span> <span class="pre">OUTER</span> <span class="pre">JOIN</span> <span class="pre">manager</span> <span class="pre">ON</span> <span class="pre">employee.id</span> <span class="pre">=</span> <span class="pre">manager.id</span>
<span class="pre">WHERE</span> <span class="pre">manager.manager_name</span> <span class="pre">=</span> <span class="pre">:manager_name_1</span> <span class="pre">OR</span> <span class="pre">engineer.engineer_info</span> <span class="pre">=</span> <span class="pre">:engineer_info_1`</span></code></p>
<p>然而，如果我们需要在不同的别名上下文中引用“Employee”实体或其子实体，我们将再次直接使用:func：<a href="#id7"><span class="problematic" id="id8">`</span></a>_orm.with_polymorphic`来定义这些别名实体，如在:ref：<a href="#id9"><span class="problematic" id="id10">`</span></a>with_polymorphic_aliasing`中所示。</p>
<p>为了更集中地控制多态可选项，可使用更遗留的映射器级多态控制形式，即配置在基类上的：paramref：<a href="#id11"><span class="problematic" id="id12">`</span></a>_orm.Mapper.with_polymorphic`参数。此参数接受与:func：<a href="#id13"><span class="problematic" id="id14">`</span></a>_orm.with_polymorphic`构造可比较的参数，但使用联接继承映射的常见用法是纯星号，表示应LEFT OUTER JOIN所有子表，如下所示：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">类Employee</span><span class="err">（</span><span class="n">基类</span><span class="err">）：</span>
    <span class="n">__tablename__</span> <span class="o">=</span><span class="err">“</span><span class="n">employee</span><span class="err">”</span>
    <span class="n">id</span> <span class="o">=</span><span class="n">映射列</span><span class="err">（</span><span class="n">整数</span><span class="err">，</span><span class="n">primary_key</span> <span class="o">=</span> <span class="kc">True</span><span class="err">）</span>
    <span class="n">name</span> <span class="o">=</span><span class="n">映射列</span><span class="err">（</span><span class="n">字符串</span><span class="err">（</span><span class="mi">50</span><span class="err">））</span>
    <span class="n">type</span> <span class="o">=</span><span class="n">映射列</span><span class="err">（</span><span class="n">字符串</span><span class="err">（</span><span class="mi">50</span><span class="err">））</span>

    <span class="n">__mapper_args__</span> <span class="o">=</span> <span class="p">{</span>
        <span class="err">“</span><span class="n">polymorphic_identity</span><span class="err">”：“</span><span class="n">employee</span><span class="err">”，</span>
        <span class="err">“</span><span class="n">with_polymorphic</span><span class="err">”：“</span><span class="o">*</span><span class="err">”，</span>
        <span class="err">“</span><span class="n">polymorphic_on</span><span class="err">”：</span><span class="n">type</span><span class="err">，</span>
    <span class="p">}</span>


<span class="n">类工程师</span><span class="err">（</span><span class="n">员工</span><span class="err">）：</span>
    <span class="n">__tablename__</span> <span class="o">=</span><span class="err">“</span><span class="n">engineer</span><span class="err">”</span>
    <span class="n">id</span> <span class="o">=</span><span class="n">映射列</span><span class="err">（</span><span class="n">整数</span><span class="err">，</span><span class="n">ForeignKey</span><span class="err">（“</span><span class="n">employee</span><span class="o">.</span><span class="n">id</span><span class="err">”），</span><span class="n">primary_key</span> <span class="o">=</span> <span class="kc">True</span><span class="err">）</span>
    <span class="n">engineer_info</span> <span class="o">=</span><span class="n">映射列</span><span class="err">（</span><span class="n">字符串</span><span class="err">（</span><span class="mi">30</span><span class="err">））</span>

    <span class="n">__mapper_args__</span> <span class="o">=</span> <span class="p">{</span>
        <span class="err">“</span><span class="n">polymorphic_identity</span><span class="err">”：“</span><span class="n">engineer</span><span class="err">”，</span>
    <span class="p">}</span>


<span class="n">类经理</span><span class="err">（</span><span class="n">员工</span><span class="err">）：</span>
    <span class="n">__tablename__</span> <span class="o">=</span><span class="err">“</span><span class="n">manager</span><span class="err">”</span>
    <span class="n">id</span> <span class="o">=</span><span class="n">映射列</span><span class="err">（</span><span class="n">整数</span><span class="err">，</span><span class="n">ForeignKey</span><span class="err">（“</span><span class="n">employee</span><span class="o">.</span><span class="n">id</span><span class="err">”），</span><span class="n">primary_key</span> <span class="o">=</span> <span class="kc">True</span><span class="err">）</span>
    <span class="n">manager_name</span> <span class="o">=</span><span class="n">映射列</span><span class="err">（</span><span class="n">字符串</span><span class="err">（</span><span class="mi">30</span><span class="err">））</span>

    <span class="n">__mapper_args__</span> <span class="o">=</span> <span class="p">{</span>
        <span class="err">“</span><span class="n">polymorphic_identity</span><span class="err">”：“</span><span class="n">manager</span><span class="err">”，</span>
    <span class="p">}</span></pre></div>
</div>
<p>总的来说，：func：<cite>_orm.with_polymorphic`使用的LEFT OUTER JOIN格式和选项（例如：paramref：`_orm.Mapper.with_polymorphic</cite>）在SQL和数据库优化器方面可能很繁琐；对于加载已加入继承映射中的子类属性，应优先使用：func：<cite>_orm.selectin_polymorphic`方法或将其映射器级等效设置为：paramref：`_orm.Mapper.polymorphic_load`为“selectin”，仅在需要每个查询时根据需要使用:func：`_orm.with_polymorphic</cite>。</p>
<p id="inheritance-of-type">加入特定的子类型或带多态()的实体
————————————————– ————</p>
<p>由于:func：<cite>_orm.with_polymorphic`实体是:func：`_orm.aliased`的一个特殊情况，因此为了将多态实体作为联接的目标处理，特别是在使用: 唐：`_orm.relationship`构造作为ON子句时，使用与常规别名相同的技术如下清楚地列出了在:ref： `orm_queryguide_joining_relationships_aliased`中。 最简洁的方法是使用:meth：`_orm.PropComparator.of_type</cite>。 在下面的示例中，我们展示了从父“Company”实体沿“Company.employees”的一对多关系连接，后者在:doc帮助下进行配置&lt;_inheritance_setup&gt;`链接到“Employee”对象， 并使用:func：<a href="#id15"><span class="problematic" id="id16">`</span></a>_orm.with_polymorphic`实体作为目标:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="go">＆gt;＆gt;＆gt; employee_plus_engineer = with_polymorphic（Employee，[Engineer]）</span>
<span class="go">＆gt;＆gt;＆gt; stmt = (</span>
<span class="go">...     select（Company.name，employee_plus_engineer.name）</span>
<span class="go">...     .join（Company.employees.of_type（employee_plus_engineer））</span>
<span class="go">...     .where（</span>
<span class="go">...         or_（</span>
<span class="go">...             employee_plus_engineer.name ==“SpongeBob”，</span>
<span class="go">...             employee_plus_engineer.Engineer.engineer_info</span>
<span class="go">...             ==“Senior Customer Engagement Engineer”，</span>
<span class="go">...         ）</span>
<span class="go">...     ）</span>
<span class="go">... ）</span>
<span class="go">＆gt;＆gt;＆gt; for company_name，emp_name in session.execute（stmt）：</span>
<span class="go">...     print（f“ {company_name} {emp_name}”）</span>
<div class='show_sql'><span class="k">SELECT</span><span class="w"> </span><span class="n">company</span><span class="p">.</span><span class="n">name</span><span class="err">，</span><span class="n">employee</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">name_1</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">company</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="err">（</span><span class="n">employee</span><span class="w"> </span><span class="k">LEFT</span><span class="w"> </span><span class="k">OUTER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">engineer</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">employee</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">engineer</span><span class="p">.</span><span class="n">id</span><span class="err">）</span><span class="k">ON</span><span class="w"> </span><span class="n">company</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">employee</span><span class="p">.</span><span class="n">company_id</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">employee</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="err">？或</span><span class="n">engineer</span><span class="p">.</span><span class="n">engineer_info</span><span class="w"> </span><span class="o">=</span><span class="err">？</span>
<span class="p">[...]</span><span class="err">（</span><span class="s1">&#39;SpongeBob&#39;</span><span class="err">，</span><span class="s1">&#39;Senior Customer Engagement Engineer&#39;</span><span class="err">）</span>
</div><span class="go">Krusty Krab SpongeBob</span>
<span class="go">Krusty Krab Squidward</span></pre></div>
</div>
<p>更直接的是，: meth：<a href="#id17"><span class="problematic" id="id18">`</span></a>_orm.PropComparator.of_type`也用于任何类型的继承映射，以将对: func：<a href="#id19"><span class="problematic" id="id20">`</span></a>_orm.relationship`的联接限制为其目标的特定子类型。 上面的查询可以严格按照以下方式编写：作为“工程师”目标:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="go">＆gt;＆gt;＆gt; stmt = (</span>
<span class="go">...     select（Company.name，Engineer.name）</span>
<span class="go">...     .join（Company.employees.of_type（Engineer））</span>
<span class="go">...     .where（</span>
<span class="go">...         or_（</span>
<span class="go">...             Engineer.name ==“SpongeBob”，</span>
<span class="go">...             Engineer.engineer_info ==“高级客户参与工程师”，</span>
<span class="go">...         ）</span>
<span class="go">...     ）</span>
<span class="go">... ）</span>
<span class="go">＆gt;＆gt;＆gt; for company_name，emp_name in session.execute（stmt）：</span>
<span class="go">...     print（f“ {company_name} {emp_name}”）</span>
<div class='show_sql'><span class="k">SELECT</span><span class="w"> </span><span class="n">company</span><span class="p">.</span><span class="n">name</span><span class="err">，</span><span class="n">employee</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">name_1</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">company</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="err">（</span><span class="n">employee</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">engineer</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">employee</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">engineer</span><span class="p">.</span><span class="n">id</span><span class="err">）</span><span class="k">ON</span><span class="w"> </span><span class="n">company</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">employee</span><span class="p">.</span><span class="n">company_id</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">employee</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="err">？或</span><span class="n">engineer</span><span class="p">.</span><span class="n">engineer_info</span><span class="w"> </span><span class="o">=</span><span class="err">？</span>
<span class="p">[...]</span><span class="err">（</span><span class="s1">&#39;SpongeBob&#39;</span><span class="err">，</span><span class="s1">&#39;Senior Customer Engagement Engineer&#39;</span><span class="err">）</span>
</div><span class="go">Krusty Krab SpongeBob</span>
<span class="go">Krusty Krab Squidward</span></pre></div>
</div>
<p>可以观察到以上，“工程师”目标的直接加入使用内部JOIN，而不是LEFT OUTER JOIN，SQL优化器通常会从SQL优化器角度考虑，更具性能。</p>
<p id="eagerloading-polymorphic-subtypes">通过急切地加载多态子类型来</p>
<p>可使用:meth：<cite>_orm.PropComparator.of_type`与继承映射的任何类型等效地将多态实体应用到:ref：`relationship loader options &lt;orm_queryguide_relationship_loaders&gt;</cite>，例如:func： <cite>_orm.selectinload`和:func：`_orm.joinedload</cite>。</p>
<p>例如，如果我们想要加载“Company”对象，并使用：func：<a href="#id21"><span class="problematic" id="id22">`</span></a>_orm.with_polymorphic`构造对整个层次结构进行快速加载，我们可以写成:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="go">＆gt;＆gt;＆gt; all_employees = with_polymorphic（Employee，“*”）</span>
<span class="go">＆gt;＆gt;＆gt; stmt = select（Company）。options（selectinload（Company.employees.of_type（all_employees）））</span>
<span class="go">＆gt;＆gt;＆gt; for company in session.scalars（stmt）：</span>
<span class="go">...     print（f“company：{company.name}”）</span>
<span class="go">...     print（f“employees：{company.employees}”）</span>
<div class='show_sql'><span class="k">SELECT</span><span class="w"> </span><span class="n">company</span><span class="p">.</span><span class="n">id</span><span class="err">，</span><span class="n">company</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">company</span>
<span class="p">[...]</span><span class="err">（）</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">employee</span><span class="p">.</span><span class="n">company_id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">employee_company_id</span><span class="err">，</span><span class="n">employee</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">employee_id</span><span class="err">，</span><span class="n">employee</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">employee_name</span><span class="err">，</span><span class="n">employee</span><span class="p">.</span><span class="k">type</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">employee_type</span><span class="err">，</span><span class="n">manager</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">manager_id</span><span class="err">，</span><span class="n">manager</span><span class="p">.</span><span class="n">manager_name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">manager_manager_name</span><span class="err">，</span><span class="n">engineer</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">engineer_id</span><span class="err">，</span><span class="n">engineer</span><span class="p">.</span><span class="n">engineer_info</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">engineer_engineer_info</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">employee</span><span class="w"> </span><span class="k">LEFT</span><span class="w"> </span><span class="k">OUTER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">manager</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">employee</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">manager</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">LEFT</span><span class="w"> </span><span class="k">OUTER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">engineer</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">employee</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">engineer</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">employee</span><span class="p">.</span><span class="n">company_id</span><span class="w"> </span><span class="k">IN</span><span class="err">（？）</span>
<span class="p">[...]</span><span class="err">（</span><span class="mi">1</span><span class="err">，）</span>
<span class="n">company</span><span class="err">：</span><span class="n">Krusty</span><span class="w"> </span><span class="n">Krab</span>
<span class="n">employees</span><span class="err">：</span><span class="p">[</span><span class="n">Manager</span><span class="err">（</span><span class="s1">&#39;Mr. Krabs&#39;</span><span class="err">），</span><span class="n">Engineer</span><span class="err">（</span><span class="s1">&#39;SpongeBob&#39;</span><span class="err">），</span><span class="n">Engineer</span><span class="err">（</span><span class="s1">&#39;Squidward&#39;</span><span class="err">）</span><span class="p">]</span>
</div></pre></div>
</div>
<p>可以将上述查询直接与在前一节:ref：<a href="#id23"><span class="problematic" id="id24">`</span></a>polymorphic_selectin_as_loader_option_target`中说明的使用: func: <a href="#id25"><span class="problematic" id="id26">`</span></a>_orm.selectin_polymorphic`的版本进行比较。</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>:ref：<cite>polymorphic_selectin_as_loader_option_target</cite>-举例说明了
与上述相同的示例，使用：func：<a href="#id27"><span class="problematic" id="id28">`</span></a>_orm.selectin_polymorphic`代替</p>
</div>
<p>用于单继承映射的SELECT语句
————————————————– ————-</p>
<p>..设置代码，不显示</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">session</span><span class="o">.</span><span class="n">close</span><span class="err">（）</span>
<span class="go">ROLLBACK</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="err">（）</span></pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>单表继承设置</p>
<p>这一部分讨论了单表继承，
描述在：ref：<a href="#id29"><span class="problematic" id="id30">`</span></a>single_inheritance`中，使用单个表表示层次结构中的多个类。</p>
<p>:doc：<cite>查看此部分的ORM设置 &lt;_single_inheritance&gt;</cite>。</p>
</div>
<p>与加入继承映射不同，单继承映射的SELECT语句的构建趋向于更简单，因为对于全单继承层次结构，只有一个表格。</p>
<p>无论继承层次结构是否全部为单继承，查询基类与子类之间的查询的SELECT语句均可通过添加附加的WHERE条件来进行区分。</p>
<p>例如，将加载类型为“Manager”，“Engineer”和“Employee”的单继承示例映射为“Employee”的查询将使用表的简单SELECT:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="err">（</span><span class="n">Employee</span><span class="err">）</span><span class="o">.</span><span class="n">order_by</span><span class="err">（</span><span class="n">Employee</span><span class="o">.</span><span class="n">id</span><span class="err">）</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">session</span><span class="o">.</span><span class="n">scalars</span><span class="err">（</span><span class="n">stmt</span><span class="err">）：</span>
<span class="go">...     print（f“{obj}”）</span>
<div class='show_sql'><span class="k">BEGIN</span><span class="err">（</span><span class="k">implicit</span><span class="err">）</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">employee</span><span class="p">.</span><span class="n">id</span><span class="err">，</span><span class="n">employee</span><span class="p">.</span><span class="n">name</span><span class="err">，</span><span class="n">employee</span><span class="p">.</span><span class="k">type</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">employee</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">employee</span><span class="p">.</span><span class="n">id</span>
<span class="p">[...]</span><span class="err">（）</span>
</div><span class="go">Manager（&#39;Mr. Krabs&#39;）</span>
<span class="go">Engineer（&#39;SpongeBob&#39;）</span>
<span class="go">Engineer（&#39;Squidward&#39;）</span></pre></div>
</div>
<p>针对特定的子类发出负载时，可能会向SELECT添加其他条件以限制行，例如下面针对“工程师”实体执行的SELECT：¶</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="err">（</span><span class="n">Engineer</span><span class="err">）</span><span class="o">.</span><span class="n">order_by</span><span class="err">（</span><span class="n">Engineer</span><span class="o">.</span><span class="n">id</span><span class="err">）</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">objects</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">scalars</span><span class="err">（</span><span class="n">stmt</span><span class="err">）</span><span class="o">.</span><span class="n">all</span><span class="err">（）</span>
<span class="go">{execsql}SELECT employee.id，employee.name，employee.type，employee.engineer_info</span>
<span class="go">FROM employee</span>
<span class="go">WHERE employee.type IN（？）ORDER BY employee.id</span>
<span class="go">[...]（&#39;engineer&#39;，）</span>
<span class="go">{stop}&gt;&gt;&gt; for obj in objects：</span>
<span class="go">...     print（f“{obj}”）</span>
<span class="go">Engineer（&#39;SpongeBob&#39;）</span>
<span class="go">Engineer（&#39;Squidward&#39;）</span></pre></div>
</div>
<p>单继承映射的默认行为与加入继承相同，即默认情况下仍通过第二个SELECT发出特定于子类的属性。 在下面的示例中，加载类型为“Manager”的单个“Employee”对象，但由于请求的类是“Employee”，因此默认情况下不包含“Manager.manager_name”属性，当它被访问时发出一个附加的SELECT链接:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">mr_krabs</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">scalars</span><span class="err">（</span><span class="n">select</span><span class="err">（</span><span class="n">Employee</span><span class="err">）。</span><span class="n">where</span><span class="err">（</span><span class="n">Employee</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span><span class="err">“</span><span class="n">Mr</span><span class="o">.</span> <span class="n">Krabs</span><span class="err">”））。</span><span class="n">one</span><span class="err">（）</span>
<div class='show_sql'><span class="k">BEGIN</span><span class="err">（</span><span class="k">implicit</span><span class="err">）</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">employee</span><span class="p">.</span><span class="n">id</span><span class="err">，</span><span class="n">employee</span><span class="p">.</span><span class="n">name</span><span class="err">，</span><span class="n">employee</span><span class="p">.</span><span class="k">type</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">employee</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">employee</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="err">？</span>
<span class="p">[...]</span><span class="w"> </span><span class="err">（</span><span class="s1">&#39;Mr. Krabs&#39;</span><span class="err">，）</span>
</div><span class="gp">&gt;&gt;&gt; </span><span class="n">mr_krabs</span><span class="o">.</span><span class="n">manager_name</span>
<div class='show_sql'><span class="k">SELECT</span><span class="w"> </span><span class="n">employee</span><span class="p">.</span><span class="n">manager_name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">employee_manager_name</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">employee</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">employee</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="err">？</span><span class="w"> </span><span class="err">和</span><span class="n">employee</span><span class="p">.</span><span class="k">type</span><span class="w"> </span><span class="k">in</span><span class="err">（？）</span>
<span class="p">[...]</span><span class="w"> </span><span class="err">（</span><span class="mi">1</span><span class="err">，</span><span class="s1">&#39;manager&#39;</span><span class="err">）</span>
</div><span class="go">&#39;Eugene H. Krabs&#39;</span></pre></div>
</div>
<p>要更改此行为，与加入继承加载中使用的相同的常规概念适用于单继承，包括使用:func：_orm选择in_polymorphic选项以及使用:func：_orm.with_polymorphic选项，后者仅包括附加列，并且从SQL的角度来看更加有效效为：</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">employees</span> <span class="o">=</span> <span class="n">with_polymorphic</span><span class="err">（</span><span class="n">Employee</span><span class="err">，“</span><span class="o">*</span><span class="err">”）</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="err">（</span><span class="n">employees</span><span class="err">）。</span><span class="n">order_by</span><span class="err">（</span><span class="n">employees</span><span class="o">.</span><span class="n">id</span><span class="err">）</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">objects</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">scalars</span><span class="err">（</span><span class="n">stmt</span><span class="err">）</span><span class="o">.</span><span class="n">all</span><span class="err">（）</span>
<span class="go">{execsql}BEGIN（implicit）</span>
<span class="go">SELECT employee.id，employee.name，employee.type，</span>
<span class="go">employee.manager_name，employee.engineer_info</span>
<span class="go">FROM employee ORDER BY employee.id</span>
<span class="go">[...]（）</span>
<span class="go">{stop}&gt;&gt;&gt; for obj in objects：</span>
<span class="go">...     print（f“{obj}””）</span>
<span class="go">Manager（&#39;Mr. Krabs&#39;）</span>
<span class="go">Engineer（&#39;SpongeBob&#39;）</span>
<span class="go">Engineer（&#39;Squidward&#39;）</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">objects</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">.</span><span class="n">manager_name</span>
<span class="go">&#39;Eugene H. Krabs&#39;</span></pre></div>
</div>
<p>由于加载单继承子类映射的开销通常很小，因此建议对单继承映射包括:paramref：<cite>_orm.Mapper.polymorphic_load`参数，具有“inline”设置那些子类，其中预期其特定子类属性的加载是常见的。 下面的示例说明:doc：`设置 &lt;_single_inheritance&gt;</cite>，修改以包含此选项。</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">Base</span><span class="err">（</span><span class="n">DeclarativeBase</span><span class="err">）：</span>
<span class="gp">... </span>   <span class="n">过去</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">Employee</span><span class="err">（</span><span class="n">Base</span><span class="err">）：</span>
<span class="gp">... </span>    <span class="n">__tablename__</span> <span class="o">=</span><span class="err">“</span><span class="n">employee</span><span class="err">”</span>
<span class="gp">... </span>    <span class="n">id</span><span class="err">：</span><span class="n">Mapped</span> <span class="p">[</span><span class="n">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="err">（</span><span class="n">primary_key</span> <span class="o">=</span> <span class="kc">True</span><span class="err">）</span>
<span class="gp">... </span>    <span class="n">name</span><span class="err">：</span><span class="n">Mapped</span> <span class="p">[</span><span class="n">str</span><span class="p">]</span>
<span class="gp">... </span>    <span class="n">type</span><span class="err">：</span><span class="n">Mapped</span> <span class="p">[</span><span class="n">str</span><span class="p">]</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="fm">__repr__</span><span class="err">（</span><span class="bp">self</span><span class="err">）：</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="n">f</span><span class="err">“</span><span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">_name__</span><span class="p">}</span><span class="err">（</span><span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="err">！</span><span class="n">r</span><span class="p">}</span><span class="err">）”</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="n">__mapper_args__</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>        <span class="err">“</span><span class="n">polymorphic_identity</span><span class="err">”：“</span><span class="n">employee</span><span class="err">”，</span>
<span class="gp">... </span>        <span class="err">“</span><span class="n">polymorphic_on</span><span class="err">”：“</span><span class="n">type</span><span class="err">”，</span>
<span class="gp">... </span>    <span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">Manager</span><span class="err">（</span><span class="n">Employee</span><span class="err">）：</span>
<span class="gp">... </span>    <span class="n">manager_name</span><span class="err">：</span><span class="n">Mapped</span> <span class="p">[</span><span class="n">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="err">（</span><span class="n">nullable</span> <span class="o">=</span> <span class="kc">True</span><span class="err">）</span>
<span class="gp">... </span>    <span class="n">__mapper_args__</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>        <span class="err">“</span><span class="n">polymorphic_identity</span><span class="err">”：“</span><span class="n">manager</span><span class="err">”，</span>
<span class="gp">... </span>        <span class="err">“</span><span class="n">polymorphic_load</span><span class="err">”：“</span><span class="n">inline</span><span class="err">”，</span>
<span class="gp">... </span>    <span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">Engineer</span><span class="err">（</span><span class="n">Employee</span><span class="err">）：</span>
<span class="gp">... </span>    <span class="n">engineer_info</span><span class="err">：</span><span class="n">Mapped</span> <span class="p">[</span><span class="n">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="err">（</span><span class="n">nullable</span> <span class="o">=</span> <span class="kc">True</span><span class="err">）</span>
<span class="gp">... </span>    <span class="n">__mapper_args__</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>        <span class="err">“</span><span class="n">polymorphic_identity</span><span class="err">”：“</span><span class="n">engineer</span><span class="err">”，</span>
<span class="gp">... </span>        <span class="err">“</span><span class="n">polymorphic_load</span><span class="err">”：“</span><span class="n">inline</span><span class="err">”，</span>
<span class="gp">... </span>    <span class="p">}</span></pre><div class="code-non-annotations-key"></div></div>
</div>
<p>以上映射表明，“Manager”和“Engineer”类的列将自动包含在针对“ Employee”实体的SELECT语句中：</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">print</span><span class="err">（</span><span class="n">select</span><span class="err">（</span><span class="n">Employee</span><span class="err">））</span>
<span class="go">{printsql}SELECT employee.id，employee.name，employee.type，</span>
<span class="go">employee.manager_name，employee.engineer_info</span>
<span class="go">FROM employee</span></pre></div>
</div>
</section>
</section>
<section id="api">
<h2>继承加载API<a class="headerlink" href="#api" title="Permalink to this heading">¶</a></h2>
<table class="longtable docutils align-default">
<thead>
<tr class="row-odd"><th class="head">Object Name</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.orm.selectin_polymorphic"><span class="sig-name descname">selectin_polymorphic</span></a>(base_cls, classes)</p></td>
<td><p>Indicate an eager load should take place for all attributes
specific to a subclass.</p></td>
</tr>
<tr class="row-odd"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.orm.with_polymorphic"><span class="sig-name descname">with_polymorphic</span></a>(base, classes[, selectable, flat, ...])</p></td>
<td><p>Produce an <a class="reference internal" href="api.html#sqlalchemy.orm.util.AliasedClass" title="sqlalchemy.orm.util.AliasedClass"><code class="xref py py-class docutils literal notranslate"><span class="pre">AliasedClass</span></code></a> construct which specifies
columns for descendant mappers of the given base.</p></td>
</tr>
</tbody>
</table>
<dl class="py function">
<dt class="sig sig-object py" id="sqlalchemy.orm.with_polymorphic">
<em class="property"><span class="pre">function</span> </em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.orm.</span></span><span class="sig-name descname"><span class="pre">with_polymorphic</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">base</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Type</span><span class="p"><span class="pre">[</span></span><span class="pre">_O</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Mapper</span><span class="p"><span class="pre">[</span></span><span class="pre">_O</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">classes</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Literal</span><span class="p"><span class="pre">[</span></span><span class="s"><span class="pre">'*'</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Iterable</span><span class="p"><span class="pre">[</span></span><span class="pre">Type</span><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">selectable</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Literal</span><span class="p"><span class="pre">[</span></span><span class="k"><span class="pre">False</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">None</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.FromClause" title="sqlalchemy.sql.expression.FromClause"><span class="pre">FromClause</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">flat</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">polymorphic_on</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="../../core/sqlelement.html#sqlalchemy.sql.expression.ColumnElement" title="sqlalchemy.sql.expression.ColumnElement"><span class="pre">ColumnElement</span></a><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">aliased</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">innerjoin</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">adapt_on_names</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">_use_mapper_path</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="api.html#sqlalchemy.orm.util.AliasedClass" title="sqlalchemy.orm.util.AliasedClass"><span class="pre">AliasedClass</span></a><span class="p"><span class="pre">[</span></span><span class="pre">_O</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#sqlalchemy.orm.with_polymorphic" title="Permalink to this definition">¶</a></dt>
<dd><p>Produce an <a class="reference internal" href="api.html#sqlalchemy.orm.util.AliasedClass" title="sqlalchemy.orm.util.AliasedClass"><code class="xref py py-class docutils literal notranslate"><span class="pre">AliasedClass</span></code></a> construct which specifies
columns for descendant mappers of the given base.</p>
<p>Using this method will ensure that each descendant mapper’s
tables are included in the FROM clause, and will allow filter()
criterion to be used against those tables.  The resulting
instances will also have those columns already loaded so that
no “post fetch” of those columns will be required.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><span class="xref std std-ref">with_polymorphic</span> - full discussion of
<a class="reference internal" href="#sqlalchemy.orm.with_polymorphic" title="sqlalchemy.orm.with_polymorphic"><code class="xref py py-func docutils literal notranslate"><span class="pre">with_polymorphic()</span></code></a>.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.orm.with_polymorphic.params.base"></span><strong>base</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.with_polymorphic.params.base">¶</a> – Base class to be aliased.</p></li>
<li><p><span class="target" id="sqlalchemy.orm.with_polymorphic.params.classes"></span><strong>classes</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.with_polymorphic.params.classes">¶</a> – a single class or mapper, or list of
class/mappers, which inherit from the base class.
Alternatively, it may also be the string <code class="docutils literal notranslate"><span class="pre">'*'</span></code>, in which case
all descending mapped classes will be added to the FROM clause.</p></li>
<li><p><span class="target" id="sqlalchemy.orm.with_polymorphic.params.aliased"></span><strong>aliased</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.with_polymorphic.params.aliased">¶</a> – when True, the selectable will be aliased.   For a
JOIN, this means the JOIN will be SELECTed from inside of a subquery
unless the <a class="reference internal" href="#sqlalchemy.orm.with_polymorphic.params.flat" title="sqlalchemy.orm.with_polymorphic"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">with_polymorphic.flat</span></code></a> flag is set to
True, which is recommended for simpler use cases.</p></li>
<li><p><span class="target" id="sqlalchemy.orm.with_polymorphic.params.flat"></span><strong>flat</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.with_polymorphic.params.flat">¶</a> – Boolean, will be passed through to the
<a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.FromClause.alias" title="sqlalchemy.sql.expression.FromClause.alias"><code class="xref py py-meth docutils literal notranslate"><span class="pre">FromClause.alias()</span></code></a> call so that aliases of
<a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.Join" title="sqlalchemy.sql.expression.Join"><code class="xref py py-class docutils literal notranslate"><span class="pre">Join</span></code></a> objects will alias the individual tables
inside the join, rather than creating a subquery.  This is generally
supported by all modern databases with regards to right-nested joins
and generally produces more efficient queries.  Setting this flag is
recommended as long as the resulting SQL is functional.</p></li>
<li><p><span class="target" id="sqlalchemy.orm.with_polymorphic.params.selectable"></span><strong>selectable</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.with_polymorphic.params.selectable">¶</a> – <p>a table or subquery that will
be used in place of the generated FROM clause. This argument is
required if any of the desired classes use concrete table
inheritance, since SQLAlchemy currently cannot generate UNIONs
among tables automatically. If used, the <code class="docutils literal notranslate"><span class="pre">selectable</span></code> argument
must represent the full set of tables and columns mapped by every
mapped class. Otherwise, the unaccounted mapped columns will
result in their table being appended directly to the FROM clause
which will usually lead to incorrect results.</p>
<p>When left at its default value of <code class="docutils literal notranslate"><span class="pre">False</span></code>, the polymorphic
selectable assigned to the base mapper is used for selecting rows.
However, it may also be passed as <code class="docutils literal notranslate"><span class="pre">None</span></code>, which will bypass the
configured polymorphic selectable and instead construct an ad-hoc
selectable for the target classes given; for joined table inheritance
this will be a join that includes all target mappers and their
subclasses.</p>
</p></li>
<li><p><span class="target" id="sqlalchemy.orm.with_polymorphic.params.polymorphic_on"></span><strong>polymorphic_on</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.with_polymorphic.params.polymorphic_on">¶</a> – a column to be used as the “discriminator”
column for the given selectable. If not given, the polymorphic_on
attribute of the base classes’ mapper will be used, if any. This
is useful for mappings that don’t have polymorphic loading
behavior by default.</p></li>
<li><p><span class="target" id="sqlalchemy.orm.with_polymorphic.params.innerjoin"></span><strong>innerjoin</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.with_polymorphic.params.innerjoin">¶</a> – if True, an INNER JOIN will be used.  This should
only be specified if querying for one specific subtype only</p></li>
<li><p><span class="target" id="sqlalchemy.orm.with_polymorphic.params.adapt_on_names"></span><strong>adapt_on_names</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.with_polymorphic.params.adapt_on_names">¶</a> – <p>Passes through the
<a class="reference internal" href="api.html#sqlalchemy.orm.aliased.params.adapt_on_names" title="sqlalchemy.orm.aliased"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">aliased.adapt_on_names</span></code></a>
parameter to the aliased object.  This may be useful in situations where
the given selectable is not directly related to the existing mapped
selectable.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.4.33.</span></p>
</div>
</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="sqlalchemy.orm.selectin_polymorphic">
<em class="property"><span class="pre">function</span> </em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.orm.</span></span><span class="sig-name descname"><span class="pre">selectin_polymorphic</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">base_cls</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_EntityType</span><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">classes</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Iterable</span><span class="p"><span class="pre">[</span></span><span class="pre">Type</span><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">_AbstractLoad</span></span></span><a class="headerlink" href="#sqlalchemy.orm.selectin_polymorphic" title="Permalink to this definition">¶</a></dt>
<dd><p>Indicate an eager load should take place for all attributes
specific to a subclass.</p>
<p>This uses an additional SELECT with IN against all matched primary
key values, and is the per-query analogue to the <code class="docutils literal notranslate"><span class="pre">&quot;selectin&quot;</span></code>
setting on the <code class="xref py py-paramref docutils literal notranslate"><span class="pre">mapper.polymorphic_load</span></code> parameter.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.2.</span></p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#polymorphic-selectin"><span class="std std-ref">使用 selectin_polymorphic()</span></a></p>
</div>
</dd></dl>

</section>
</section>

    </div>

</div>

<div id="docs-bottom-navigation" class="docs-navigation-links, withsidebar">
        Previous:
        <a href="select.html" title="previous chapter">用ORM Mapper类编写SELECT语句</a>
        Next:
        <a href="dml.html" title="next chapter">支持 ORM 的 INSERT、UPDATE 和 DELETE 语句</a>

    <div id="docs-copyright">
        &copy; <a href="../../copyright.html">Copyright</a> 2007-2023, the SQLAlchemy authors and contributors.


    <p><b>flambé!</b> the dragon and <b><i>The Alchemist</i></b> image designs created and generously donated by <a href="https://github.com/vmalloc">Rotem Yaari</a>.</p>

        Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 7.0.1.

    Documentation last generated: 2023/8/18 10:07:16

    </div>
</div>

</div>



        
        

    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
          URL_ROOT:    '../../',
          VERSION:     '2.0.19',
          COLLAPSE_MODINDEX: false,
          FILE_SUFFIX: '.html'
      };
    </script>

    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>

    <!-- begin iterate through sphinx environment script_files -->
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script type="text/javascript" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/sphinx_highlight.js"></script>
        <script type="text/javascript" src="../../_static/clipboard.min.js"></script>
        <script type="text/javascript" src="../../_static/copybutton.js"></script>
    <!-- end iterate through sphinx environment script_files -->

    <script type="text/javascript" src="../../_static/init.js"></script>


    </body>
</html>


