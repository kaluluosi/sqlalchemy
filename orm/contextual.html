<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">



<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />

        <title>
            
    
    上下文/线程本地会话
 &mdash;
    SQLAlchemy 2.0 Documentation

        </title>

        
            <!-- begin iterate through site-imported + sphinx environment css_files -->
                <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
                <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
                <link rel="stylesheet" href="../_static/default.css" type="text/css" />
                <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
                <link rel="stylesheet" href="../_static/docs.css" type="text/css" />
                <link rel="stylesheet" href="../_static/sphinx_paramlinks.css" type="text/css" />
            <!-- end iterate through site-imported + sphinx environment css_files -->
        

        

    

    <!-- begin layout.mako headers -->

    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
        <link rel="copyright" title="Copyright" href="../copyright.html" />
    <link rel="top" title="SQLAlchemy 2.0 Documentation" href="../index.html" />
        <link rel="up" title="使用Session" href="session.html" />
        <link rel="next" title="使用事件跟踪查询、对象和会话更改" href="session_events.html" />
        <link rel="prev" title="附加的持久化技术" href="persistence_techniques.html" />
    <!-- end layout.mako headers -->


    </head>
    <body>
        
















<div id="docs-container">





<div id="docs-top-navigation-container" class="body-background">
<div id="docs-header">
    <div id="docs-version-header">
        Release: <span class="version-num">2.0.19</span>


        | Release Date: July 15, 2023

    </div>

    <h1><a href="../index.html">SQLAlchemy 2.0 Documentation</a></h1>

</div>
</div>

<div id="docs-body-container">

    <div id="fixed-sidebar" class="withsidebar">



        <div id="docs-sidebar-popout">
            <h3><a href="../index.html">SQLAlchemy 2.0 Documentation</a></h3>
            <p id="sidebar-topnav">
                <a href="../index.html">Home</a>
            </p>

            <div id="sidebar-search">
                <form class="search" action="../search.html" method="get">
                  <label>
                  Search terms:
                  <input type="text" placeholder="search..." name="q" size="12" />
                  </label>
                  <input type="hidden" name="check_keywords" value="yes" />
                  <input type="hidden" name="area" value="default" />
                </form>
            </div>

        </div>

        <div id="docs-sidebar">

        <div id="sidebar-banner">
            
        </div>

        <div id="docs-sidebar-inner">

        
        <h3>
            <a href="index.html" title="SQLAlchemy ORM">SQLAlchemy ORM</a>
        </h3>

        <ul>
<li><span class="link-container"><a class="reference external" href="quickstart.html">ORM快速入门</a></span></li>
<li><span class="link-container"><a class="reference external" href="mapper_config.html">ORM映射类配置</a></span></li>
<li><span class="link-container"><a class="reference external" href="relationships.html">关系配置</a></span></li>
<li><span class="link-container"><a class="reference external" href="queryguide/index.html">ORM查询指南</a></span></li>
<li><span class="link-container"><a class="reference external" href="session.html">使用Session</a></span><ul>
<li><span class="link-container"><a class="reference external" href="session_basics.html">会话基础知识</a></span></li>
<li><span class="link-container"><a class="reference external" href="session_state_management.html">状态管理</a></span></li>
<li><span class="link-container"><a class="reference external" href="cascades.html">级联</a></span></li>
<li><span class="link-container"><a class="reference external" href="session_transaction.html">事务和连接管理</a></span></li>
<li><span class="link-container"><a class="reference external" href="persistence_techniques.html">附加的持久化技术</a></span></li>
<li class="selected"><span class="link-container"><strong>上下文/线程本地会话</strong><a class="paramlink headerlink reference internal" href="#">¶</a></span><ul>
<li><span class="link-container"><a class="reference external" href="#id3">隐式方法访问</a></span></li>
<li><span class="link-container"><a class="reference external" href="#unitofwork-contextual-threadlocal">线程本地范围</a></span></li>
<li><span class="link-container"><a class="reference external" href="#web">在 Web 应用程序中使用线程本地范围</a></span></li>
<li><span class="link-container"><a class="reference external" href="#id5">使用自定义创建的作用域</a></span></li>
<li><span class="link-container"><a class="reference external" href="#api">上下文会话 API</a></span><ul>
<li><span class="link-container"><a class="reference external" href="#sqlalchemy.orm.scoped_session"><code class="docutils literal notranslate"><span class="pre">scoped_session</span></code></a></span><ul>
<li><span class="link-container"><a class="reference external" href="#sqlalchemy.orm.scoped_session.__call__"><code class="docutils literal notranslate"><span class="pre">scoped_session.__call__()</span></code></a></span></li>
<li><span class="link-container"><a class="reference external" href="#sqlalchemy.orm.scoped_session.__init__"><code class="docutils literal notranslate"><span class="pre">scoped_session.__init__()</span></code></a></span></li>
<li><span class="link-container"><a class="reference external" href="#sqlalchemy.orm.scoped_session.add"><code class="docutils literal notranslate"><span class="pre">scoped_session.add()</span></code></a></span></li>
<li><span class="link-container"><a class="reference external" href="#sqlalchemy.orm.scoped_session.add_all"><code class="docutils literal notranslate"><span class="pre">scoped_session.add_all()</span></code></a></span></li>
<li><span class="link-container"><a class="reference external" href="#sqlalchemy.orm.scoped_session.autoflush"><code class="docutils literal notranslate"><span class="pre">scoped_session.autoflush</span></code></a></span></li>
<li><span class="link-container"><a class="reference external" href="#sqlalchemy.orm.scoped_session.begin"><code class="docutils literal notranslate"><span class="pre">scoped_session.begin()</span></code></a></span></li>
<li><span class="link-container"><a class="reference external" href="#sqlalchemy.orm.scoped_session.begin_nested"><code class="docutils literal notranslate"><span class="pre">scoped_session.begin_nested()</span></code></a></span></li>
<li><span class="link-container"><a class="reference external" href="#sqlalchemy.orm.scoped_session.bind"><code class="docutils literal notranslate"><span class="pre">scoped_session.bind</span></code></a></span></li>
<li><span class="link-container"><a class="reference external" href="#sqlalchemy.orm.scoped_session.bulk_insert_mappings"><code class="docutils literal notranslate"><span class="pre">scoped_session.bulk_insert_mappings()</span></code></a></span></li>
<li><span class="link-container"><a class="reference external" href="#sqlalchemy.orm.scoped_session.bulk_save_objects"><code class="docutils literal notranslate"><span class="pre">scoped_session.bulk_save_objects()</span></code></a></span></li>
<li><span class="link-container"><a class="reference external" href="#sqlalchemy.orm.scoped_session.bulk_update_mappings"><code class="docutils literal notranslate"><span class="pre">scoped_session.bulk_update_mappings()</span></code></a></span></li>
<li><span class="link-container"><a class="reference external" href="#sqlalchemy.orm.scoped_session.close"><code class="docutils literal notranslate"><span class="pre">scoped_session.close()</span></code></a></span></li>
<li><span class="link-container"><a class="reference external" href="#sqlalchemy.orm.scoped_session.close_all"><code class="docutils literal notranslate"><span class="pre">scoped_session.close_all()</span></code></a></span></li>
<li><span class="link-container"><a class="reference external" href="#sqlalchemy.orm.scoped_session.commit"><code class="docutils literal notranslate"><span class="pre">scoped_session.commit()</span></code></a></span></li>
<li><span class="link-container"><a class="reference external" href="#sqlalchemy.orm.scoped_session.configure"><code class="docutils literal notranslate"><span class="pre">scoped_session.configure()</span></code></a></span></li>
<li><span class="link-container"><a class="reference external" href="#sqlalchemy.orm.scoped_session.connection"><code class="docutils literal notranslate"><span class="pre">scoped_session.connection()</span></code></a></span></li>
<li><span class="link-container"><a class="reference external" href="#sqlalchemy.orm.scoped_session.delete"><code class="docutils literal notranslate"><span class="pre">scoped_session.delete()</span></code></a></span></li>
<li><span class="link-container"><a class="reference external" href="#sqlalchemy.orm.scoped_session.deleted"><code class="docutils literal notranslate"><span class="pre">scoped_session.deleted</span></code></a></span></li>
<li><span class="link-container"><a class="reference external" href="#sqlalchemy.orm.scoped_session.dirty"><code class="docutils literal notranslate"><span class="pre">scoped_session.dirty</span></code></a></span></li>
<li><span class="link-container"><a class="reference external" href="#sqlalchemy.orm.scoped_session.execute"><code class="docutils literal notranslate"><span class="pre">scoped_session.execute()</span></code></a></span></li>
<li><span class="link-container"><a class="reference external" href="#sqlalchemy.orm.scoped_session.expire"><code class="docutils literal notranslate"><span class="pre">scoped_session.expire()</span></code></a></span></li>
<li><span class="link-container"><a class="reference external" href="#sqlalchemy.orm.scoped_session.expire_all"><code class="docutils literal notranslate"><span class="pre">scoped_session.expire_all()</span></code></a></span></li>
<li><span class="link-container"><a class="reference external" href="#sqlalchemy.orm.scoped_session.expunge"><code class="docutils literal notranslate"><span class="pre">scoped_session.expunge()</span></code></a></span></li>
<li><span class="link-container"><a class="reference external" href="#sqlalchemy.orm.scoped_session.expunge_all"><code class="docutils literal notranslate"><span class="pre">scoped_session.expunge_all()</span></code></a></span></li>
<li><span class="link-container"><a class="reference external" href="#sqlalchemy.orm.scoped_session.flush"><code class="docutils literal notranslate"><span class="pre">scoped_session.flush()</span></code></a></span></li>
<li><span class="link-container"><a class="reference external" href="#sqlalchemy.orm.scoped_session.get"><code class="docutils literal notranslate"><span class="pre">scoped_session.get()</span></code></a></span></li>
<li><span class="link-container"><a class="reference external" href="#sqlalchemy.orm.scoped_session.get_bind"><code class="docutils literal notranslate"><span class="pre">scoped_session.get_bind()</span></code></a></span></li>
<li><span class="link-container"><a class="reference external" href="#sqlalchemy.orm.scoped_session.identity_key"><code class="docutils literal notranslate"><span class="pre">scoped_session.identity_key()</span></code></a></span></li>
<li><span class="link-container"><a class="reference external" href="#sqlalchemy.orm.scoped_session.identity_map"><code class="docutils literal notranslate"><span class="pre">scoped_session.identity_map</span></code></a></span></li>
<li><span class="link-container"><a class="reference external" href="#sqlalchemy.orm.scoped_session.info"><code class="docutils literal notranslate"><span class="pre">scoped_session.info</span></code></a></span></li>
<li><span class="link-container"><a class="reference external" href="#sqlalchemy.orm.scoped_session.is_active"><code class="docutils literal notranslate"><span class="pre">scoped_session.is_active</span></code></a></span></li>
<li><span class="link-container"><a class="reference external" href="#sqlalchemy.orm.scoped_session.is_modified"><code class="docutils literal notranslate"><span class="pre">scoped_session.is_modified()</span></code></a></span></li>
<li><span class="link-container"><a class="reference external" href="#sqlalchemy.orm.scoped_session.merge"><code class="docutils literal notranslate"><span class="pre">scoped_session.merge()</span></code></a></span></li>
<li><span class="link-container"><a class="reference external" href="#sqlalchemy.orm.scoped_session.new"><code class="docutils literal notranslate"><span class="pre">scoped_session.new</span></code></a></span></li>
<li><span class="link-container"><a class="reference external" href="#sqlalchemy.orm.scoped_session.no_autoflush"><code class="docutils literal notranslate"><span class="pre">scoped_session.no_autoflush</span></code></a></span></li>
<li><span class="link-container"><a class="reference external" href="#sqlalchemy.orm.scoped_session.object_session"><code class="docutils literal notranslate"><span class="pre">scoped_session.object_session()</span></code></a></span></li>
<li><span class="link-container"><a class="reference external" href="#sqlalchemy.orm.scoped_session.query"><code class="docutils literal notranslate"><span class="pre">scoped_session.query()</span></code></a></span></li>
<li><span class="link-container"><a class="reference external" href="#sqlalchemy.orm.scoped_session.query_property"><code class="docutils literal notranslate"><span class="pre">scoped_session.query_property()</span></code></a></span></li>
<li><span class="link-container"><a class="reference external" href="#sqlalchemy.orm.scoped_session.refresh"><code class="docutils literal notranslate"><span class="pre">scoped_session.refresh()</span></code></a></span></li>
<li><span class="link-container"><a class="reference external" href="#sqlalchemy.orm.scoped_session.remove"><code class="docutils literal notranslate"><span class="pre">scoped_session.remove()</span></code></a></span></li>
<li><span class="link-container"><a class="reference external" href="#sqlalchemy.orm.scoped_session.rollback"><code class="docutils literal notranslate"><span class="pre">scoped_session.rollback()</span></code></a></span></li>
<li><span class="link-container"><a class="reference external" href="#sqlalchemy.orm.scoped_session.scalar"><code class="docutils literal notranslate"><span class="pre">scoped_session.scalar()</span></code></a></span></li>
<li><span class="link-container"><a class="reference external" href="#sqlalchemy.orm.scoped_session.scalars"><code class="docutils literal notranslate"><span class="pre">scoped_session.scalars()</span></code></a></span></li>
<li><span class="link-container"><a class="reference external" href="#sqlalchemy.orm.scoped_session.session_factory"><code class="docutils literal notranslate"><span class="pre">scoped_session.session_factory</span></code></a></span></li>
</ul>
</li>
<li><span class="link-container"><a class="reference external" href="#sqlalchemy.util.ScopedRegistry"><code class="docutils literal notranslate"><span class="pre">ScopedRegistry</span></code></a></span><ul>
<li><span class="link-container"><a class="reference external" href="#sqlalchemy.util.ScopedRegistry.__init__"><code class="docutils literal notranslate"><span class="pre">ScopedRegistry.__init__()</span></code></a></span></li>
<li><span class="link-container"><a class="reference external" href="#sqlalchemy.util.ScopedRegistry.clear"><code class="docutils literal notranslate"><span class="pre">ScopedRegistry.clear()</span></code></a></span></li>
<li><span class="link-container"><a class="reference external" href="#sqlalchemy.util.ScopedRegistry.has"><code class="docutils literal notranslate"><span class="pre">ScopedRegistry.has()</span></code></a></span></li>
<li><span class="link-container"><a class="reference external" href="#sqlalchemy.util.ScopedRegistry.set"><code class="docutils literal notranslate"><span class="pre">ScopedRegistry.set()</span></code></a></span></li>
</ul>
</li>
<li><span class="link-container"><a class="reference external" href="#sqlalchemy.util.ThreadLocalRegistry"><code class="docutils literal notranslate"><span class="pre">ThreadLocalRegistry</span></code></a></span></li>
<li><span class="link-container"><a class="reference external" href="#sqlalchemy.orm.QueryPropertyDescriptor"><code class="docutils literal notranslate"><span class="pre">QueryPropertyDescriptor</span></code></a></span></li>
</ul>
</li>
</ul>
</li>
<li><span class="link-container"><a class="reference external" href="session_events.html">使用事件跟踪查询、对象和会话更改</a></span></li>
<li><span class="link-container"><a class="reference external" href="session_api.html">会话API</a></span></li>
</ul>
</li>
<li><span class="link-container"><a class="reference external" href="extending.html">事件和内部实现</a></span></li>
<li><span class="link-container"><a class="reference external" href="extensions/index.html">ORM扩展</a></span></li>
<li><span class="link-container"><a class="reference external" href="examples.html">ORM Examples</a></span></li>
</ul>



        </div>

        </div>

    </div>

    <div id="narrow-index-nav">
        <form class="search" action="../search.html" method="get">
            <label>
                Search terms:
            <input type="text" placeholder="search..." name="q" size="12" />
            </label>
            <input type="submit" value="Search" />
            <input type="hidden" name="check_keywords" value="yes" />
            <input type="hidden" name="area" value="default" />
        </form>

        <p>
        <a href="../index.html">Home</a>
        </p>

    </div>


        <div id="docs-narrow-top-navigation">
            <ul>
                <li><b>Previous:</b>
                <a href="persistence_techniques.html" title="previous chapter">附加的持久化技术</a></li>
                <li><b>Next:</b>
                <a href="session_events.html" title="next chapter">使用事件跟踪查询、对象和会话更改</a></li>

            <li><b>Up:</b> <a href="../index.html">Home</a></li>
                    <ul><li><a href="index.html" title="SQLAlchemy ORM">SQLAlchemy ORM</a></li>
                    <ul><li><a href="session.html" title="使用Session">使用Session</a></li>
                </ul>
                </ul>



            <li><b>On this page:</b></li>
            <ul>
<li><a class="reference internal" href="#unitofwork-contextual">上下文/线程本地会话</a><ul>
<li><a class="reference internal" href="#id3">隐式方法访问</a></li>
<li><a class="reference internal" href="#unitofwork-contextual-threadlocal">线程本地范围</a></li>
<li><a class="reference internal" href="#web">在 Web 应用程序中使用线程本地范围</a></li>
<li><a class="reference internal" href="#id5">使用自定义创建的作用域</a></li>
<li><a class="reference internal" href="#api">上下文会话 API</a><ul>
<li><a class="reference internal" href="#sqlalchemy.orm.scoped_session"><code class="docutils literal notranslate"><span class="pre">scoped_session</span></code></a><ul>
<li><a class="reference internal" href="#sqlalchemy.orm.scoped_session.__call__"><code class="docutils literal notranslate"><span class="pre">scoped_session.__call__()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.scoped_session.__init__"><code class="docutils literal notranslate"><span class="pre">scoped_session.__init__()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.scoped_session.add"><code class="docutils literal notranslate"><span class="pre">scoped_session.add()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.scoped_session.add_all"><code class="docutils literal notranslate"><span class="pre">scoped_session.add_all()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.scoped_session.autoflush"><code class="docutils literal notranslate"><span class="pre">scoped_session.autoflush</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.scoped_session.begin"><code class="docutils literal notranslate"><span class="pre">scoped_session.begin()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.scoped_session.begin_nested"><code class="docutils literal notranslate"><span class="pre">scoped_session.begin_nested()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.scoped_session.bind"><code class="docutils literal notranslate"><span class="pre">scoped_session.bind</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.scoped_session.bulk_insert_mappings"><code class="docutils literal notranslate"><span class="pre">scoped_session.bulk_insert_mappings()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.scoped_session.bulk_save_objects"><code class="docutils literal notranslate"><span class="pre">scoped_session.bulk_save_objects()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.scoped_session.bulk_update_mappings"><code class="docutils literal notranslate"><span class="pre">scoped_session.bulk_update_mappings()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.scoped_session.close"><code class="docutils literal notranslate"><span class="pre">scoped_session.close()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.scoped_session.close_all"><code class="docutils literal notranslate"><span class="pre">scoped_session.close_all()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.scoped_session.commit"><code class="docutils literal notranslate"><span class="pre">scoped_session.commit()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.scoped_session.configure"><code class="docutils literal notranslate"><span class="pre">scoped_session.configure()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.scoped_session.connection"><code class="docutils literal notranslate"><span class="pre">scoped_session.connection()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.scoped_session.delete"><code class="docutils literal notranslate"><span class="pre">scoped_session.delete()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.scoped_session.deleted"><code class="docutils literal notranslate"><span class="pre">scoped_session.deleted</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.scoped_session.dirty"><code class="docutils literal notranslate"><span class="pre">scoped_session.dirty</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.scoped_session.execute"><code class="docutils literal notranslate"><span class="pre">scoped_session.execute()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.scoped_session.expire"><code class="docutils literal notranslate"><span class="pre">scoped_session.expire()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.scoped_session.expire_all"><code class="docutils literal notranslate"><span class="pre">scoped_session.expire_all()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.scoped_session.expunge"><code class="docutils literal notranslate"><span class="pre">scoped_session.expunge()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.scoped_session.expunge_all"><code class="docutils literal notranslate"><span class="pre">scoped_session.expunge_all()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.scoped_session.flush"><code class="docutils literal notranslate"><span class="pre">scoped_session.flush()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.scoped_session.get"><code class="docutils literal notranslate"><span class="pre">scoped_session.get()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.scoped_session.get_bind"><code class="docutils literal notranslate"><span class="pre">scoped_session.get_bind()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.scoped_session.identity_key"><code class="docutils literal notranslate"><span class="pre">scoped_session.identity_key()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.scoped_session.identity_map"><code class="docutils literal notranslate"><span class="pre">scoped_session.identity_map</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.scoped_session.info"><code class="docutils literal notranslate"><span class="pre">scoped_session.info</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.scoped_session.is_active"><code class="docutils literal notranslate"><span class="pre">scoped_session.is_active</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.scoped_session.is_modified"><code class="docutils literal notranslate"><span class="pre">scoped_session.is_modified()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.scoped_session.merge"><code class="docutils literal notranslate"><span class="pre">scoped_session.merge()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.scoped_session.new"><code class="docutils literal notranslate"><span class="pre">scoped_session.new</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.scoped_session.no_autoflush"><code class="docutils literal notranslate"><span class="pre">scoped_session.no_autoflush</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.scoped_session.object_session"><code class="docutils literal notranslate"><span class="pre">scoped_session.object_session()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.scoped_session.query"><code class="docutils literal notranslate"><span class="pre">scoped_session.query()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.scoped_session.query_property"><code class="docutils literal notranslate"><span class="pre">scoped_session.query_property()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.scoped_session.refresh"><code class="docutils literal notranslate"><span class="pre">scoped_session.refresh()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.scoped_session.remove"><code class="docutils literal notranslate"><span class="pre">scoped_session.remove()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.scoped_session.rollback"><code class="docutils literal notranslate"><span class="pre">scoped_session.rollback()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.scoped_session.scalar"><code class="docutils literal notranslate"><span class="pre">scoped_session.scalar()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.scoped_session.scalars"><code class="docutils literal notranslate"><span class="pre">scoped_session.scalars()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.scoped_session.session_factory"><code class="docutils literal notranslate"><span class="pre">scoped_session.session_factory</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#sqlalchemy.util.ScopedRegistry"><code class="docutils literal notranslate"><span class="pre">ScopedRegistry</span></code></a><ul>
<li><a class="reference internal" href="#sqlalchemy.util.ScopedRegistry.__init__"><code class="docutils literal notranslate"><span class="pre">ScopedRegistry.__init__()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.util.ScopedRegistry.clear"><code class="docutils literal notranslate"><span class="pre">ScopedRegistry.clear()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.util.ScopedRegistry.has"><code class="docutils literal notranslate"><span class="pre">ScopedRegistry.has()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.util.ScopedRegistry.set"><code class="docutils literal notranslate"><span class="pre">ScopedRegistry.set()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#sqlalchemy.util.ThreadLocalRegistry"><code class="docutils literal notranslate"><span class="pre">ThreadLocalRegistry</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.QueryPropertyDescriptor"><code class="docutils literal notranslate"><span class="pre">QueryPropertyDescriptor</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>


            </ul>

        </div>



    <div id="docs-body" role="main" class="withsidebar orm-contextual" >
        
<section id="unitofwork-contextual">
<span id="id1"></span><h1>上下文/线程本地会话<a class="headerlink" href="#unitofwork-contextual" title="Permalink to this heading">¶</a></h1>
<p>回想一下，在 <a class="reference internal" href="session_basics.html#session-faq-whentocreate"><span class="std std-ref">何时构造 Session，何时提交，何时关闭？</span></a> 一节中，”会话范围”的概念被引入，强调了将 <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> 的范围与 web 请求的范围关联的实践。大多数现代 web 框架都包括集成工具，以便自动管理 <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> 的范围，并应该使用这些工具。</p>
<p>SQLAlchemy 包括它自己的辅助对象，它有助于建立用户定义的 <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> 范围。第三方集成系统也会使用它来帮助构建它们的集成方案。</p>
<p>该对象是 <a class="reference internal" href="#sqlalchemy.orm.scoped_session" title="sqlalchemy.orm.scoped_session"><code class="xref py py-class docutils literal notranslate"><span class="pre">scoped_session</span></code></a> 对象，它表示一组 <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> 对象的 <strong>注册表</strong>。如果您不熟悉注册表模式，则可以在 <a class="reference external" href="https://martinfowler.com/eaaCatalog/registry.html">企业级应用程序架构模式</a> 中找到一个很好的介绍。</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p><a class="reference internal" href="#sqlalchemy.orm.scoped_session" title="sqlalchemy.orm.scoped_session"><code class="xref py py-class docutils literal notranslate"><span class="pre">scoped_session</span></code></a> 注册表默认使用 Python 的 <code class="docutils literal notranslate"><span class="pre">threading.local()</span></code>
来跟踪 <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> 实例。<strong>这不一定与所有应用程序服务器兼容</strong>，
特别是那些使用 greenlets 或其他替代并发控制形式的应用程序服务器，这可能会在中高并发情况下导致竞争条件（例如随机出现故障）。
请阅读 <a class="reference internal" href="#unitofwork-contextual-threadlocal"><span class="std std-ref">线程本地范围</span></a> 和下面的 <a class="reference internal" href="#session-lifespan"><span class="std std-ref">在 Web 应用程序中使用线程本地范围</span></a>，
以更全面地了解使用 <code class="docutils literal notranslate"><span class="pre">threading.local()</span></code> 来跟踪 <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> 对象的影响，并在使用不基于传统线程的应用程序服务器时考虑更明确的作用域。</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="#sqlalchemy.orm.scoped_session" title="sqlalchemy.orm.scoped_session"><code class="xref py py-class docutils literal notranslate"><span class="pre">scoped_session</span></code></a> 对象是许多 SQLAlchemy 应用程序使用的非常受欢迎和有用的对象。
然而，要注意的是，它只提供了解决 <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> 管理问题的 <strong>一种方法</strong>。如果您是 SQLAlchemy 初学者，
特别是如果术语 “线程本地变量” 对您来说似乎很奇怪，我们建议您优先选择一个成品集成系统，
例如 <a class="reference external" href="https://pypi.org/project/Flask-SQLAlchemy/">Flask-SQLAlchemy</a> 或 <a class="reference external" href="https://pypi.org/project/zope.sqlalchemy">zope.sqlalchemy</a>。</p>
</div>
<p>我们可以通过调用 <a class="reference internal" href="#sqlalchemy.orm.scoped_session" title="sqlalchemy.orm.scoped_session"><code class="xref py py-class docutils literal notranslate"><span class="pre">scoped_session</span></code></a> ，并传递一个**工厂函数**来构建一个 <a class="reference internal" href="#sqlalchemy.orm.scoped_session" title="sqlalchemy.orm.scoped_session"><code class="xref py py-class docutils literal notranslate"><span class="pre">scoped_session</span></code></a>，
该工厂函数可以创建新的 <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> 对象。任何能够在被调用时生成新对象的函数都可以看作是一个工厂函数，对于 <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code>，最常见的工厂函数是本节之前介绍的 <code class="xref py py-class docutils literal notranslate"><span class="pre">sessionmaker</span></code>。下面演示了这种用法:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">scoped_session</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">sessionmaker</span></pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">session_factory</span> <span class="o">=</span> <span class="n">sessionmaker</span><span class="p">(</span><span class="n">bind</span><span class="o">=</span><span class="n">some_engine</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Session</span> <span class="o">=</span> <span class="n">scoped_session</span><span class="p">(</span><span class="n">session_factory</span><span class="p">)</span></pre></div>
</div>
<p>我们创建的 <a class="reference internal" href="#sqlalchemy.orm.scoped_session" title="sqlalchemy.orm.scoped_session"><code class="xref py py-class docutils literal notranslate"><span class="pre">scoped_session</span></code></a> 对象现在将在我们“调用”注册表时调用 <code class="xref py py-class docutils literal notranslate"><span class="pre">sessionmaker</span></code>：</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">some_session</span> <span class="o">=</span> <span class="n">Session</span><span class="p">()</span></pre></div>
</div>
<p>上面，<code class="docutils literal notranslate"><span class="pre">some_session</span></code> 是 <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> 的一个实例，现在我们可以使用它来连接到数据库。
我们创建的 <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> 也在我们创建的 <a class="reference internal" href="#sqlalchemy.orm.scoped_session" title="sqlalchemy.orm.scoped_session"><code class="xref py py-class docutils literal notranslate"><span class="pre">scoped_session</span></code></a> 注册表中。
如果我们再次调用此注册表，我们将返回相同的 <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code>：</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">some_other_session</span> <span class="o">=</span> <span class="n">Session</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">some_session</span> <span class="ow">is</span> <span class="n">some_other_session</span>
<span class="go">True</span></pre></div>
</div>
<p>这种模式允许应用程序的不同部分调用全局 <a class="reference internal" href="#sqlalchemy.orm.scoped_session" title="sqlalchemy.orm.scoped_session"><code class="xref py py-class docutils literal notranslate"><span class="pre">scoped_session</span></code></a>，
以便所有这些区域都可以共享相同的会话，无需显式传递它。
我们在注册表中建立的 <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> 将保持不变，直到我们明确告诉该注册表将其处理掉，
通过调用 <a class="reference internal" href="#sqlalchemy.orm.scoped_session.remove" title="sqlalchemy.orm.scoped_session.remove"><code class="xref py py-meth docutils literal notranslate"><span class="pre">scoped_session.remove()</span></code></a>：</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Session</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span></pre></div>
</div>
<p><a class="reference internal" href="#sqlalchemy.orm.scoped_session.remove" title="sqlalchemy.orm.scoped_session.remove"><code class="xref py py-meth docutils literal notranslate"><span class="pre">scoped_session.remove()</span></code></a> 方法首先在当前 <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> 上调用 <code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.close()</span></code>，
这会将 <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> 拥有的任何连接/事务资源的占用效果释放，然后丢弃 <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> 本身。
这里的 “释放” 意味着将连接返回到链接池，并回滚任何事务状态，最终使用底层 DBAPI 连接的 <code class="docutils literal notranslate"><span class="pre">rollback()</span></code> 方法。</p>
<p>此时，<a class="reference internal" href="#sqlalchemy.orm.scoped_session" title="sqlalchemy.orm.scoped_session"><code class="xref py py-class docutils literal notranslate"><span class="pre">scoped_session</span></code></a> 对象是“空的”，并在再次调用该注册表时创建一个**新的** <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code>。
如下所示，这不是我们之前拥有的 <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code>：</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">new_session</span> <span class="o">=</span> <span class="n">Session</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">new_session</span> <span class="ow">is</span> <span class="n">some_session</span>
<span class="go">False</span></pre></div>
</div>
<p>上述步骤说明了注册表模式的要点。掌握这个基本思想后，我们可以讨论如何进行此模式的详细信息。</p>
<section id="id3">
<h2>隐式方法访问<a class="headerlink" href="#id3" title="Permalink to this heading">¶</a></h2>
<p><a class="reference internal" href="#sqlalchemy.orm.scoped_session" title="sqlalchemy.orm.scoped_session"><code class="xref py py-class docutils literal notranslate"><span class="pre">scoped_session</span></code></a> 的工作非常简单：将 <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> 保留给所有请求它的人。为了更透明地访问该 <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code>，<a class="reference internal" href="#sqlalchemy.orm.scoped_session" title="sqlalchemy.orm.scoped_session"><code class="xref py py-class docutils literal notranslate"><span class="pre">scoped_session</span></code></a> 还包括 <strong>代理行为</strong>，这意味着可以直接如同 <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> 一样处理该注册表；当在该对象上调用方法时，它们被**代理**到注册表维护的基础 <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> 上：</p>
<blockquote>
<div><p>Session = scoped_session(some_factory)</p>
<p># 等效于:
#
# session = Session()
# print(session.scalars(select(MyClass)).all())
#
print(Session.scalars(select(MyClass)).all())</p>
</div></blockquote>
<p>上述代码实现的功能与通过调用上述注册表获取当前 <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code>，然后使用该 <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> 完成的任务相同。</p>
</section>
<section id="unitofwork-contextual-threadlocal">
<span id="id4"></span><h2>线程本地范围<a class="headerlink" href="#unitofwork-contextual-threadlocal" title="Permalink to this heading">¶</a></h2>
<p>熟悉多线程编程的用户会注意到，将任何东西表示为全局变量通常是一个坏主意，因为它意味着全局对象将被同时许多线程访问。<code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> 对象完全是为在一个线程中 <strong>非并发</strong> 使用而设计的，就多线程来说，这意味着“同一时间只能在一个线程中使用”。因此，我们在上面的 <a class="reference internal" href="#sqlalchemy.orm.scoped_session" title="sqlalchemy.orm.scoped_session"><code class="xref py py-class docutils literal notranslate"><span class="pre">scoped_session</span></code></a> 用法示例中表示一个相同 <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> 对象在多次调用中维护的事实，表明必须存在某种处理方式，使跨许多线程的多个调用实际上不会获得一个句柄到相同的会话。我们称之为 <strong>线程本地存储</strong>，这意味着将使用一个特殊的对象，该对象将为每个应用程序线程维护一个不同的对象。Python 提供了这个对象，通过 <a class="reference external" href="https://docs.python.org/library/threading.html#threading.local">threading.local()</a> 构建。<a class="reference internal" href="#sqlalchemy.orm.scoped_session" title="sqlalchemy.orm.scoped_session"><code class="xref py py-class docutils literal notranslate"><span class="pre">scoped_session</span></code></a> 对象默认情况下使用此对象作为存储，以便单个 <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> 为所有调用 <a class="reference internal" href="#sqlalchemy.orm.scoped_session" title="sqlalchemy.orm.scoped_session"><code class="xref py py-class docutils literal notranslate"><span class="pre">scoped_session</span></code></a> 注册表的人维护，但在单个线程的范围内。在不同的线程上调用此注册表的调用者将获得一个与该线程本地的 <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> 实例。</p>
<p>使用这种技术，<a class="reference internal" href="#sqlalchemy.orm.scoped_session" title="sqlalchemy.orm.scoped_session"><code class="xref py py-class docutils literal notranslate"><span class="pre">scoped_session</span></code></a> 提供了一种快速而相对简单的（如果熟悉线程本地存储的话）方式，在多个线程中从全局角度提供单个对象的应用程序中调用。</p>
<p>总是使用 <a class="reference internal" href="#sqlalchemy.orm.scoped_session.remove" title="sqlalchemy.orm.scoped_session.remove"><code class="xref py py-meth docutils literal notranslate"><span class="pre">scoped_session.remove()</span></code></a> 方法删除当前与线程关联的任何 <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code>。但是，<code class="docutils literal notranslate"><span class="pre">threading.local()</span></code> 对象的一个优点是，如果应用程序线程本身结束，那么该线程的“存储”也将被垃圾回收。因此，使用线程本地范围的应用程序可以生成和销毁线程，而不需要调用 <a class="reference internal" href="#sqlalchemy.orm.scoped_session.remove" title="sqlalchemy.orm.scoped_session.remove"><code class="xref py py-meth docutils literal notranslate"><span class="pre">scoped_session.remove()</span></code></a>。但是，事务本身的范围，即通过 <code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.commit()</span></code> 或 <code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.rollback()</span></code> 结束它们的范围，通常仍然是必须在适当的时间显式设置的，除非应用程序实际上将线程生存期与事务的生存期相关联。</p>
</section>
<section id="web">
<span id="session-lifespan"></span><h2>在 Web 应用程序中使用线程本地范围<a class="headerlink" href="#web" title="Permalink to this heading">¶</a></h2>
<p>如 <a class="reference internal" href="session_basics.html#session-faq-whentocreate"><span class="std std-ref">何时构造 Session，何时提交，何时关闭？</span></a> 一节中所述，一个 Web 应用程序的架构围绕 <strong>Web 请求</strong> 的概念建立，将 <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> 与该请求相关联通常意味着 <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> 将与该请求关联。事实证明，大多数 Python Web 框架，与 Twisted 和 Tornado 这样的异步框架不同，使用线程的简单方式，其中接收特定 Web 请求，处理并完成该请求在单个 <strong>工作线程</strong> 的范围内完成。Web 请求结束时，工作线程被释放到一个工作池中，它可用于处理另一个请求。</p>
<p>这种 Web 请求与线程之间的简单对应关系意味着，要将 <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> 与线程相关联，也意味着它还与在该线程内运行的 Web 请求相关联，反之亦然，只要 <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> 是在 Web 请求开始之后创建的，并在 Web 请求结束之前撤销，就会自然关联该 Web 请求，这是一种常见的做法，使用 <a class="reference internal" href="#sqlalchemy.orm.scoped_session" title="sqlalchemy.orm.scoped_session"><code class="xref py py-class docutils literal notranslate"><span class="pre">scoped_session</span></code></a> 快速地将 <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> 与 Web 应用程序集成。下面的序列图说明了此流程：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Web 服务器          Web 框架              SQLAlchemy ORM 代码
--------------      --------------        ------------------------------
启动        -&gt;      Web 框架          -&gt;   # 建立会话注册表
                    初始化请求         Session = scoped_session(sessionmaker())

进入请求
Web 请求     -&gt;      Web 请求进行     -&gt;   # 可选地，该注册表
                    开始                 # 可显式调用以创建适合该线程和 / 或请求的 Session
                                          Session()

                                          # 会话注册表也可能在任何时候使用，如果不存在，则创建请求本地 Session()，
                                          # 否则返回现有的 Session()
                                          Session.execute(select(MyClass)) # ...

                                          Session.add(some_object) # ...

                                          # 如果修改了数据，请提交事务
                                          Session.commit()

                    结束并删除请求  -&gt;     # 指示注册表删除会话
                                          Session.remove()

                    发送输出         &lt;-
响应 Web 请求   &lt;-
结束</pre></div>
</div>
<p>使用上述流程，将 <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> 与 Web 应用程序集成的流程具有以下两个要求：</p>
<ol class="arabic simple">
<li><p>在 Web 应用程序一开始时创建一个 <a class="reference internal" href="#sqlalchemy.orm.scoped_session" title="sqlalchemy.orm.scoped_session"><code class="xref py py-class docutils literal notranslate"><span class="pre">scoped_session</span></code></a> 注册表，确保应用程序的所有其他部分都可以访问该对象。</p></li>
<li><p>确保在 Web 请求结束时调用 <a class="reference internal" href="#sqlalchemy.orm.scoped_session.remove" title="sqlalchemy.orm.scoped_session.remove"><code class="xref py py-meth docutils literal notranslate"><span class="pre">scoped_session.remove()</span></code></a>，通常通过与 Web 框架的事件系统进行集成以建立“请求结束”事件来实现。</p></li>
</ol>
<p>如前所述，上述模式是 <strong>集成 :class:`.Session` 与 Web 框架的潜在方法之一</strong>，其中特别假设 <strong>Web 框架将 Web 请求与应用程序线程相关联</strong>。但是，<strong>强烈建议使用 Web 框架提供的集成工具，如果有的话</strong>，
而不是 <a class="reference internal" href="#sqlalchemy.orm.scoped_session" title="sqlalchemy.orm.scoped_session"><code class="xref py py-class docutils literal notranslate"><span class="pre">scoped_session</span></code></a>。</p>
<p>特别地，在 <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> 直接与请求相关联而不是与当前线程相关联，比使用线程本地更加优选。下面的自定义范围部分详细介绍了一种更高级的配置，该配置可以将 <a class="reference internal" href="#sqlalchemy.orm.scoped_session" title="sqlalchemy.orm.scoped_session"><code class="xref py py-class docutils literal notranslate"><span class="pre">scoped_session</span></code></a> 的使用与直接基于请求的作用域或任何类型的作用域相结合。</p>
</section>
<section id="id5">
<h2>使用自定义创建的作用域<a class="headerlink" href="#id5" title="Permalink to this heading">¶</a></h2>
<p><a class="reference internal" href="#sqlalchemy.orm.scoped_session" title="sqlalchemy.orm.scoped_session"><code class="xref py py-class docutils literal notranslate"><span class="pre">scoped_session</span></code></a> 对象的默认行为“线程本地”范围仅是可将 <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> “限定范围”的许多选项之一。可以基于任何现有的系统定义自定义范围，以获取当前操作的“当前对象”。</p>
<p>假设 Web 框架定义了一个库函数``get_current_request()``。使用这个框架构建的应用程序可以随时调用此函数，结果是表示当前正在处理的请求的一种 “Request” 对象。如果 “Request” 对象是可哈希的，则可以轻松地将此函数与 <a class="reference internal" href="#sqlalchemy.orm.scoped_session" title="sqlalchemy.orm.scoped_session"><code class="xref py py-class docutils literal notranslate"><span class="pre">scoped_session</span></code></a> 集成，以将 <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> 与该请求相关联。以下演示了这一点，结合一个假设的事件标记，该事件标记由 Web 框架提供，允许在请求结束时调用代码：</p>
<blockquote>
<div><p>from my_web_framework import get_current_request, on_request_end
from sqlalchemy.orm import scoped_session, sessionmaker</p>
<p>Session = scoped_session(sessionmaker(bind=some_engine), scopefunc=get_current_request)</p>
<p>&#64;on_request_end
def remove_session(req):</p>
<blockquote>
<div><p>Session.remove()</p>
</div></blockquote>
</div></blockquote>
<p>上面，我们以通常的方式实例化 <a class="reference internal" href="#sqlalchemy.orm.scoped_session" title="sqlalchemy.orm.scoped_session"><code class="xref py py-class docutils literal notranslate"><span class="pre">scoped_session</span></code></a>，除了将请求返回函数作为 “scopefunc” 传递。这会指示 <a class="reference internal" href="#sqlalchemy.orm.scoped_session" title="sqlalchemy.orm.scoped_session"><code class="xref py py-class docutils literal notranslate"><span class="pre">scoped_session</span></code></a> 对象使用此函数在注册表调用时生成一个字典键来返回当前 <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code>。在这种情况下，特别重要的是，我们确保实现了可靠的“remove”系统，因为该字典否则不进行自我管理。</p>
</section>
<section id="api">
<h2>上下文会话 API<a class="headerlink" href="#api" title="Permalink to this heading">¶</a></h2>
<table class="longtable docutils align-default">
<thead>
<tr class="row-odd"><th class="head">Object Name</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.orm.QueryPropertyDescriptor"><span class="sig-name descname">QueryPropertyDescriptor</span></a></p></td>
<td><p>Describes the type applied to a class-level
<a class="reference internal" href="#sqlalchemy.orm.scoped_session.query_property" title="sqlalchemy.orm.scoped_session.query_property"><code class="xref py py-meth docutils literal notranslate"><span class="pre">scoped_session.query_property()</span></code></a> attribute.</p></td>
</tr>
<tr class="row-odd"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.orm.scoped_session"><span class="sig-name descname">scoped_session</span></a></p></td>
<td><p>Provides scoped management of <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> objects.</p></td>
</tr>
<tr class="row-even"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.util.ScopedRegistry"><span class="sig-name descname">ScopedRegistry</span></a></p></td>
<td><p>A Registry that can store one or multiple instances of a single
class on the basis of a “scope” function.</p></td>
</tr>
<tr class="row-odd"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.util.ThreadLocalRegistry"><span class="sig-name descname">ThreadLocalRegistry</span></a></p></td>
<td><p>A <a class="reference internal" href="#sqlalchemy.util.ScopedRegistry" title="sqlalchemy.util.ScopedRegistry"><code class="xref py py-class docutils literal notranslate"><span class="pre">ScopedRegistry</span></code></a> that uses a <code class="docutils literal notranslate"><span class="pre">threading.local()</span></code>
variable for storage.</p></td>
</tr>
</tbody>
</table>
<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.orm.scoped_session">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.orm.</span></span><span class="sig-name descname"><span class="pre">scoped_session</span></span><a class="headerlink" href="#sqlalchemy.orm.scoped_session" title="Permalink to this definition">¶</a></dt>
<dd><p>Provides scoped management of <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> objects.</p>
<p>See <a class="reference internal" href="#unitofwork-contextual"><span class="std std-ref">上下文/线程本地会话</span></a> for a tutorial.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When using <a class="reference internal" href="extensions/asyncio.html"><span class="std std-ref">异步 I/O (asyncio)</span></a>, the async-compatible
<a class="reference internal" href="extensions/asyncio.html#sqlalchemy.ext.asyncio.async_scoped_session" title="sqlalchemy.ext.asyncio.async_scoped_session"><code class="xref py py-class docutils literal notranslate"><span class="pre">async_scoped_session</span></code></a> class should be
used in place of <a class="reference internal" href="#sqlalchemy.orm.scoped_session" title="sqlalchemy.orm.scoped_session"><code class="xref py py-class docutils literal notranslate"><span class="pre">scoped_session</span></code></a>.</p>
</div>
<div class="class-members docutils container">
<p><strong>Members</strong></p>
<p><a class="reference internal" href="#sqlalchemy.orm.scoped_session.__call__"><span class="sig-name descname">__call__()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.scoped_session.__init__"><span class="sig-name descname">__init__()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.scoped_session.add"><span class="sig-name descname">add()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.scoped_session.add_all"><span class="sig-name descname">add_all()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.scoped_session.autoflush"><span class="sig-name descname">autoflush</span></a>, <a class="reference internal" href="#sqlalchemy.orm.scoped_session.begin"><span class="sig-name descname">begin()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.scoped_session.begin_nested"><span class="sig-name descname">begin_nested()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.scoped_session.bind"><span class="sig-name descname">bind</span></a>, <a class="reference internal" href="#sqlalchemy.orm.scoped_session.bulk_insert_mappings"><span class="sig-name descname">bulk_insert_mappings()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.scoped_session.bulk_save_objects"><span class="sig-name descname">bulk_save_objects()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.scoped_session.bulk_update_mappings"><span class="sig-name descname">bulk_update_mappings()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.scoped_session.close"><span class="sig-name descname">close()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.scoped_session.close_all"><span class="sig-name descname">close_all()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.scoped_session.commit"><span class="sig-name descname">commit()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.scoped_session.configure"><span class="sig-name descname">configure()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.scoped_session.connection"><span class="sig-name descname">connection()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.scoped_session.delete"><span class="sig-name descname">delete()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.scoped_session.deleted"><span class="sig-name descname">deleted</span></a>, <a class="reference internal" href="#sqlalchemy.orm.scoped_session.dirty"><span class="sig-name descname">dirty</span></a>, <a class="reference internal" href="#sqlalchemy.orm.scoped_session.execute"><span class="sig-name descname">execute()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.scoped_session.expire"><span class="sig-name descname">expire()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.scoped_session.expire_all"><span class="sig-name descname">expire_all()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.scoped_session.expunge"><span class="sig-name descname">expunge()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.scoped_session.expunge_all"><span class="sig-name descname">expunge_all()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.scoped_session.flush"><span class="sig-name descname">flush()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.scoped_session.get"><span class="sig-name descname">get()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.scoped_session.get_bind"><span class="sig-name descname">get_bind()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.scoped_session.identity_key"><span class="sig-name descname">identity_key()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.scoped_session.identity_map"><span class="sig-name descname">identity_map</span></a>, <a class="reference internal" href="#sqlalchemy.orm.scoped_session.info"><span class="sig-name descname">info</span></a>, <a class="reference internal" href="#sqlalchemy.orm.scoped_session.is_active"><span class="sig-name descname">is_active</span></a>, <a class="reference internal" href="#sqlalchemy.orm.scoped_session.is_modified"><span class="sig-name descname">is_modified()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.scoped_session.merge"><span class="sig-name descname">merge()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.scoped_session.new"><span class="sig-name descname">new</span></a>, <a class="reference internal" href="#sqlalchemy.orm.scoped_session.no_autoflush"><span class="sig-name descname">no_autoflush</span></a>, <a class="reference internal" href="#sqlalchemy.orm.scoped_session.object_session"><span class="sig-name descname">object_session()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.scoped_session.query"><span class="sig-name descname">query()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.scoped_session.query_property"><span class="sig-name descname">query_property()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.scoped_session.refresh"><span class="sig-name descname">refresh()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.scoped_session.remove"><span class="sig-name descname">remove()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.scoped_session.rollback"><span class="sig-name descname">rollback()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.scoped_session.scalar"><span class="sig-name descname">scalar()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.scoped_session.scalars"><span class="sig-name descname">scalars()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.scoped_session.session_factory"><span class="sig-name descname">session_factory</span></a></p>
</div>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.orm.scoped_session" title="sqlalchemy.orm.scoped_session"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.orm.scoped_session</span></code></a> (<code class="xref py py-class docutils literal notranslate"><span class="pre">typing.Generic</span></code>)</p>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.scoped_session.__call__">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.scoped_session"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.scoped_session.</span></code></a><span class="sig-name descname"><span class="pre">__call__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kw</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">_S</span></span></span><a class="headerlink" href="#sqlalchemy.orm.scoped_session.__call__" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the current <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code>, creating it
using the <a class="reference internal" href="#sqlalchemy.orm.scoped_session.session_factory" title="sqlalchemy.orm.scoped_session.session_factory"><code class="xref py py-attr docutils literal notranslate"><span class="pre">scoped_session.session_factory</span></code></a> if not present.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><span class="target" id="sqlalchemy.orm.scoped_session.__call__.params.**kw"></span><strong>**kw</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.scoped_session.__call__.params.**kw">¶</a> – Keyword arguments will be passed to the
<a class="reference internal" href="#sqlalchemy.orm.scoped_session.session_factory" title="sqlalchemy.orm.scoped_session.session_factory"><code class="xref py py-attr docutils literal notranslate"><span class="pre">scoped_session.session_factory</span></code></a> callable, if an existing
<code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> is not present.  If the <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> is present
and keyword arguments have been passed,
<a class="reference internal" href="../core/exceptions.html#sqlalchemy.exc.InvalidRequestError" title="sqlalchemy.exc.InvalidRequestError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">InvalidRequestError</span></code></a> is raised.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.scoped_session.__init__">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.scoped_session"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.scoped_session.</span></code></a><span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">session_factory</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">sessionmaker</span><span class="p"><span class="pre">[</span></span><span class="pre">_S</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scopefunc</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Callable</span><span class="p"><span class="pre">[</span></span><span class="p"><span class="pre">[</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.orm.scoped_session.__init__" title="Permalink to this definition">¶</a></dt>
<dd><p>Construct a new <a class="reference internal" href="#sqlalchemy.orm.scoped_session" title="sqlalchemy.orm.scoped_session"><code class="xref py py-class docutils literal notranslate"><span class="pre">scoped_session</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.orm.scoped_session.params.session_factory"></span><strong>session_factory</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.scoped_session.params.session_factory">¶</a> – a factory to create new <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code>
instances. This is usually, but not necessarily, an instance
of <code class="xref py py-class docutils literal notranslate"><span class="pre">sessionmaker</span></code>.</p></li>
<li><p><span class="target" id="sqlalchemy.orm.scoped_session.params.scopefunc"></span><strong>scopefunc</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.scoped_session.params.scopefunc">¶</a> – optional function which defines
the current scope.   If not passed, the <a class="reference internal" href="#sqlalchemy.orm.scoped_session" title="sqlalchemy.orm.scoped_session"><code class="xref py py-class docutils literal notranslate"><span class="pre">scoped_session</span></code></a>
object assumes “thread-local” scope, and will use
a Python <code class="docutils literal notranslate"><span class="pre">threading.local()</span></code> in order to maintain the current
<code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code>.  If passed, the function should return
a hashable token; this token will be used as the key in a
dictionary in order to store and retrieve the current
<code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code>.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.scoped_session.add">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.scoped_session"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.scoped_session.</span></code></a><span class="sig-name descname"><span class="pre">add</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">instance</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">object</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">_warn</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.orm.scoped_session.add" title="Permalink to this definition">¶</a></dt>
<dd><p>Place an object into this <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code>.</p>
<div class="class-bases docutils container">
<p>Proxied for the <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> class on
behalf of the <a class="reference internal" href="#sqlalchemy.orm.scoped_session" title="sqlalchemy.orm.scoping.scoped_session"><code class="xref py py-class docutils literal notranslate"><span class="pre">scoped_session</span></code></a> class.</p>
</div>
<p>Objects that are in the <span class="xref std std-term">transient</span> state when passed to the
<code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.add()</span></code> method will move to the
<span class="xref std std-term">pending</span> state, until the next flush, at which point they
will move to the <span class="xref std std-term">persistent</span> state.</p>
<p>Objects that are in the <span class="xref std std-term">detached</span> state when passed to the
<code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.add()</span></code> method will move to the <span class="xref std std-term">persistent</span>
state directly.</p>
<p>If the transaction used by the <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> is rolled back,
objects which were transient when they were passed to
<code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.add()</span></code> will be moved back to the
<span class="xref std std-term">transient</span> state, and will no longer be present within this
<code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code>.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.add_all()</span></code></p>
<p><a class="reference internal" href="session_basics.html#session-adding"><span class="std std-ref">添加新对象或现有对象</span></a> - at <a class="reference internal" href="session_basics.html#session-basics"><span class="std std-ref">使用会话的基础知识</span></a></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.scoped_session.add_all">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.scoped_session"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.scoped_session.</span></code></a><span class="sig-name descname"><span class="pre">add_all</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">instances</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Iterable</span><span class="p"><span class="pre">[</span></span><span class="pre">object</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.orm.scoped_session.add_all" title="Permalink to this definition">¶</a></dt>
<dd><p>Add the given collection of instances to this <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code>.</p>
<div class="class-bases docutils container">
<p>Proxied for the <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> class on
behalf of the <a class="reference internal" href="#sqlalchemy.orm.scoped_session" title="sqlalchemy.orm.scoping.scoped_session"><code class="xref py py-class docutils literal notranslate"><span class="pre">scoped_session</span></code></a> class.</p>
</div>
<p>See the documentation for <code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.add()</span></code> for a general
behavioral description.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.add()</span></code></p>
<p><a class="reference internal" href="session_basics.html#session-adding"><span class="std std-ref">添加新对象或现有对象</span></a> - at <a class="reference internal" href="session_basics.html#session-basics"><span class="std std-ref">使用会话的基础知识</span></a></p>
</div>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.orm.scoped_session.autoflush">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.orm.scoped_session"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.scoped_session.</span></code></a><span class="sig-name descname"><span class="pre">autoflush</span></span><a class="headerlink" href="#sqlalchemy.orm.scoped_session.autoflush" title="Permalink to this definition">¶</a></dt>
<dd><p>Proxy for the <code class="xref py py-attr docutils literal notranslate"><span class="pre">Session.autoflush</span></code> attribute
on behalf of the <a class="reference internal" href="#sqlalchemy.orm.scoped_session" title="sqlalchemy.orm.scoping.scoped_session"><code class="xref py py-class docutils literal notranslate"><span class="pre">scoped_session</span></code></a> class.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.scoped_session.begin">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.scoped_session"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.scoped_session.</span></code></a><span class="sig-name descname"><span class="pre">begin</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">nested</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">SessionTransaction</span></span></span><a class="headerlink" href="#sqlalchemy.orm.scoped_session.begin" title="Permalink to this definition">¶</a></dt>
<dd><p>Begin a transaction, or nested transaction,
on this <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code>, if one is not already begun.</p>
<div class="class-bases docutils container">
<p>Proxied for the <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> class on
behalf of the <a class="reference internal" href="#sqlalchemy.orm.scoped_session" title="sqlalchemy.orm.scoping.scoped_session"><code class="xref py py-class docutils literal notranslate"><span class="pre">scoped_session</span></code></a> class.</p>
</div>
<p>The <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> object features <strong>autobegin</strong> behavior,
so that normally it is not necessary to call the
<code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.begin()</span></code>
method explicitly. However, it may be used in order to control
the scope of when the transactional state is begun.</p>
<p>When used to begin the outermost transaction, an error is raised
if this <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> is already inside of a transaction.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><span class="target" id="sqlalchemy.orm.scoped_session.begin.params.nested"></span><strong>nested</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.scoped_session.begin.params.nested">¶</a> – if True, begins a SAVEPOINT transaction and is
equivalent to calling <code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.begin_nested()</span></code>. For
documentation on SAVEPOINT transactions, please see
<a class="reference internal" href="session_transaction.html#session-begin-nested"><span class="std std-ref">使用保存点（SAVEPOINT）</span></a>.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>the <code class="xref py py-class docutils literal notranslate"><span class="pre">SessionTransaction</span></code> object.  Note that
<code class="xref py py-class docutils literal notranslate"><span class="pre">SessionTransaction</span></code>
acts as a Python context manager, allowing <code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.begin()</span></code>
to be used in a “with” block.  See <a class="reference internal" href="session_transaction.html#session-explicit-begin"><span class="std std-ref">显式开启事务</span></a> for
an example.</p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="session_basics.html#session-autobegin"><span class="std std-ref">自动开始</span></a></p>
<p><a class="reference internal" href="session_transaction.html#unitofwork-transaction"><span class="std std-ref">管理事务</span></a></p>
<p><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.begin_nested()</span></code></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.scoped_session.begin_nested">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.scoped_session"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.scoped_session.</span></code></a><span class="sig-name descname"><span class="pre">begin_nested</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">SessionTransaction</span></span></span><a class="headerlink" href="#sqlalchemy.orm.scoped_session.begin_nested" title="Permalink to this definition">¶</a></dt>
<dd><p>Begin a “nested” transaction on this Session, e.g. SAVEPOINT.</p>
<div class="class-bases docutils container">
<p>Proxied for the <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> class on
behalf of the <a class="reference internal" href="#sqlalchemy.orm.scoped_session" title="sqlalchemy.orm.scoping.scoped_session"><code class="xref py py-class docutils literal notranslate"><span class="pre">scoped_session</span></code></a> class.</p>
</div>
<p>The target database(s) and associated drivers must support SQL
SAVEPOINT for this method to function correctly.</p>
<p>For documentation on SAVEPOINT
transactions, please see <a class="reference internal" href="session_transaction.html#session-begin-nested"><span class="std std-ref">使用保存点（SAVEPOINT）</span></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>the <code class="xref py py-class docutils literal notranslate"><span class="pre">SessionTransaction</span></code> object.  Note that
<code class="xref py py-class docutils literal notranslate"><span class="pre">SessionTransaction</span></code> acts as a context manager, allowing
<code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.begin_nested()</span></code> to be used in a “with” block.
See <a class="reference internal" href="session_transaction.html#session-begin-nested"><span class="std std-ref">使用保存点（SAVEPOINT）</span></a> for a usage example.</p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="session_transaction.html#session-begin-nested"><span class="std std-ref">使用保存点（SAVEPOINT）</span></a></p>
<p><a class="reference internal" href="../dialects/sqlite.html#pysqlite-serializable"><span class="std std-ref">Serializable isolation / Savepoints / Transactional DDL</span></a> - special workarounds required
with the SQLite driver in order for SAVEPOINT to work
correctly.</p>
</div>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.orm.scoped_session.bind">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.orm.scoped_session"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.scoped_session.</span></code></a><span class="sig-name descname"><span class="pre">bind</span></span><a class="headerlink" href="#sqlalchemy.orm.scoped_session.bind" title="Permalink to this definition">¶</a></dt>
<dd><p>Proxy for the <code class="xref py py-attr docutils literal notranslate"><span class="pre">Session.bind</span></code> attribute
on behalf of the <a class="reference internal" href="#sqlalchemy.orm.scoped_session" title="sqlalchemy.orm.scoping.scoped_session"><code class="xref py py-class docutils literal notranslate"><span class="pre">scoped_session</span></code></a> class.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.scoped_session.bulk_insert_mappings">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.scoped_session"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.scoped_session.</span></code></a><span class="sig-name descname"><span class="pre">bulk_insert_mappings</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mapper</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Mapper</span><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mappings</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Iterable</span><span class="p"><span class="pre">[</span></span><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">return_defaults</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">render_nulls</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.orm.scoped_session.bulk_insert_mappings" title="Permalink to this definition">¶</a></dt>
<dd><p>Perform a bulk insert of the given list of mapping dictionaries.</p>
<div class="class-bases docutils container">
<p>Proxied for the <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> class on
behalf of the <a class="reference internal" href="#sqlalchemy.orm.scoped_session" title="sqlalchemy.orm.scoping.scoped_session"><code class="xref py py-class docutils literal notranslate"><span class="pre">scoped_session</span></code></a> class.</p>
</div>
<div class="admonition legacy">
<p class="admonition-title">Legacy Feature</p>
<p>This method is a legacy feature as of the 2.0 series of
SQLAlchemy.   For modern bulk INSERT and UPDATE, see
the sections <a class="reference internal" href="queryguide/dml.html#orm-queryguide-bulk-insert"><span class="std std-ref">ORM 批量 INSERT 语句</span></a> and
<span class="xref std std-ref">orm_queryguide_bulk_update</span>.  The 2.0 API shares
implementation details with this method and adds new features
as well.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.orm.scoped_session.bulk_insert_mappings.params.mapper"></span><strong>mapper</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.scoped_session.bulk_insert_mappings.params.mapper">¶</a> – a mapped class, or the actual <code class="xref py py-class docutils literal notranslate"><span class="pre">Mapper</span></code>
object,
representing the single kind of object represented within the mapping
list.</p></li>
<li><p><span class="target" id="sqlalchemy.orm.scoped_session.bulk_insert_mappings.params.mappings"></span><strong>mappings</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.scoped_session.bulk_insert_mappings.params.mappings">¶</a> – a sequence of dictionaries, each one containing the
state of the mapped row to be inserted, in terms of the attribute
names on the mapped class.   If the mapping refers to multiple tables,
such as a joined-inheritance mapping, each dictionary must contain all
keys to be populated into all tables.</p></li>
<li><p><span class="target" id="sqlalchemy.orm.scoped_session.bulk_insert_mappings.params.return_defaults"></span><strong>return_defaults</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.scoped_session.bulk_insert_mappings.params.return_defaults">¶</a> – <p>when True, the INSERT process will be altered
to ensure that newly generated primary key values will be fetched.
The rationale for this parameter is typically to enable
<a class="reference internal" href="inheritance.html#joined-inheritance"><span class="std std-ref">Joined Table Inheritance</span></a> mappings to
be bulk inserted.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>for backends that don’t support RETURNING, the
<code class="xref py py-paramref docutils literal notranslate"><span class="pre">Session.bulk_insert_mappings.return_defaults</span></code>
parameter can significantly decrease performance as INSERT
statements can no longer be batched.   See
<span class="xref std std-ref">engine_insertmanyvalues</span>
for background on which backends are affected.</p>
</div>
</p></li>
<li><p><span class="target" id="sqlalchemy.orm.scoped_session.bulk_insert_mappings.params.render_nulls"></span><strong>render_nulls</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.scoped_session.bulk_insert_mappings.params.render_nulls">¶</a> – <p>When True, a value of <code class="docutils literal notranslate"><span class="pre">None</span></code> will result
in a NULL value being included in the INSERT statement, rather
than the column being omitted from the INSERT.   This allows all
the rows being INSERTed to have the identical set of columns which
allows the full set of rows to be batched to the DBAPI.  Normally,
each column-set that contains a different combination of NULL values
than the previous row must omit a different series of columns from
the rendered INSERT statement, which means it must be emitted as a
separate statement.   By passing this flag, the full set of rows
are guaranteed to be batchable into one batch; the cost however is
that server-side defaults which are invoked by an omitted column will
be skipped, so care must be taken to ensure that these are not
necessary.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>When this flag is set, <strong>server side default SQL values will
not be invoked</strong> for those columns that are inserted as NULL;
the NULL value will be sent explicitly.   Care must be taken
to ensure that no server-side default functions need to be
invoked for the operation as a whole.</p>
</div>
</p></li>
</ul>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="queryguide/dml.html"><span class="doc">支持 ORM 的 INSERT、UPDATE 和 DELETE 语句</span></a></p>
<p><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.bulk_save_objects()</span></code></p>
<p><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.bulk_update_mappings()</span></code></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.scoped_session.bulk_save_objects">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.scoped_session"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.scoped_session.</span></code></a><span class="sig-name descname"><span class="pre">bulk_save_objects</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">objects</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Iterable</span><span class="p"><span class="pre">[</span></span><span class="pre">object</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">return_defaults</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">update_changed_only</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">preserve_order</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.orm.scoped_session.bulk_save_objects" title="Permalink to this definition">¶</a></dt>
<dd><p>Perform a bulk save of the given list of objects.</p>
<div class="class-bases docutils container">
<p>Proxied for the <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> class on
behalf of the <a class="reference internal" href="#sqlalchemy.orm.scoped_session" title="sqlalchemy.orm.scoping.scoped_session"><code class="xref py py-class docutils literal notranslate"><span class="pre">scoped_session</span></code></a> class.</p>
</div>
<div class="admonition legacy">
<p class="admonition-title">Legacy Feature</p>
<p>This method is a legacy feature as of the 2.0 series of
SQLAlchemy.   For modern bulk INSERT and UPDATE, see
the sections <a class="reference internal" href="queryguide/dml.html#orm-queryguide-bulk-insert"><span class="std std-ref">ORM 批量 INSERT 语句</span></a> and
<span class="xref std std-ref">orm_queryguide_bulk_update</span>.</p>
<p>For general INSERT and UPDATE of existing ORM mapped objects,
prefer standard <span class="xref std std-term">unit of work</span> data management patterns,
introduced in the <a class="reference internal" href="../tutorial/index.html#unified-tutorial"><span class="std std-ref">SQLAlchemy统一教程</span></a> at
<a class="reference internal" href="../tutorial/orm_data_manipulation.html#tutorial-orm-data-manipulation"><span class="std std-ref">使用ORM进行数据操作</span></a>.  SQLAlchemy 2.0
now uses <span class="xref std std-ref">engine_insertmanyvalues</span> with modern dialects
which solves previous issues of bulk INSERT slowness.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.orm.scoped_session.bulk_save_objects.params.objects"></span><strong>objects</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.scoped_session.bulk_save_objects.params.objects">¶</a> – <p>a sequence of mapped object instances.  The mapped
objects are persisted as is, and are <strong>not</strong> associated with the
<code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> afterwards.</p>
<p>For each object, whether the object is sent as an INSERT or an
UPDATE is dependent on the same rules used by the <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code>
in traditional operation; if the object has the
<code class="xref py py-attr docutils literal notranslate"><span class="pre">InstanceState.key</span></code>
attribute set, then the object is assumed to be “detached” and
will result in an UPDATE.  Otherwise, an INSERT is used.</p>
<p>In the case of an UPDATE, statements are grouped based on which
attributes have changed, and are thus to be the subject of each
SET clause.  If <code class="docutils literal notranslate"><span class="pre">update_changed_only</span></code> is False, then all
attributes present within each object are applied to the UPDATE
statement, which may help in allowing the statements to be grouped
together into a larger executemany(), and will also reduce the
overhead of checking history on attributes.</p>
</p></li>
<li><p><span class="target" id="sqlalchemy.orm.scoped_session.bulk_save_objects.params.return_defaults"></span><strong>return_defaults</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.scoped_session.bulk_save_objects.params.return_defaults">¶</a> – when True, rows that are missing values which
generate defaults, namely integer primary key defaults and sequences,
will be inserted <strong>one at a time</strong>, so that the primary key value
is available.  In particular this will allow joined-inheritance
and other multi-table mappings to insert correctly without the need
to provide primary key values ahead of time; however,
<code class="xref py py-paramref docutils literal notranslate"><span class="pre">Session.bulk_save_objects.return_defaults</span></code> <strong>greatly
reduces the performance gains</strong> of the method overall.  It is strongly
advised to please use the standard <code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.add_all()</span></code>
approach.</p></li>
<li><p><span class="target" id="sqlalchemy.orm.scoped_session.bulk_save_objects.params.update_changed_only"></span><strong>update_changed_only</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.scoped_session.bulk_save_objects.params.update_changed_only">¶</a> – when True, UPDATE statements are rendered
based on those attributes in each state that have logged changes.
When False, all attributes present are rendered into the SET clause
with the exception of primary key attributes.</p></li>
<li><p><span class="target" id="sqlalchemy.orm.scoped_session.bulk_save_objects.params.preserve_order"></span><strong>preserve_order</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.scoped_session.bulk_save_objects.params.preserve_order">¶</a> – when True, the order of inserts and updates
matches exactly the order in which the objects are given.   When
False, common types of objects are grouped into inserts
and updates, to allow for more batching opportunities.</p></li>
</ul>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="queryguide/dml.html"><span class="doc">支持 ORM 的 INSERT、UPDATE 和 DELETE 语句</span></a></p>
<p><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.bulk_insert_mappings()</span></code></p>
<p><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.bulk_update_mappings()</span></code></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.scoped_session.bulk_update_mappings">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.scoped_session"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.scoped_session.</span></code></a><span class="sig-name descname"><span class="pre">bulk_update_mappings</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mapper</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Mapper</span><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mappings</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Iterable</span><span class="p"><span class="pre">[</span></span><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.orm.scoped_session.bulk_update_mappings" title="Permalink to this definition">¶</a></dt>
<dd><p>Perform a bulk update of the given list of mapping dictionaries.</p>
<div class="class-bases docutils container">
<p>Proxied for the <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> class on
behalf of the <a class="reference internal" href="#sqlalchemy.orm.scoped_session" title="sqlalchemy.orm.scoping.scoped_session"><code class="xref py py-class docutils literal notranslate"><span class="pre">scoped_session</span></code></a> class.</p>
</div>
<div class="admonition legacy">
<p class="admonition-title">Legacy Feature</p>
<p>This method is a legacy feature as of the 2.0 series of
SQLAlchemy.   For modern bulk INSERT and UPDATE, see
the sections <a class="reference internal" href="queryguide/dml.html#orm-queryguide-bulk-insert"><span class="std std-ref">ORM 批量 INSERT 语句</span></a> and
<span class="xref std std-ref">orm_queryguide_bulk_update</span>.  The 2.0 API shares
implementation details with this method and adds new features
as well.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.orm.scoped_session.bulk_update_mappings.params.mapper"></span><strong>mapper</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.scoped_session.bulk_update_mappings.params.mapper">¶</a> – a mapped class, or the actual <code class="xref py py-class docutils literal notranslate"><span class="pre">Mapper</span></code>
object,
representing the single kind of object represented within the mapping
list.</p></li>
<li><p><span class="target" id="sqlalchemy.orm.scoped_session.bulk_update_mappings.params.mappings"></span><strong>mappings</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.scoped_session.bulk_update_mappings.params.mappings">¶</a> – a sequence of dictionaries, each one containing the
state of the mapped row to be updated, in terms of the attribute names
on the mapped class.   If the mapping refers to multiple tables, such
as a joined-inheritance mapping, each dictionary may contain keys
corresponding to all tables.   All those keys which are present and
are not part of the primary key are applied to the SET clause of the
UPDATE statement; the primary key values, which are required, are
applied to the WHERE clause.</p></li>
</ul>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="queryguide/dml.html"><span class="doc">支持 ORM 的 INSERT、UPDATE 和 DELETE 语句</span></a></p>
<p><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.bulk_insert_mappings()</span></code></p>
<p><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.bulk_save_objects()</span></code></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.scoped_session.close">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.scoped_session"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.scoped_session.</span></code></a><span class="sig-name descname"><span class="pre">close</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.orm.scoped_session.close" title="Permalink to this definition">¶</a></dt>
<dd><p>Close out the transactional resources and ORM objects used by this
<code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code>.</p>
<div class="class-bases docutils container">
<p>Proxied for the <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> class on
behalf of the <a class="reference internal" href="#sqlalchemy.orm.scoped_session" title="sqlalchemy.orm.scoping.scoped_session"><code class="xref py py-class docutils literal notranslate"><span class="pre">scoped_session</span></code></a> class.</p>
</div>
<p>This expunges all ORM objects associated with this
<code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code>, ends any transaction in progress and
<span class="xref std std-term">releases</span> any <code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code> objects which this
<code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> itself has checked out from associated
<code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code> objects. The operation then leaves the
<code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> in a state which it may be used again.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>The <code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.close()</span></code> method <strong>does not prevent the
Session from being used again</strong>.   The <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> itself
does not actually have a distinct “closed” state; it merely means
the <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> will release all database connections
and ORM objects.</p>
</div>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 1.4: </span>The <code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.close()</span></code> method does not
immediately create a new <code class="xref py py-class docutils literal notranslate"><span class="pre">SessionTransaction</span></code> object;
instead, the new <code class="xref py py-class docutils literal notranslate"><span class="pre">SessionTransaction</span></code> is created only if
the <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> is used again for a database operation.</p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="session_basics.html#session-closing"><span class="std std-ref">关闭</span></a> - detail on the semantics of
<code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.close()</span></code></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.scoped_session.close_all">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><a class="reference internal" href="#sqlalchemy.orm.scoped_session"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.scoped_session.</span></code></a><span class="sig-name descname"><span class="pre">close_all</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.orm.scoped_session.close_all" title="Permalink to this definition">¶</a></dt>
<dd><p>Close <em>all</em> sessions in memory.</p>
<div class="class-bases docutils container">
<p>Proxied for the <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> class on
behalf of the <a class="reference internal" href="#sqlalchemy.orm.scoped_session" title="sqlalchemy.orm.scoping.scoped_session"><code class="xref py py-class docutils literal notranslate"><span class="pre">scoped_session</span></code></a> class.</p>
</div>
<div class="deprecated">
<p><span class="versionmodified deprecated">Deprecated since version 1.3: </span>The <code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.close_all()</span></code> method is deprecated and will be removed in a future release.  Please refer to <code class="xref py py-func docutils literal notranslate"><span class="pre">close_all_sessions()</span></code>.</p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.scoped_session.commit">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.scoped_session"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.scoped_session.</span></code></a><span class="sig-name descname"><span class="pre">commit</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.orm.scoped_session.commit" title="Permalink to this definition">¶</a></dt>
<dd><p>Flush pending changes and commit the current transaction.</p>
<div class="class-bases docutils container">
<p>Proxied for the <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> class on
behalf of the <a class="reference internal" href="#sqlalchemy.orm.scoped_session" title="sqlalchemy.orm.scoping.scoped_session"><code class="xref py py-class docutils literal notranslate"><span class="pre">scoped_session</span></code></a> class.</p>
</div>
<p>When the COMMIT operation is complete, all objects are fully
<span class="xref std std-term">expired</span>, erasing their internal contents, which will be
automatically re-loaded when the objects are next accessed. In the
interim, these objects are in an expired state and will not function if
they are <span class="xref std std-term">detached</span> from the <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code>. Additionally,
this re-load operation is not supported when using asyncio-oriented
APIs. The <code class="xref py py-paramref docutils literal notranslate"><span class="pre">Session.expire_on_commit</span></code> parameter may be used
to disable this behavior.</p>
<p>When there is no transaction in place for the <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code>,
indicating that no operations were invoked on this <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code>
since the previous call to <code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.commit()</span></code>, the method will
begin and commit an internal-only “logical” transaction, that does not
normally affect the database unless pending flush changes were
detected, but will still invoke event handlers and object expiration
rules.</p>
<p>The outermost database transaction is committed unconditionally,
automatically releasing any SAVEPOINTs in effect.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="session_basics.html#session-committing"><span class="std std-ref">提交</span></a></p>
<p><a class="reference internal" href="session_transaction.html#unitofwork-transaction"><span class="std std-ref">管理事务</span></a></p>
<p><a class="reference internal" href="extensions/asyncio.html#asyncio-orm-avoid-lazyloads"><span class="std std-ref">在使用 AsyncSession 时避免隐式 I/O</span></a></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.scoped_session.configure">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.scoped_session"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.scoped_session.</span></code></a><span class="sig-name descname"><span class="pre">configure</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.orm.scoped_session.configure" title="Permalink to this definition">¶</a></dt>
<dd><p>reconfigure the <code class="xref py py-class docutils literal notranslate"><span class="pre">sessionmaker</span></code> used by this
<a class="reference internal" href="#sqlalchemy.orm.scoped_session" title="sqlalchemy.orm.scoped_session"><code class="xref py py-class docutils literal notranslate"><span class="pre">scoped_session</span></code></a>.</p>
<p>See <code class="xref py py-meth docutils literal notranslate"><span class="pre">sessionmaker.configure()</span></code>.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.scoped_session.connection">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.scoped_session"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.scoped_session.</span></code></a><span class="sig-name descname"><span class="pre">connection</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">bind_arguments</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_BindArguments</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">execution_options</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">CoreExecuteOptionsParameter</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Connection</span></span></span><a class="headerlink" href="#sqlalchemy.orm.scoped_session.connection" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a <code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code> object corresponding to this
<code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> object’s transactional state.</p>
<div class="class-bases docutils container">
<p>Proxied for the <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> class on
behalf of the <a class="reference internal" href="#sqlalchemy.orm.scoped_session" title="sqlalchemy.orm.scoping.scoped_session"><code class="xref py py-class docutils literal notranslate"><span class="pre">scoped_session</span></code></a> class.</p>
</div>
<p>Either the <code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code> corresponding to the current
transaction is returned, or if no transaction is in progress, a new
one is begun and the <code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code>
returned (note that no
transactional state is established with the DBAPI until the first
SQL statement is emitted).</p>
<p>Ambiguity in multi-bind or unbound <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> objects can be
resolved through any of the optional keyword arguments.   This
ultimately makes usage of the <a class="reference internal" href="#sqlalchemy.orm.scoped_session.get_bind" title="sqlalchemy.orm.scoped_session.get_bind"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_bind()</span></code></a> method for resolution.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.orm.scoped_session.connection.params.bind_arguments"></span><strong>bind_arguments</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.scoped_session.connection.params.bind_arguments">¶</a> – dictionary of bind arguments.  May include
“mapper”, “bind”, “clause”, other custom arguments that are passed
to <code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.get_bind()</span></code>.</p></li>
<li><p><span class="target" id="sqlalchemy.orm.scoped_session.connection.params.execution_options"></span><strong>execution_options</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.scoped_session.connection.params.execution_options">¶</a> – <p>a dictionary of execution options that will
be passed to <code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.execution_options()</span></code>, <strong>when the
connection is first procured only</strong>.   If the connection is already
present within the <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code>, a warning is emitted and
the arguments are ignored.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="session_transaction.html#session-transaction-isolation"><span class="std std-ref">设置事务隔离级别 / DBAPI AUTOCOMMIT</span></a></p>
</div>
</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.scoped_session.delete">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.scoped_session"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.scoped_session.</span></code></a><span class="sig-name descname"><span class="pre">delete</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">instance</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">object</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.orm.scoped_session.delete" title="Permalink to this definition">¶</a></dt>
<dd><p>Mark an instance as deleted.</p>
<div class="class-bases docutils container">
<p>Proxied for the <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> class on
behalf of the <a class="reference internal" href="#sqlalchemy.orm.scoped_session" title="sqlalchemy.orm.scoping.scoped_session"><code class="xref py py-class docutils literal notranslate"><span class="pre">scoped_session</span></code></a> class.</p>
</div>
<p>The object is assumed to be either <span class="xref std std-term">persistent</span> or
<span class="xref std std-term">detached</span> when passed; after the method is called, the
object will remain in the <span class="xref std std-term">persistent</span> state until the next
flush proceeds.  During this time, the object will also be a member
of the <code class="xref py py-attr docutils literal notranslate"><span class="pre">Session.deleted</span></code> collection.</p>
<p>When the next flush proceeds, the object will move to the
<span class="xref std std-term">deleted</span> state, indicating a <code class="docutils literal notranslate"><span class="pre">DELETE</span></code> statement was emitted
for its row within the current transaction.   When the transaction
is successfully committed,
the deleted object is moved to the <span class="xref std std-term">detached</span> state and is
no longer present within this <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code>.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="session_basics.html#session-deleting"><span class="std std-ref">删除</span></a> - at <a class="reference internal" href="session_basics.html#session-basics"><span class="std std-ref">使用会话的基础知识</span></a></p>
</div>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.orm.scoped_session.deleted">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.orm.scoped_session"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.scoped_session.</span></code></a><span class="sig-name descname"><span class="pre">deleted</span></span><a class="headerlink" href="#sqlalchemy.orm.scoped_session.deleted" title="Permalink to this definition">¶</a></dt>
<dd><p>The set of all instances marked as ‘deleted’ within this <code class="docutils literal notranslate"><span class="pre">Session</span></code></p>
<div class="class-bases docutils container">
<p>Proxied for the <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> class
on behalf of the <a class="reference internal" href="#sqlalchemy.orm.scoped_session" title="sqlalchemy.orm.scoping.scoped_session"><code class="xref py py-class docutils literal notranslate"><span class="pre">scoped_session</span></code></a> class.</p>
</div>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.orm.scoped_session.dirty">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.orm.scoped_session"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.scoped_session.</span></code></a><span class="sig-name descname"><span class="pre">dirty</span></span><a class="headerlink" href="#sqlalchemy.orm.scoped_session.dirty" title="Permalink to this definition">¶</a></dt>
<dd><p>The set of all persistent instances considered dirty.</p>
<div class="class-bases docutils container">
<p>Proxied for the <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> class
on behalf of the <a class="reference internal" href="#sqlalchemy.orm.scoped_session" title="sqlalchemy.orm.scoping.scoped_session"><code class="xref py py-class docutils literal notranslate"><span class="pre">scoped_session</span></code></a> class.</p>
</div>
<p>E.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">some_mapped_object</span> <span class="ow">in</span> <span class="n">session</span><span class="o">.</span><span class="n">dirty</span></pre></div>
</div>
<p>Instances are considered dirty when they were modified but not
deleted.</p>
<p>Note that this ‘dirty’ calculation is ‘optimistic’; most
attribute-setting or collection modification operations will
mark an instance as ‘dirty’ and place it in this set, even if
there is no net change to the attribute’s value.  At flush
time, the value of each attribute is compared to its
previously saved value, and if there’s no net change, no SQL
operation will occur (this is a more expensive operation so
it’s only done at flush time).</p>
<p>To check if an instance has actionable net changes to its
attributes, use the <code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.is_modified()</span></code> method.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.scoped_session.execute">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.scoped_session"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.scoped_session.</span></code></a><span class="sig-name descname"><span class="pre">execute</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">statement</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.Executable" title="sqlalchemy.sql.expression.Executable"><span class="pre">Executable</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">params</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_CoreAnyExecuteParams</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">execution_options</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">OrmExecuteOptionsParameter</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">{}</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bind_arguments</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_BindArguments</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">_parent_execute_state</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">_add_event</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Result</span><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#sqlalchemy.orm.scoped_session.execute" title="Permalink to this definition">¶</a></dt>
<dd><p>Execute a SQL expression construct.</p>
<div class="class-bases docutils container">
<p>Proxied for the <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> class on
behalf of the <a class="reference internal" href="#sqlalchemy.orm.scoped_session" title="sqlalchemy.orm.scoping.scoped_session"><code class="xref py py-class docutils literal notranslate"><span class="pre">scoped_session</span></code></a> class.</p>
</div>
<p>Returns a <code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code> object representing
results of the statement execution.</p>
<p>E.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">select</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
    <span class="n">select</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="mi">5</span><span class="p">)</span>
<span class="p">)</span></pre></div>
</div>
<p>The API contract of <code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.execute()</span></code> is similar to that
of <code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.execute()</span></code>, the <a class="reference internal" href="../glossary.html#term-2.0-style"><span class="xref std std-term">2.0 style</span></a> version
of <code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code>.</p>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 1.4: </span>the <code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.execute()</span></code> method is
now the primary point of ORM statement execution when using
<a class="reference internal" href="../glossary.html#term-2.0-style"><span class="xref std std-term">2.0 style</span></a> ORM usage.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.orm.scoped_session.execute.params.statement"></span><strong>statement</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.scoped_session.execute.params.statement">¶</a> – An executable statement (i.e. an <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.Executable" title="sqlalchemy.sql.expression.Executable"><code class="xref py py-class docutils literal notranslate"><span class="pre">Executable</span></code></a> expression
such as <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.select" title="sqlalchemy.sql.expression.select"><code class="xref py py-func docutils literal notranslate"><span class="pre">select()</span></code></a>).</p></li>
<li><p><span class="target" id="sqlalchemy.orm.scoped_session.execute.params.params"></span><strong>params</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.scoped_session.execute.params.params">¶</a> – Optional dictionary, or list of dictionaries, containing
bound parameter values.   If a single dictionary, single-row
execution occurs; if a list of dictionaries, an
“executemany” will be invoked.  The keys in each dictionary
must correspond to parameter names present in the statement.</p></li>
<li><p><span class="target" id="sqlalchemy.orm.scoped_session.execute.params.execution_options"></span><strong>execution_options</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.scoped_session.execute.params.execution_options">¶</a> – <p>optional dictionary of execution options,
which will be associated with the statement execution.  This
dictionary can provide a subset of the options that are accepted
by <code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.execution_options()</span></code>, and may also
provide additional options understood only in an ORM context.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="queryguide/api.html#orm-queryguide-execution-options"><span class="std std-ref">ORM执行选项</span></a> - ORM-specific execution
options</p>
</div>
</p></li>
<li><p><span class="target" id="sqlalchemy.orm.scoped_session.execute.params.bind_arguments"></span><strong>bind_arguments</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.scoped_session.execute.params.bind_arguments">¶</a> – dictionary of additional arguments to determine
the bind.  May include “mapper”, “bind”, or other custom arguments.
Contents of this dictionary are passed to the
<code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.get_bind()</span></code> method.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>a <code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code> object.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.scoped_session.expire">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.scoped_session"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.scoped_session.</span></code></a><span class="sig-name descname"><span class="pre">expire</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">instance</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">object</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">attribute_names</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Iterable</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.orm.scoped_session.expire" title="Permalink to this definition">¶</a></dt>
<dd><p>Expire the attributes on an instance.</p>
<div class="class-bases docutils container">
<p>Proxied for the <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> class on
behalf of the <a class="reference internal" href="#sqlalchemy.orm.scoped_session" title="sqlalchemy.orm.scoping.scoped_session"><code class="xref py py-class docutils literal notranslate"><span class="pre">scoped_session</span></code></a> class.</p>
</div>
<p>Marks the attributes of an instance as out of date. When an expired
attribute is next accessed, a query will be issued to the
<code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> object’s current transactional context in order to
load all expired attributes for the given instance.   Note that
a highly isolated transaction will return the same values as were
previously read in that same transaction, regardless of changes
in database state outside of that transaction.</p>
<p>To expire all objects in the <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> simultaneously,
use <code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.expire_all()</span></code>.</p>
<p>The <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> object’s default behavior is to
expire all state whenever the <code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.rollback()</span></code>
or <code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.commit()</span></code> methods are called, so that new
state can be loaded for the new transaction.   For this reason,
calling <code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.expire()</span></code> only makes sense for the specific
case that a non-ORM SQL statement was emitted in the current
transaction.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.orm.scoped_session.expire.params.instance"></span><strong>instance</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.scoped_session.expire.params.instance">¶</a> – The instance to be refreshed.</p></li>
<li><p><span class="target" id="sqlalchemy.orm.scoped_session.expire.params.attribute_names"></span><strong>attribute_names</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.scoped_session.expire.params.attribute_names">¶</a> – optional list of string attribute names
indicating a subset of attributes to be expired.</p></li>
</ul>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><span class="xref std std-ref">session_expire</span> - introductory material</p>
<p><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.expire()</span></code></p>
<p><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.refresh()</span></code></p>
<p><a class="reference internal" href="queryguide/query.html#sqlalchemy.orm.Query.populate_existing" title="sqlalchemy.orm.Query.populate_existing"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Query.populate_existing()</span></code></a></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.scoped_session.expire_all">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.scoped_session"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.scoped_session.</span></code></a><span class="sig-name descname"><span class="pre">expire_all</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.orm.scoped_session.expire_all" title="Permalink to this definition">¶</a></dt>
<dd><p>Expires all persistent instances within this Session.</p>
<div class="class-bases docutils container">
<p>Proxied for the <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> class on
behalf of the <a class="reference internal" href="#sqlalchemy.orm.scoped_session" title="sqlalchemy.orm.scoping.scoped_session"><code class="xref py py-class docutils literal notranslate"><span class="pre">scoped_session</span></code></a> class.</p>
</div>
<p>When any attributes on a persistent instance is next accessed,
a query will be issued using the
<code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> object’s current transactional context in order to
load all expired attributes for the given instance.   Note that
a highly isolated transaction will return the same values as were
previously read in that same transaction, regardless of changes
in database state outside of that transaction.</p>
<p>To expire individual objects and individual attributes
on those objects, use <code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.expire()</span></code>.</p>
<p>The <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> object’s default behavior is to
expire all state whenever the <code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.rollback()</span></code>
or <code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.commit()</span></code> methods are called, so that new
state can be loaded for the new transaction.   For this reason,
calling <code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.expire_all()</span></code> is not usually needed,
assuming the transaction is isolated.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><span class="xref std std-ref">session_expire</span> - introductory material</p>
<p><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.expire()</span></code></p>
<p><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.refresh()</span></code></p>
<p><a class="reference internal" href="queryguide/query.html#sqlalchemy.orm.Query.populate_existing" title="sqlalchemy.orm.Query.populate_existing"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Query.populate_existing()</span></code></a></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.scoped_session.expunge">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.scoped_session"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.scoped_session.</span></code></a><span class="sig-name descname"><span class="pre">expunge</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">instance</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">object</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.orm.scoped_session.expunge" title="Permalink to this definition">¶</a></dt>
<dd><p>Remove the <cite>instance</cite> from this <code class="docutils literal notranslate"><span class="pre">Session</span></code>.</p>
<div class="class-bases docutils container">
<p>Proxied for the <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> class on
behalf of the <a class="reference internal" href="#sqlalchemy.orm.scoped_session" title="sqlalchemy.orm.scoping.scoped_session"><code class="xref py py-class docutils literal notranslate"><span class="pre">scoped_session</span></code></a> class.</p>
</div>
<p>This will free all internal references to the instance.  Cascading
will be applied according to the <em>expunge</em> cascade rule.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.scoped_session.expunge_all">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.scoped_session"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.scoped_session.</span></code></a><span class="sig-name descname"><span class="pre">expunge_all</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.orm.scoped_session.expunge_all" title="Permalink to this definition">¶</a></dt>
<dd><p>Remove all object instances from this <code class="docutils literal notranslate"><span class="pre">Session</span></code>.</p>
<div class="class-bases docutils container">
<p>Proxied for the <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> class on
behalf of the <a class="reference internal" href="#sqlalchemy.orm.scoped_session" title="sqlalchemy.orm.scoping.scoped_session"><code class="xref py py-class docutils literal notranslate"><span class="pre">scoped_session</span></code></a> class.</p>
</div>
<p>This is equivalent to calling <code class="docutils literal notranslate"><span class="pre">expunge(obj)</span></code> on all objects in this
<code class="docutils literal notranslate"><span class="pre">Session</span></code>.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.scoped_session.flush">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.scoped_session"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.scoped_session.</span></code></a><span class="sig-name descname"><span class="pre">flush</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">objects</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Sequence</span><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.orm.scoped_session.flush" title="Permalink to this definition">¶</a></dt>
<dd><p>Flush all the object changes to the database.</p>
<div class="class-bases docutils container">
<p>Proxied for the <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> class on
behalf of the <a class="reference internal" href="#sqlalchemy.orm.scoped_session" title="sqlalchemy.orm.scoping.scoped_session"><code class="xref py py-class docutils literal notranslate"><span class="pre">scoped_session</span></code></a> class.</p>
</div>
<p>Writes out all pending object creations, deletions and modifications
to the database as INSERTs, DELETEs, UPDATEs, etc.  Operations are
automatically ordered by the Session’s unit of work dependency
solver.</p>
<p>Database operations will be issued in the current transactional
context and do not affect the state of the transaction, unless an
error occurs, in which case the entire transaction is rolled back.
You may flush() as often as you like within a transaction to move
changes from Python to the database’s transaction buffer.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><span class="target" id="sqlalchemy.orm.scoped_session.flush.params.objects"></span><strong>objects</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.scoped_session.flush.params.objects">¶</a> – <p>Optional; restricts the flush operation to operate
only on elements that are in the given collection.</p>
<p>This feature is for an extremely narrow set of use cases where
particular objects may need to be operated upon before the
full flush() occurs.  It is not intended for general use.</p>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.scoped_session.get">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.scoped_session"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.scoped_session.</span></code></a><span class="sig-name descname"><span class="pre">get</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">entity</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_EntityBindKey</span><span class="p"><span class="pre">[</span></span><span class="pre">_O</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ident</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_PKIdentityArgument</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">options</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="../core/defaults.html#sqlalchemy.schema.Sequence" title="sqlalchemy.schema.Sequence"><span class="pre">Sequence</span></a><span class="p"><span class="pre">[</span></span><span class="pre">ORMOption</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">populate_existing</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">with_for_update</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">ForUpdateParameter</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">identity_token</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">execution_options</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">OrmExecuteOptionsParameter</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">{}</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bind_arguments</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_BindArguments</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">_O</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.orm.scoped_session.get" title="Permalink to this definition">¶</a></dt>
<dd><p>Return an instance based on the given primary key identifier,
or <code class="docutils literal notranslate"><span class="pre">None</span></code> if not found.</p>
<div class="class-bases docutils container">
<p>Proxied for the <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> class on
behalf of the <a class="reference internal" href="#sqlalchemy.orm.scoped_session" title="sqlalchemy.orm.scoping.scoped_session"><code class="xref py py-class docutils literal notranslate"><span class="pre">scoped_session</span></code></a> class.</p>
</div>
<p>E.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">my_user</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>

<span class="n">some_object</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">VersionedFoo</span><span class="p">,</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

<span class="n">some_object</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
    <span class="n">VersionedFoo</span><span class="p">,</span>
    <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s2">&quot;version_id&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">}</span>
<span class="p">)</span></pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.4: </span>Added <code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.get()</span></code>, which is moved
from the now legacy <a class="reference internal" href="queryguide/query.html#sqlalchemy.orm.Query.get" title="sqlalchemy.orm.Query.get"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Query.get()</span></code></a> method.</p>
</div>
<p><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.get()</span></code> is special in that it provides direct
access to the identity map of the <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code>.
If the given primary key identifier is present
in the local identity map, the object is returned
directly from this collection and no SQL is emitted,
unless the object has been marked fully expired.
If not present,
a SELECT is performed in order to locate the object.</p>
<p><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.get()</span></code> also will perform a check if
the object is present in the identity map and
marked as expired - a SELECT
is emitted to refresh the object as well as to
ensure that the row is still present.
If not, <a class="reference internal" href="exceptions.html#sqlalchemy.orm.exc.ObjectDeletedError" title="sqlalchemy.orm.exc.ObjectDeletedError"><code class="xref py py-class docutils literal notranslate"><span class="pre">ObjectDeletedError</span></code></a> is raised.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.orm.scoped_session.get.params.entity"></span><strong>entity</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.scoped_session.get.params.entity">¶</a> – a mapped class or <code class="xref py py-class docutils literal notranslate"><span class="pre">Mapper</span></code> indicating the
type of entity to be loaded.</p></li>
<li><p><span class="target" id="sqlalchemy.orm.scoped_session.get.params.ident"></span><strong>ident</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.scoped_session.get.params.ident">¶</a> – <p>A scalar, tuple, or dictionary representing the
primary key.  For a composite (e.g. multiple column) primary key,
a tuple or dictionary should be passed.</p>
<p>For a single-column primary key, the scalar calling form is typically
the most expedient.  If the primary key of a row is the value “5”,
the call looks like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">my_object</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">SomeClass</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span></pre></div>
</div>
<p>The tuple form contains primary key values typically in
the order in which they correspond to the mapped
<a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal notranslate"><span class="pre">Table</span></code></a>
object’s primary key columns, or if the
<code class="xref py py-paramref docutils literal notranslate"><span class="pre">Mapper.primary_key</span></code> configuration parameter were
used, in
the order used for that parameter. For example, if the primary key
of a row is represented by the integer
digits “5, 10” the call would look like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">my_object</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">SomeClass</span><span class="p">,</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span></pre></div>
</div>
<p>The dictionary form should include as keys the mapped attribute names
corresponding to each element of the primary key.  If the mapped class
has the attributes <code class="docutils literal notranslate"><span class="pre">id</span></code>, <code class="docutils literal notranslate"><span class="pre">version_id</span></code> as the attributes which
store the object’s primary key value, the call would look like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">my_object</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">SomeClass</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s2">&quot;version_id&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">})</span></pre></div>
</div>
</p></li>
<li><p><span class="target" id="sqlalchemy.orm.scoped_session.get.params.options"></span><strong>options</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.scoped_session.get.params.options">¶</a> – optional sequence of loader options which will be
applied to the query, if one is emitted.</p></li>
<li><p><span class="target" id="sqlalchemy.orm.scoped_session.get.params.populate_existing"></span><strong>populate_existing</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.scoped_session.get.params.populate_existing">¶</a> – causes the method to unconditionally emit
a SQL query and refresh the object with the newly loaded data,
regardless of whether or not the object is already present.</p></li>
<li><p><span class="target" id="sqlalchemy.orm.scoped_session.get.params.with_for_update"></span><strong>with_for_update</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.scoped_session.get.params.with_for_update">¶</a> – optional boolean <code class="docutils literal notranslate"><span class="pre">True</span></code> indicating FOR UPDATE
should be used, or may be a dictionary containing flags to
indicate a more specific set of FOR UPDATE flags for the SELECT;
flags should match the parameters of
<a class="reference internal" href="queryguide/query.html#sqlalchemy.orm.Query.with_for_update" title="sqlalchemy.orm.Query.with_for_update"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Query.with_for_update()</span></code></a>.
Supersedes the <code class="xref py py-paramref docutils literal notranslate"><span class="pre">Session.refresh.lockmode</span></code> parameter.</p></li>
<li><p><span class="target" id="sqlalchemy.orm.scoped_session.get.params.execution_options"></span><strong>execution_options</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.scoped_session.get.params.execution_options">¶</a> – <p>optional dictionary of execution options,
which will be associated with the query execution if one is emitted.
This dictionary can provide a subset of the options that are
accepted by <code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.execution_options()</span></code>, and may
also provide additional options understood only in an ORM context.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.4.29.</span></p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="queryguide/api.html#orm-queryguide-execution-options"><span class="std std-ref">ORM执行选项</span></a> - ORM-specific execution
options</p>
</div>
</p></li>
<li><p><span class="target" id="sqlalchemy.orm.scoped_session.get.params.bind_arguments"></span><strong>bind_arguments</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.scoped_session.get.params.bind_arguments">¶</a> – <p>dictionary of additional arguments to determine
the bind.  May include “mapper”, “bind”, or other custom arguments.
Contents of this dictionary are passed to the
<code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.get_bind()</span></code> method.</p>
</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The object instance, or <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.scoped_session.get_bind">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.scoped_session"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.scoped_session.</span></code></a><span class="sig-name descname"><span class="pre">get_bind</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mapper</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_EntityBindKey</span><span class="p"><span class="pre">[</span></span><span class="pre">_O</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clause</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="../core/foundation.html#sqlalchemy.sql.expression.ClauseElement" title="sqlalchemy.sql.expression.ClauseElement"><span class="pre">ClauseElement</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bind</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_SessionBind</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">_sa_skip_events</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">_sa_skip_for_implicit_returning</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kw</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Engine</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Connection</span></span></span><a class="headerlink" href="#sqlalchemy.orm.scoped_session.get_bind" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a “bind” to which this <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> is bound.</p>
<div class="class-bases docutils container">
<p>Proxied for the <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> class on
behalf of the <a class="reference internal" href="#sqlalchemy.orm.scoped_session" title="sqlalchemy.orm.scoping.scoped_session"><code class="xref py py-class docutils literal notranslate"><span class="pre">scoped_session</span></code></a> class.</p>
</div>
<p>The “bind” is usually an instance of <code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code>,
except in the case where the <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> has been
explicitly bound directly to a <code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code>.</p>
<p>For a multiply-bound or unbound <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code>, the
<code class="docutils literal notranslate"><span class="pre">mapper</span></code> or <code class="docutils literal notranslate"><span class="pre">clause</span></code> arguments are used to determine the
appropriate bind to return.</p>
<p>Note that the “mapper” argument is usually present
when <code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.get_bind()</span></code> is called via an ORM
operation such as a <code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.query()</span></code>, each
individual INSERT/UPDATE/DELETE operation within a
<code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.flush()</span></code>, call, etc.</p>
<p>The order of resolution is:</p>
<ol class="arabic simple">
<li><p>if mapper given and <code class="xref py py-paramref docutils literal notranslate"><span class="pre">Session.binds</span></code> is present,
locate a bind based first on the mapper in use, then
on the mapped class in use, then on any base classes that are
present in the <code class="docutils literal notranslate"><span class="pre">__mro__</span></code> of the mapped class, from more specific
superclasses to more general.</p></li>
<li><p>if clause given and <code class="docutils literal notranslate"><span class="pre">Session.binds</span></code> is present,
locate a bind based on <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal notranslate"><span class="pre">Table</span></code></a> objects
found in the given clause present in <code class="docutils literal notranslate"><span class="pre">Session.binds</span></code>.</p></li>
<li><p>if <code class="docutils literal notranslate"><span class="pre">Session.binds</span></code> is present, return that.</p></li>
<li><p>if clause given, attempt to return a bind
linked to the <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.MetaData" title="sqlalchemy.schema.MetaData"><code class="xref py py-class docutils literal notranslate"><span class="pre">MetaData</span></code></a> ultimately
associated with the clause.</p></li>
<li><p>if mapper given, attempt to return a bind
linked to the <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.MetaData" title="sqlalchemy.schema.MetaData"><code class="xref py py-class docutils literal notranslate"><span class="pre">MetaData</span></code></a> ultimately
associated with the <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal notranslate"><span class="pre">Table</span></code></a> or other
selectable to which the mapper is mapped.</p></li>
<li><p>No bind can be found, <a class="reference internal" href="../core/exceptions.html#sqlalchemy.exc.UnboundExecutionError" title="sqlalchemy.exc.UnboundExecutionError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">UnboundExecutionError</span></code></a>
is raised.</p></li>
</ol>
<p>Note that the <code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.get_bind()</span></code> method can be overridden on
a user-defined subclass of <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> to provide any kind
of bind resolution scheme.  See the example at
<a class="reference internal" href="persistence_techniques.html#session-custom-partitioning"><span class="std std-ref">自定义垂直分区</span></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.orm.scoped_session.get_bind.params.mapper"></span><strong>mapper</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.scoped_session.get_bind.params.mapper">¶</a> – Optional mapped class or corresponding <code class="xref py py-class docutils literal notranslate"><span class="pre">Mapper</span></code> instance.
The bind can be derived from a <code class="xref py py-class docutils literal notranslate"><span class="pre">Mapper</span></code> first by
consulting the “binds” map associated with this <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code>,
and secondly by consulting the <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.MetaData" title="sqlalchemy.schema.MetaData"><code class="xref py py-class docutils literal notranslate"><span class="pre">MetaData</span></code></a> associated
with the <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal notranslate"><span class="pre">Table</span></code></a> to which the <code class="xref py py-class docutils literal notranslate"><span class="pre">Mapper</span></code> is
mapped for a bind.</p></li>
<li><p><span class="target" id="sqlalchemy.orm.scoped_session.get_bind.params.clause"></span><strong>clause</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.scoped_session.get_bind.params.clause">¶</a> – A <a class="reference internal" href="../core/foundation.html#sqlalchemy.sql.expression.ClauseElement" title="sqlalchemy.sql.expression.ClauseElement"><code class="xref py py-class docutils literal notranslate"><span class="pre">ClauseElement</span></code></a> (i.e.
<a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.select" title="sqlalchemy.sql.expression.select"><code class="xref py py-func docutils literal notranslate"><span class="pre">select()</span></code></a>,
<a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.text" title="sqlalchemy.sql.expression.text"><code class="xref py py-func docutils literal notranslate"><span class="pre">text()</span></code></a>,
etc.).  If the <code class="docutils literal notranslate"><span class="pre">mapper</span></code> argument is not present or could not
produce a bind, the given expression construct will be searched
for a bound element, typically a <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal notranslate"><span class="pre">Table</span></code></a>
associated with
bound <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.MetaData" title="sqlalchemy.schema.MetaData"><code class="xref py py-class docutils literal notranslate"><span class="pre">MetaData</span></code></a>.</p></li>
</ul>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="persistence_techniques.html#session-partitioning"><span class="std std-ref">分区策略（例如，每个Session的多个数据库后端）</span></a></p>
<p><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Session.binds</span></code></p>
<p><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.bind_mapper()</span></code></p>
<p><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.bind_table()</span></code></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.scoped_session.identity_key">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><a class="reference internal" href="#sqlalchemy.orm.scoped_session"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.scoped_session.</span></code></a><span class="sig-name descname"><span class="pre">identity_key</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">class_</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Type</span><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ident</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.Tuple" title="sqlalchemy.sql.expression.Tuple"><span class="pre">Tuple</span></a><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="p"><span class="pre">...</span></span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">instance</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">row</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Row</span><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">RowMapping</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">identity_token</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">_IdentityKeyType</span><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#sqlalchemy.orm.scoped_session.identity_key" title="Permalink to this definition">¶</a></dt>
<dd><p>Return an identity key.</p>
<div class="class-bases docutils container">
<p>Proxied for the <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> class on
behalf of the <a class="reference internal" href="#sqlalchemy.orm.scoped_session" title="sqlalchemy.orm.scoping.scoped_session"><code class="xref py py-class docutils literal notranslate"><span class="pre">scoped_session</span></code></a> class.</p>
</div>
<p>This is an alias of <a class="reference internal" href="mapping_api.html#sqlalchemy.orm.util.identity_key" title="sqlalchemy.orm.util.identity_key"><code class="xref py py-func docutils literal notranslate"><span class="pre">identity_key()</span></code></a>.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.orm.scoped_session.identity_map">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.orm.scoped_session"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.scoped_session.</span></code></a><span class="sig-name descname"><span class="pre">identity_map</span></span><a class="headerlink" href="#sqlalchemy.orm.scoped_session.identity_map" title="Permalink to this definition">¶</a></dt>
<dd><p>Proxy for the <code class="xref py py-attr docutils literal notranslate"><span class="pre">Session.identity_map</span></code> attribute
on behalf of the <a class="reference internal" href="#sqlalchemy.orm.scoped_session" title="sqlalchemy.orm.scoping.scoped_session"><code class="xref py py-class docutils literal notranslate"><span class="pre">scoped_session</span></code></a> class.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.orm.scoped_session.info">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.orm.scoped_session"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.scoped_session.</span></code></a><span class="sig-name descname"><span class="pre">info</span></span><a class="headerlink" href="#sqlalchemy.orm.scoped_session.info" title="Permalink to this definition">¶</a></dt>
<dd><p>A user-modifiable dictionary.</p>
<div class="class-bases docutils container">
<p>Proxied for the <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> class
on behalf of the <a class="reference internal" href="#sqlalchemy.orm.scoped_session" title="sqlalchemy.orm.scoping.scoped_session"><code class="xref py py-class docutils literal notranslate"><span class="pre">scoped_session</span></code></a> class.</p>
</div>
<p>The initial value of this dictionary can be populated using the
<code class="docutils literal notranslate"><span class="pre">info</span></code> argument to the <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> constructor or
<code class="xref py py-class docutils literal notranslate"><span class="pre">sessionmaker</span></code> constructor or factory methods.  The dictionary
here is always local to this <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> and can be modified
independently of all other <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> objects.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.orm.scoped_session.is_active">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.orm.scoped_session"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.scoped_session.</span></code></a><span class="sig-name descname"><span class="pre">is_active</span></span><a class="headerlink" href="#sqlalchemy.orm.scoped_session.is_active" title="Permalink to this definition">¶</a></dt>
<dd><p>True if this <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> not in “partial rollback” state.</p>
<div class="class-bases docutils container">
<p>Proxied for the <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> class
on behalf of the <a class="reference internal" href="#sqlalchemy.orm.scoped_session" title="sqlalchemy.orm.scoping.scoped_session"><code class="xref py py-class docutils literal notranslate"><span class="pre">scoped_session</span></code></a> class.</p>
</div>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 1.4: </span>The <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> no longer begins
a new transaction immediately, so this attribute will be False
when the <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> is first instantiated.</p>
</div>
<p>“partial rollback” state typically indicates that the flush process
of the <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> has failed, and that the
<code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.rollback()</span></code> method must be emitted in order to
fully roll back the transaction.</p>
<p>If this <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> is not in a transaction at all, the
<code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> will autobegin when it is first used, so in this
case <code class="xref py py-attr docutils literal notranslate"><span class="pre">Session.is_active</span></code> will return True.</p>
<p>Otherwise, if this <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> is within a transaction,
and that transaction has not been rolled back internally, the
<code class="xref py py-attr docutils literal notranslate"><span class="pre">Session.is_active</span></code> will also return True.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../faq/sessions.html#faq-session-rollback"><span class="std std-ref">此Session的事务由于刷新期间之前的异常而被回滚了。 。 （或类似的）</span></a></p>
<p><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.in_transaction()</span></code></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.scoped_session.is_modified">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.scoped_session"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.scoped_session.</span></code></a><span class="sig-name descname"><span class="pre">is_modified</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">instance</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">object</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">include_collections</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">bool</span></span></span><a class="headerlink" href="#sqlalchemy.orm.scoped_session.is_modified" title="Permalink to this definition">¶</a></dt>
<dd><p>Return <code class="docutils literal notranslate"><span class="pre">True</span></code> if the given instance has locally
modified attributes.</p>
<div class="class-bases docutils container">
<p>Proxied for the <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> class on
behalf of the <a class="reference internal" href="#sqlalchemy.orm.scoped_session" title="sqlalchemy.orm.scoping.scoped_session"><code class="xref py py-class docutils literal notranslate"><span class="pre">scoped_session</span></code></a> class.</p>
</div>
<p>This method retrieves the history for each instrumented
attribute on the instance and performs a comparison of the current
value to its previously committed value, if any.</p>
<p>It is in effect a more expensive and accurate
version of checking for the given instance in the
<code class="xref py py-attr docutils literal notranslate"><span class="pre">Session.dirty</span></code> collection; a full test for
each attribute’s net “dirty” status is performed.</p>
<p>E.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">return</span> <span class="n">session</span><span class="o">.</span><span class="n">is_modified</span><span class="p">(</span><span class="n">someobject</span><span class="p">)</span></pre></div>
</div>
<p>A few caveats to this method apply:</p>
<ul>
<li><p>Instances present in the <code class="xref py py-attr docutils literal notranslate"><span class="pre">Session.dirty</span></code> collection may
report <code class="docutils literal notranslate"><span class="pre">False</span></code> when tested with this method.  This is because
the object may have received change events via attribute mutation,
thus placing it in <code class="xref py py-attr docutils literal notranslate"><span class="pre">Session.dirty</span></code>, but ultimately the state
is the same as that loaded from the database, resulting in no net
change here.</p></li>
<li><p>Scalar attributes may not have recorded the previously set
value when a new value was applied, if the attribute was not loaded,
or was expired, at the time the new value was received - in these
cases, the attribute is assumed to have a change, even if there is
ultimately no net change against its database value. SQLAlchemy in
most cases does not need the “old” value when a set event occurs, so
it skips the expense of a SQL call if the old value isn’t present,
based on the assumption that an UPDATE of the scalar value is
usually needed, and in those few cases where it isn’t, is less
expensive on average than issuing a defensive SELECT.</p>
<p>The “old” value is fetched unconditionally upon set only if the
attribute container has the <code class="docutils literal notranslate"><span class="pre">active_history</span></code> flag set to <code class="docutils literal notranslate"><span class="pre">True</span></code>.
This flag is set typically for primary key attributes and scalar
object references that are not a simple many-to-one.  To set this
flag for any arbitrary mapped column, use the <code class="docutils literal notranslate"><span class="pre">active_history</span></code>
argument with <code class="xref py py-func docutils literal notranslate"><span class="pre">column_property()</span></code>.</p>
</li>
</ul>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.orm.scoped_session.is_modified.params.instance"></span><strong>instance</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.scoped_session.is_modified.params.instance">¶</a> – mapped instance to be tested for pending changes.</p></li>
<li><p><span class="target" id="sqlalchemy.orm.scoped_session.is_modified.params.include_collections"></span><strong>include_collections</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.scoped_session.is_modified.params.include_collections">¶</a> – Indicates if multivalued collections
should be included in the operation.  Setting this to <code class="docutils literal notranslate"><span class="pre">False</span></code> is a
way to detect only local-column based properties (i.e. scalar columns
or many-to-one foreign keys) that would result in an UPDATE for this
instance upon flush.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.scoped_session.merge">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.scoped_session"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.scoped_session.</span></code></a><span class="sig-name descname"><span class="pre">merge</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">instance</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_O</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">load</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">options</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="../core/defaults.html#sqlalchemy.schema.Sequence" title="sqlalchemy.schema.Sequence"><span class="pre">Sequence</span></a><span class="p"><span class="pre">[</span></span><span class="pre">ORMOption</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">_O</span></span></span><a class="headerlink" href="#sqlalchemy.orm.scoped_session.merge" title="Permalink to this definition">¶</a></dt>
<dd><p>Copy the state of a given instance into a corresponding instance
within this <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code>.</p>
<div class="class-bases docutils container">
<p>Proxied for the <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> class on
behalf of the <a class="reference internal" href="#sqlalchemy.orm.scoped_session" title="sqlalchemy.orm.scoping.scoped_session"><code class="xref py py-class docutils literal notranslate"><span class="pre">scoped_session</span></code></a> class.</p>
</div>
<p><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.merge()</span></code> examines the primary key attributes of the
source instance, and attempts to reconcile it with an instance of the
same primary key in the session.   If not found locally, it attempts
to load the object from the database based on primary key, and if
none can be located, creates a new instance.  The state of each
attribute on the source instance is then copied to the target
instance.  The resulting target instance is then returned by the
method; the original source instance is left unmodified, and
un-associated with the <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> if not already.</p>
<p>This operation cascades to associated instances if the association is
mapped with <code class="docutils literal notranslate"><span class="pre">cascade=&quot;merge&quot;</span></code>.</p>
<p>See <a class="reference internal" href="session_state_management.html#unitofwork-merging"><span class="std std-ref">合并</span></a> for a detailed discussion of merging.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.orm.scoped_session.merge.params.instance"></span><strong>instance</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.scoped_session.merge.params.instance">¶</a> – Instance to be merged.</p></li>
<li><p><span class="target" id="sqlalchemy.orm.scoped_session.merge.params.load"></span><strong>load</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.scoped_session.merge.params.load">¶</a> – <p>Boolean, when False, <a class="reference internal" href="#sqlalchemy.orm.scoped_session.merge" title="sqlalchemy.orm.scoped_session.merge"><code class="xref py py-meth docutils literal notranslate"><span class="pre">merge()</span></code></a> switches into
a “high performance” mode which causes it to forego emitting history
events as well as all database access.  This flag is used for
cases such as transferring graphs of objects into a <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code>
from a second level cache, or to transfer just-loaded objects
into the <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> owned by a worker thread or process
without re-querying the database.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">load=False</span></code> use case adds the caveat that the given
object has to be in a “clean” state, that is, has no pending changes
to be flushed - even if the incoming object is detached from any
<code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code>.   This is so that when
the merge operation populates local attributes and
cascades to related objects and
collections, the values can be “stamped” onto the
target object as is, without generating any history or attribute
events, and without the need to reconcile the incoming data with
any existing related objects or collections that might not
be loaded.  The resulting objects from <code class="docutils literal notranslate"><span class="pre">load=False</span></code> are always
produced as “clean”, so it is only appropriate that the given objects
should be “clean” as well, else this suggests a mis-use of the
method.</p>
</p></li>
<li><p><span class="target" id="sqlalchemy.orm.scoped_session.merge.params.options"></span><strong>options</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.scoped_session.merge.params.options">¶</a> – <p>optional sequence of loader options which will be
applied to the <code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.get()</span></code> method when the merge
operation loads the existing version of the object from the database.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.4.24.</span></p>
</div>
</p></li>
</ul>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><code class="xref py py-func docutils literal notranslate"><span class="pre">make_transient_to_detached()</span></code> - provides for an alternative
means of “merging” a single object into the <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></p>
</div>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.orm.scoped_session.new">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.orm.scoped_session"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.scoped_session.</span></code></a><span class="sig-name descname"><span class="pre">new</span></span><a class="headerlink" href="#sqlalchemy.orm.scoped_session.new" title="Permalink to this definition">¶</a></dt>
<dd><p>The set of all instances marked as ‘new’ within this <code class="docutils literal notranslate"><span class="pre">Session</span></code>.</p>
<div class="class-bases docutils container">
<p>Proxied for the <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> class
on behalf of the <a class="reference internal" href="#sqlalchemy.orm.scoped_session" title="sqlalchemy.orm.scoping.scoped_session"><code class="xref py py-class docutils literal notranslate"><span class="pre">scoped_session</span></code></a> class.</p>
</div>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.orm.scoped_session.no_autoflush">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.orm.scoped_session"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.scoped_session.</span></code></a><span class="sig-name descname"><span class="pre">no_autoflush</span></span><a class="headerlink" href="#sqlalchemy.orm.scoped_session.no_autoflush" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a context manager that disables autoflush.</p>
<div class="class-bases docutils container">
<p>Proxied for the <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> class
on behalf of the <a class="reference internal" href="#sqlalchemy.orm.scoped_session" title="sqlalchemy.orm.scoping.scoped_session"><code class="xref py py-class docutils literal notranslate"><span class="pre">scoped_session</span></code></a> class.</p>
</div>
<p>e.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">no_autoflush</span><span class="p">:</span>

    <span class="n">some_object</span> <span class="o">=</span> <span class="n">SomeClass</span><span class="p">()</span>
    <span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">some_object</span><span class="p">)</span>
    <span class="c1"># won&#39;t autoflush</span>
    <span class="n">some_object</span><span class="o">.</span><span class="n">related_thing</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">SomeRelated</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span></pre></div>
</div>
<p>Operations that proceed within the <code class="docutils literal notranslate"><span class="pre">with:</span></code> block
will not be subject to flushes occurring upon query
access.  This is useful when initializing a series
of objects which involve existing database queries,
where the uncompleted object should not yet be flushed.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.scoped_session.object_session">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><a class="reference internal" href="#sqlalchemy.orm.scoped_session"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.scoped_session.</span></code></a><span class="sig-name descname"><span class="pre">object_session</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">instance</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">object</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Session</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.orm.scoped_session.object_session" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> to which an object belongs.</p>
<div class="class-bases docutils container">
<p>Proxied for the <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> class on
behalf of the <a class="reference internal" href="#sqlalchemy.orm.scoped_session" title="sqlalchemy.orm.scoping.scoped_session"><code class="xref py py-class docutils literal notranslate"><span class="pre">scoped_session</span></code></a> class.</p>
</div>
<p>This is an alias of <code class="xref py py-func docutils literal notranslate"><span class="pre">object_session()</span></code>.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.scoped_session.query">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.scoped_session"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.scoped_session.</span></code></a><span class="sig-name descname"><span class="pre">query</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">entities</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_ColumnsClauseArgument</span><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="queryguide/query.html#sqlalchemy.orm.Query" title="sqlalchemy.orm.Query"><span class="pre">Query</span></a><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#sqlalchemy.orm.scoped_session.query" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a new <a class="reference internal" href="queryguide/query.html#sqlalchemy.orm.Query" title="sqlalchemy.orm.Query"><code class="xref py py-class docutils literal notranslate"><span class="pre">Query</span></code></a> object corresponding to this
<code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code>.</p>
<div class="class-bases docutils container">
<p>Proxied for the <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> class on
behalf of the <a class="reference internal" href="#sqlalchemy.orm.scoped_session" title="sqlalchemy.orm.scoping.scoped_session"><code class="xref py py-class docutils literal notranslate"><span class="pre">scoped_session</span></code></a> class.</p>
</div>
<p>Note that the <a class="reference internal" href="queryguide/query.html#sqlalchemy.orm.Query" title="sqlalchemy.orm.Query"><code class="xref py py-class docutils literal notranslate"><span class="pre">Query</span></code></a> object is legacy as of
SQLAlchemy 2.0; the <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.select" title="sqlalchemy.sql.expression.select"><code class="xref py py-func docutils literal notranslate"><span class="pre">select()</span></code></a> construct is now used
to construct ORM queries.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../tutorial/index.html#unified-tutorial"><span class="std std-ref">SQLAlchemy统一教程</span></a></p>
<p><span class="xref std std-ref">queryguide_toplevel</span></p>
<p><a class="reference internal" href="queryguide/query.html"><span class="std std-ref">旧版查询API</span></a> - legacy API doc</p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.scoped_session.query_property">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.scoped_session"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.scoped_session.</span></code></a><span class="sig-name descname"><span class="pre">query_property</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">query_cls</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Type</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="queryguide/query.html#sqlalchemy.orm.Query" title="sqlalchemy.orm.Query"><span class="pre">Query</span></a><span class="p"><span class="pre">[</span></span><span class="pre">_T</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#sqlalchemy.orm.QueryPropertyDescriptor" title="sqlalchemy.orm.QueryPropertyDescriptor"><span class="pre">QueryPropertyDescriptor</span></a></span></span><a class="headerlink" href="#sqlalchemy.orm.scoped_session.query_property" title="Permalink to this definition">¶</a></dt>
<dd><p>return a class property which produces a legacy
<a class="reference internal" href="queryguide/query.html#sqlalchemy.orm.Query" title="sqlalchemy.orm.Query"><code class="xref py py-class docutils literal notranslate"><span class="pre">Query</span></code></a> object against the class and the current
<code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> when called.</p>
<div class="admonition legacy">
<p class="admonition-title">Legacy Feature</p>
<p>The <a class="reference internal" href="#sqlalchemy.orm.scoped_session.query_property" title="sqlalchemy.orm.scoped_session.query_property"><code class="xref py py-meth docutils literal notranslate"><span class="pre">scoped_session.query_property()</span></code></a> accessor
is specific to the legacy <a class="reference internal" href="queryguide/query.html#sqlalchemy.orm.Query" title="sqlalchemy.orm.Query"><code class="xref py py-class docutils literal notranslate"><span class="pre">Query</span></code></a> object and is not
considered to be part of <a class="reference internal" href="../glossary.html#term-1"><span class="xref std std-term">2.0-style</span></a> ORM use.</p>
</div>
<p>e.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">QueryPropertyDescriptor</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">scoped_session</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">sessionmaker</span>

<span class="n">Session</span> <span class="o">=</span> <span class="n">scoped_session</span><span class="p">(</span><span class="n">sessionmaker</span><span class="p">())</span>

<span class="k">class</span> <span class="nc">MyClass</span><span class="p">:</span>
    <span class="n">query</span><span class="p">:</span> <span class="n">QueryPropertyDescriptor</span> <span class="o">=</span> <span class="n">Session</span><span class="o">.</span><span class="n">query_property</span><span class="p">()</span>

<span class="c1"># after mappers are defined</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">MyClass</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">MyClass</span><span class="o">.</span><span class="n">name</span><span class="o">==</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span></pre><div class="code-annotations-key"></div></div>
</div>
<p>Produces instances of the session’s configured query class by
default.  To override and use a custom implementation, provide
a <code class="docutils literal notranslate"><span class="pre">query_cls</span></code> callable.  The callable will be invoked with
the class’s mapper as a positional argument and a session
keyword argument.</p>
<p>There is no limit to the number of query properties placed on
a class.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.scoped_session.refresh">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.scoped_session"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.scoped_session.</span></code></a><span class="sig-name descname"><span class="pre">refresh</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">instance</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">object</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">attribute_names</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Iterable</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">with_for_update</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">ForUpdateParameter</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.orm.scoped_session.refresh" title="Permalink to this definition">¶</a></dt>
<dd><p>Expire and refresh attributes on the given instance.</p>
<div class="class-bases docutils container">
<p>Proxied for the <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> class on
behalf of the <a class="reference internal" href="#sqlalchemy.orm.scoped_session" title="sqlalchemy.orm.scoping.scoped_session"><code class="xref py py-class docutils literal notranslate"><span class="pre">scoped_session</span></code></a> class.</p>
</div>
<p>The selected attributes will first be expired as they would when using
<code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.expire()</span></code>; then a SELECT statement will be issued to
the database to refresh column-oriented attributes with the current
value available in the current transaction.</p>
<p><code class="xref py py-func docutils literal notranslate"><span class="pre">relationship()</span></code> oriented attributes will also be immediately
loaded if they were already eagerly loaded on the object, using the
same eager loading strategy that they were loaded with originally.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.4: </span>- the <code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.refresh()</span></code> method
can also refresh eagerly loaded attributes.</p>
</div>
<p><code class="xref py py-func docutils literal notranslate"><span class="pre">relationship()</span></code> oriented attributes that would normally
load using the <code class="docutils literal notranslate"><span class="pre">select</span></code> (or “lazy”) loader strategy will also
load <strong>if they are named explicitly in the attribute_names
collection</strong>, emitting a SELECT statement for the attribute using the
<code class="docutils literal notranslate"><span class="pre">immediate</span></code> loader strategy.  If lazy-loaded relationships are not
named in <code class="xref py py-paramref docutils literal notranslate"><span class="pre">Session.refresh.attribute_names</span></code>, then
they remain as “lazy loaded” attributes and are not implicitly
refreshed.</p>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 2.0.4: </span>The <code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.refresh()</span></code> method
will now refresh lazy-loaded <code class="xref py py-func docutils literal notranslate"><span class="pre">relationship()</span></code> oriented
attributes for those which are named explicitly in the
<code class="xref py py-paramref docutils literal notranslate"><span class="pre">Session.refresh.attribute_names</span></code> collection.</p>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>While the <code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.refresh()</span></code> method is capable of
refreshing both column and relationship oriented attributes, its
primary focus is on refreshing of local column-oriented attributes
on a single instance. For more open ended “refresh” functionality,
including the ability to refresh the attributes on many objects at
once while having explicit control over relationship loader
strategies, use the
<a class="reference internal" href="queryguide/api.html#orm-queryguide-populate-existing"><span class="std std-ref">populate existing</span></a> feature
instead.</p>
</div>
<p>Note that a highly isolated transaction will return the same values as
were previously read in that same transaction, regardless of changes
in database state outside of that transaction.   Refreshing
attributes usually only makes sense at the start of a transaction
where database rows have not yet been accessed.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.orm.scoped_session.refresh.params.attribute_names"></span><strong>attribute_names</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.scoped_session.refresh.params.attribute_names">¶</a> – optional.  An iterable collection of
string attribute names indicating a subset of attributes to
be refreshed.</p></li>
<li><p><span class="target" id="sqlalchemy.orm.scoped_session.refresh.params.with_for_update"></span><strong>with_for_update</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.scoped_session.refresh.params.with_for_update">¶</a> – optional boolean <code class="docutils literal notranslate"><span class="pre">True</span></code> indicating FOR UPDATE
should be used, or may be a dictionary containing flags to
indicate a more specific set of FOR UPDATE flags for the SELECT;
flags should match the parameters of
<a class="reference internal" href="queryguide/query.html#sqlalchemy.orm.Query.with_for_update" title="sqlalchemy.orm.Query.with_for_update"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Query.with_for_update()</span></code></a>.
Supersedes the <code class="xref py py-paramref docutils literal notranslate"><span class="pre">Session.refresh.lockmode</span></code> parameter.</p></li>
</ul>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><span class="xref std std-ref">session_expire</span> - introductory material</p>
<p><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.expire()</span></code></p>
<p><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.expire_all()</span></code></p>
<p><a class="reference internal" href="queryguide/api.html#orm-queryguide-populate-existing"><span class="std std-ref">现有数据充填</span></a> - allows any ORM query
to refresh objects as they would be loaded normally.</p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.scoped_session.remove">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.scoped_session"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.scoped_session.</span></code></a><span class="sig-name descname"><span class="pre">remove</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.orm.scoped_session.remove" title="Permalink to this definition">¶</a></dt>
<dd><p>Dispose of the current <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code>, if present.</p>
<p>This will first call <code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.close()</span></code> method
on the current <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code>, which releases any existing
transactional/connection resources still being held; transactions
specifically are rolled back.  The <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> is then
discarded.   Upon next usage within the same scope,
the <a class="reference internal" href="#sqlalchemy.orm.scoped_session" title="sqlalchemy.orm.scoped_session"><code class="xref py py-class docutils literal notranslate"><span class="pre">scoped_session</span></code></a> will produce a new
<code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> object.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.scoped_session.rollback">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.scoped_session"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.scoped_session.</span></code></a><span class="sig-name descname"><span class="pre">rollback</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.orm.scoped_session.rollback" title="Permalink to this definition">¶</a></dt>
<dd><p>Rollback the current transaction in progress.</p>
<div class="class-bases docutils container">
<p>Proxied for the <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> class on
behalf of the <a class="reference internal" href="#sqlalchemy.orm.scoped_session" title="sqlalchemy.orm.scoping.scoped_session"><code class="xref py py-class docutils literal notranslate"><span class="pre">scoped_session</span></code></a> class.</p>
</div>
<p>If no transaction is in progress, this method is a pass-through.</p>
<p>The method always rolls back
the topmost database transaction, discarding any nested
transactions that may be in progress.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="session_basics.html#session-rollback"><span class="std std-ref">回滚</span></a></p>
<p><a class="reference internal" href="session_transaction.html#unitofwork-transaction"><span class="std std-ref">管理事务</span></a></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.scoped_session.scalar">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.scoped_session"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.scoped_session.</span></code></a><span class="sig-name descname"><span class="pre">scalar</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">statement</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.Executable" title="sqlalchemy.sql.expression.Executable"><span class="pre">Executable</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">params</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_CoreSingleExecuteParams</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">execution_options</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">OrmExecuteOptionsParameter</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">{}</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bind_arguments</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_BindArguments</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kw</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Any</span></span></span><a class="headerlink" href="#sqlalchemy.orm.scoped_session.scalar" title="Permalink to this definition">¶</a></dt>
<dd><p>Execute a statement and return a scalar result.</p>
<div class="class-bases docutils container">
<p>Proxied for the <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> class on
behalf of the <a class="reference internal" href="#sqlalchemy.orm.scoped_session" title="sqlalchemy.orm.scoping.scoped_session"><code class="xref py py-class docutils literal notranslate"><span class="pre">scoped_session</span></code></a> class.</p>
</div>
<p>Usage and parameters are the same as that of
<code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.execute()</span></code>; the return result is a scalar Python
value.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.scoped_session.scalars">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.scoped_session"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.scoped_session.</span></code></a><span class="sig-name descname"><span class="pre">scalars</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">statement</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.Executable" title="sqlalchemy.sql.expression.Executable"><span class="pre">Executable</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">params</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_CoreAnyExecuteParams</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">execution_options</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">OrmExecuteOptionsParameter</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">{}</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bind_arguments</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_BindArguments</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kw</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">ScalarResult</span><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#sqlalchemy.orm.scoped_session.scalars" title="Permalink to this definition">¶</a></dt>
<dd><p>Execute a statement and return the results as scalars.</p>
<div class="class-bases docutils container">
<p>Proxied for the <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> class on
behalf of the <a class="reference internal" href="#sqlalchemy.orm.scoped_session" title="sqlalchemy.orm.scoping.scoped_session"><code class="xref py py-class docutils literal notranslate"><span class="pre">scoped_session</span></code></a> class.</p>
</div>
<p>Usage and parameters are the same as that of
<code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.execute()</span></code>; the return result is a
<code class="xref py py-class docutils literal notranslate"><span class="pre">ScalarResult</span></code> filtering object which
will return single elements rather than <code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code> objects.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>a <code class="xref py py-class docutils literal notranslate"><span class="pre">ScalarResult</span></code> object</p>
</dd>
</dl>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.4.24: </span>Added <code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.scalars()</span></code></p>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.4.26: </span>Added <a class="reference internal" href="#sqlalchemy.orm.scoped_session.scalars" title="sqlalchemy.orm.scoped_session.scalars"><code class="xref py py-meth docutils literal notranslate"><span class="pre">scoped_session.scalars()</span></code></a></p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><span class="xref std std-ref">orm_queryguide_select_orm_entities</span> - contrasts the behavior
of <code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.execute()</span></code> to <code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.scalars()</span></code></p>
</div>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.orm.scoped_session.session_factory">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.orm.scoped_session"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.scoped_session.</span></code></a><span class="sig-name descname"><span class="pre">session_factory</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">sessionmaker</span><span class="p"><span class="pre">[</span></span><span class="pre">_S</span><span class="p"><span class="pre">]</span></span></em><a class="headerlink" href="#sqlalchemy.orm.scoped_session.session_factory" title="Permalink to this definition">¶</a></dt>
<dd><p>The <cite>session_factory</cite> provided to <cite>__init__</cite> is stored in this
attribute and may be accessed at a later time.  This can be useful when
a new non-scoped <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> is needed.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.util.ScopedRegistry">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.util.</span></span><span class="sig-name descname"><span class="pre">ScopedRegistry</span></span><a class="headerlink" href="#sqlalchemy.util.ScopedRegistry" title="Permalink to this definition">¶</a></dt>
<dd><p>A Registry that can store one or multiple instances of a single
class on the basis of a “scope” function.</p>
<p>The object implements <code class="docutils literal notranslate"><span class="pre">__call__</span></code> as the “getter”, so by
calling <code class="docutils literal notranslate"><span class="pre">myregistry()</span></code> the contained object is returned
for the current scope.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.util.ScopedRegistry.params.createfunc"></span><strong>createfunc</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.util.ScopedRegistry.params.createfunc">¶</a> – a callable that returns a new object to be placed in the registry</p></li>
<li><p><span class="target" id="sqlalchemy.util.ScopedRegistry.params.scopefunc"></span><strong>scopefunc</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.util.ScopedRegistry.params.scopefunc">¶</a> – a callable that will return a key to store/retrieve an object.</p></li>
</ul>
</dd>
</dl>
<div class="class-members docutils container">
<p><strong>Members</strong></p>
<p><a class="reference internal" href="#sqlalchemy.util.ScopedRegistry.__init__"><span class="sig-name descname">__init__()</span></a>, <a class="reference internal" href="#sqlalchemy.util.ScopedRegistry.clear"><span class="sig-name descname">clear()</span></a>, <a class="reference internal" href="#sqlalchemy.util.ScopedRegistry.has"><span class="sig-name descname">has()</span></a>, <a class="reference internal" href="#sqlalchemy.util.ScopedRegistry.set"><span class="sig-name descname">set()</span></a></p>
</div>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.util.ScopedRegistry" title="sqlalchemy.util.ScopedRegistry"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.util.ScopedRegistry</span></code></a> (<code class="xref py py-class docutils literal notranslate"><span class="pre">typing.Generic</span></code>)</p>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.util.ScopedRegistry.__init__">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.util.ScopedRegistry"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.util.ScopedRegistry.</span></code></a><span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">createfunc</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Callable</span><span class="p"><span class="pre">[</span></span><span class="p"><span class="pre">[</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">_T</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scopefunc</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Callable</span><span class="p"><span class="pre">[</span></span><span class="p"><span class="pre">[</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.util.ScopedRegistry.__init__" title="Permalink to this definition">¶</a></dt>
<dd><p>Construct a new <a class="reference internal" href="#sqlalchemy.util.ScopedRegistry" title="sqlalchemy.util.ScopedRegistry"><code class="xref py py-class docutils literal notranslate"><span class="pre">ScopedRegistry</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.util.ScopedRegistry.params.createfunc"></span><strong>createfunc</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.util.ScopedRegistry.params.createfunc">¶</a> – A creation function that will generate
a new value for the current scope, if none is present.</p></li>
<li><p><span class="target" id="sqlalchemy.util.ScopedRegistry.params.scopefunc"></span><strong>scopefunc</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.util.ScopedRegistry.params.scopefunc">¶</a> – A function that returns a hashable
token representing the current scope (such as, current
thread identifier).</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.util.ScopedRegistry.clear">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.util.ScopedRegistry"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.util.ScopedRegistry.</span></code></a><span class="sig-name descname"><span class="pre">clear</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.util.ScopedRegistry.clear" title="Permalink to this definition">¶</a></dt>
<dd><p>Clear the current scope, if any.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.util.ScopedRegistry.has">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.util.ScopedRegistry"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.util.ScopedRegistry.</span></code></a><span class="sig-name descname"><span class="pre">has</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">bool</span></span></span><a class="headerlink" href="#sqlalchemy.util.ScopedRegistry.has" title="Permalink to this definition">¶</a></dt>
<dd><p>Return True if an object is present in the current scope.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.util.ScopedRegistry.set">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.util.ScopedRegistry"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.util.ScopedRegistry.</span></code></a><span class="sig-name descname"><span class="pre">set</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">obj</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_T</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.util.ScopedRegistry.set" title="Permalink to this definition">¶</a></dt>
<dd><p>Set the value for the current scope.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.util.ThreadLocalRegistry">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.util.</span></span><span class="sig-name descname"><span class="pre">ThreadLocalRegistry</span></span><a class="headerlink" href="#sqlalchemy.util.ThreadLocalRegistry" title="Permalink to this definition">¶</a></dt>
<dd><p>A <a class="reference internal" href="#sqlalchemy.util.ScopedRegistry" title="sqlalchemy.util.ScopedRegistry"><code class="xref py py-class docutils literal notranslate"><span class="pre">ScopedRegistry</span></code></a> that uses a <code class="docutils literal notranslate"><span class="pre">threading.local()</span></code>
variable for storage.</p>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.util.ThreadLocalRegistry" title="sqlalchemy.util.ThreadLocalRegistry"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.util.ThreadLocalRegistry</span></code></a> (<a class="reference internal" href="#sqlalchemy.util.ScopedRegistry" title="sqlalchemy.util.ScopedRegistry"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.util.ScopedRegistry</span></code></a>)</p>
</div>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.orm.QueryPropertyDescriptor">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.orm.</span></span><span class="sig-name descname"><span class="pre">QueryPropertyDescriptor</span></span><a class="headerlink" href="#sqlalchemy.orm.QueryPropertyDescriptor" title="Permalink to this definition">¶</a></dt>
<dd><p>Describes the type applied to a class-level
<a class="reference internal" href="#sqlalchemy.orm.scoped_session.query_property" title="sqlalchemy.orm.scoped_session.query_property"><code class="xref py py-meth docutils literal notranslate"><span class="pre">scoped_session.query_property()</span></code></a> attribute.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 2.0.5.</span></p>
</div>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.orm.QueryPropertyDescriptor" title="sqlalchemy.orm.QueryPropertyDescriptor"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.orm.QueryPropertyDescriptor</span></code></a> (<code class="xref py py-class docutils literal notranslate"><span class="pre">typing_extensions.Protocol</span></code>)</p>
</div>
</dd></dl>

</section>
</section>

    </div>

</div>

<div id="docs-bottom-navigation" class="docs-navigation-links, withsidebar">
        Previous:
        <a href="persistence_techniques.html" title="previous chapter">附加的持久化技术</a>
        Next:
        <a href="session_events.html" title="next chapter">使用事件跟踪查询、对象和会话更改</a>

    <div id="docs-copyright">
        &copy; <a href="../copyright.html">Copyright</a> 2007-2023, the SQLAlchemy authors and contributors.


    <p><b>flambé!</b> the dragon and <b><i>The Alchemist</i></b> image designs created and generously donated by <a href="https://github.com/vmalloc">Rotem Yaari</a>.</p>

        Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 7.0.1.

    Documentation last generated: 2023/8/18 10:07:09

    </div>
</div>

</div>



        
        

    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
          URL_ROOT:    '../',
          VERSION:     '2.0.19',
          COLLAPSE_MODINDEX: false,
          FILE_SUFFIX: '.html'
      };
    </script>

    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>

    <!-- begin iterate through sphinx environment script_files -->
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script type="text/javascript" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/sphinx_highlight.js"></script>
        <script type="text/javascript" src="../_static/clipboard.min.js"></script>
        <script type="text/javascript" src="../_static/copybutton.js"></script>
    <!-- end iterate through sphinx environment script_files -->

    <script type="text/javascript" src="../_static/init.js"></script>


    </body>
</html>


