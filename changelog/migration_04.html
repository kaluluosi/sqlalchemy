<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">



<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />

        <title>
            
    
    SQLAlchemy 0.4有什么新功能？
 &mdash;
    SQLAlchemy 2.0 Documentation

        </title>

        
            <!-- begin iterate through site-imported + sphinx environment css_files -->
                <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
                <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
                <link rel="stylesheet" href="../_static/default.css" type="text/css" />
                <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
                <link rel="stylesheet" href="../_static/docs.css" type="text/css" />
                <link rel="stylesheet" href="../_static/sphinx_paramlinks.css" type="text/css" />
            <!-- end iterate through site-imported + sphinx environment css_files -->
        

        

    

    <!-- begin layout.mako headers -->

    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
        <link rel="copyright" title="Copyright" href="../copyright.html" />
    <link rel="top" title="SQLAlchemy 2.0 Documentation" href="../index.html" />
        <link rel="up" title="变更和迁移" href="index.html" />
        <link rel="prev" title="SQLAlchemy 0.5有哪些新特性？" href="migration_05.html" />
    <!-- end layout.mako headers -->


    </head>
    <body>
        
















<div id="docs-container">





<div id="docs-top-navigation-container" class="body-background">
<div id="docs-header">
    <div id="docs-version-header">
        Release: <span class="version-num">2.0.19</span>


        | Release Date: July 15, 2023

    </div>

    <h1><a href="../index.html">SQLAlchemy 2.0 Documentation</a></h1>

</div>
</div>

<div id="docs-body-container">

    <div id="fixed-sidebar" class="withsidebar">



        <div id="docs-sidebar-popout">
            <h3><a href="../index.html">SQLAlchemy 2.0 Documentation</a></h3>
            <p id="sidebar-topnav">
                <a href="../index.html">Home</a>
            </p>

            <div id="sidebar-search">
                <form class="search" action="../search.html" method="get">
                  <label>
                  Search terms:
                  <input type="text" placeholder="search..." name="q" size="12" />
                  </label>
                  <input type="hidden" name="check_keywords" value="yes" />
                  <input type="hidden" name="area" value="default" />
                </form>
            </div>

        </div>

        <div id="docs-sidebar">

        <div id="sidebar-banner">
            
        </div>

        <div id="docs-sidebar-inner">

        
        <h3>
            <a href="index.html" title="变更和迁移">变更和迁移</a>
        </h3>

        <ul>
<li><span class="link-container"><a class="reference external" href="migration_20.html">SQLAlchemy 2.0 - 主要迁移指南</a></span></li>
<li><span class="link-container"><a class="reference external" href="whatsnew_20.html">SQLAlchemy 2.0 有什么新特性？</a></span></li>
<li><span class="link-container"><a class="reference external" href="changelog_20.html">2.0 变更日志</a></span></li>
<li><span class="link-container"><a class="reference external" href="changelog_14.html">1.4 版本更新历史</a></span></li>
<li><span class="link-container"><a class="reference external" href="changelog_13.html">1.3 更新日志</a></span></li>
<li><span class="link-container"><a class="reference external" href="changelog_12.html">1.2 更新日志</a></span></li>
<li><span class="link-container"><a class="reference external" href="changelog_11.html">1.1 更新日志</a></span></li>
<li><span class="link-container"><a class="reference external" href="changelog_10.html">1.0 更新日志</a></span></li>
<li><span class="link-container"><a class="reference external" href="changelog_09.html">0.9版本更新日志</a></span></li>
<li><span class="link-container"><a class="reference external" href="changelog_08.html">0.8 更新日志</a></span></li>
<li><span class="link-container"><a class="reference external" href="changelog_06.html">0.6 更新日志</a></span></li>
<li><span class="link-container"><a class="reference external" href="changelog_05.html">0.5 更新日志</a></span></li>
<li><span class="link-container"><a class="reference external" href="changelog_04.html">0.4 变更日志</a></span></li>
<li><span class="link-container"><a class="reference external" href="changelog_03.html">0.3 更新日志</a></span></li>
<li><span class="link-container"><a class="reference external" href="changelog_02.html">0.2 更新日志</a></span></li>
<li><span class="link-container"><a class="reference external" href="changelog_01.html">版本记录</a></span></li>
<li><span class="link-container"><a class="reference external" href="migration_14.html">SQLAlchemy 1.4有哪些新内容？</a></span></li>
<li><span class="link-container"><a class="reference external" href="migration_13.html">SQLAlchemy 1.3有什么新特性？</a></span></li>
<li><span class="link-container"><a class="reference external" href="migration_12.html">SQLAlchemy 1.2有哪些新特性?</a></span></li>
<li><span class="link-container"><a class="reference external" href="migration_11.html">SQLAlchemy 1.1新功能</a></span></li>
<li><span class="link-container"><a class="reference external" href="migration_10.html">SQLAlchemy 1.0有哪些新特性？</a></span></li>
<li><span class="link-container"><a class="reference external" href="migration_09.html">SQLAlchemy 0.9 的新特性</a></span></li>
<li><span class="link-container"><a class="reference external" href="migration_08.html">SQLAlchemy 0.8有哪些新特性？</a></span></li>
<li><span class="link-container"><a class="reference external" href="migration_07.html">SQLAlchemy 0.7有什么新特性？</a></span></li>
<li><span class="link-container"><a class="reference external" href="migration_06.html">SQLAlchemy 0.6 有哪些新变化?</a></span></li>
<li><span class="link-container"><a class="reference external" href="migration_05.html">SQLAlchemy 0.5有哪些新特性？</a></span></li>
<li><span class="link-container"><a class="reference external" href="migration_05.html#id1">主要文档更改</a></span></li>
<li><span class="link-container"><a class="reference external" href="migration_05.html#id6">退化源</a></span></li>
<li><span class="link-container"><a class="reference external" href="migration_05.html#id7">需求更改</a></span></li>
<li><span class="link-container"><a class="reference external" href="migration_05.html#id8">ORM</a></span></li>
<li><span class="link-container"><a class="reference external" href="migration_05.html#id21">ORM扩展</a></span></li>
<li><span class="link-container"><a class="reference external" href="migration_05.html#id22">模式/类型</a></span></li>
<li><span class="link-container"><a class="reference external" href="migration_05.html#id23">连接池不再默认为线程本地</a></span></li>
<li><span class="link-container"><a class="reference external" href="migration_05.html#args-args">*args已接受，不再接受*args</a></span></li>
<li><span class="link-container"><a class="reference external" href="migration_05.html#id44">删除</a></span></li>
<li><span class="link-container"><a class="reference external" href="migration_05.html#id77">已重命名或已移动</a></span></li>
<li><span class="link-container"><a class="reference external" href="migration_05.html#id86">已弃用</a></span></li>
<li class="selected"><span class="link-container"><strong>SQLAlchemy 0.4有什么新功能？</strong><a class="paramlink headerlink reference internal" href="#">¶</a></span></li>
<li><span class="link-container"><a class="reference external" href="#id1">首先要做什么</a></span></li>
<li><span class="link-container"><a class="reference external" href="#id2">模块导入</a></span></li>
<li><span class="link-container"><a class="reference external" href="#id3">对象关系映射</a></span></li>
<li><span class="link-container"><a class="reference external" href="#id22">SQL表达式</a></span></li>
<li><span class="link-container"><a class="reference external" href="#id26">架构和反射</a></span></li>
<li><span class="link-container"><a class="reference external" href="#id28">SQL执行</a></span></li>
</ul>



        </div>

        </div>

    </div>

    <div id="narrow-index-nav">
        <form class="search" action="../search.html" method="get">
            <label>
                Search terms:
            <input type="text" placeholder="search..." name="q" size="12" />
            </label>
            <input type="submit" value="Search" />
            <input type="hidden" name="check_keywords" value="yes" />
            <input type="hidden" name="area" value="default" />
        </form>

        <p>
        <a href="../index.html">Home</a>
        </p>

    </div>


        <div id="docs-narrow-top-navigation">
            <ul>
                <li><b>Previous:</b>
                <a href="migration_05.html" title="previous chapter">SQLAlchemy 0.5有哪些新特性？</a></li>

            <li><b>Up:</b> <a href="../index.html">Home</a></li>
                    <ul><li><a href="index.html" title="变更和迁移">变更和迁移</a></li>
                </ul>



            <li><b>On this page:</b></li>
            <ul>
<li><a class="reference internal" href="#sqlalchemy-0-4">SQLAlchemy 0.4有什么新功能？</a></li>
<li><a class="reference internal" href="#id1">首先要做什么</a></li>
<li><a class="reference internal" href="#id2">模块导入</a></li>
<li><a class="reference internal" href="#id3">对象关系映射</a><ul>
<li><a class="reference internal" href="#id4">查询</a><ul>
<li><a class="reference internal" href="#api">新的查询API</a></li>
<li><a class="reference internal" href="#id5">新的基于属性的表达式构造</a></li>
<li><a class="reference internal" href="#id8">自动连接别名</a></li>
<li><a class="reference internal" href="#id9">自我引用查询</a></li>
<li><a class="reference internal" href="#query-populate-existing"><code class="docutils literal notranslate"><span class="pre">query.populate_existing（）</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#id10">关系</a><ul>
<li><a class="reference internal" href="#sql">嵌入式更新/插入SQL子句</a></li>
<li><a class="reference internal" href="#id11">自我引用和循环急切加载</a></li>
<li><a class="reference internal" href="#id12">复合类型</a></li>
<li><a class="reference internal" href="#dynamic-loader">“dynamic_loader（）”关系</a></li>
<li><a class="reference internal" href="#undefer-group-eagerload-all">新选项：“undefer_group（）”，“eagerload_all（）”</a></li>
<li><a class="reference internal" href="#id17">新的集合API</a></li>
<li><a class="reference internal" href="#id18">来自外部表/子查询的映射关系</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id19">继承</a><ul>
<li><a class="reference internal" href="#id20">没有联接或联合的多态继承</a></li>
<li><a class="reference internal" href="#get">更好的多态行为与“get（）”</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id21">类型</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id22">SQL表达式</a><ul>
<li><a class="reference internal" href="#label-alias-generation">全新，确定性Label / Alias Generation</a></li>
<li><a class="reference internal" href="#id23">生成选择（）构造</a></li>
<li><a class="reference internal" href="#id24">新的运营商系统</a></li>
<li><a class="reference internal" href="#typetype">所有“type”关键字参数重命名为“type_”</a></li>
<li><a class="reference internal" href="#id25">变为_函数改为接受序列或可选择的</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id26">架构和反射</a><ul>
<li><a class="reference internal" href="#metadata-boundmetadata-dynamicmetadata">“MetaData”，“BoundMetaData”，“DynamicMetaData”…</a></li>
<li><a class="reference internal" href="#id27">一步多表反射</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id28">SQL执行</a><ul>
<li><a class="reference internal" href="#engine-connectablebind-tobind">“engine”，“connectable”和“bind_to”现在都是“bind”</a></li>
<li><a class="reference internal" href="#transactionsnestedtransactionstwophasetransactions">“Transactions”、“NestedTransactions”和“TwoPhaseTransactions”</a></li>
<li><a class="reference internal" href="#id29">连接池事件</a></li>
<li><a class="reference internal" href="#oracle-engine">Oracle Engine固定</a></li>
<li><a class="reference internal" href="#oracle">Oracle的输出参数</a></li>
<li><a class="reference internal" href="#metadatasessions">基于连接的“MetaData”和“Sessions”</a></li>
<li><a class="reference internal" href="#resultproxy">更快、更可靠的“ResultProxy”对象</a></li>
</ul>
</li>
</ul>


            </ul>

        </div>



    <div id="docs-body" role="main" class="withsidebar changelog-migration_04" >
        
<section id="sqlalchemy-0-4">
<h1>SQLAlchemy 0.4有什么新功能？<a class="headerlink" href="#sqlalchemy-0-4" title="Permalink to this heading">¶</a></h1>
<div class="admonition- admonition">
<p class="admonition-title">关于本文档</p>
<p>本文档介绍了SQLAlchemy 0.3和0.4之间的更改，最近发布于2008年10月12日。</p>
<p>文档日期：2008年3月21日</p>
</div>
</section>
<section id="id1">
<h1>首先要做什么<a class="headerlink" href="#id1" title="Permalink to this heading">¶</a></h1>
<p>如果您正在使用任何ORM功能，请确保从``sqlalchemy.orm``导入：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="o">*</span></pre></div>
</div>
<p>其次，在任何以前使用``engine =` <cite>，``connectable =</cite> <cite>，``bind_to =</cite> <cite>，``something.engine`</cite>，<code class="docutils literal notranslate"><span class="pre">metadata.connect（）``的地方，请使用``bind</span> <span class="pre">=</span></code>：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">myengine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s2">&quot;sqlite://&quot;</span><span class="p">)</span>

<span class="n">meta</span> <span class="o">=</span> <span class="n">MetaData</span><span class="p">(</span><span class="n">myengine</span><span class="p">)</span>

<span class="n">meta2</span> <span class="o">=</span> <span class="n">MetaData</span><span class="p">()</span>
<span class="n">meta2</span><span class="o">.</span><span class="n">bind</span> <span class="o">=</span> <span class="n">myengine</span>

<span class="n">session</span> <span class="o">=</span> <span class="n">create_session</span><span class="p">(</span><span class="n">bind</span><span class="o">=</span><span class="n">myengine</span><span class="p">)</span>

<span class="n">statement</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span><span class="n">table</span><span class="p">],</span> <span class="n">bind</span><span class="o">=</span><span class="n">myengine</span><span class="p">)</span></pre></div>
</div>
<p>这些知道了吗？好的！您现在（95％）兼容0.4了。如果您使用的是0.3.10，可以立即进行这些更改；它们也将适用于该位置。</p>
</section>
<section id="id2">
<h1>模块导入<a class="headerlink" href="#id2" title="Permalink to this heading">¶</a></h1>
<p>在0.3中，“<code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">sqlalchemy</span> <span class="pre">import</span> <span class="pre">*</span></code>”将所有sqlalchemy的子模块导入到您的命名空间中。版本0.4不再将子模块导入命名空间。这可能意味着您需要在代码中添加额外的导入。</p>
<p>在0.3中，此代码有效：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="o">*</span>


<span class="k">class</span> <span class="nc">UTCDateTime</span><span class="p">(</span><span class="n">types</span><span class="o">.</span><span class="n">TypeDecorator</span><span class="p">):</span>
    <span class="k">pass</span></pre><div class="code-non-annotations-key"></div></div>
</div>
<p>在0.4中，必须这样做：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">types</span>


<span class="k">class</span> <span class="nc">UTCDateTime</span><span class="p">(</span><span class="n">types</span><span class="o">.</span><span class="n">TypeDecorator</span><span class="p">):</span>
    <span class="k">pass</span></pre><div class="code-non-annotations-key"></div></div>
</div>
</section>
<section id="id3">
<h1>对象关系映射<a class="headerlink" href="#id3" title="Permalink to this heading">¶</a></h1>
<section id="id4">
<h2>查询<a class="headerlink" href="#id4" title="Permalink to this heading">¶</a></h2>
<section id="api">
<h3>新的查询API<a class="headerlink" href="#api" title="Permalink to this heading">¶</a></h3>
<p>查询基于生成器接口进行标准化（旧接口仍然存在，只是已弃用）。虽然0.3中的大多数生成接口在0.4查询中仍然可用，但是0.4查询具有内部部件以匹配生成器外部，并且具有更多技巧。所有结果缩小都通过``filter（）``和``filter_by（）``，限制/偏移量通过数组切片或``limit（）/ offset（）``进行，连接通过``join（）``和``outerjoin（）``进行（或更手动地，通过``select_from（）``以及手动形成的标准）。</p>
<p>要避免已弃用的警告，请对03代码进行一些更改</p>
<p>User.query.get_by( **kwargs )</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">User</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span></pre></div>
</div>
<p>User.query.select_by( **kwargs )</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">User</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span></pre></div>
</div>
<p>User.query.select()</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">User</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">xxx</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span></pre></div>
</div>
</section>
<section id="id5">
<h3>新的基于属性的表达式构造<a class="headerlink" href="#id5" title="Permalink to this heading">¶</a></h3>
<p>到目前为止，在ORM中最明显的区别是现在您可以直接使用基于类属性构建查询标准。当使用映射类时，不再需要“<code class="docutils literal notranslate"><span class="pre">.c.</span></code>”前缀：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">and_</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;fred&quot;</span><span class="p">,</span> <span class="n">User</span><span class="o">.</span><span class="n">id</span> <span class="o">&gt;</span> <span class="mi">17</span><span class="p">))</span></pre></div>
</div>
<p>虽然简单的基于列的比较并不是什么大问题，但是类属性具有一些新的“更高级别”的结构可用，包括之前仅在``filter_by（）``中可用的结构：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># comparison of scalar relations to an instance</span>
<span class="n">filter</span><span class="p">(</span><span class="n">Address</span><span class="o">.</span><span class="n">user</span> <span class="o">==</span> <span class="n">user</span><span class="p">)</span>

<span class="c1"># return all users who contain a particular address</span>
<span class="n">filter</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">addresses</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">address</span><span class="p">))</span>

<span class="c1"># return all users who *dont* contain the address</span>
<span class="n">filter</span><span class="p">(</span><span class="o">~</span><span class="n">User</span><span class="o">.</span><span class="n">address</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">address</span><span class="p">))</span>

<span class="c1"># return all users who contain a particular address with</span>
<span class="c1"># the email_address like &#39;%foo%&#39;</span>
<span class="n">filter</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">addresses</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">Address</span><span class="o">.</span><span class="n">email_address</span><span class="o">.</span><span class="n">like</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%f</span><span class="s2">oo%&quot;</span><span class="p">)))</span>

<span class="c1"># same, email address equals &#39;foo@bar.com&#39;.</span>
<span class="c1"># for simple comparisons,% keyword</span>
<span class="n">filter</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">addresses</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">email_address</span><span class="o">=</span><span class="s2">&quot;foo@bar.com&quot;</span><span class="p">))</span>

<span class="c1"># return all Addresses whose user attribute has the username &#39;ed&#39;</span>
<span class="n">filter</span><span class="p">(</span><span class="n">Address</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">has</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;ed&quot;</span><span class="p">))</span>

<span class="c1"># return all Addresses whose user attribute has the username &#39;ed&#39;</span>
<span class="c1"># and an id &gt; 5 (mixing clauses with kwargs)</span>
<span class="n">filter</span><span class="p">(</span><span class="n">Address</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">has</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">id</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;ed&quot;</span><span class="p">))</span></pre></div>
</div>
<p>在映射类的``.c``属性中仍然可用``Column``集合。请注意，只有映射类的映射属性可用于基于属性的表达式。 <a href="#id6"><span class="problematic" id="id7">``</span></a>.c``仍用于访问来自SQL表达式生成的常规表格和可选择对象中的列。</p>
</section>
<section id="id8">
<h3>自动连接别名<a class="headerlink" href="#id8" title="Permalink to this heading">¶</a></h3>
<p>我们已经有一段时间使用join（）和outerjoin（）了：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Order</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;items&quot;</span><span class="p">)</span></pre></div>
</div>
<p>现在，您可以将它们别名：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Order</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;items&quot;</span><span class="p">,</span> <span class="n">aliased</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Item</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;item 1&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
    <span class="s2">&quot;items&quot;</span><span class="p">,</span> <span class="n">aliased</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Item</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;item 3&quot;</span><span class="p">)</span></pre></div>
</div>
<p>上述代码将创建从订单-&gt;项目使用别名的两个连接。每个后续“filter（）”调用都将其表述准则调整为该别名的准则。使用``add_entity（）``并用“id”定位每个连接就可以获得``Item``对象：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Order</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;items&quot;</span><span class="p">,</span> <span class="n">id</span><span class="o">=</span><span class="s2">&quot;j1&quot;</span><span class="p">,</span> <span class="n">aliased</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
    <span class="n">Item</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;item 1&quot;</span>
<span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;items&quot;</span><span class="p">,</span> <span class="n">aliased</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">id</span><span class="o">=</span><span class="s2">&quot;j2&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Item</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;item 3&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">add_entity</span><span class="p">(</span>
    <span class="n">Item</span><span class="p">,</span> <span class="n">id</span><span class="o">=</span><span class="s2">&quot;j1&quot;</span>
<span class="p">)</span><span class="o">.</span><span class="n">add_entity</span><span class="p">(</span>
    <span class="n">Item</span><span class="p">,</span> <span class="n">id</span><span class="o">=</span><span class="s2">&quot;j2&quot;</span>
<span class="p">)</span></pre></div>
</div>
<p>以``（Order，Item，Item）``形式返回元组。</p>
</section>
<section id="id9">
<h3>自我引用查询<a class="headerlink" href="#id9" title="Permalink to this heading">¶</a></h3>
<p>因此，查询。join（）现在可以别名了。那给了我们什么？自引用查询！无需任何“Alias”对象即可进行连接：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># standard self-referential TreeNode mapper with backref</span>
<span class="n">mapper</span><span class="p">(</span>
    <span class="n">TreeNode</span><span class="p">,</span>
    <span class="n">tree_nodes</span><span class="p">,</span>
    <span class="n">properties</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;children&quot;</span><span class="p">:</span> <span class="n">relation</span><span class="p">(</span>
            <span class="n">TreeNode</span><span class="p">,</span> <span class="n">backref</span><span class="o">=</span><span class="n">backref</span><span class="p">(</span><span class="s2">&quot;parent&quot;</span><span class="p">,</span> <span class="n">remote_side</span><span class="o">=</span><span class="n">tree_nodes</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="p">},</span>
<span class="p">)</span>

<span class="c1"># query for node with child containing &quot;bar&quot; two levels deep</span>
<span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">TreeNode</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;children&quot;</span><span class="p">,</span> <span class="s2">&quot;children&quot;</span><span class="p">],</span> <span class="n">aliased</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;bar&quot;</span>
<span class="p">)</span></pre></div>
</div>
<p>要在别名连接的每个表上添加标准，您可以使用``from_joinpoint``，以便针对相同的别名行继续连接：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># search for the treenode along the path &quot;n1/n12/n122&quot;</span>

<span class="c1"># first find a Node with name=&quot;n122&quot;</span>
<span class="n">q</span> <span class="o">=</span> <span class="n">sess</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Node</span><span class="p">)</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;n122&quot;</span><span class="p">)</span>

<span class="c1"># then join to parent with &quot;n12&quot;</span>
<span class="n">q</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;parent&quot;</span><span class="p">,</span> <span class="n">aliased</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;n12&quot;</span><span class="p">)</span>

<span class="c1"># join again to the next parent with &#39;n1&#39;.  use &#39;from_joinpoint&#39;</span>
<span class="c1"># so we join from the previous point, instead of joining off the</span>
<span class="c1"># root table</span>
<span class="n">q</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;parent&quot;</span><span class="p">,</span> <span class="n">aliased</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">from_joinpoint</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;n1&quot;</span><span class="p">)</span>

<span class="n">node</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">first</span><span class="p">()</span></pre></div>
</div>
</section>
<section id="query-populate-existing">
<h3><code class="docutils literal notranslate"><span class="pre">query.populate_existing（）</span></code><a class="headerlink" href="#query-populate-existing" title="Permalink to this heading">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">query.load()``的热情版本（或``session.refresh（）</span></code>）。从查询中加载的每个实例都将即时刷新，包括所有急切地加载的项目，如果已经存在于会话中，则会立即刷新它们：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Blah</span><span class="p">)</span><span class="o">.</span><span class="n">populate_existing</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">()</span></pre></div>
</div>
</section>
</section>
<section id="id10">
<h2>关系<a class="headerlink" href="#id10" title="Permalink to this heading">¶</a></h2>
<section id="sql">
<h3>嵌入式更新/插入SQL子句<a class="headerlink" href="#sql" title="Permalink to this heading">¶</a></h3>
<p>在``flush（）``期间，在更新或插入中嵌入SQL子句的内联执行：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">myobject</span><span class="o">.</span><span class="n">foo</span> <span class="o">=</span> <span class="n">mytable</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">value</span> <span class="o">+</span> <span class="mi">1</span>

<span class="n">user</span><span class="o">.</span><span class="n">pwhash</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="n">password</span><span class="p">)</span>

<span class="n">order</span><span class="o">.</span><span class="n">hash</span> <span class="o">=</span> <span class="n">text</span><span class="p">(</span><span class="s2">&quot;select hash from hashing_table&quot;</span><span class="p">)</span></pre></div>
</div>
<p>操作后的列属性设置为延迟加载器，以便在下一次访问时发出加载新值的SQL。</p>
</section>
<section id="id11">
<h3>自我引用和循环急切加载<a class="headerlink" href="#id11" title="Permalink to this heading">¶</a></h3>
<p>由于别名化的改进，<code class="docutils literal notranslate"><span class="pre">relation（）``现在可以沿着相同的表*任意次数*加入；告诉它你想要走多深。让我们更清楚地显示自我引用的“``TreeNode</span></code>”：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nodes</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span>
    <span class="s2">&quot;nodes&quot;</span><span class="p">,</span>
    <span class="n">metadata</span><span class="p">,</span>
    <span class="n">Column</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="n">Column</span><span class="p">(</span><span class="s2">&quot;parent_id&quot;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">ForeignKey</span><span class="p">(</span><span class="s2">&quot;nodes.id&quot;</span><span class="p">)),</span>
    <span class="n">Column</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">String</span><span class="p">(</span><span class="mi">30</span><span class="p">)),</span>
<span class="p">)</span>


<span class="k">class</span> <span class="nc">TreeNode</span><span class="p">(</span><span class="n">object</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="n">mapper</span><span class="p">(</span>
    <span class="n">TreeNode</span><span class="p">,</span>
    <span class="n">nodes</span><span class="p">,</span>
    <span class="n">properties</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;children&quot;</span><span class="p">:</span> <span class="n">relation</span><span class="p">(</span><span class="n">TreeNode</span><span class="p">,</span> <span class="n">lazy</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">join_depth</span><span class="o">=</span><span class="mi">3</span><span class="p">)},</span>
<span class="p">)</span></pre><div class="code-non-annotations-key"></div></div>
</div>
<p>那么当我们说：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">create_session</span><span class="p">()</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">TreeNode</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span></pre></div>
</div>
<p>什么会发生？一次沿着别名，深入三个级别的父级：</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span>
<span class="n">nodes_3</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">nodes_3_id</span><span class="p">,</span><span class="w"> </span><span class="n">nodes_3</span><span class="p">.</span><span class="n">parent_id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">nodes_3_parent_id</span><span class="p">,</span><span class="w"> </span><span class="n">nodes_3</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">nodes_3_name</span><span class="p">,</span>
<span class="n">nodes_2</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">nodes_2_id</span><span class="p">,</span><span class="w"> </span><span class="n">nodes_2</span><span class="p">.</span><span class="n">parent_id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">nodes_2_parent_id</span><span class="p">,</span><span class="w"> </span><span class="n">nodes_2</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">nodes_2_name</span><span class="p">,</span>
<span class="n">nodes_1</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">nodes_1_id</span><span class="p">,</span><span class="w"> </span><span class="n">nodes_1</span><span class="p">.</span><span class="n">parent_id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">nodes_1_parent_id</span><span class="p">,</span><span class="w"> </span><span class="n">nodes_1</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">nodes_1_name</span><span class="p">,</span>
<span class="n">nodes</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">nodes_id</span><span class="p">,</span><span class="w"> </span><span class="n">nodes</span><span class="p">.</span><span class="n">parent_id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">nodes_parent_id</span><span class="p">,</span><span class="w"> </span><span class="n">nodes</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">nodes_name</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">nodes</span><span class="w"> </span><span class="k">LEFT</span><span class="w"> </span><span class="k">OUTER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">nodes</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">nodes_1</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">nodes</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nodes_1</span><span class="p">.</span><span class="n">parent_id</span>
<span class="k">LEFT</span><span class="w"> </span><span class="k">OUTER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">nodes</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">nodes_2</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">nodes_1</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nodes_2</span><span class="p">.</span><span class="n">parent_id</span>
<span class="k">LEFT</span><span class="w"> </span><span class="k">OUTER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">nodes</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">nodes_3</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">nodes_2</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nodes_3</span><span class="p">.</span><span class="n">parent_id</span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">nodes</span><span class="p">.</span><span class="n">oid</span><span class="p">,</span><span class="w"> </span><span class="n">nodes_1</span><span class="p">.</span><span class="n">oid</span><span class="p">,</span><span class="w"> </span><span class="n">nodes_2</span><span class="p">.</span><span class="n">oid</span><span class="p">,</span><span class="w"> </span><span class="n">nodes_3</span><span class="p">.</span><span class="n">oid</span></pre></div>
</div>
<p>请注意，还有一个好看的干净的别名名称。即使连接与同一个立即表不同的对象无关，连接也不会在本身上循环。任何连接可以通过指定``join_depth``而返回到自身。当不存在时，贪婪装载自动停止贪婪装载。</p>
</section>
<section id="id12">
<h3>复合类型<a class="headerlink" href="#id12" title="Permalink to this heading">¶</a></h3>
<p>这是Hibernate阵营的一种。复合类型允许您定义由多个列（或一个列，如果您愿意）组成的自定义数据类型。让我们定义一个名为``Point``的新类型。存储x / y坐标：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Point</span><span class="p">(</span><span class="n">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">y</span>

    <span class="k">def</span> <span class="nf">__composite_values__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">other</span><span class="o">.</span><span class="n">x</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="ow">and</span> <span class="n">other</span><span class="o">.</span><span class="n">y</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span>

    <span class="k">def</span> <span class="fm">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__eq__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span></pre><div class="code-non-annotations-key"></div></div>
</div>
<p>定义``Point``对象的方式特定于自定类型；构造函数接受一个参数列表，<a href="#id13"><span class="problematic" id="id14">``</span></a>__composite_values __（）``方法生成这些参数的序列。命令将匹配我们的映射，如下所示：</p>
<p>让我们创建一个存储每行两个点的顶点表：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">vertices</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span>
    <span class="s2">&quot;vertices&quot;</span><span class="p">,</span>
    <span class="n">metadata</span><span class="p">,</span>
    <span class="n">Column</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="n">Column</span><span class="p">(</span><span class="s2">&quot;x1&quot;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">),</span>
    <span class="n">Column</span><span class="p">(</span><span class="s2">&quot;y1&quot;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">),</span>
    <span class="n">Column</span><span class="p">(</span><span class="s2">&quot;x2&quot;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">),</span>
    <span class="n">Column</span><span class="p">(</span><span class="s2">&quot;y2&quot;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">),</span>
<span class="p">)</span></pre></div>
</div>
<p>然后，映射它！我们将创建一个``Vertex``对象，其中存储了两个“<code class="docutils literal notranslate"><span class="pre">Point</span></code>”对象：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Vertex</span><span class="p">(</span><span class="n">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">start</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end</span> <span class="o">=</span> <span class="n">end</span>


<span class="n">mapper</span><span class="p">(</span>
    <span class="n">Vertex</span><span class="p">,</span>
    <span class="n">vertices</span><span class="p">,</span>
    <span class="n">properties</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;start&quot;</span><span class="p">:</span> <span class="n">composite</span><span class="p">(</span><span class="n">Point</span><span class="p">,</span> <span class="n">vertices</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">x1</span><span class="p">,</span> <span class="n">vertices</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">y1</span><span class="p">),</span>
        <span class="s2">&quot;end&quot;</span><span class="p">:</span> <span class="n">composite</span><span class="p">(</span><span class="n">Point</span><span class="p">,</span> <span class="n">vertices</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">x2</span><span class="p">,</span> <span class="n">vertices</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">y2</span><span class="p">),</span>
    <span class="p">},</span>
<span class="p">)</span></pre><div class="code-non-annotations-key"></div></div>
</div>
<p>一旦设置了复合类型，它的使用方式就与任何其他类型一样：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">v</span> <span class="o">=</span> <span class="n">Vertex</span><span class="p">(</span><span class="n">Point</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">Point</span><span class="p">(</span><span class="mi">26</span><span class="p">,</span> <span class="mi">15</span><span class="p">))</span>
<span class="n">session</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
<span class="n">session</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

<span class="c1"># works in queries too</span>
<span class="n">q</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Vertex</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Vertex</span><span class="o">.</span><span class="n">start</span> <span class="o">==</span> <span class="n">Point</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span></pre></div>
</div>
<p>如果要定义映射属性在表达式中使用时生成SQL子句的方式，请创建自己的``sqlalchemy.orm.PropComparator``子类，并将其发送到``composite（）``中。复合类型也可以作为主键使用，并且可用于``query.get()``：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># a Document class which uses a composite Version</span>
<span class="c1"># object as primary key</span>
<span class="n">document</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">Version</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">))</span></pre></div>
</div>
</section>
<section id="dynamic-loader">
<h3>“dynamic_loader（）”关系<a class="headerlink" href="#dynamic-loader" title="Permalink to this heading">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">relation()``会为所有读操作返回一个实时的``Query``对象。写操作仅限于``append（）``和``remove（）</span></code>，直到会话刷新为止，集合的更改才可见。此功能在“自动刷新”会话的情况下特别方便，它将在每个查询之前刷新。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mapper</span><span class="p">(</span>
    <span class="n">Foo</span><span class="p">,</span>
    <span class="n">foo_table</span><span class="p">,</span>
    <span class="n">properties</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;bars&quot;</span><span class="p">:</span> <span class="n">dynamic_loader</span><span class="p">(</span>
            <span class="n">Bar</span><span class="p">,</span>
            <span class="n">backref</span><span class="o">=</span><span class="s2">&quot;foo&quot;</span><span class="p">,</span>
            <span class="c1"># &lt;other relation() opts&gt;</span>
        <span class="p">)</span>
    <span class="p">},</span>
<span class="p">)</span>

<span class="n">session</span> <span class="o">=</span> <span class="n">create_session</span><span class="p">(</span><span class="n">autoflush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">foo</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Foo</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>

<span class="n">foo</span><span class="o">.</span><span class="n">bars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Bar</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;lala&quot;</span><span class="p">))</span>

<span class="k">for</span> <span class="n">bar</span> <span class="ow">in</span> <span class="n">foo</span><span class="o">.</span><span class="n">bars</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Bar</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;lala&quot;</span><span class="p">):</span>
    <span class="n">print</span><span class="p">(</span><span class="n">bar</span><span class="p">)</span>

<span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span></pre></div>
</div>
</section>
<section id="undefer-group-eagerload-all">
<h3>新选项：“undefer_group（）”，“eagerload_all（）”<a class="headerlink" href="#undefer-group-eagerload-all" title="Permalink to this heading">¶</a></h3>
<p>几个查询选项非常方便。 <a href="#id15"><span class="problematic" id="id16">``</span></a>undefer_group()``将整个“推迟”的列组标记为未推迟：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mapper</span><span class="p">(</span>
    <span class="n">Class</span><span class="p">,</span>
    <span class="n">table</span><span class="p">,</span>
    <span class="n">properties</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;foo&quot;</span><span class="p">:</span> <span class="n">deferred</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">foo</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="s2">&quot;group1&quot;</span><span class="p">),</span>
        <span class="s2">&quot;bar&quot;</span><span class="p">:</span> <span class="n">deferred</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">bar</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="s2">&quot;group1&quot;</span><span class="p">),</span>
        <span class="s2">&quot;bat&quot;</span><span class="p">:</span> <span class="n">deferred</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">bat</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="s2">&quot;group1&quot;</span><span class="p">),</span>
    <span class="p">},</span>
<span class="p">)</span>

<span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Class</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">undefer_group</span><span class="p">(</span><span class="s2">&quot;group1&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="o">...</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span></pre></div>
</div>
<p>而“eagerload_all（）”在一次传递中设置一系列属性为贪婪：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mapper</span><span class="p">(</span><span class="n">Foo</span><span class="p">,</span> <span class="n">foo_table</span><span class="p">,</span> <span class="n">properties</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;bar&quot;</span><span class="p">:</span> <span class="n">relation</span><span class="p">(</span><span class="n">Bar</span><span class="p">)})</span>
<span class="n">mapper</span><span class="p">(</span><span class="n">Bar</span><span class="p">,</span> <span class="n">bar_table</span><span class="p">,</span> <span class="n">properties</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;bat&quot;</span><span class="p">:</span> <span class="n">relation</span><span class="p">(</span><span class="n">Bat</span><span class="p">)})</span>
<span class="n">mapper</span><span class="p">(</span><span class="n">Bat</span><span class="p">,</span> <span class="n">bat_table</span><span class="p">)</span>

<span class="c1"># eager load bar and bat</span>
<span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Foo</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">eagerload_all</span><span class="p">(</span><span class="s2">&quot;bar.bat&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="o">...</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span></pre></div>
</div>
</section>
<section id="id17">
<h3>新的集合API<a class="headerlink" href="#id17" title="Permalink to this heading">¶</a></h3>
<p>集合现在不再由身份列表（{{{InstrumentedList}}} proxy）代理，对成员，方法和属性的访问是直接的。装饰器现在截取进入和离开集合的对象，并且现在可以轻松编写自定义集合类来管理其自己的成员身份。灵活的装饰器还替换了0.3中定制集合的命名方法界面，允许任何类轻松适应用作集合容器。</p>
<p>基于字典的集合现在更易于使用，完全类似于``dict``。不再需要更改“__iter__”对于字典和新的内置“dict”类型可以满足许多需求：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># use a dictionary relation keyed by a column</span>
<span class="n">relation</span><span class="p">(</span><span class="n">Item</span><span class="p">,</span> <span class="n">collection_class</span><span class="o">=</span><span class="n">column_mapped_collection</span><span class="p">(</span><span class="n">items</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">keyword</span><span class="p">))</span>
<span class="c1"># or named attribute</span>
<span class="n">relation</span><span class="p">(</span><span class="n">Item</span><span class="p">,</span> <span class="n">collection_class</span><span class="o">=</span><span class="n">attribute_mapped_collection</span><span class="p">(</span><span class="s2">&quot;keyword&quot;</span><span class="p">))</span>
<span class="c1"># or any function you like</span>
<span class="n">relation</span><span class="p">(</span><span class="n">Item</span><span class="p">,</span> <span class="n">collection_class</span><span class="o">=</span><span class="n">mapped_collection</span><span class="p">(</span><span class="k">lambda</span> <span class="n">entity</span><span class="p">:</span> <span class="n">entity</span><span class="o">.</span><span class="n">a</span> <span class="o">+</span> <span class="n">entity</span><span class="o">.</span><span class="n">b</span><span class="p">))</span></pre></div>
</div>
<p>现有的0.3类``dict`` -like和基于自由对象的集合类需要更新其新的API。在大多数情况下，这仅涉及向类定义添加几个装饰器。</p>
</section>
<section id="id18">
<h3>来自外部表/子查询的映射关系<a class="headerlink" href="#id18" title="Permalink to this heading">¶</a></h3>
<p>此功能在0.3中悄然出现，但是在0.4中得到了改进，由于更好地能够将针对表的子查询转换为该表别名的子查询；这对于贪婪的装载，查询中的别名连接等非常重要。这减少了对选择语句进行映射器的创建的必要性，当您只需要添加一些额外的列或子查询时。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mapper</span><span class="p">(</span>
    <span class="n">User</span><span class="p">,</span>
    <span class="n">users</span><span class="p">,</span>
    <span class="n">properties</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;fullname&quot;</span><span class="p">:</span> <span class="n">column_property</span><span class="p">(</span>
            <span class="p">(</span><span class="n">users</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">firstname</span> <span class="o">+</span> <span class="n">users</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">lastname</span><span class="p">)</span><span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="s2">&quot;fullname&quot;</span><span class="p">)</span>
        <span class="p">),</span>
        <span class="s2">&quot;numposts&quot;</span><span class="p">:</span> <span class="n">column_property</span><span class="p">(</span>
            <span class="n">select</span><span class="p">([</span><span class="n">func</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="mi">1</span><span class="p">)],</span> <span class="n">users</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">posts</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">user_id</span><span class="p">)</span>
            <span class="o">.</span><span class="n">correlate</span><span class="p">(</span><span class="n">users</span><span class="p">)</span>
            <span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="s2">&quot;posts&quot;</span><span class="p">)</span>
        <span class="p">),</span>
    <span class="p">},</span>
<span class="p">)</span></pre></div>
</div>
<p>典型查询的外观如下：</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">posts</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">users</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">posts</span><span class="p">.</span><span class="n">user_id</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">count</span><span class="p">,</span>
<span class="n">users</span><span class="p">.</span><span class="n">firstname</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">users</span><span class="p">.</span><span class="n">lastname</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">fullname</span><span class="p">,</span>
<span class="n">users</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">users_id</span><span class="p">,</span><span class="w"> </span><span class="n">users</span><span class="p">.</span><span class="n">firstname</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">users_firstname</span><span class="p">,</span><span class="w"> </span><span class="n">users</span><span class="p">.</span><span class="n">lastname</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">users_lastname</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">users</span><span class="p">.</span><span class="n">oid</span></pre></div>
</div>
</section>
</section>
<section id="id19">
<h2>继承<a class="headerlink" href="#id19" title="Permalink to this heading">¶</a></h2>
<section id="id20">
<h3>没有联接或联合的多态继承<a class="headerlink" href="#id20" title="Permalink to this heading">¶</a></h3>
<p>继承的新文档： <a class="reference external" href="https://www.sqlalchemy.org/docs/04">https://www.sqlalchemy.org/docs/04</a>
/mappers.html#advdatamapping_mapper_inheritance_joined</p>
</section>
<section id="get">
<h3>更好的多态行为与“get（）”<a class="headerlink" href="#get" title="Permalink to this heading">¶</a></h3>
<p>联接表继承层次结构中的所有类都使用基类获取“_instance_key”，即``(BaseClass，（1，）,None)``。那么，当您调用基类上的``get（）``从基类的``Query``中查找子类实例时，它可以在当前标识映射中查找子类实例，而无需查询数据库。</p>
</section>
</section>
<section id="id21">
<h2>类型<a class="headerlink" href="#id21" title="Permalink to this heading">¶</a></h2>
<p>sqlalchemy.types.TypeDecorator的自定义子类
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^■</p>
<p>有一个`新API &lt;<a class="reference external" href="https://www.sqlalchemy.org/docs/04/types">https://www.sqlalchemy.org/docs/04/types</a>
.html#types_custom&gt;`_可用于子类化TypeDecorator。在某些情况下，使用0.3 API会导致编译错误。</p>
</section>
</section>
<section id="id22">
<h1>SQL表达式<a class="headerlink" href="#id22" title="Permalink to this heading">¶</a></h1>
<section id="label-alias-generation">
<h2>全新，确定性Label / Alias Generation<a class="headerlink" href="#label-alias-generation" title="Permalink to this heading">¶</a></h2>
<p>所有“匿名”标签和别名现在使用简单的&lt;name&gt;_&lt;number&gt;格式。 SQL更容易阅读，并与计划优化器缓存兼容。只需查看教程中的一些示例：
<a class="reference external" href="https://www.sqlalchemy.org/docs/04/ormtutorial.html">https://www.sqlalchemy.org/docs/04/ormtutorial.html</a>
<a class="reference external" href="https://www.sqlalchemy.org/docs/04/sqlexpression.html">https://www.sqlalchemy.org/docs/04/sqlexpression.html</a></p>
</section>
<section id="id23">
<h2>生成选择（）构造<a class="headerlink" href="#id23" title="Permalink to this heading">¶</a></h2>
<p>这显然是使用 “select（）” 的方法。请参阅htt
p://www.sqlalchemy.org/docs/04/sqlexpression.html#sql_transf
orm 。</p>
</section>
<section id="id24">
<h2>新的运营商系统<a class="headerlink" href="#id24" title="Permalink to this heading">¶</a></h2>
<p>SQL运算符和更多或更多SQL关键字现在已抽象为编译器层。它们现在可以智能地运作，并具有类型/后端感知性，请参见：https：//www.sqlalchemy.org/docs/04/sqlexpression.html#sql_operators</p>
</section>
<section id="typetype">
<h2>所有“type”关键字参数重命名为“<a href="#id30"><span class="problematic" id="id31">type_</span></a>”<a class="headerlink" href="#typetype" title="Permalink to this heading">¶</a></h2>
<p>就像它所说的那样：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">b</span> <span class="o">=</span> <span class="n">bindparam</span><span class="p">(</span><span class="s2">&quot;foo&quot;</span><span class="p">,</span> <span class="n">type_</span><span class="o">=</span><span class="n">String</span><span class="p">)</span></pre></div>
</div>
</section>
<section id="id25">
<h2>变为_函数改为接受序列或可选择的<a class="headerlink" href="#id25" title="Permalink to this heading">¶</a></h2>
<p>in_函数现在需要一个值序列或可选择的可接受其唯一参数。将值作为位置参数传递的以前API仍然有效，但是现已被弃用。这意味着</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">my_table</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">my_table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">in_</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">my_table</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">my_table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">in_</span><span class="p">(</span><span class="o">*</span><span class="n">listOfIds</span><span class="p">))</span></pre></div>
</div>
<p>应更改为</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">my_table</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">my_table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">in_</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]))</span>
<span class="n">my_table</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">my_table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">in_</span><span class="p">(</span><span class="n">listOfIds</span><span class="p">))</span></pre></div>
</div>
</section>
</section>
<section id="id26">
<h1>架构和反射<a class="headerlink" href="#id26" title="Permalink to this heading">¶</a></h1>
<section id="metadata-boundmetadata-dynamicmetadata">
<h2>“MetaData”，“BoundMetaData”，“DynamicMetaData”…<a class="headerlink" href="#metadata-boundmetadata-dynamicmetadata" title="Permalink to this heading">¶</a></h2>
<p>在0.3.x系列中，<code class="docutils literal notranslate"><span class="pre">BoundMetaData``和</span>
<span class="pre">``DynamicMetaData``已弃用，预计更换为``MetaData</span></code>
和``ThreadLocalMetaData``。旧名称已在0.4中删除。更新很简单：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>+-------------------------------------+-------------------------+
|如果您有                            | 现在使用                |
+=====================================+=========================+
| ``MetaData``                        | ``MetaData``            |
+-------------------------------------+-------------------------+
| ``BoundMetaData``                   | ``MetaData``            |
+-------------------------------------+-------------------------+
| ``DynamicMetaData``（有一个引擎或   | ``MetaData``            |
| threadlocal = False）                |                         |
+-------------------------------------+-------------------------+
| ``DynamicMetaData``                 | ``ThreadLocalMetaData`` |
|（每个线程具有不同的引擎）          |                         |
+-------------------------------------+-------------------------+</pre></div>
</div>
<p>Seldom-used“name”指针已被删除。 <code class="docutils literal notranslate"><span class="pre">ThreadLocalMetaData``构造函数现在不带参数。这两种类型都可以绑定到``Engine``或单个``Connection</span></code>。</p>
</section>
<section id="id27">
<h2>一步多表反射<a class="headerlink" href="#id27" title="Permalink to this heading">¶</a></h2>
<p>现在可以在一步中从整个数据库或模式中加载表定义并自动创建“Table”对象：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">metadata</span> <span class="o">=</span> <span class="n">MetaData</span><span class="p">(</span><span class="n">myengine</span><span class="p">,</span> <span class="n">reflect</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">metadata</span><span class="o">.</span><span class="n">tables</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<span class="go">[&#39;table_a&#39;, &#39;table_b&#39;, &#39;table_c&#39;, &#39;...&#39;]</span></pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">MetaData``还增加了一个</span></code>.reflect()``
方法，可对加载过程进行更好的控制，包括指定要加载的可用表的子集。</p>
</section>
</section>
<section id="id28">
<h1>SQL执行<a class="headerlink" href="#id28" title="Permalink to this heading">¶</a></h1>
<section id="engine-connectablebind-tobind">
<h2>“engine”，“connectable”和“bind_to”现在都是“bind”<a class="headerlink" href="#engine-connectablebind-tobind" title="Permalink to this heading">¶</a></h2>
</section>
<section id="transactionsnestedtransactionstwophasetransactions">
<h2>“Transactions”、“NestedTransactions”和“TwoPhaseTransactions”<a class="headerlink" href="#transactionsnestedtransactionstwophasetransactions" title="Permalink to this heading">¶</a></h2>
</section>
<section id="id29">
<h2>连接池事件<a class="headerlink" href="#id29" title="Permalink to this heading">¶</a></h2>
<p>连接池现在在创建新的DB-API时应发出事件
连接，检查并将其检查回池中。您可以使用这些在新连接上执行会话范围的SQL设置语句，例如。</p>
</section>
<section id="oracle-engine">
<h2>Oracle Engine固定<a class="headerlink" href="#oracle-engine" title="Permalink to this heading">¶</a></h2>
<p>在0.3.11中，Oracle Engine存在有关主键处理方式的错误。这些错误可能会导致程序出现问题。当使用SQLite等其他引擎时并没有问题，但在使用Oracle引擎时会出现失败。
在0.4版本中，Oracle引擎已经重新设计，修复了这些主键问题。</p>
</section>
<section id="oracle">
<h2>Oracle的输出参数<a class="headerlink" href="#oracle" title="Permalink to this heading">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="n">engine</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
    <span class="n">text</span><span class="p">(</span>
        <span class="s2">&quot;begin foo(:x, :y, :z); end;&quot;</span><span class="p">,</span>
        <span class="n">bindparams</span><span class="o">=</span><span class="p">[</span>
            <span class="n">bindparam</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">Numeric</span><span class="p">),</span>
            <span class="n">outparam</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">Numeric</span><span class="p">),</span>
            <span class="n">outparam</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Numeric</span><span class="p">),</span>
        <span class="p">],</span>
    <span class="p">),</span>
    <span class="n">x</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
<span class="p">)</span>
<span class="k">assert</span> <span class="n">result</span><span class="o">.</span><span class="n">out_parameters</span> <span class="o">==</span> <span class="p">{</span><span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">:</span> <span class="mi">75</span><span class="p">}</span></pre></div>
</div>
</section>
<section id="metadatasessions">
<h2>基于连接的“MetaData”和“Sessions”<a class="headerlink" href="#metadatasessions" title="Permalink to this heading">¶</a></h2>
<p>“MetaData”和“Session”可以显式地绑定到连接：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">conn</span> <span class="o">=</span> <span class="n">engine</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
<span class="n">sess</span> <span class="o">=</span> <span class="n">create_session</span><span class="p">(</span><span class="n">bind</span><span class="o">=</span><span class="n">conn</span><span class="p">)</span></pre></div>
</div>
</section>
<section id="resultproxy">
<h2>更快、更可靠的“ResultProxy”对象<a class="headerlink" href="#resultproxy" title="Permalink to this heading">¶</a></h2>
</section>
</section>

    </div>

</div>

<div id="docs-bottom-navigation" class="docs-navigation-links, withsidebar">
        Previous:
        <a href="migration_05.html" title="previous chapter">SQLAlchemy 0.5有哪些新特性？</a>

    <div id="docs-copyright">
        &copy; <a href="../copyright.html">Copyright</a> 2007-2023, the SQLAlchemy authors and contributors.


    <p><b>flambé!</b> the dragon and <b><i>The Alchemist</i></b> image designs created and generously donated by <a href="https://github.com/vmalloc">Rotem Yaari</a>.</p>

        Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 7.0.1.

    Documentation last generated: 2023/8/18 9:47:08

    </div>
</div>

</div>



        
        

    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
          URL_ROOT:    '../',
          VERSION:     '2.0.19',
          COLLAPSE_MODINDEX: false,
          FILE_SUFFIX: '.html'
      };
    </script>

    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>

    <!-- begin iterate through sphinx environment script_files -->
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script type="text/javascript" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/sphinx_highlight.js"></script>
        <script type="text/javascript" src="../_static/clipboard.min.js"></script>
        <script type="text/javascript" src="../_static/copybutton.js"></script>
    <!-- end iterate through sphinx environment script_files -->

    <script type="text/javascript" src="../_static/init.js"></script>


    </body>
</html>


