<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">



<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />

        <title>
            
    
    概述
 &mdash;
    SQLAlchemy 2.0 Documentation

        </title>

        
            <!-- begin iterate through site-imported + sphinx environment css_files -->
                <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
                <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
                <link rel="stylesheet" href="_static/default.css" type="text/css" />
                <link rel="stylesheet" href="_static/copybutton.css" type="text/css" />
                <link rel="stylesheet" href="_static/docs.css" type="text/css" />
                <link rel="stylesheet" href="_static/sphinx_paramlinks.css" type="text/css" />
            <!-- end iterate through site-imported + sphinx environment css_files -->
        

        

    

    <!-- begin layout.mako headers -->

    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
        <link rel="copyright" title="Copyright" href="copyright.html" />
    <link rel="top" title="SQLAlchemy 2.0 Documentation" href="index.html" />
        <link rel="next" title="SQLAlchemy统一教程" href="tutorial/index.html" />
        <link rel="prev" title="目录" href="contents.html" />
    <!-- end layout.mako headers -->


    </head>
    <body>
        
















<div id="docs-container">





<div id="docs-top-navigation-container" class="body-background">
<div id="docs-header">
    <div id="docs-version-header">
        Release: <span class="version-num">2.0.19</span>


        | Release Date: July 15, 2023

    </div>

    <h1><a href="index.html">SQLAlchemy 2.0 Documentation</a></h1>

</div>
</div>

<div id="docs-body-container">

    <div id="fixed-sidebar" class="withsidebar">



        <div id="docs-sidebar-popout">
            <h3><a href="index.html">SQLAlchemy 2.0 Documentation</a></h3>
            <p id="sidebar-topnav">
                <a href="index.html">Home</a>
            </p>

            <div id="sidebar-search">
                <form class="search" action="search.html" method="get">
                  <label>
                  Search terms:
                  <input type="text" placeholder="search..." name="q" size="12" />
                  </label>
                  <input type="hidden" name="check_keywords" value="yes" />
                  <input type="hidden" name="area" value="default" />
                </form>
            </div>

        </div>

        <div id="docs-sidebar">

        <div id="sidebar-banner">
            
        </div>

        <div id="docs-sidebar-inner">

        
        <h3>
            <a href="index.html" title="SQLAlchemy 2.0 Documentation">SQLAlchemy 2.0 Documentation</a>
        </h3>

        <ul>
<li class="selected"><span class="link-container"><strong>概述</strong><a class="paramlink headerlink reference internal" href="#">¶</a></span><ul>
<li><span class="link-container"><a class="reference external" href="#doc-overview">文档概述</a></span></li>
<li><span class="link-container"><a class="reference external" href="#id5">代码示例</a></span></li>
<li><span class="link-container"><a class="reference external" href="#installation">安装指南</a></span><ul>
<li><span class="link-container"><a class="reference external" href="#id9">支持的平台</a></span></li>
<li><span class="link-container"><a class="reference external" href="#asyncio">AsyncIO支持</a></span></li>
<li><span class="link-container"><a class="reference external" href="#id10">支持的安装方法</a></span></li>
<li><span class="link-container"><a class="reference external" href="#pip">通过pip安装</a></span></li>
<li><span class="link-container"><a class="reference external" href="#id11">从源分发手动安装</a></span></li>
<li><span class="link-container"><a class="reference external" href="#cython">生成Cython扩展</a></span></li>
<li><span class="link-container"><a class="reference external" href="#api">安装数据库API</a></span></li>
<li><span class="link-container"><a class="reference external" href="#sqlalchemy">检查已安装的SQLAlchemy版本</a></span></li>
<li><span class="link-container"><a class="reference external" href="#id15">下一步</a></span></li>
</ul>
</li>
<li><span class="link-container"><a class="reference external" href="#x2-0">从1.x迁移到2.0</a></span></li>
</ul>
</li>
<li><span class="link-container"><a class="reference external" href="tutorial/index.html">SQLAlchemy统一教程</a></span></li>
<li><span class="link-container"><a class="reference external" href="orm/index.html">SQLAlchemy ORM</a></span></li>
<li><span class="link-container"><a class="reference external" href="core/index.html">SQLAlchemy 核心</a></span></li>
<li><span class="link-container"><a class="reference external" href="dialects/index.html">方言</a></span></li>
<li><span class="link-container"><a class="reference external" href="faq/index.html">常见问题解答</a></span></li>
<li><span class="link-container"><a class="reference external" href="errors.html">错误消息</a></span></li>
<li><span class="link-container"><a class="reference external" href="changelog/index.html">变更和迁移</a></span></li>
</ul>



        </div>

        </div>

    </div>

    <div id="narrow-index-nav">
        <form class="search" action="search.html" method="get">
            <label>
                Search terms:
            <input type="text" placeholder="search..." name="q" size="12" />
            </label>
            <input type="submit" value="Search" />
            <input type="hidden" name="check_keywords" value="yes" />
            <input type="hidden" name="area" value="default" />
        </form>

        <p>
        <a href="index.html">Home</a>
        </p>

    </div>


        <div id="docs-narrow-top-navigation">
            <ul>
                <li><b>Previous:</b>
                <a href="contents.html" title="previous chapter">目录</a></li>
                <li><b>Next:</b>
                <a href="tutorial/index.html" title="next chapter">SQLAlchemy统一教程</a></li>

            <li><b>Up:</b> <a href="index.html">Home</a></li>



            <li><b>On this page:</b></li>
            <ul>
<li><a class="reference internal" href="#overview">概述</a><ul>
<li><a class="reference internal" href="#doc-overview">文档概述</a></li>
<li><a class="reference internal" href="#id5">代码示例</a></li>
<li><a class="reference internal" href="#installation">安装指南</a><ul>
<li><a class="reference internal" href="#id9">支持的平台</a></li>
<li><a class="reference internal" href="#asyncio">AsyncIO支持</a></li>
<li><a class="reference internal" href="#id10">支持的安装方法</a></li>
<li><a class="reference internal" href="#pip">通过pip安装</a></li>
<li><a class="reference internal" href="#id11">从源分发手动安装</a></li>
<li><a class="reference internal" href="#cython">生成Cython扩展</a></li>
<li><a class="reference internal" href="#api">安装数据库API</a></li>
<li><a class="reference internal" href="#sqlalchemy">检查已安装的SQLAlchemy版本</a></li>
<li><a class="reference internal" href="#id15">下一步</a></li>
</ul>
</li>
<li><a class="reference internal" href="#x2-0">从1.x迁移到2.0</a></li>
</ul>
</li>
</ul>


            </ul>

        </div>



    <div id="docs-body" role="main" class="withsidebar intro" >
        
<section id="overview">
<span id="overview-toplevel"></span><span id="id1"></span><h1>概述<a class="headerlink" href="#overview" title="Permalink to this heading">¶</a></h1>
<p>SQLAlchemy SQL工具包和对象关系映射器是一个广泛应用于Python和数据库的工具集。它有几个不同的功能区域，可以单独使用或组合使用。如下图所示，其主要组成部分已经组织成图层，并且组件之间有依赖关系：</p>
<img alt="_images/sqla_arch_small.png" src="_images/sqla_arch_small.png" />
<p>上图展示SQLAlchemy最重要的两个部分应该是**对象关系映射器(ORM)**和**核心(Core)**。</p>
<p>核心包含了SQLAlchemy SQL和数据库集成以及描述服务的大部分内容，其中最突出的部分是**SQL表达式语言(SQL Expression Language)**。</p>
<p>SQL表达式语言本身是一个独立于ORM包的工具包，它提供了一组构建SQL表达式的系统，这些表达式由可组合的对象表示，然后可以在指定事务的范围内的目标数据库上“执行”，并返回结果集。插入、更新和删除(即：term:<cite>DML</cite>)是通过传递SQL表达式对象来实现的，这些语句代表了这些语句的字典，以及要与每个语句一起使用的参数。</p>
<p>ORM基于核心构建了一种工作方式，并与数据库模式映射的域对象模型进行交互。使用ORM，SQL语句的构造方式与使用核心时基本相同，但是DML的任务，这里指的是在数据库中保持业务对象时，使用了称为：term:<a href="#id2"><span class="problematic" id="id3">`</span></a>unit of work`的模式进行自动化处理，该模式将针对可变对象的状态变化转换为需要插入、更新和删除的构造，然后在这些对象的术语中调用它们。SELECT语句也通过ORM特定的自动化和对象中心查询功能进行增强。</p>
<p>与使用核心和SQL表达式语言的工作方式相比，这提供了关于数据库的基于架构的视图，以及面向不可变性的编程范例。ORM在此基础上构建了基于域的数据库视图，其编程规范更加明确，依赖于可变性。由于关系型数据库本身也是一种可变的服务，因此不同之处在于：Core/SQL表达式语言是面向命令的，而ORM是面向状态的。</p>
<section id="doc-overview">
<span id="id4"></span><h2>文档概述<a class="headerlink" href="#doc-overview" title="Permalink to this heading">¶</a></h2>
<p>文档分为四个部分：</p>
<ul class="simple">
<li><p><a class="reference internal" href="tutorial/index.html#unified-tutorial"><span class="std std-ref">SQLAlchemy统一教程</span></a> ——为1.4/2.0系列提供的全新教程，它从Core的描述开始，逐渐向ORM特定的概念等内容展开来介绍整个库。新用户以及从SQLAlchemy 1.x系列过来的用户应该从这里开始。</p></li>
<li><p><a class="reference internal" href="orm/index.html"><span class="std std-ref">SQLAlchemy ORM</span></a> ——该部分提供ORM的参考文献。</p></li>
<li><p><a class="reference internal" href="core/index.html"><span class="std std-ref">SQLAlchemy 核心</span></a> ——该部分提供所有Core内部的参考文献。也在这里描述了SQLAlchemy引擎、连接和汇集服务。</p></li>
<li><p><a class="reference internal" href="dialects/index.html"><span class="std std-ref">方言</span></a> ——提供所有: term:<cite>方言(dialect)`实现的参考文献，包括  :term:`DBAPI</cite>  细节。</p></li>
</ul>
</section>
<section id="id5">
<h2>代码示例<a class="headerlink" href="#id5" title="Permalink to this heading">¶</a></h2>
<p>SQLAlchemy分发的工作代码示例，主要是关于ORM的。在 :ref:<a href="#id6"><span class="problematic" id="id7">`</span></a>examples_toplevel`描述了所有包含的示例应用程序。</p>
<p>在维基上还有大量涉及核心SQLAlchemy结构以及ORM的示例。详见`炼金剧场&lt;<a class="reference external" href="https://www.sqlalchemy.org/trac/wiki/UsageRecipes">https://www.sqlalchemy.org/trac/wiki/UsageRecipes</a>&gt;`_。</p>
</section>
<section id="installation">
<span id="id8"></span><h2>安装指南<a class="headerlink" href="#installation" title="Permalink to this heading">¶</a></h2>
<section id="id9">
<h3>支持的平台<a class="headerlink" href="#id9" title="Permalink to this heading">¶</a></h3>
<p>SQLAlchemy支持以下平台：</p>
<ul class="simple">
<li><p>cPython 3.7和更高版本</p></li>
<li><p>Python-3兼容版本的`PyPy &lt;<a class="reference external" href="http://pypy.org/">http://pypy.org/</a>&gt;`_</p></li>
</ul>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 2.0: </span>SQLAlchemy现在针对Python 3.7及以上版本。</p>
</div>
</section>
<section id="asyncio">
<h3>AsyncIO支持<a class="headerlink" href="#asyncio" title="Permalink to this heading">¶</a></h3>
<p>SQLAlchemy的``asyncio``支持取决于`greenlet &lt;<a class="reference external" href="https://pypi.org/project/greenlet/">https://pypi.org/project/greenlet/</a>&gt;`_项目。此依赖项将默认安装在常见的机器平台上，但不支持每种架构，也可能在不常见的体系结构上不会默认安装。请参见   <a class="reference internal" href="orm/extensions/asyncio.html#asyncio-install"><span class="std std-ref">异步io平台安装说明(包括Apple M1)</span></a> ，了解确保存在asyncio支持的其他详细信息。</p>
</section>
<section id="id10">
<h3>支持的安装方法<a class="headerlink" href="#id10" title="Permalink to this heading">¶</a></h3>
<p>SQLAlchemy安装是通过基于`setuptools &lt;<a class="reference external" href="https://pypi.org/project/setuptools/">https://pypi.org/project/setuptools/</a>&gt;`_的标准Python方法实现的，可以直接引用``setup.py``，也可以使用`pip &lt;<a class="reference external" href="https://pypi.org/project/pip/">https://pypi.org/project/pip/</a>&gt;`_或其他与setuptools兼容的方法。</p>
</section>
<section id="pip">
<h3>通过pip安装<a class="headerlink" href="#pip" title="Permalink to this heading">¶</a></h3>
<p>当“pip”可用时，可以通过以下一步下载Python Cheese Shop(PyPI)提供的最新区版本SQLAlchemy的分发和在您的系统上安装它：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>pip install SQLAlchemy</pre></div>
</div>
<p>这个命令将从Python Cheese Shop(PyPI)下载SQLAlchemy的最新发布版本，并将其安装到您的系统中。对于大多数常见平台，将下载Python Wheel文件，提供了预编译的Cython / C扩展。</p>
<p>为了安装最新的**预发布版**，例如“2.0.0b1”，pip要求要使用“–pre”标志：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>pip install --pre SQLAlchemy</pre></div>
</div>
<p>上面的命令，如果最新版本是预发布版本，将安装预发布版本而不是最新发布版本。</p>
</section>
<section id="id11">
<h3>从源分发手动安装<a class="headerlink" href="#id11" title="Permalink to this heading">¶</a></h3>
<p>未从pip安装时，可以使用“setup.py”脚本安装源分发：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>python setup.py install</pre></div>
</div>
<p>源代码安装对平台无关，并且将在无论是否安装了Cython/C构建工具的任何平台上进行安装。如下面的章节 :ref:<a href="#id12"><span class="problematic" id="id13">`</span></a>c_extensions`所述，“setup.py”将尝试在构建过程中使用Cython/C构建，但是如果失败，则会退回到纯Python安装。</p>
</section>
<section id="cython">
<span id="c-extensions"></span><h3>生成Cython扩展<a class="headerlink" href="#cython" title="Permalink to this heading">¶</a></h3>
<p>SQLAlchemy包括Cython扩展，这些Cython扩展为各个领域提供了额外的速度提升，目前重点是加快核心结果集的速度。</p>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 2.0: </span>C扩展使用Cython重写</p>
</div>
<p>如果检测到适当的平台，并且安装了Cython软件包，则“setup.py”将自动构建扩展。完整的手动构建如下所示:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span># cd into SQLAlchemy source distribution
cd path/to/sqlalchemy

# install cython
pip install cython

# optionally build Cython extensions ahead of install
python setup.py build_ext

# run the install
python setup.py install</pre></div>
</div>
<p>还可以使用  <span class="target" id="index-0"></span><a class="pep reference external" href="https://peps.python.org/pep-0517/"><strong>PEP 517</strong></a>  技术，如使用“<a class="reference external" href="https://pypi.org/project/build/">build</a>”来执行源构建:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span># cd into SQLAlchemy source distribution
cd path/to/sqlalchemy

# install build
pip install build

# build source / wheel dists
python -m build</pre></div>
</div>
<p>如果Cython扩展的构建失败，由于未安装Cython或编译器缺失等问题，配置过程将输出警告消息，并在完成后不使用Cython扩展重新运行构建，报告最终状态。</p>
<p>要运行构建/安装，而不尝试编译Cython扩展，可以指定“DISABLE_SQLALCHEMY_CEXT”环境变量。这种情况的用例要么是用于特殊测试情况，要么是在通常“重建”机制不能克服的兼容性/构建问题的罕见情况下使用：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>export DISABLE_SQLALCHEMY_CEXT=1; python setup.py install</pre></div>
</div>
</section>
<section id="api">
<h3>安装数据库API<a class="headerlink" href="#api" title="Permalink to this heading">¶</a></h3>
<p>SQLAlchemy旨在与为特定数据库构建的: term: <cite>DBAPI`实现一起操作，并包括对最流行数据库的支持。在  :doc:</cite>/dialects/index`  中的各个数据库部分列出了每个数据库的可用DBAPI，包括外部链接。</p>
</section>
<section id="sqlalchemy">
<h3>检查已安装的SQLAlchemy版本<a class="headerlink" href="#sqlalchemy" title="Permalink to this heading">¶</a></h3>
<p>本文档涵盖了SQLAlchemy版本2.0。如果您正在处理已经安装了SQLAlchemy的系统，请在Python提示符下检查版本，如下所示：</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">sqlalchemy</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sqlalchemy</span><span class="o">.</span><span class="n">__version__</span>  
<span class="go">2.0.0</span></pre></div>
</div>
</section>
<section id="id15">
<h3>下一步<a class="headerlink" href="#id15" title="Permalink to this heading">¶</a></h3>
<p>安装了SQLAlchemy之后，新用户和老用户都可以  <a class="reference internal" href="tutorial/index.html#unified-tutorial"><span class="std std-ref">转到SQLAlchemy教程</span></a> 。</p>
</section>
</section>
<section id="x2-0">
<span id="migration"></span><h2>从1.x迁移到2.0<a class="headerlink" href="#x2-0" title="Permalink to this heading">¶</a></h2>
<p>关于在SQLAlchemy 2.0中发布的新API的说明在这里可以查看  <a class="reference internal" href="changelog/migration_20.html"><span class="doc">SQLAlchemy 2.0 - 主要迁移指南</span></a>  。</p>
</section>
</section>

    </div>

</div>

<div id="docs-bottom-navigation" class="docs-navigation-links, withsidebar">
        Previous:
        <a href="contents.html" title="previous chapter">目录</a>
        Next:
        <a href="tutorial/index.html" title="next chapter">SQLAlchemy统一教程</a>

    <div id="docs-copyright">
        &copy; <a href="copyright.html">Copyright</a> 2007-2023, the SQLAlchemy authors and contributors.


    <p><b>flambé!</b> the dragon and <b><i>The Alchemist</i></b> image designs created and generously donated by <a href="https://github.com/vmalloc">Rotem Yaari</a>.</p>

        Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 7.0.1.

    Documentation last generated: 2023/8/18 18:43:53

    </div>
</div>

</div>



        
        

    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
          URL_ROOT:    './',
          VERSION:     '2.0.19',
          COLLAPSE_MODINDEX: false,
          FILE_SUFFIX: '.html'
      };
    </script>

    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>

    <!-- begin iterate through sphinx environment script_files -->
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script type="text/javascript" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/sphinx_highlight.js"></script>
        <script type="text/javascript" src="_static/clipboard.min.js"></script>
        <script type="text/javascript" src="_static/copybutton.js"></script>
    <!-- end iterate through sphinx environment script_files -->

    <script type="text/javascript" src="_static/init.js"></script>


    </body>
</html>


