<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">



<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />

        <title>
            
    
    概述
 &mdash;
    SQLAlchemy 2.0 Documentation

        </title>

        
            <!-- begin iterate through site-imported + sphinx environment css_files -->
                <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
                <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
                <link rel="stylesheet" href="_static/default.css" type="text/css" />
                <link rel="stylesheet" href="_static/copybutton.css" type="text/css" />
                <link rel="stylesheet" href="_static/docs.css" type="text/css" />
                <link rel="stylesheet" href="_static/sphinx_paramlinks.css" type="text/css" />
            <!-- end iterate through site-imported + sphinx environment css_files -->
        

        

    

    <!-- begin layout.mako headers -->

    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
        <link rel="copyright" title="Copyright" href="copyright.html" />
    <link rel="top" title="SQLAlchemy 2.0 Documentation" href="index.html" />
        <link rel="next" title="SQLAlchemy统一教程" href="tutorial/index.html" />
        <link rel="prev" title="目录" href="contents.html" />
    <!-- end layout.mako headers -->


    </head>
    <body>
        
















<div id="docs-container">





<div id="docs-top-navigation-container" class="body-background">
<div id="docs-header">
    <div id="docs-version-header">
        Release: <span class="version-num">2.0.19</span>


        | Release Date: July 15, 2023

    </div>

    <h1><a href="index.html">SQLAlchemy 2.0 Documentation</a></h1>

</div>
</div>

<div id="docs-body-container">

    <div id="fixed-sidebar" class="withsidebar">



        <div id="docs-sidebar-popout">
            <h3><a href="index.html">SQLAlchemy 2.0 Documentation</a></h3>
            <p id="sidebar-topnav">
                <a href="index.html">Home</a>
            </p>

            <div id="sidebar-search">
                <form class="search" action="search.html" method="get">
                  <label>
                  Search terms:
                  <input type="text" placeholder="search..." name="q" size="12" />
                  </label>
                  <input type="hidden" name="check_keywords" value="yes" />
                  <input type="hidden" name="area" value="default" />
                </form>
            </div>

        </div>

        <div id="docs-sidebar">

        <div id="sidebar-banner">
            
        </div>

        <div id="docs-sidebar-inner">

        
        <h3>
            <a href="index.html" title="SQLAlchemy 2.0 Documentation">SQLAlchemy 2.0 Documentation</a>
        </h3>

        <ul>
<li class="selected"><span class="link-container"><strong>概述</strong><a class="paramlink headerlink reference internal" href="#">¶</a></span><ul>
<li><span class="link-container"><a class="reference external" href="#doc-overview">文档概述</a></span></li>
<li><span class="link-container"><a class="reference external" href="#id3">代码示例</a></span></li>
<li><span class="link-container"><a class="reference external" href="#installation">安装指南</a></span><ul>
<li><span class="link-container"><a class="reference external" href="#id7">支持平台</a></span></li>
<li><span class="link-container"><a class="reference external" href="#asyncio">AsyncIO支持</a></span></li>
<li><span class="link-container"><a class="reference external" href="#id10">支持的安装方法</a></span></li>
<li><span class="link-container"><a class="reference external" href="#pip">通过pip进行安装</a></span></li>
<li><span class="link-container"><a class="reference external" href="#id11">从源代码分发手动安装</a></span></li>
<li><span class="link-container"><a class="reference external" href="#cython">构建Cython扩展</a></span></li>
<li><span class="link-container"><a class="reference external" href="#api">安装数据库API</a></span></li>
<li><span class="link-container"><a class="reference external" href="#sqlalchemy">检查已安装的SQLAlchemy版本</a></span></li>
<li><span class="link-container"><a class="reference external" href="#id21">下一步</a></span></li>
</ul>
</li>
<li><span class="link-container"><a class="reference external" href="#x-2-0">1.x 到 2.0 迁移</a></span></li>
</ul>
</li>
<li><span class="link-container"><a class="reference external" href="tutorial/index.html">SQLAlchemy统一教程</a></span></li>
<li><span class="link-container"><a class="reference external" href="orm/index.html">SQLAlchemy ORM</a></span></li>
<li><span class="link-container"><a class="reference external" href="core/index.html">SQLAlchemy核心模块</a></span></li>
<li><span class="link-container"><a class="reference external" href="dialects/index.html">方言</a></span></li>
<li><span class="link-container"><a class="reference external" href="faq/index.html">常见问题解答</a></span></li>
<li><span class="link-container"><a class="reference external" href="errors.html">错误消息</a></span></li>
<li><span class="link-container"><a class="reference external" href="changelog/index.html">变更和迁移</a></span></li>
</ul>



        </div>

        </div>

    </div>

    <div id="narrow-index-nav">
        <form class="search" action="search.html" method="get">
            <label>
                Search terms:
            <input type="text" placeholder="search..." name="q" size="12" />
            </label>
            <input type="submit" value="Search" />
            <input type="hidden" name="check_keywords" value="yes" />
            <input type="hidden" name="area" value="default" />
        </form>

        <p>
        <a href="index.html">Home</a>
        </p>

    </div>


        <div id="docs-narrow-top-navigation">
            <ul>
                <li><b>Previous:</b>
                <a href="contents.html" title="previous chapter">目录</a></li>
                <li><b>Next:</b>
                <a href="tutorial/index.html" title="next chapter">SQLAlchemy统一教程</a></li>

            <li><b>Up:</b> <a href="index.html">Home</a></li>



            <li><b>On this page:</b></li>
            <ul>
<li><a class="reference internal" href="#overview">概述</a><ul>
<li><a class="reference internal" href="#doc-overview">文档概述</a></li>
<li><a class="reference internal" href="#id3">代码示例</a></li>
<li><a class="reference internal" href="#installation">安装指南</a><ul>
<li><a class="reference internal" href="#id7">支持平台</a></li>
<li><a class="reference internal" href="#asyncio">AsyncIO支持</a></li>
<li><a class="reference internal" href="#id10">支持的安装方法</a></li>
<li><a class="reference internal" href="#pip">通过pip进行安装</a></li>
<li><a class="reference internal" href="#id11">从源代码分发手动安装</a></li>
<li><a class="reference internal" href="#cython">构建Cython扩展</a></li>
<li><a class="reference internal" href="#api">安装数据库API</a></li>
<li><a class="reference internal" href="#sqlalchemy">检查已安装的SQLAlchemy版本</a></li>
<li><a class="reference internal" href="#id21">下一步</a></li>
</ul>
</li>
<li><a class="reference internal" href="#x-2-0">1.x 到 2.0 迁移</a></li>
</ul>
</li>
</ul>


            </ul>

        </div>



    <div id="docs-body" role="main" class="withsidebar intro" >
        
<section id="overview">
<span id="overview-toplevel"></span><span id="id1"></span><h1>概述<a class="headerlink" href="#overview" title="Permalink to this heading">¶</a></h1>
<p>SQLAlchemy SQL Toolkit和ORM(Object Relational Mapper)是一个用于处理数据库和Python的完整工具集。它有几个独立领域的功能，这些功能可以单独使用或结合使用。其主要组成部分如下图所示，组件之间的依赖关系组织成层：</p>
<img alt="_images/sqla_arch_small.png" src="_images/sqla_arch_small.png" />
<p>上图中，SQLAlchemy最显著的前端部分是**ORM(Object Relational Mapper)**和**Core**。</p>
<p>Core包含了SQLAlchemy的主要SQL和数据库集成与描述服务，其中最突出的部分是**SQL Expression Language**。</p>
<p>SQL Expression Language本身是一种工具包，独立于ORM包，提供了通过可组合的对象构建SQL表达式的系统，然后可以对特定事务范围内的目标数据库执行这些表达式，返回结果集。插入、更新和删除（即:DML）是通过传递表示这些语句的SQL表达式对象以及表示要与每个语句一起使用的参数的字典来实现的。</p>
<p>ORM基于Core来提供一种处理与数据库架构映射的域对象模型的方式。当使用ORM时，SQL语句的构建方式与使用Core时基本相同，但是DML（这里指业务对象在数据库中的持久化）的任务是通过称为**unit of work**的模式自动化，在该模式中，将可变对象的状态更改转换为INSERT、UPDATE和DELETE构造。然后根据这些对象的术语调用。SELECT语句也通过ORM特定的自动化和面向对象的查询功能进行增强。</p>
<p>与使用Core和SQL Expression语言工作提供了数据库的基于架构的视图以及基于不可变性的编程范例相比，ORM在此基础上建立了一个基于领域的数据库视图，其编程范例更为明确地面向对象并且依赖于可变性。因为关系数据库本身就是一项可变的服务，所以与Core/ SQL Expression语言的区别在于Core/SQL Expression语言是命令定向的而ORM是状态定向的。</p>
<section id="doc-overview">
<span id="id2"></span><h2>文档概述<a class="headerlink" href="#doc-overview" title="Permalink to this heading">¶</a></h2>
<p>文档分为四个部分:</p>
<ul class="simple">
<li><p><a class="reference internal" href="tutorial/index.html#unified-tutorial"><span class="std std-ref">SQLAlchemy统一教程</span></a> - 此1.4/2.0系列的全新教程综合介绍了整个库，从Core的描述开始，逐步向ORM特定的概念工作。新用户和来自SQLAlchemy 1.x系列的用户应从这里开始。</p></li>
<li><p><a class="reference internal" href="orm/index.html"><span class="std std-ref">SQLAlchemy ORM</span></a> - 在这个部分，展示了ORM的参考文档。</p></li>
<li><p><a class="reference internal" href="core/index.html"><span class="std std-ref">SQLAlchemy核心模块</span></a> - 在这里，展示了Core中的所有其他内容的参考文档。SQLAlchemy引擎、连接和池服务也在此处得到介绍。</p></li>
<li><p><a class="reference internal" href="dialects/index.html"><span class="std std-ref">方言</span></a> - 提供了所有dialect实现的参考文档，包括DBAPI专用词。</p></li>
</ul>
</section>
<section id="id3">
<h2>代码示例<a class="headerlink" href="#id3" title="Permalink to this heading">¶</a></h2>
<p>包含有关ORM的可操作代码示例已包括在SQLAlchemy发行版中。所有已包括示例应用的说明在:ref:<a href="#id4"><span class="problematic" id="id5">`</span></a>examples_toplevel`中。</p>
<p>在wiki中还有大量有关Core SQLAlchemy结构以及ORM的示例。有关详细信息，请参见`Theatrum Chemicum&lt;<a class="reference external" href="https://www.sqlalchemy.org/trac/wiki/UsageRecipes">https://www.sqlalchemy.org/trac/wiki/UsageRecipes</a>&gt;`_。</p>
</section>
<section id="installation">
<span id="id6"></span><h2>安装指南<a class="headerlink" href="#installation" title="Permalink to this heading">¶</a></h2>
<section id="id7">
<h3>支持平台<a class="headerlink" href="#id7" title="Permalink to this heading">¶</a></h3>
<p>SQLAlchemy支持以下平台:</p>
<ul class="simple">
<li><p>cPython 3.7 及更高版本</p></li>
<li><p>适用于`PyPy &lt;<a class="reference external" href="http://pypy.org/">http://pypy.org/</a>&gt;`_的 Python 3 兼容版本</p></li>
</ul>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 2.0: </span>SQLAlchemy现在针对Python 3.7及以上版本进行目标定位。</p>
</div>
</section>
<section id="asyncio">
<h3>AsyncIO支持<a class="headerlink" href="#asyncio" title="Permalink to this heading">¶</a></h3>
<p>SQLAlchemy的``asyncio``支持取决于`greenlet &lt;<a class="reference external" href="https://pypi.org/project/greenlet/">https://pypi.org/project/greenlet/</a>&gt;`_项目。此依赖项将在常见机器平台上默认安装，但不会支持所有架构，并且也可能不会在不常见的架构上默认安装。请参见：ref:<a href="#id8"><span class="problematic" id="id9">`</span></a>asyncio_install`节，以了解有关确保asyncio支持正常的其他详细信息。</p>
</section>
<section id="id10">
<h3>支持的安装方法<a class="headerlink" href="#id10" title="Permalink to this heading">¶</a></h3>
<p>SQLAlchemy的安装是通过基于`setuptools &lt;<a class="reference external" href="https://pypi.org/project/setuptools/">https://pypi.org/project/setuptools/</a>&gt;`_的标准Python方法进行的，可以直接引用``setup.py``或使用`pip &lt;<a class="reference external" href="https://pypi.org/project/pip/">https://pypi.org/project/pip/</a>&gt;`_或其他支持setuptools的方法进行。</p>
</section>
<section id="pip">
<h3>通过pip进行安装<a class="headerlink" href="#pip" title="Permalink to this heading">¶</a></h3>
<p>如果``pip``可用，可以使用以下一步下载SQLAlchemy分配并进行安装：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>pip install SQLAlchemy</pre></div>
</div>
<p>此命令将从`Python Cheese Shop &lt;<a class="reference external" href="https://pypi.org/project/SQLAlchemy">https://pypi.org/project/SQLAlchemy</a>&gt;`_下载SQLAlchemy的最新“released”版本，并将其安装到系统中。对于大多数常见平台，将下载提供本地Cython / C扩展预构建的Python Wheel文件。</p>
<p>要安装最新的“prerelease”版本，例如“2.0.0b1”，需要使用``–pre``标志：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>pip install --pre SQLAlchemy</pre></div>
</div>
<p>如果最近的版本是预发行版，则将安装它，而不是最新发布的版本。</p>
</section>
<section id="id11">
<h3>从源代码分发手动安装<a class="headerlink" href="#id11" title="Permalink to this heading">¶</a></h3>
<p>如果不是从pip安装，则可以使用``setup.py``脚本安装源分发：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>python setup.py install</pre></div>
</div>
<p>源代码安装与平台无关，可以在任何平台上安装，无论是否安装了Cython / C构建工具。正如下一节:ref: <a href="#id12"><span class="problematic" id="id13">`</span></a>c_extensions`所述，<a href="#id14"><span class="problematic" id="id15">``</span></a>setup.py``将尝试使用Cython / C进行构建，如果不可能，则会回退到纯Python安装。</p>
</section>
<section id="cython">
<span id="c-extensions"></span><h3>构建Cython扩展<a class="headerlink" href="#cython" title="Permalink to this heading">¶</a></h3>
<p>SQLAlchemy包含Cython_扩展，这些扩展提供了各种领域内的额外速度提升，目前重点关注Core结果集的速度。</p>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 2.0: </span>SQLAlchemy C扩展已使用Cython进行重写。</p>
</div>
<p>如果检测到一个合适的平台，<a href="#id16"><span class="problematic" id="id17">``</span></a>setup.py``将自动构建扩展，假设Cython包已安装。完整的手动构建如下所示：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span># 进入SQLAlchemy源分销商
cd path/to/sqlalchemy

# 安装Cython
pip install cython

# 可选地提前安装Cython扩展
python setup.py build_ext

# 运行安装
python setup.py install</pre></div>
</div>
<p>也可以使用:pep:<a href="#id18"><span class="problematic" id="id19">`</span></a>517`技术，例如使用库构建源/ wheel分销商：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span># 进入SQLAlchemy源分销商
cd path/to/sqlalchemy

# 安装build
pip install build

＃构建源码/轮Dists
python -m build</pre></div>
</div>
<p>如果Cython扩展的构建因未安装Cython、缺少编译器或其他问题而失败，则设置过程将输出警告消息，并在完成后在Cython扩展上重新运行构建并报告最终状态。</p>
<p>要完全运行构建/安装而无需尝试编译Cython扩展，可以指定``DISABLE_SQLALCHEMY_CEXT``环境变量。用例是特殊测试情况，或在通常的“重建”机制无法克服的兼容性/构建问题的罕见情况下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>export DISABLE_SQLALCHEMY_CEXT=1; python setup.py install</pre></div>
</div>
</section>
<section id="api">
<h3>安装数据库API<a class="headerlink" href="#api" title="Permalink to this heading">¶</a></h3>
<p>SQLAlchemy旨在与专为特定数据库构建的:term:<cite>DBAPI`实现一起运行，并包含对最受欢迎的数据库的支持。在:doc:</cite>/dialects/index`中的各个数据库部分枚举了每个数据库的可用DBAPI，包括外部链接。</p>
</section>
<section id="sqlalchemy">
<h3>检查已安装的SQLAlchemy版本<a class="headerlink" href="#sqlalchemy" title="Permalink to this heading">¶</a></h3>
<p>此文档涵盖的SQLAlchemy版本为2.0。如果您正在使用已安装SQLAlchemy的系统，请像这样从Python提示符中检查版本：</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">sqlalchemy</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sqlalchemy</span><span class="o">.</span><span class="n">__version__</span>  
<span class="go">2.0.0</span></pre></div>
</div>
</section>
<section id="id21">
<h3>下一步<a class="headerlink" href="#id21" title="Permalink to this heading">¶</a></h3>
<p>安装SQLAlchemy后，无论是新用户还是老用户，都可以 <strong>下一步</strong> <a class="reference internal" href="tutorial/index.html#unified-tutorial"><span class="std std-ref">继续SQLAlchemy教程</span></a>。</p>
</section>
</section>
<section id="x-2-0">
<span id="migration"></span><h2>1.x 到 2.0 迁移<a class="headerlink" href="#x-2-0" title="Permalink to this heading">¶</a></h2>
<p>SQLAlchemy 2.0发布的新API说明在 :doc:<a href="#id22"><span class="problematic" id="id23">`</span></a>changelog/migration_20`中。</p>
</section>
</section>

    </div>

</div>

<div id="docs-bottom-navigation" class="docs-navigation-links, withsidebar">
        Previous:
        <a href="contents.html" title="previous chapter">目录</a>
        Next:
        <a href="tutorial/index.html" title="next chapter">SQLAlchemy统一教程</a>

    <div id="docs-copyright">
        &copy; <a href="copyright.html">Copyright</a> 2007-2023, the SQLAlchemy authors and contributors.


    <p><b>flambé!</b> the dragon and <b><i>The Alchemist</i></b> image designs created and generously donated by <a href="https://github.com/vmalloc">Rotem Yaari</a>.</p>

        Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 7.0.1.

    Documentation last generated: 2023/8/18 10:07:08

    </div>
</div>

</div>



        
        

    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
          URL_ROOT:    './',
          VERSION:     '2.0.19',
          COLLAPSE_MODINDEX: false,
          FILE_SUFFIX: '.html'
      };
    </script>

    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>

    <!-- begin iterate through sphinx environment script_files -->
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script type="text/javascript" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/sphinx_highlight.js"></script>
        <script type="text/javascript" src="_static/clipboard.min.js"></script>
        <script type="text/javascript" src="_static/copybutton.js"></script>
    <!-- end iterate through sphinx environment script_files -->

    <script type="text/javascript" src="_static/init.js"></script>


    </body>
</html>


