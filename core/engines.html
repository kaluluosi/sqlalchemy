<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">



<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />

        <title>
            
    
    引擎配置
 &mdash;
    SQLAlchemy 2.0 Documentation

        </title>

        
            <!-- begin iterate through site-imported + sphinx environment css_files -->
                <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
                <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
                <link rel="stylesheet" href="../_static/default.css" type="text/css" />
                <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
                <link rel="stylesheet" href="../_static/docs.css" type="text/css" />
                <link rel="stylesheet" href="../_static/sphinx_paramlinks.css" type="text/css" />
            <!-- end iterate through site-imported + sphinx environment css_files -->
        

        

    

    <!-- begin layout.mako headers -->

    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
        <link rel="copyright" title="Copyright" href="../copyright.html" />
    <link rel="top" title="SQLAlchemy 2.0 Documentation" href="../index.html" />
    <!-- end layout.mako headers -->


    </head>
    <body>
        
















<div id="docs-container">





<div id="docs-top-navigation-container" class="body-background">
<div id="docs-header">
    <div id="docs-version-header">
        Release: <span class="version-num">2.0.19</span>


        | Release Date: July 15, 2023

    </div>

    <h1><a href="../index.html">SQLAlchemy 2.0 Documentation</a></h1>

</div>
</div>

<div id="docs-body-container">

    <div id="fixed-sidebar" class="withsidebar">



        <div id="docs-sidebar-popout">
            <h3><a href="../index.html">SQLAlchemy 2.0 Documentation</a></h3>
            <p id="sidebar-topnav">
                <a href="../index.html">Home</a>
            </p>

            <div id="sidebar-search">
                <form class="search" action="../search.html" method="get">
                  <label>
                  Search terms:
                  <input type="text" placeholder="search..." name="q" size="12" />
                  </label>
                  <input type="hidden" name="check_keywords" value="yes" />
                  <input type="hidden" name="area" value="default" />
                </form>
            </div>

        </div>

        <div id="docs-sidebar">

        <div id="sidebar-banner">
            
        </div>

        <div id="docs-sidebar-inner">

        
        <h3>
            <a href="../index.html" title="SQLAlchemy 2.0 Documentation">SQLAlchemy 2.0 Documentation</a>
        </h3>

        <ul>
<li><span class="link-container"><a class="reference external" href="../intro.html">概述</a></span></li>
<li><span class="link-container"><a class="reference external" href="../tutorial/index.html">SQLAlchemy统一教程</a></span></li>
<li><span class="link-container"><a class="reference external" href="../orm/index.html">SQLAlchemy ORM</a></span></li>
<li><span class="link-container"><a class="reference external" href="index.html">SQLAlchemy 核心</a></span></li>
<li><span class="link-container"><a class="reference external" href="../dialects/index.html">方言</a></span></li>
<li><span class="link-container"><a class="reference external" href="../faq/index.html">常见问题解答</a></span></li>
<li><span class="link-container"><a class="reference external" href="../errors.html">错误消息</a></span></li>
<li><span class="link-container"><a class="reference external" href="../changelog/index.html">变更和迁移</a></span></li>
</ul>



        </div>

        </div>

    </div>

    <div id="narrow-index-nav">
        <form class="search" action="../search.html" method="get">
            <label>
                Search terms:
            <input type="text" placeholder="search..." name="q" size="12" />
            </label>
            <input type="submit" value="Search" />
            <input type="hidden" name="check_keywords" value="yes" />
            <input type="hidden" name="area" value="default" />
        </form>

        <p>
        <a href="../index.html">Home</a>
        </p>

    </div>


        <div id="docs-narrow-top-navigation">
            <ul>

            <li><b>Up:</b> <a href="../index.html">Home</a></li>



            <li><b>On this page:</b></li>
            <ul>
<li><a class="reference internal" href="#engines-toplevel">引擎配置</a><ul>
<li><a class="reference internal" href="#supported-dbapis">支持的数据库</a></li>
<li><a class="reference internal" href="#urls">数据库URLs</a><ul>
<li><a class="reference internal" href="#id17">转义密码中的特殊字符，如&#64;符号</a><ul>
<li><a class="reference internal" href="#id20">动态生成身份验证令牌</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id21">屏蔽参数</a></li>
</ul>
</li>
</ul>
</li>
</ul>


            </ul>

        </div>



    <div id="docs-body" role="main" class="withsidebar core-engines" >
        
<section id="engines-toplevel">
<span id="id1"></span><h1>引擎配置<a class="headerlink" href="#" title="Permalink to this heading">¶</a></h1>
<blockquote>
<div><p><a class="reference internal" href="connections.html#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a> .Dialect`通过连接池和  <a class="reference internal" href="internals.html#sqlalchemy.engine.Dialect" title="sqlalchemy.engine.Dialect"><code class="xref py py-class docutils literal notranslate"><span class="pre">Dialect</span></code></a> ，用于区分术语和说明文本的方式解释数据库的行为。这些应用程序描述了与特定类型的数据库/DBAPI组合谈话的方法。</p>
</div></blockquote>
<p>一般结构如下所示：</p>
<img alt="../_images/sqla_engine_arch.png" src="../_images/sqla_engine_arch.png" />
<p>上面，  <a class="reference internal" href="connections.html#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a> .Dialect`和一个  <a class="reference internal" href="pooling.html#sqlalchemy.pool.Pool" title="sqlalchemy.pool.Pool"><code class="xref py py-class docutils literal notranslate"><span class="pre">Pool</span></code></a> ，它们在一起解释了DBAPI的模​​块函数以及数据库的行为。</p>
<p>创建引擎只涉及发出单个调用，  <code class="xref py py-func docutils literal notranslate"><span class="pre">create_engine()</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">create_engine</span>

<span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s2">&quot;postgresql+psycopg2://scott:tiger@localhost:5432/mydatabase&quot;</span><span class="p">)</span></pre></div>
</div>
<p>上面的引擎创建了一个专为PostgreSQL量身定制的  <a class="reference internal" href="internals.html#sqlalchemy.engine.Dialect" title="sqlalchemy.engine.Dialect"><code class="xref py py-class docutils literal notranslate"><span class="pre">Dialect</span></code></a> <cite>localhost：5432``建立一个DBAPI连接。请注意，  :class:`_engine.Engine</cite>  方法或依赖于此方法的操作（例如  <code class="xref py py-meth docutils literal notranslate"><span class="pre">Engine.execute()</span></code>  ）之前建立第一个实际的DBAPI连接。通过这种方式，可以说 :class:<a href="#id2"><span class="problematic" id="id3">`</span></a>_engine.Engine`和 :class:<a href="#id4"><span class="problematic" id="id5">`</span></a>_pool.Pool`具有*懒初始化*行为。</p>
<p>一旦创建  <a class="reference internal" href="connections.html#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a> ，可以直接使用它与数据库交互，或者将其传递给  <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> ,将详细介绍 :class:<a href="#id6"><span class="problematic" id="id7">`</span></a>_engine.Engine`及类似对象的使用API，通常用于非ORM应用程序。</p>
<section id="supported-dbapis">
<span id="id8"></span><h2>支持的数据库<a class="headerlink" href="#supported-dbapis" title="Permalink to this heading">¶</a></h2>
<p>SQLAlchemy包括许多 :class:<a href="#id9"><span class="problematic" id="id10">`</span></a>.Dialect`实现，用于不同的后端。与大多数常见的数据库相关的方言已包含在SQLAlchemy中；另外一些需要额外安装一个单独的方言。</p>
<p>请参见 :ref:<a href="#id11"><span class="problematic" id="id12">`</span></a>dialect_toplevel`一节，了解各种后端的详细信息。</p>
</section>
<section id="urls">
<span id="database-urls"></span><h2>数据库URLs<a class="headerlink" href="#urls" title="Permalink to this heading">¶</a></h2>
<blockquote>
<div><p><a href="#id13"><span class="problematic" id="id14">:func:`_sa.create_engine`函数基于URL生成 :class:`_engine.Engine`对象。URL的格式通常遵循`RFC-1738&lt;https://www.ietf.org/rfc/rfc1738.txt&gt;`_</span></a>，除了在“方案”部分之内接受下划线而不是短横线或句点。URL通常包括用户名、密码、主机名、数据库名称字段，以及可选的关键字参数用于其他配置。在某些情况下，文件路径是可接受的，而在其他情况下，“数据源名称”替换“主机”和“数据库”部分。数据库URL的典型形式为：</p>
</div></blockquote>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>dialect+driver://username:password@host:port/database</pre></div>
</div>
<p>方言名称包括SQLAlchemy方言的标识名称，例如 <code class="docutils literal notranslate"><span class="pre">sqlite</span></code>，<code class="docutils literal notranslate"><span class="pre">mysql</span></code>，<code class="docutils literal notranslate"><span class="pre">postgresql</span></code>，<a href="#id15"><span class="problematic" id="id16">``</span></a>oracle``或``mssql``的名称。driverName是用于使用所有小写字母连接到数据库的DBAPI的名称。如果未指定，则会导入“默认”DBAPI（如果可用）-这个默认值通常是该后端可用的最通用的驱动程序。</p>
<section id="id17">
<h3>转义密码中的特殊字符，如&#64;符号<a class="headerlink" href="#id17" title="Permalink to this heading">¶</a></h3>
<p>当构建一个完整的URL字符串传递给 :func:<a href="#id18"><span class="problematic" id="id19">`</span></a>_sa.create_engine`时，<strong>特殊字符，例如在用户和密码中使用的字符需要进行URL编码，以便被正确解析</strong>。<strong>这就包括了“&#64;”符号</strong>。</p>
<p>以下是一个URL示例，其中包括密码“<a class="reference external" href="mailto:kx&#37;&#52;&#48;jj5/g">kx<span>&#64;</span>jj5/g</a>”，其中“at”符号和斜杆字符分别表示为“%40”和“%2F”：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>postgresql+pg8000://dbuser:kx%40jj5%2Fg@pghost10/appdb</pre></div>
</div>
<p>上述密码的转码可以使用`urllib.parse &lt;<a class="reference external" href="https://docs.python.org/3/library/urllib.parse.html">https://docs.python.org/3/library/urllib.parse.html</a>&gt;`_生成:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">urllib.parse</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">quote_plus</span><span class="p">(</span><span class="s2">&quot;kx@jj5/g&quot;</span><span class="p">)</span>
<span class="go">&#39;kx%40jj5%2Fg&#39;</span></pre></div>
</div>
<p>然后可以将URL作为字符串传递给  <code class="xref py py-func docutils literal notranslate"><span class="pre">create_engine()</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">create_engine</span>

<span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s2">&quot;postgresql+pg8000://dbuser:kx%40jj5</span><span class="si">%2F</span><span class="s2">g@pghost10/appdb&quot;</span><span class="p">)</span></pre></div>
</div>
<p>作为转义特殊字符以创建完整的URL字符串的替代方法，传递给  <code class="xref py py-func docutils literal notranslate"><span class="pre">create_engine()</span></code> .URL`类的实例，该实例绕过解析阶段，直接适应未转义的字符串。有关示例，请参见以下部分。</p>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 1.4: </span>修复了主机名和数据库名中的``&#64;``符号的支持。作为此修复的副作用，必须转义密码中的``&#64;``符号。</p>
</div>
<section id="id20">
<h4>动态生成身份验证令牌<a class="headerlink" href="#id20" title="Permalink to this heading">¶</a></h4>
<blockquote>
<div><p><a class="reference internal" href="connections.html#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a> .DialectEvents.do_connect` 事件挂钩来全面接管连接过程，从而为生命周期内可能会更改的令牌提供理想的方法。例如，如果标记通过``get_authentication_token()``生成并在一个``token``参数中传递给DBAPI，那么可以实现如下：</p>
<blockquote>
<div><p>from sqlalchemy import event</p>
<p>engine = create_engine(“postgresql+psycopg2://user:pass&#64;hostname/dbname”)</p>
<p>&#64;event.listens_for(engine, “do_connect”)
def provide_token(dialect, conn_rec, cargs, cparams):</p>
<blockquote>
<div><p>cparams[“token”] = get_authentication_token()</p>
</div></blockquote>
</div></blockquote>
</div></blockquote>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../dialects/mssql.html#mssql-pyodbc-access-tokens"><span class="std std-ref">Connecting to databases with access tokens</span></a>  - 一个涉及SQL Server的更具体的例子</p>
</div>
</section>
</section>
<section id="id21">
<h3>屏蔽参数<a class="headerlink" href="#id21" title="Permalink to this heading">¶</a></h3>
<blockquote>
<div><p><a class="reference internal" href="connections.html#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a>  标志即可：</p>
<blockquote>
<div><p>e = create_engine(“sqlite://”, echo=True, hide_parameters=True)</p>
</div></blockquote>
</div></blockquote>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">e</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">text</span><span class="p">(</span><span class="s2">&quot;select :some_private_name&quot;</span><span class="p">),</span> <span class="p">{</span><span class="s2">&quot;some_private_name&quot;</span><span class="p">:</span> <span class="s2">&quot;pii&quot;</span><span class="p">})</span>
<span class="go">2020-10-24 12:48:32,808 INFO sqlalchemy.engine.Engine select ?</span>
<span class="go">2020-10-24 12:48:32,808 INFO sqlalchemy.engine.Engine [由于hide_parameters=True参数被隐藏, SQL参数没有显示]</span></pre></div>
</div>
</section>
</section>
</section>

    </div>

</div>

<div id="docs-bottom-navigation" class="docs-navigation-links, withsidebar">

    <div id="docs-copyright">
        &copy; <a href="../copyright.html">Copyright</a> 2007-2023, the SQLAlchemy authors and contributors.


    <p><b>flambé!</b> the dragon and <b><i>The Alchemist</i></b> image designs created and generously donated by <a href="https://github.com/vmalloc">Rotem Yaari</a>.</p>

        Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 7.0.1.

    Documentation last generated: 2023/8/18 18:43:46

    </div>
</div>

</div>



        
        

    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
          URL_ROOT:    '../',
          VERSION:     '2.0.19',
          COLLAPSE_MODINDEX: false,
          FILE_SUFFIX: '.html'
      };
    </script>

    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>

    <!-- begin iterate through sphinx environment script_files -->
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script type="text/javascript" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/sphinx_highlight.js"></script>
        <script type="text/javascript" src="../_static/clipboard.min.js"></script>
        <script type="text/javascript" src="../_static/copybutton.js"></script>
    <!-- end iterate through sphinx environment script_files -->

    <script type="text/javascript" src="../_static/init.js"></script>


    </body>
</html>


