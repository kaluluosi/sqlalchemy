<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">



<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />

        <title>
            
    
    使用 Engine 和 Connections
 &mdash;
    SQLAlchemy 2.0 Documentation

        </title>

        
            <!-- begin iterate through site-imported + sphinx environment css_files -->
                <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
                <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
                <link rel="stylesheet" href="../_static/default.css" type="text/css" />
                <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
                <link rel="stylesheet" href="../_static/docs.css" type="text/css" />
                <link rel="stylesheet" href="../_static/sphinx_paramlinks.css" type="text/css" />
            <!-- end iterate through site-imported + sphinx environment css_files -->
        

        

    

    <!-- begin layout.mako headers -->

    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
        <link rel="copyright" title="Copyright" href="../copyright.html" />
    <link rel="top" title="SQLAlchemy 2.0 Documentation" href="../index.html" />
    <!-- end layout.mako headers -->


    </head>
    <body>
        
















<div id="docs-container">





<div id="docs-top-navigation-container" class="body-background">
<div id="docs-header">
    <div id="docs-version-header">
        Release: <span class="version-num">2.0.19</span>


        | Release Date: July 15, 2023

    </div>

    <h1><a href="../index.html">SQLAlchemy 2.0 Documentation</a></h1>

</div>
</div>

<div id="docs-body-container">

    <div id="fixed-sidebar" class="withsidebar">



        <div id="docs-sidebar-popout">
            <h3><a href="../index.html">SQLAlchemy 2.0 Documentation</a></h3>
            <p id="sidebar-topnav">
                <a href="../index.html">Home</a>
            </p>

            <div id="sidebar-search">
                <form class="search" action="../search.html" method="get">
                  <label>
                  Search terms:
                  <input type="text" placeholder="search..." name="q" size="12" />
                  </label>
                  <input type="hidden" name="check_keywords" value="yes" />
                  <input type="hidden" name="area" value="default" />
                </form>
            </div>

        </div>

        <div id="docs-sidebar">

        <div id="sidebar-banner">
            
        </div>

        <div id="docs-sidebar-inner">

        
        <h3>
            <a href="../index.html" title="SQLAlchemy 2.0 Documentation">SQLAlchemy 2.0 Documentation</a>
        </h3>

        <ul>
<li><span class="link-container"><a class="reference external" href="../intro.html">概述</a></span></li>
<li><span class="link-container"><a class="reference external" href="../tutorial/index.html">SQLAlchemy统一教程</a></span></li>
<li><span class="link-container"><a class="reference external" href="../orm/index.html">SQLAlchemy ORM</a></span></li>
<li><span class="link-container"><a class="reference external" href="index.html">SQLAlchemy 核心</a></span></li>
<li><span class="link-container"><a class="reference external" href="../dialects/index.html">方言</a></span></li>
<li><span class="link-container"><a class="reference external" href="../faq/index.html">常见问题解答</a></span></li>
<li><span class="link-container"><a class="reference external" href="../errors.html">错误消息</a></span></li>
<li><span class="link-container"><a class="reference external" href="../changelog/index.html">变更和迁移</a></span></li>
</ul>



        </div>

        </div>

    </div>

    <div id="narrow-index-nav">
        <form class="search" action="../search.html" method="get">
            <label>
                Search terms:
            <input type="text" placeholder="search..." name="q" size="12" />
            </label>
            <input type="submit" value="Search" />
            <input type="hidden" name="check_keywords" value="yes" />
            <input type="hidden" name="area" value="default" />
        </form>

        <p>
        <a href="../index.html">Home</a>
        </p>

    </div>


        <div id="docs-narrow-top-navigation">
            <ul>

            <li><b>Up:</b> <a href="../index.html">Home</a></li>



            <li><b>On this page:</b></li>
            <ul>
<li><a class="reference internal" href="#module-sqlalchemy.engine">使用 Engine 和 Connections</a><ul>
<li><a class="reference internal" href="#id1">基本用法</a></li>
<li><a class="reference internal" href="#id4">使用事务</a><ul>
<li><a class="reference internal" href="#id5">按需提交</a></li>
<li><a class="reference internal" href="#id6">一次开始</a></li>
<li><a class="reference internal" href="#engine">连接和一次开始从 Engine 中开始</a></li>
<li><a class="reference internal" href="#id7">样式混合</a></li>
</ul>
</li>
<li><a class="reference internal" href="#dbapi">设置事务隔离级别，包括 DBAPI 自动提交</a><ul>
<li><a class="reference internal" href="#isolation-level-dbapi-autocommit">为一个连接设置 Isolation Level 或 DBAPI Autocommit</a></li>
<li><a class="reference internal" href="#id10">为引擎设置隔离级别或 DBAPI 自动提交</a></li>
<li><a class="reference internal" href="#dbapi-autocommit-multiple">对于单个引擎维护多个隔离级别</a></li>
<li><a class="reference internal" href="#dbapi-autocommit-understanding">理解 DBAPI 级别的自动提交隔离级别行为</a><ul>
<li><a class="reference internal" href="#id15">更改隔离级别</a></li>
</ul>
</li>
<li><a class="reference internal" href="#yield-per">通过 yield_per 使用固定大小的缓冲进行流处理</a></li>
<li><a class="reference internal" href="#stream-results">使用 stream_results 动态增长的缓冲区进行流处理</a></li>
</ul>
</li>
<li><a class="reference internal" href="#schema-translating">翻译模式名称</a></li>
<li><a class="reference internal" href="#sql">SQL 编译缓存</a><ul>
<li><a class="reference internal" href="#id17">配置</a></li>
<li><a class="reference internal" href="#sql-caching-logging">使用日志记录估计缓存性能</a></li>
<li><a class="reference internal" href="#id19">缓存使用了多少内存？</a></li>
<li><a class="reference internal" href="#engine-compiled-cache">禁用或使用其他字典缓存一些（或全部）语句</a></li>
<li><a class="reference internal" href="#engine-thirdparty-caching">第三方方言的缓存</a><ul>
<li><a class="reference internal" href="#limit-offset">示例：使用后编译参数呈现LIMIT / OFFSET</a></li>
</ul>
</li>
<li><a class="reference internal" href="#lambda">使用Lambda在语句生成中添加显着的速度增益</a><ul>
<li><a class="reference internal" href="#id32">简要指南对于Lambda</a></li>
<li><a class="reference internal" href="#id33">缓存密钥生成</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id34">当前支持</a></li>
<li><a class="reference internal" href="#id36">禁用功能</a></li>
<li><a class="reference internal" href="#id37">批操作模式</a></li>
<li><a class="reference internal" href="#returning">将RETURNING行与参数集相关联</a></li>
<li><a class="reference internal" href="#engine-insertmanyvalues-non-batch">非批次模式操作</a></li>
<li><a class="reference internal" href="#id40">语句执行模型</a></li>
<li><a class="reference internal" href="#engine-insertmanyvalues-page-size">控制批量大小</a></li>
<li><a class="reference internal" href="#engine-insertmanyvalues-events">日志和事件</a></li>
<li><a class="reference internal" href="#upsert-support">Upsert Support</a></li>
</ul>
</li>
<li><a class="reference internal" href="#engine-disposal">引擎处理</a></li>
<li><a class="reference internal" href="#driver-sql-raw-dbapi-connections">使用Driver SQL和 Raw DBAPI Connections 工作</a><ul>
<li><a class="reference internal" href="#id46">直接向驱动程序调用SQL字符串</a></li>
<li><a class="reference internal" href="#dbapi-connections-cursor">直接与DBAPI游标交互</a></li>
<li><a class="reference internal" href="#stored-procedures">调用存储过程和用户定义函数</a></li>
<li><a class="reference internal" href="#id51">多个结果集</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id52">注册新方言</a><ul>
<li><a class="reference internal" href="#id53">在进程中注册方言</a></li>
</ul>
</li>
<li><a class="reference internal" href="#api">连接/引擎API</a><ul>
<li><a class="reference internal" href="#sqlalchemy.engine.Connection"><code class="docutils literal notranslate"><span class="pre">Connection</span></code></a><ul>
<li><a class="reference internal" href="#sqlalchemy.engine.Connection.__init__"><code class="docutils literal notranslate"><span class="pre">Connection.__init__()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.Connection.begin"><code class="docutils literal notranslate"><span class="pre">Connection.begin()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.Connection.begin_nested"><code class="docutils literal notranslate"><span class="pre">Connection.begin_nested()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.Connection.begin_twophase"><code class="docutils literal notranslate"><span class="pre">Connection.begin_twophase()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.Connection.close"><code class="docutils literal notranslate"><span class="pre">Connection.close()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.Connection.closed"><code class="docutils literal notranslate"><span class="pre">Connection.closed</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.Connection.commit"><code class="docutils literal notranslate"><span class="pre">Connection.commit()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.Connection.connection"><code class="docutils literal notranslate"><span class="pre">Connection.connection</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.Connection.default_isolation_level"><code class="docutils literal notranslate"><span class="pre">Connection.default_isolation_level</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.Connection.detach"><code class="docutils literal notranslate"><span class="pre">Connection.detach()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.Connection.exec_driver_sql"><code class="docutils literal notranslate"><span class="pre">Connection.exec_driver_sql()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.Connection.execute"><code class="docutils literal notranslate"><span class="pre">Connection.execute()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.Connection.execution_options"><code class="docutils literal notranslate"><span class="pre">Connection.execution_options()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.Connection.get_execution_options"><code class="docutils literal notranslate"><span class="pre">Connection.get_execution_options()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.Connection.get_isolation_level"><code class="docutils literal notranslate"><span class="pre">Connection.get_isolation_level()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.Connection.get_nested_transaction"><code class="docutils literal notranslate"><span class="pre">Connection.get_nested_transaction()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.Connection.get_transaction"><code class="docutils literal notranslate"><span class="pre">Connection.get_transaction()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.Connection.in_nested_transaction"><code class="docutils literal notranslate"><span class="pre">Connection.in_nested_transaction()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.Connection.in_transaction"><code class="docutils literal notranslate"><span class="pre">Connection.in_transaction()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.Connection.info"><code class="docutils literal notranslate"><span class="pre">Connection.info</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.Connection.invalidate"><code class="docutils literal notranslate"><span class="pre">Connection.invalidate()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.Connection.invalidated"><code class="docutils literal notranslate"><span class="pre">Connection.invalidated</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.Connection.rollback"><code class="docutils literal notranslate"><span class="pre">Connection.rollback()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.Connection.scalar"><code class="docutils literal notranslate"><span class="pre">Connection.scalar()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.Connection.scalars"><code class="docutils literal notranslate"><span class="pre">Connection.scalars()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.Connection.schema_for_object"><code class="docutils literal notranslate"><span class="pre">Connection.schema_for_object()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#sqlalchemy.engine.CreateEnginePlugin"><code class="docutils literal notranslate"><span class="pre">CreateEnginePlugin</span></code></a><ul>
<li><a class="reference internal" href="#sqlalchemy.engine.CreateEnginePlugin.__init__"><code class="docutils literal notranslate"><span class="pre">CreateEnginePlugin.__init__()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.CreateEnginePlugin.engine_created"><code class="docutils literal notranslate"><span class="pre">CreateEnginePlugin.engine_created()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.CreateEnginePlugin.handle_dialect_kwargs"><code class="docutils literal notranslate"><span class="pre">CreateEnginePlugin.handle_dialect_kwargs()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.CreateEnginePlugin.handle_pool_kwargs"><code class="docutils literal notranslate"><span class="pre">CreateEnginePlugin.handle_pool_kwargs()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.CreateEnginePlugin.update_url"><code class="docutils literal notranslate"><span class="pre">CreateEnginePlugin.update_url()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#sqlalchemy.engine.Engine"><code class="docutils literal notranslate"><span class="pre">Engine</span></code></a><ul>
<li><a class="reference internal" href="#sqlalchemy.engine.Engine.begin"><code class="docutils literal notranslate"><span class="pre">Engine.begin()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.Engine.clear_compiled_cache"><code class="docutils literal notranslate"><span class="pre">Engine.clear_compiled_cache()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.Engine.connect"><code class="docutils literal notranslate"><span class="pre">Engine.connect()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.Engine.dispose"><code class="docutils literal notranslate"><span class="pre">Engine.dispose()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.Engine.driver"><code class="docutils literal notranslate"><span class="pre">Engine.driver</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.Engine.engine"><code class="docutils literal notranslate"><span class="pre">Engine.engine</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.Engine.execution_options"><code class="docutils literal notranslate"><span class="pre">Engine.execution_options()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.Engine.get_execution_options"><code class="docutils literal notranslate"><span class="pre">Engine.get_execution_options()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.Engine.name"><code class="docutils literal notranslate"><span class="pre">Engine.name</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.Engine.raw_connection"><code class="docutils literal notranslate"><span class="pre">Engine.raw_connection()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.Engine.update_execution_options"><code class="docutils literal notranslate"><span class="pre">Engine.update_execution_options()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#sqlalchemy.engine.ExceptionContext"><code class="docutils literal notranslate"><span class="pre">ExceptionContext</span></code></a><ul>
<li><a class="reference internal" href="#sqlalchemy.engine.ExceptionContext.chained_exception"><code class="docutils literal notranslate"><span class="pre">ExceptionContext.chained_exception</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.ExceptionContext.connection"><code class="docutils literal notranslate"><span class="pre">ExceptionContext.connection</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.ExceptionContext.cursor"><code class="docutils literal notranslate"><span class="pre">ExceptionContext.cursor</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.ExceptionContext.dialect"><code class="docutils literal notranslate"><span class="pre">ExceptionContext.dialect</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.ExceptionContext.engine"><code class="docutils literal notranslate"><span class="pre">ExceptionContext.engine</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.ExceptionContext.execution_context"><code class="docutils literal notranslate"><span class="pre">ExceptionContext.execution_context</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.ExceptionContext.invalidate_pool_on_disconnect"><code class="docutils literal notranslate"><span class="pre">ExceptionContext.invalidate_pool_on_disconnect</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.ExceptionContext.is_disconnect"><code class="docutils literal notranslate"><span class="pre">ExceptionContext.is_disconnect</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.ExceptionContext.is_pre_ping"><code class="docutils literal notranslate"><span class="pre">ExceptionContext.is_pre_ping</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.ExceptionContext.original_exception"><code class="docutils literal notranslate"><span class="pre">ExceptionContext.original_exception</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.ExceptionContext.parameters"><code class="docutils literal notranslate"><span class="pre">ExceptionContext.parameters</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.ExceptionContext.sqlalchemy_exception"><code class="docutils literal notranslate"><span class="pre">ExceptionContext.sqlalchemy_exception</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.ExceptionContext.statement"><code class="docutils literal notranslate"><span class="pre">ExceptionContext.statement</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#sqlalchemy.engine.NestedTransaction"><code class="docutils literal notranslate"><span class="pre">NestedTransaction</span></code></a><ul>
<li><a class="reference internal" href="#sqlalchemy.engine.NestedTransaction.close"><code class="docutils literal notranslate"><span class="pre">NestedTransaction.close()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.NestedTransaction.commit"><code class="docutils literal notranslate"><span class="pre">NestedTransaction.commit()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.NestedTransaction.rollback"><code class="docutils literal notranslate"><span class="pre">NestedTransaction.rollback()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#sqlalchemy.engine.RootTransaction"><code class="docutils literal notranslate"><span class="pre">RootTransaction</span></code></a><ul>
<li><a class="reference internal" href="#sqlalchemy.engine.RootTransaction.close"><code class="docutils literal notranslate"><span class="pre">RootTransaction.close()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.RootTransaction.commit"><code class="docutils literal notranslate"><span class="pre">RootTransaction.commit()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.RootTransaction.rollback"><code class="docutils literal notranslate"><span class="pre">RootTransaction.rollback()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#sqlalchemy.engine.Transaction"><code class="docutils literal notranslate"><span class="pre">Transaction</span></code></a><ul>
<li><a class="reference internal" href="#sqlalchemy.engine.Transaction.close"><code class="docutils literal notranslate"><span class="pre">Transaction.close()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.Transaction.commit"><code class="docutils literal notranslate"><span class="pre">Transaction.commit()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.Transaction.rollback"><code class="docutils literal notranslate"><span class="pre">Transaction.rollback()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#sqlalchemy.engine.TwoPhaseTransaction"><code class="docutils literal notranslate"><span class="pre">TwoPhaseTransaction</span></code></a><ul>
<li><a class="reference internal" href="#sqlalchemy.engine.TwoPhaseTransaction.close"><code class="docutils literal notranslate"><span class="pre">TwoPhaseTransaction.close()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.TwoPhaseTransaction.commit"><code class="docutils literal notranslate"><span class="pre">TwoPhaseTransaction.commit()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.TwoPhaseTransaction.prepare"><code class="docutils literal notranslate"><span class="pre">TwoPhaseTransaction.prepare()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.TwoPhaseTransaction.rollback"><code class="docutils literal notranslate"><span class="pre">TwoPhaseTransaction.rollback()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#id54">结果集API</a><ul>
<li><a class="reference internal" href="#sqlalchemy.engine.ChunkedIteratorResult"><code class="docutils literal notranslate"><span class="pre">ChunkedIteratorResult</span></code></a><ul>
<li><a class="reference internal" href="#sqlalchemy.engine.ChunkedIteratorResult.yield_per"><code class="docutils literal notranslate"><span class="pre">ChunkedIteratorResult.yield_per()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#sqlalchemy.engine.CursorResult"><code class="docutils literal notranslate"><span class="pre">CursorResult</span></code></a><ul>
<li><a class="reference internal" href="#sqlalchemy.engine.CursorResult.all"><code class="docutils literal notranslate"><span class="pre">CursorResult.all()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.CursorResult.close"><code class="docutils literal notranslate"><span class="pre">CursorResult.close()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.CursorResult.columns"><code class="docutils literal notranslate"><span class="pre">CursorResult.columns()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.CursorResult.fetchall"><code class="docutils literal notranslate"><span class="pre">CursorResult.fetchall()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.CursorResult.fetchmany"><code class="docutils literal notranslate"><span class="pre">CursorResult.fetchmany()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.CursorResult.fetchone"><code class="docutils literal notranslate"><span class="pre">CursorResult.fetchone()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.CursorResult.first"><code class="docutils literal notranslate"><span class="pre">CursorResult.first()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.CursorResult.freeze"><code class="docutils literal notranslate"><span class="pre">CursorResult.freeze()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.CursorResult.inserted_primary_key"><code class="docutils literal notranslate"><span class="pre">CursorResult.inserted_primary_key</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.CursorResult.inserted_primary_key_rows"><code class="docutils literal notranslate"><span class="pre">CursorResult.inserted_primary_key_rows</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.CursorResult.is_insert"><code class="docutils literal notranslate"><span class="pre">CursorResult.is_insert</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.CursorResult.keys"><code class="docutils literal notranslate"><span class="pre">CursorResult.keys()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.CursorResult.last_inserted_params"><code class="docutils literal notranslate"><span class="pre">CursorResult.last_inserted_params()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.CursorResult.last_updated_params"><code class="docutils literal notranslate"><span class="pre">CursorResult.last_updated_params()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.CursorResult.lastrow_has_defaults"><code class="docutils literal notranslate"><span class="pre">CursorResult.lastrow_has_defaults()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.CursorResult.lastrowid"><code class="docutils literal notranslate"><span class="pre">CursorResult.lastrowid</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.CursorResult.mappings"><code class="docutils literal notranslate"><span class="pre">CursorResult.mappings()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.CursorResult.merge"><code class="docutils literal notranslate"><span class="pre">CursorResult.merge()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.CursorResult.one"><code class="docutils literal notranslate"><span class="pre">CursorResult.one()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.CursorResult.one_or_none"><code class="docutils literal notranslate"><span class="pre">CursorResult.one_or_none()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.CursorResult.partitions"><code class="docutils literal notranslate"><span class="pre">CursorResult.partitions()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.CursorResult.postfetch_cols"><code class="docutils literal notranslate"><span class="pre">CursorResult.postfetch_cols()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.CursorResult.prefetch_cols"><code class="docutils literal notranslate"><span class="pre">CursorResult.prefetch_cols()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.CursorResult.returned_defaults"><code class="docutils literal notranslate"><span class="pre">CursorResult.returned_defaults</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.CursorResult.returned_defaults_rows"><code class="docutils literal notranslate"><span class="pre">CursorResult.returned_defaults_rows</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.CursorResult.returns_rows"><code class="docutils literal notranslate"><span class="pre">CursorResult.returns_rows</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.CursorResult.rowcount"><code class="docutils literal notranslate"><span class="pre">CursorResult.rowcount</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.CursorResult.scalar"><code class="docutils literal notranslate"><span class="pre">CursorResult.scalar()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.CursorResult.scalar_one"><code class="docutils literal notranslate"><span class="pre">CursorResult.scalar_one()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.CursorResult.scalar_one_or_none"><code class="docutils literal notranslate"><span class="pre">CursorResult.scalar_one_or_none()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.CursorResult.scalars"><code class="docutils literal notranslate"><span class="pre">CursorResult.scalars()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.CursorResult.splice_horizontally"><code class="docutils literal notranslate"><span class="pre">CursorResult.splice_horizontally()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.CursorResult.splice_vertically"><code class="docutils literal notranslate"><span class="pre">CursorResult.splice_vertically()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.CursorResult.supports_sane_multi_rowcount"><code class="docutils literal notranslate"><span class="pre">CursorResult.supports_sane_multi_rowcount()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.CursorResult.supports_sane_rowcount"><code class="docutils literal notranslate"><span class="pre">CursorResult.supports_sane_rowcount()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.CursorResult.t"><code class="docutils literal notranslate"><span class="pre">CursorResult.t</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.CursorResult.tuples"><code class="docutils literal notranslate"><span class="pre">CursorResult.tuples()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.CursorResult.unique"><code class="docutils literal notranslate"><span class="pre">CursorResult.unique()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.CursorResult.yield_per"><code class="docutils literal notranslate"><span class="pre">CursorResult.yield_per()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#sqlalchemy.engine.FilterResult"><code class="docutils literal notranslate"><span class="pre">FilterResult</span></code></a><ul>
<li><a class="reference internal" href="#sqlalchemy.engine.FilterResult.close"><code class="docutils literal notranslate"><span class="pre">FilterResult.close()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.FilterResult.closed"><code class="docutils literal notranslate"><span class="pre">FilterResult.closed</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.FilterResult.yield_per"><code class="docutils literal notranslate"><span class="pre">FilterResult.yield_per()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#sqlalchemy.engine.FrozenResult"><code class="docutils literal notranslate"><span class="pre">FrozenResult</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.IteratorResult"><code class="docutils literal notranslate"><span class="pre">IteratorResult</span></code></a><ul>
<li><a class="reference internal" href="#sqlalchemy.engine.IteratorResult.closed"><code class="docutils literal notranslate"><span class="pre">IteratorResult.closed</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#sqlalchemy.engine.MergedResult"><code class="docutils literal notranslate"><span class="pre">MergedResult</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.Result"><code class="docutils literal notranslate"><span class="pre">Result</span></code></a><ul>
<li><a class="reference internal" href="#sqlalchemy.engine.Result.all"><code class="docutils literal notranslate"><span class="pre">Result.all()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.Result.close"><code class="docutils literal notranslate"><span class="pre">Result.close()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.Result.closed"><code class="docutils literal notranslate"><span class="pre">Result.closed</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.Result.columns"><code class="docutils literal notranslate"><span class="pre">Result.columns()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.Result.fetchall"><code class="docutils literal notranslate"><span class="pre">Result.fetchall()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.Result.fetchmany"><code class="docutils literal notranslate"><span class="pre">Result.fetchmany()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.Result.fetchone"><code class="docutils literal notranslate"><span class="pre">Result.fetchone()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.Result.first"><code class="docutils literal notranslate"><span class="pre">Result.first()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.Result.freeze"><code class="docutils literal notranslate"><span class="pre">Result.freeze()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.Result.keys"><code class="docutils literal notranslate"><span class="pre">Result.keys()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.Result.mappings"><code class="docutils literal notranslate"><span class="pre">Result.mappings()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.Result.merge"><code class="docutils literal notranslate"><span class="pre">Result.merge()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.Result.one"><code class="docutils literal notranslate"><span class="pre">Result.one()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.Result.one_or_none"><code class="docutils literal notranslate"><span class="pre">Result.one_or_none()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.Result.partitions"><code class="docutils literal notranslate"><span class="pre">Result.partitions()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.Result.scalar"><code class="docutils literal notranslate"><span class="pre">Result.scalar()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.Result.scalar_one"><code class="docutils literal notranslate"><span class="pre">Result.scalar_one()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.Result.scalar_one_or_none"><code class="docutils literal notranslate"><span class="pre">Result.scalar_one_or_none()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.Result.scalars"><code class="docutils literal notranslate"><span class="pre">Result.scalars()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.Result.t"><code class="docutils literal notranslate"><span class="pre">Result.t</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.Result.tuples"><code class="docutils literal notranslate"><span class="pre">Result.tuples()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.Result.unique"><code class="docutils literal notranslate"><span class="pre">Result.unique()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.Result.yield_per"><code class="docutils literal notranslate"><span class="pre">Result.yield_per()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#sqlalchemy.engine.ScalarResult"><code class="docutils literal notranslate"><span class="pre">ScalarResult</span></code></a><ul>
<li><a class="reference internal" href="#sqlalchemy.engine.ScalarResult.all"><code class="docutils literal notranslate"><span class="pre">ScalarResult.all()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.ScalarResult.close"><code class="docutils literal notranslate"><span class="pre">ScalarResult.close()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.ScalarResult.closed"><code class="docutils literal notranslate"><span class="pre">ScalarResult.closed</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.ScalarResult.fetchall"><code class="docutils literal notranslate"><span class="pre">ScalarResult.fetchall()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.ScalarResult.fetchmany"><code class="docutils literal notranslate"><span class="pre">ScalarResult.fetchmany()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.ScalarResult.first"><code class="docutils literal notranslate"><span class="pre">ScalarResult.first()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.ScalarResult.one"><code class="docutils literal notranslate"><span class="pre">ScalarResult.one()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.ScalarResult.one_or_none"><code class="docutils literal notranslate"><span class="pre">ScalarResult.one_or_none()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.ScalarResult.partitions"><code class="docutils literal notranslate"><span class="pre">ScalarResult.partitions()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.ScalarResult.unique"><code class="docutils literal notranslate"><span class="pre">ScalarResult.unique()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.ScalarResult.yield_per"><code class="docutils literal notranslate"><span class="pre">ScalarResult.yield_per()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#sqlalchemy.engine.MappingResult"><code class="docutils literal notranslate"><span class="pre">MappingResult</span></code></a><ul>
<li><a class="reference internal" href="#sqlalchemy.engine.MappingResult.all"><code class="docutils literal notranslate"><span class="pre">MappingResult.all()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.MappingResult.close"><code class="docutils literal notranslate"><span class="pre">MappingResult.close()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.MappingResult.closed"><code class="docutils literal notranslate"><span class="pre">MappingResult.closed</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.MappingResult.columns"><code class="docutils literal notranslate"><span class="pre">MappingResult.columns()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.MappingResult.fetchall"><code class="docutils literal notranslate"><span class="pre">MappingResult.fetchall()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.MappingResult.fetchmany"><code class="docutils literal notranslate"><span class="pre">MappingResult.fetchmany()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.MappingResult.fetchone"><code class="docutils literal notranslate"><span class="pre">MappingResult.fetchone()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.MappingResult.first"><code class="docutils literal notranslate"><span class="pre">MappingResult.first()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.MappingResult.keys"><code class="docutils literal notranslate"><span class="pre">MappingResult.keys()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.MappingResult.one"><code class="docutils literal notranslate"><span class="pre">MappingResult.one()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.MappingResult.one_or_none"><code class="docutils literal notranslate"><span class="pre">MappingResult.one_or_none()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.MappingResult.partitions"><code class="docutils literal notranslate"><span class="pre">MappingResult.partitions()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.MappingResult.unique"><code class="docutils literal notranslate"><span class="pre">MappingResult.unique()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.MappingResult.yield_per"><code class="docutils literal notranslate"><span class="pre">MappingResult.yield_per()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#sqlalchemy.engine.Row"><code class="docutils literal notranslate"><span class="pre">Row</span></code></a><ul>
<li><a class="reference internal" href="#sqlalchemy.engine.Row._asdict"><code class="docutils literal notranslate"><span class="pre">Row._asdict()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.Row._fields"><code class="docutils literal notranslate"><span class="pre">Row._fields</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.Row._mapping"><code class="docutils literal notranslate"><span class="pre">Row._mapping</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.Row._t"><code class="docutils literal notranslate"><span class="pre">Row._t</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.Row._tuple"><code class="docutils literal notranslate"><span class="pre">Row._tuple()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.Row.count"><code class="docutils literal notranslate"><span class="pre">Row.count</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.Row.index"><code class="docutils literal notranslate"><span class="pre">Row.index</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.Row.t"><code class="docutils literal notranslate"><span class="pre">Row.t</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.Row.tuple"><code class="docutils literal notranslate"><span class="pre">Row.tuple()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#sqlalchemy.engine.RowMapping"><code class="docutils literal notranslate"><span class="pre">RowMapping</span></code></a><ul>
<li><a class="reference internal" href="#sqlalchemy.engine.RowMapping.items"><code class="docutils literal notranslate"><span class="pre">RowMapping.items()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.RowMapping.keys"><code class="docutils literal notranslate"><span class="pre">RowMapping.keys()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.engine.RowMapping.values"><code class="docutils literal notranslate"><span class="pre">RowMapping.values()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#sqlalchemy.engine.TupleResult"><code class="docutils literal notranslate"><span class="pre">TupleResult</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>


            </ul>

        </div>



    <div id="docs-body" role="main" class="withsidebar core-connections" >
        
<section id="module-sqlalchemy.engine">
<span id="engine-connections"></span><span id="connections-toplevel"></span><h1>使用 Engine 和 Connections<a class="headerlink" href="#module-sqlalchemy.engine" title="Permalink to this heading">¶</a></h1>
<p>本节详细介绍   <a class="reference internal" href="#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a> ， :class:` _engine.Connection`和相关对象的直接使用。需要注意的是，
在使用SQLAlchemy ORM时，通常不会直接访问这些对象；相反，通常使用   <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code>  对象作为与数据库交互的接口。
然而，对于那些围绕着直接使用文本SQL语句和/或SQL表达式构造物而建立的应用程序，在没有ORM的高级管理服务的情况下，</p>
<blockquote>
<div><p><a class="reference internal" href="#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a>  才是王（和女王？）——继续阅读。</p>
</div></blockquote>
<section id="id1">
<h2>基本用法<a class="headerlink" href="#id1" title="Permalink to this heading">¶</a></h2>
<p>回想一下 第  <a class="reference internal" href="engines.html"><span class="doc">引擎配置</span></a>  调用创建   :class:` _engine.Engine`  对象：</p>
<blockquote>
<div><p>engine = create_engine(“mysql+mysqldb://scott:tiger&#64;localhost/test”)</p>
</div></blockquote>
<dl class="simple">
<dt>通常使用   <code class="xref py py-func docutils literal notranslate"><span class="pre">create_engine()</span></code>  一次创建一个特定的数据库URL，并保存为单个应用程序进程生命周期的全局变量。单个</dt><dd><p><a class="reference internal" href="#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a>  管理代表进程的许多单独的  :term:` DBAPI`  连接，旨在以并发方式调用。   <a class="reference internal" href="#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a></p>
</dd>
</dl>
<p><a href="#id2"><span class="problematic" id="id3">**</span></a>不**等同于 DBAPI 的 <code class="docutils literal notranslate"><span class="pre">connect()</span></code> 函数，后者只表示一个连接资源 - 只创建一个   <a class="reference internal" href="#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a>  对象
才是最有效的，而不是每个对象或每个函数调用。</p>
<aside class="sidebar">
<p class="sidebar-title">贴士</p>
<blockquote>
<div><p>在使用包含内容多个Python进程的   <a class="reference internal" href="#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a> （例如使用“os.fork”或Python ` <cite>multiprocessing`</cite>）时，
重要的是要为每个进程初始化引擎。有关详情，请参阅   <span class="xref std std-ref">pooling_multiprocessing</span> 。</p>
</div></blockquote>
<p><a class="reference internal" href="#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a>  最基本的功能是提供对   :class:` _engine.Connection`  的访问，然后可以调用 SQL 语句。如何发出对</p>
</aside>
<p>数据库的文本语句看起来像这样:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">text</span>

<span class="k">with</span> <span class="n">engine</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">text</span><span class="p">(</span><span class="s2">&quot;select username from users&quot;</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
        <span class="n">print</span><span class="p">(</span><span class="s2">&quot;username:&quot;</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">username</span><span class="p">)</span></pre></div>
</div>
<p>上面的  <a class="reference internal" href="#sqlalchemy.engine.Engine.connect" title="sqlalchemy.engine.Engine.connect"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Engine.connect()</span></code></a>  方法返回一个   :class:` _engine.Connection`  对象，并通过在 Python 上下文管理器中
（例如 <code class="docutils literal notranslate"><span class="pre">with:</span></code> 语句）使用它，  <a class="reference internal" href="#sqlalchemy.engine.Connection.close" title="sqlalchemy.engine.Connection.close"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.close()</span></code></a>  方法 在块结束时自动调用。   :class:` _engine.Connection`
是实际 DBAPI 连接的**代理**对象。 DBAPI 连接从连接池中检索到在创建   <a class="reference internal" href="#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a>  时。</p>
<p>返回的对象称为   <a class="reference internal" href="#sqlalchemy.engine.CursorResult" title="sqlalchemy.engine.CursorResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">CursorResult</span></code></a> ，引用了 DBAPI 游标，并提供类似于 DBAPI 游标的方法来检索行。当所有
结果行（如果有）都用完时，DBAPI 游标将被   <a class="reference internal" href="#sqlalchemy.engine.CursorResult" title="sqlalchemy.engine.CursorResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">CursorResult</span></code></a>  关闭。   :class:` _engine.CursorResult`  对象
不返回任何行，例如 UPDATE 语句（没有返回任何行），则这些游标资源在构建时立即释放。</p>
<p>在 <code class="docutils literal notranslate"><span class="pre">with:</span></code> block 结束时，将关闭   <a class="reference internal" href="#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a> ，引用的 DBAPI 连接将 :term:` 释放`到连接池中。从数据库
的角度来看，假设池有空间将此连接存储以供下次使用，则连接池实际上不会“关闭”连接。当将连接返回池以供重新使用时，
连接池机制会在 DBAPI 连接上发出 <code class="docutils literal notranslate"><span class="pre">rollback()</span></code> 调用，以便删除任何事务状态或锁（这被称为   <a class="reference internal" href="pooling.html#pool-reset-on-return"><span class="std std-ref">返回后重置表单</span></a> )，
并准备好进行下一次使用。</p>
<p>我们上面的示例说明了如何执行文本 SQL 字符串，发出此类语句应使用   <a class="reference internal" href="sqlelement.html#sqlalchemy.sql.expression.text" title="sqlalchemy.sql.expression.text"><code class="xref py py-func docutils literal notranslate"><span class="pre">text()</span></code></a>  构造对象，以表明我们希望
使用文本 SQL。当然，  <a class="reference internal" href="#sqlalchemy.engine.Connection.execute" title="sqlalchemy.engine.Connection.execute"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.execute()</span></code></a>  方法可以容纳更多内容；有关教程，请参见   :ref:` tutorial_working_with_data` 。</p>
</section>
<section id="id4">
<h2>使用事务<a class="headerlink" href="#id4" title="Permalink to this heading">¶</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>本节描述了在直接使用   <a class="reference internal" href="#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a>  和   :class:` _engine.Connection`  对象时如何使用事务控制的公共 API。在使用
SQLAlchemy ORM 时，事务控制的公共 API 是通过   <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code>  对象实现的，该对象在内部使用   :class:` .Transaction`  对象。有关
更多信息，请参见   <a class="reference internal" href="../orm/session_transaction.html#unitofwork-transaction"><span class="std std-ref">管理事务</span></a> 。</p>
</div>
<section id="id5">
<h3>按需提交<a class="headerlink" href="#id5" title="Permalink to this heading">¶</a></h3>
<blockquote>
<div><p><a class="reference internal" href="#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a></p>
</div></blockquote>
<p>方法以执行 SQL 语句时，此事务会自动启动，并使用称为 <strong>autobegin</strong> 的行为。事务在   <a class="reference internal" href="#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a>  对象范围内保持不变，直
到调用  <a class="reference internal" href="#sqlalchemy.engine.Connection.commit" title="sqlalchemy.engine.Connection.commit"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.commit()</span></code></a>  或  :meth:` _engine.Connection.rollback`  方法。在结束事务后，   <a class="reference internal" href="#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a>  对象等待
调用  <a class="reference internal" href="#sqlalchemy.engine.Connection.execute" title="sqlalchemy.engine.Connection.execute"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.execute()</span></code></a>  方法，此时它将再次自动开始。</p>
<p>此调用样式称为 <strong>按需提交</strong>，下面的示例说明了此样式</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">engine</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
    <span class="n">connection</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">some_table</span><span class="o">.</span><span class="n">insert</span><span class="p">(),</span> <span class="p">{</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="s2">&quot;this is some data&quot;</span><span class="p">})</span>
    <span class="n">connection</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
        <span class="n">some_other_table</span><span class="o">.</span><span class="n">insert</span><span class="p">(),</span> <span class="p">{</span><span class="s2">&quot;q&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span> <span class="s2">&quot;p&quot;</span><span class="p">:</span> <span class="s2">&quot;this is some more data&quot;</span><span class="p">}</span>
    <span class="p">)</span>

    <span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>  <span class="c1"># 提交事务</span></pre></div>
</div>
<aside class="topic">
<p class="topic-title">Python DBAPI 就是发生了 autopbegin</p>
<p>“按需提交”的设计目的是与  <span class="xref std std-term">DBAPI</span>  的设计相辅相成，后者是 SQLAlchemy 与之交互的底层数据库接口。在 DBAPI 中，
<code class="docutils literal notranslate"><span class="pre">connection</span></code> 对象不假设更改数据库将自动提交，而是要求在默认情况下调用 <code class="docutils literal notranslate"><span class="pre">connection.commit()</span></code> 方法以便提交更改到数据库。
CN: DBAPI 的 <code class="docutils literal notranslate"><span class="pre">connection</span></code> 对象不假设更改数据库将自动提交，而是要求在默认情况下调用 <code class="docutils literal notranslate"><span class="pre">connection.commit()</span></code> 方法以便将更改提交到数据库，从而实现提交。
必须注意的是，DBAPI 本身**根本没有begin()方法**。 所有Python DBAPI都实现了“autobegin”作为管理事务的基本方法，并在发出类似BEGIN 的语句时处理，
当首次发出SQL语句时。 SQLAlchemy的API实际上是用更高级的Python对象重新陈述这种行为。</p>
</aside>
<dl>
<dt>在“按需提交”的样式中，我们可以在  <a class="reference internal" href="#sqlalchemy.engine.Connection.execute" title="sqlalchemy.engine.Connection.execute"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.execute()</span></code></a>  的一系列其他语句中自由调用  :meth:` _engine.Connection.commit`  和</dt><dd><p><a class="reference internal" href="#sqlalchemy.engine.Connection.rollback" title="sqlalchemy.engine.Connection.rollback"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.rollback()</span></code></a>   方法；每次事务结束并发出新语句时，都会隐式地开始一个新事务。</p>
<blockquote>
<div><dl>
<dt>with engine.connect() as connection:</dt><dd><p>connection.execute(“&lt;some statement&gt;”)
connection.commit()  # 提交“some statement”</p>
<p># 新的事务开始
connection.execute(“&lt;some other statement&gt;”)
connection.rollback()  # 回退“some other statement”</p>
<p># 新的事务开始
connection.execute(“&lt;a third statement&gt;”)
connection.commit()  # 提交“a third statement”</p>
</dd>
</dl>
</div></blockquote>
</dd>
</dl>
<div class="versionadded">
<p><span class="versionmodified added">New in version 2.0: </span>“按需提交”样式是 SQLAlchemy 2.0的新功能。也可在使用“未来”样式引擎时
（通过SQLAlchemy 1.4的“过渡”模式）使用它。</p>
</div>
<p>一旦提交，数据就不能再被回退。如果需要撤销部分提交，必须再次提交撤销 SQL 语句以及处理完成任务的 SQL 语句。</p>
</section>
<section id="id6">
<h3>一次开始<a class="headerlink" href="#id6" title="Permalink to this heading">¶</a></h3>
<blockquote>
<div><p><a class="reference internal" href="#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a>  对象提供了更明确的事务管理样式，称为 <strong>一次开始</strong>。与“按需提交”不同，</p>
</div></blockquote>
<p>“一次开始”允许显式说明事务的开始点，并且允许将事务本身框架为上下文管理器块，以便事务结束变得隐式。使用“一次开始”时，
使用  <a class="reference internal" href="#sqlalchemy.engine.Connection.begin" title="sqlalchemy.engine.Connection.begin"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.begin()</span></code></a>  方法，它返回一个代表 DBAPI 事务的   :class:` .Transaction`  对象。此对象还支持通过</p>
<blockquote>
<div><p><a class="reference internal" href="#sqlalchemy.engine.Transaction.commit" title="sqlalchemy.engine.Transaction.commit"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Transaction.commit()</span></code></a>   和  :meth:` _engine.Transaction.rollback`  方法进行显式管理，但作为一种首选的惯例，它还支持上下文管理器接口，</p>
</div></blockquote>
<p>在块结束时，它将正常自动提交并在引发异常时发送回滚以将异常传播出去。以下说明了“一次开始”块的形式：</p>
<blockquote>
<div><dl>
<dt>with engine.connect() as connection:</dt><dd><dl>
<dt>with connection.begin():</dt><dd><p>connection.execute(some_table.insert(), {“x”: 7, “y”: “this is some data”})
connection.execute(</p>
<blockquote>
<div><p>some_other_table.insert(), {“q”: 8, “p”: “this is some more data”}</p>
</div></blockquote>
<p>)</p>
</dd>
</dl>
<p># 事务已提交</p>
</dd>
</dl>
</div></blockquote>
</section>
<section id="engine">
<h3>连接和一次开始从 Engine 中开始<a class="headerlink" href="#engine" title="Permalink to this heading">¶</a></h3>
<p>一个便捷的简写形式是在发起调用时对  <a class="reference internal" href="#sqlalchemy.engine.Engine.begin" title="sqlalchemy.engine.Engine.begin"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Engine.begin()</span></code></a>  进行调用，而不是执行两个单独的步骤  :meth:` _engine.Engine.connect`
和  <a class="reference internal" href="#sqlalchemy.engine.Connection.begin" title="sqlalchemy.engine.Connection.begin"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.begin()</span></code></a>  ；:meth:` _engine.Engine.begin
` 方法返回一个特殊上下文管理器，内部维护了   <a class="reference internal" href="#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a>  的上下文管理器和正常情况下由</p>
<blockquote>
<div><p><a class="reference internal" href="#sqlalchemy.engine.Connection.begin" title="sqlalchemy.engine.Connection.begin"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.begin()</span></code></a>   方法返回的-context manager class:` _engine.Transaction` 的上下文管理器:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">engine</span><span class="o">.</span><span class="n">begin</span><span class="p">()</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
    <span class="n">connection</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">some_table</span><span class="o">.</span><span class="n">insert</span><span class="p">(),</span> <span class="p">{</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="s2">&quot;this is some data&quot;</span><span class="p">})</span>
    <span class="n">connection</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
        <span class="n">some_other_table</span><span class="o">.</span><span class="n">insert</span><span class="p">(),</span> <span class="p">{</span><span class="s2">&quot;q&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span> <span class="s2">&quot;p&quot;</span><span class="p">:</span> <span class="s2">&quot;this is some more data&quot;</span><span class="p">}</span>
    <span class="p">)</span>

<span class="c1"># 事务已提交，并且 Connection 已释放到连接池中</span></pre></div>
</div>
</div></blockquote>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<blockquote>
<div><dl class="simple">
<dt>在  <a class="reference internal" href="#sqlalchemy.engine.Engine.begin" title="sqlalchemy.engine.Engine.begin"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Engine.begin()</span></code></a>  块内，我们可以调用</dt><dd><p><a class="reference internal" href="#sqlalchemy.engine.Connection.commit" title="sqlalchemy.engine.Connection.commit"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.commit()</span></code></a>  或  :meth:` _engine.Connection.rollback`  等方法，这将在块之前正常结束事务。</p>
</dd>
</dl>
</div></blockquote>
<p>但是，如果我们这样做了，则无法在   <a class="reference internal" href="#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a>  上发出其他 SQL 操作，直到块结束:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">create_engine</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">e</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s2">&quot;sqlite://&quot;</span><span class="p">,</span> <span class="n">echo</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">e</span><span class="o">.</span><span class="n">begin</span><span class="p">()</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<span class="gp">... </span>    <span class="n">conn</span><span class="o">.</span><span class="n">begin</span><span class="p">()</span>
<span class="go">2021-11-08 09:49:07,517 INFO sqlalchemy.engine.Engine BEGIN (implicit)</span>
<span class="go">2021-11-08 09:49:07,517 INFO sqlalchemy.engine.Engine COMMIT</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="gr">sqlalchemy.exc.InvalidRequestError</span>: <span class="n">Can&#39;t operate on closed transaction inside</span>
<span class="x">context manager.  Please complete the context manager before emitting</span>
<span class="x">further commands.</span></pre></div>
</div>
</div>
</section>
<section id="id7">
<h3>样式混合<a class="headerlink" href="#id7" title="Permalink to this heading">¶</a></h3>
<p>“按需提交”和“一次开始”样式可以自由混合在单个  <a class="reference internal" href="#sqlalchemy.engine.Engine.connect" title="sqlalchemy.engine.Engine.connect"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Engine.connect()</span></code></a>  块内，只要调用  :meth:` _engine.Connection.begin`  时不会与
“autobegin”行为发生冲突即可。 为了实现这一点，只有在未发出任何 SQL 语句之前或直接在前一个调用</p>
<blockquote>
<div><p><a class="reference internal" href="#sqlalchemy.engine.Connection.commit" title="sqlalchemy.engine.Connection.commit"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.commit()</span></code></a>   或  :meth:` _engine.Connection.rollback`  之后才应调用  <a class="reference internal" href="#sqlalchemy.engine.Connection.begin" title="sqlalchemy.engine.Connection.begin"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.begin()</span></code></a> 。</p>
<blockquote>
<div><dl>
<dt>with engine.connect() as connection:</dt><dd><dl class="simple">
<dt>with connection.begin():</dt><dd><p># 在“一次开始”块中运行 SQL 语句
connection.execute(some_table.insert(), {“x”: 7, “y”: “this is some data”})</p>
</dd>
</dl>
<p># 事务已提交</p>
<p># 在不使用块的情况下运行一个新语句。连接将进行“autobegin”
connection.execute(</p>
<blockquote>
<div><p>some_other_table.insert(), {“q”: 8, “p”: “this is some more data”}</p>
</div></blockquote>
<p>)</p>
<p># 显式提交
connection.commit()</p>
<p># 可在此处使用“一次开始”块
with connection.begin():</p>
<blockquote>
<div><p># 运行更多 SQL 语句
connection.execute(…)</p>
</div></blockquote>
</dd>
</dl>
</div></blockquote>
</div></blockquote>
<p>当编写使用“一次开始”的代码时，库会在已经“自动开始”事务时引发   <a class="reference internal" href="exceptions.html#sqlalchemy.exc.InvalidRequestError" title="sqlalchemy.exc.InvalidRequestError"><code class="xref py py-class docutils literal notranslate"><span class="pre">InvalidRequestError</span></code></a>  。</p>
</section>
</section>
<section id="dbapi">
<span id="dbapi-autocommit"></span><h2>设置事务隔离级别，包括 DBAPI 自动提交<a class="headerlink" href="#dbapi" title="Permalink to this heading">¶</a></h2>
<p>大多数 DBAPI 支持可配置的事务  <span class="xref std std-term">isolation</span>  级别的概念。这些通常是四个级别“READ UNCOMMITTED”、“READ COMMITTED”、
“REPEATABLE READ”和“SERIALIZABLE”。这些通常在 DBAPI 连接开始新事务之前应用。请注意，大多数 DBAPI 还支持真正的“自动提交”，
这意味着 DBAPI 连接本身将进入非事务性自动提交模式。这通常意味着 DBAPI 发送到数据库的“BEGIN”不再自动发出，但它还可能包括其他指令。
SQLAlchemy 将“自动提交”概念视为另一种事务隔离级别；因为它是一个失去了原子性的隔离级别。</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>重要的是要注意，在下面的   <a class="reference internal" href="#dbapi-autocommit-understanding"><span class="std std-ref">理解 DBAPI 级别的自动提交隔离级别行为</span></a>  部分中，“autocommit”隔离级别就像另一个事务隔离级别
一样，对   <a class="reference internal" href="#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a>  对象的“事务性”行为没有影响，  :meth:` _engine.Connection.begin`  方法仍会调用
DBAPI <code class="docutils literal notranslate"><span class="pre">.commit()</span></code> 和 <code class="docutils literal notranslate"><span class="pre">.rollback()</span></code> 方法（在自动提交下，它们没有任何作用），对于 <code class="docutils literal notranslate"><span class="pre">.begin()</span></code> 方法，<code class="docutils literal notranslate"><span class="pre">DBAPI</span></code>
会自动进行事务性开始（这意味着 SQLAlchemy 的“begin”<a href="#id8"><span class="problematic" id="id9">**</span></a>不会更改自动提交模式）。</p>
</div>
<p>SQLAlchemy 方言应尽可能支持这些隔离级别以及自动提交。</p>
<section id="isolation-level-dbapi-autocommit">
<h3>为一个连接设置 Isolation Level 或 DBAPI Autocommit<a class="headerlink" href="#isolation-level-dbapi-autocommit" title="Permalink to this heading">¶</a></h3>
<p>可以使用  <a class="reference internal" href="#sqlalchemy.engine.Connection.execution_options" title="sqlalchemy.engine.Connection.execution_options"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.execution_options()</span></code></a>  方法为单个   :class:` _engine.Connection`
对象设置隔离级别的持续时间。该参数称为  <a class="reference internal" href="#sqlalchemy.engine.Connection.execution_options.params.isolation_level" title="sqlalchemy.engine.Connection.execution_options"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Connection.execution_options.isolation_level</span></code></a>  列表，
是字符串，通常是以下名称的子集：</p>
<blockquote>
<div><p># 可能的 Connection.execution_options(isolation_level=”&lt;value&gt;”) 的取值：</p>
<p>“AUTOCOMMIT”
“READ COMMITTED”
“READ UNCOMMITTED”
“REPEATABLE READ”
“SERIALIZABLE”</p>
</div></blockquote>
<p>不是每个 DBAPI 都支持每个值; 如果在某个后端使用了不支持的值，则会引发错误。</p>
<p>例如，要强制使用特定连接的 REPEATABLE READ，然后开始事务：</p>
<blockquote>
<div><dl class="simple">
<dt>with engine.connect().execution_options(</dt><dd><p>isolation_level=”REPEATABLE READ”</p>
</dd>
<dt>) as connection:</dt><dd><dl class="simple">
<dt>with connection.begin():</dt><dd><p>connection.execute(“&lt;statement&gt;”)</p>
</dd>
</dl>
</dd>
</dl>
</div></blockquote>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<blockquote>
<div><p><a class="reference internal" href="#sqlalchemy.engine.Connection.execution_options" title="sqlalchemy.engine.Connection.execution_options"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.execution_options()</span></code></a>  方法的返回值是调用该方法的   :class:` _engine.Connection`  对象本身，</p>
</div></blockquote>
<dl class="simple">
<dt>这意味着它会直接修改   <a class="reference internal" href="#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a>  对象的状态，这是 SQLAlchemy 2.0 的新行为。该行为不适用于</dt><dd><p><a class="reference internal" href="#sqlalchemy.engine.Engine.execution_options" title="sqlalchemy.engine.Engine.execution_options"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Engine.execution_options()</span></code></a>  方法; 该方法仍将返回一个类似副本的   :class:` .Engine`  对象，就像下面所述，可以使用此方法</p>
</dd>
</dl>
<p>为具有不同执行选项的多个   <a class="reference internal" href="#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a>  对象构建引擎，但它们共享相同的方言和连接池。</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="#sqlalchemy.engine.Connection.execution_options.params.isolation_level" title="sqlalchemy.engine.Connection.execution_options"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Connection.execution_options.isolation_level</span></code></a>  参数不一定适用于语句级选项，例如
<a class="reference internal" href="selectable.html#sqlalchemy.sql.expression.Executable.execution_options" title="sqlalchemy.sql.expression.Executable.execution_options"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Executable.execution_options()</span></code></a> ，如果在该级别上设置，将被拒绝。这是因为该选项必须在 DBAPI 连接上基于每个事务设置。</p>
</div>
</section>
<section id="id10">
<h3>为引擎设置隔离级别或 DBAPI 自动提交<a class="headerlink" href="#id10" title="Permalink to this heading">¶</a></h3>
<p>使用  <code class="xref py py-meth docutils literal notranslate"><span class="pre">create_engine.execution_options()</span></code>  参数或 在  :meth:` _engine.Engine.execution_options`  方法中
可以对引擎宽度设置隔离级别，这通常是首选的。可以使用参数  <code class="xref py py-paramref docutils literal notranslate"><span class="pre">create_engine.isolation_level</span></code>  传递给</p>
<blockquote>
<div><p><code class="xref py py-func docutils literal notranslate"><span class="pre">create_engine()</span></code>  来实现：</p>
<blockquote>
<div><p>from sqlalchemy import create_engine</p>
<dl class="simple">
<dt>eng = create_engine(</dt><dd><p>“postgresql://scott:tiger&#64;localhost/test”, isolation_level=”REPEATABLE READ”</p>
</dd>
</dl>
<p>)</p>
</div></blockquote>
</div></blockquote>
<p>使用上面的设置，每当创建新的 DBAPI 连接时，它会被设置为使用“REPEATABLE READ”隔离级别设置以进行所有后续操作。</p>
</section>
<section id="dbapi-autocommit-multiple">
<span id="id11"></span><h3>对于单个引擎维护多个隔离级别<a class="headerlink" href="#dbapi-autocommit-multiple" title="Permalink to this heading">¶</a></h3>
<p>隔离级别也可以针对引擎进行设置，这具有更大程度的灵活性，可以使用  <code class="xref py py-paramref docutils literal notranslate"><span class="pre">create_engine.execution_options</span></code>
参数或  <a class="reference internal" href="#sqlalchemy.engine.Engine.execution_options" title="sqlalchemy.engine.Engine.execution_options"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Engine.execution_options()</span></code></a>  方法。后者将创建原始引擎的副本，这些副本具有相同的方言和连接池，但具有自己
独立的每个连接的隔离级别设置:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">create_engine</span>

<span class="n">eng</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span>
    <span class="s2">&quot;postgresql+psycopg2://scott:tiger@localhost/test&quot;</span><span class="p">,</span>
    <span class="n">execution_options</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;isolation_level&quot;</span><span class="p">:</span> <span class="s2">&quot;REPEATABLE READ&quot;</span><span class="p">},</span>
<span class="p">)</span></pre></div>
</div>
<p>使用上面的设置，每当开始新事务时，DBAPI 连接都将被设置为使用“REPEATABLE READ”隔离级别设置；但是连接作为池将重置为
首次出现时存在的原始隔离级别。 在   <code class="xref py py-func docutils literal notranslate"><span class="pre">create_engine()</span></code>  的级别上，最终效果与使用</p>
<blockquote>
<div><p><code class="xref py py-paramref docutils literal notranslate"><span class="pre">create_engine.isolation_level</span></code>   参数没有任何区别。</p>
</div></blockquote>
<p>然而，经常选择在不同隔离级别下运行操作的应用程序可能希望创建超级   <a class="reference internal" href="#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a>  的多个 “子引擎”，每个 “子引擎”
将配置为不同的隔离级别。一个这样的用例是具有 “事务性” 和 “只读” 操作的操作的应用程序，可以从主引擎中分离出一个额外的</p>
<blockquote>
<div><p><a class="reference internal" href="#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a> ，它使用 ` <cite>“AUTOCOMMIT”`</cite> 可以单独执行。</p>
<blockquote>
<div><p>from sqlalchemy import create_engine</p>
<p>eng = create_engine(“postgresql+psycopg2://scott:tiger&#64;localhost/test”)</p>
<p>autocommit_engine = eng.execution_options(isolation_level=”AUTOCOMMIT”)</p>
</div></blockquote>
</div></blockquote>
<p>上面，  <a class="reference internal" href="#sqlalchemy.engine.Engine.execution_options" title="sqlalchemy.engine.Engine.execution_options"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Engine.execution_options()</span></code></a>   方法创建原始   :class:` _engine.Engine`  的浅层副本。 <code class="docutils literal notranslate"><span class="pre">eng</span></code> 和
<code class="docutils literal notranslate"><span class="pre">autocommit_engine</span></code> 共享相同的方言和连接池。但是，当从 autocommit_engine 获取连接时，将为它们设置“AUTOCOMMIT”模式。</p>
<p>无论使用哪种方法，不管隔离级别如何，当一个连接返回到连接池时，隔离级别都会被无条件地恢复。</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../dialects/sqlite.html#sqlite-isolation-level"><span class="std std-ref">SQLite Transaction Isolation</span></a></p>
<p><a class="reference internal" href="../dialects/postgresql.html#postgresql-isolation-level"><span class="std std-ref">PostgreSQL Transaction Isolation</span></a></p>
<p><a class="reference internal" href="../dialects/mysql.html#mysql-isolation-level"><span class="std std-ref">MySQL Transaction Isolation</span></a></p>
<p><a class="reference internal" href="../dialects/mssql.html#mssql-isolation-level"><span class="std std-ref">SQL Server Transaction Isolation</span></a></p>
<p><a class="reference internal" href="../dialects/oracle.html#oracle-isolation-level"><span class="std std-ref">Oracle Transaction Isolation</span></a></p>
<p><a class="reference internal" href="../orm/session_transaction.html#session-transaction-isolation"><span class="std std-ref">设置事务隔离级别 / DBAPI_AUTOCOMMIT</span></a>  -  ORM</p>
<p><a class="reference internal" href="../faq/connections.html#faq-execute-retry-autocommit"><span class="std std-ref">使用DBAPI Autocommit使透明重新连接成为可用的只读版本</span></a>  -  一种使用 DBAPI 自动提交连接的配方，以便对只读操作进行透明重新连接</p>
</div>
</section>
<section id="dbapi-autocommit-understanding">
<span id="id12"></span><h3>理解 DBAPI 级别的自动提交隔离级别行为<a class="headerlink" href="#dbapi-autocommit-understanding" title="Permalink to this heading">¶</a></h3>
<p>在上述部分中，我们介绍了  <a class="reference internal" href="#sqlalchemy.engine.Connection.execution_options.params.isolation_level" title="sqlalchemy.engine.Connection.execution_options"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Connection.execution_options.isolation_level</span></code></a>  参数的概念，以及如何使用它来设置数据库
隔离级别，包括 SQLAlchemy 级别的事务隔离级别、包括 DBAPI 级别的“自动提交”隔离级别。
在本节中，我们将尝试澄清此方法的影响。</p>
<p>如果我们想要检出   <a class="reference internal" href="#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a>  对象并在“autocommit”模式下使用它，我们会按如下方式进行：</p>
<blockquote>
<div><dl class="simple">
<dt>with engine.connect() as connection:</dt><dd><p>connection.execution_options(isolation_level=”AUTOCOMMIT”)
connection.execute(“&lt;statement&gt;”)
connection.execute(“&lt;statement&gt;”)</p>
</dd>
</dl>
</div></blockquote>
<dl class="simple">
<dt>上面说明了“DBAPI 自动提交”模式的正常用法。没有必要使用  <a class="reference internal" href="#sqlalchemy.engine.Connection.begin" title="sqlalchemy.engine.Connection.begin"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.begin()</span></code></a>  或</dt><dd><p><a class="reference internal" href="#sqlalchemy.engine.Connection.commit" title="sqlalchemy.engine.Connection.commit"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.commit()</span></code></a>   方法，因为所有语句都会立即提交到数据库中。当块结束时，   :class:` _engine.Connection`</p>
</dd>
</dl>
<p>对象将恢复“自动提交”隔离级别，并将 DBAPI 连接释放到连接池中，DBAPI 的 <code class="docutils literal notranslate"><span class="pre">connection.rollback()</span></code> 方法通常将被调用，
但由于上述语句已提交，因此此回滚对数据库状态没有影响。</p>
<p>重要的是要注意，“自动提交”模式即使在调用  <a class="reference internal" href="#sqlalchemy.engine.Connection.begin" title="sqlalchemy.engine.Connection.begin"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.begin()</span></code></a>  时也会持续存在；
DBAPI 不会向数据库发出任何 BEGIN，也不会在调用  <a class="reference internal" href="#sqlalchemy.engine.Connection.commit" title="sqlalchemy.engine.Connection.commit"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.commit()</span></code></a>  时发出 COMMIT。这种使用也不是错误场景，
因为毕竟“隔离级别”是事务本身的配置细节，就像任何其他隔离级别一样。</p>
<p>在下面的示例中，语句保持自动提交，无论 SqlAlchemy 级别的事务块是否存在：</p>
<blockquote>
<div><dl>
<dt>with engine.connect() as connection:</dt><dd><p>connection = connection.execution_options(isolation_level=”AUTOCOMMIT”)</p>
<p># “transaction”被自动开始（但由于自动提交，无效果）
connection.execute(“&lt;statement&gt;”)</p>
<p># 这将引起错误，因为“transaction”已经开始了
with connection.begin() as trans:</p>
<blockquote>
<div><p>connection.execute(“&lt;statement&gt;”)</p>
</div></blockquote>
</dd>
</dl>
</div></blockquote>
<p>上面的示例还演示了与前面提到的相同主题，即“自动提交”隔离级别是底层数据库事务的一项配置细节，并且独立于 SQLAlchemy
的  <a class="reference internal" href="#sqlalchemy.engine.Connection.begin" title="sqlalchemy.engine.Connection.begin"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.begin()</span></code></a>  和 <a href="#id13"><span class="problematic" id="id14">|</span></a>meth:` _engine.Connection.commit` 方法的行为。这两种方式对于 SQLAlchemy
的   <a class="reference internal" href="#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a>  的取用方法来说没有任何影响；该“autocommit”模式可以独立地在其他位置更改，而无需表明其他不同。</p>
<section id="id15">
<h4>更改隔离级别<a class="headerlink" href="#id15" title="Permalink to this heading">¶</a></h4>
<aside class="topic">
<p class="topic-title">TL;DR;</p>
<p>更喜欢使用单个隔离级别的单个   <a class="reference internal" href="#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a>  对象，而不是在单个   :class:` _engine.Connection`  上切换隔离级别。代码会更易读，更少出现错误。</p>
</aside>
<p>隔离级别设置，包括自动提交模式，会在将连接释放回到连接池时自动重置。因此，最好不要尝试在单个   <a class="reference internal" href="#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a>
对象上切换隔离级别，因为这会导致过多的冗余 verbosity。</p>
<dl>
<dt>为说明如何在单个   <a class="reference internal" href="#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a>  检出的范围内使用即兴的“自动提交”模式，必须重新应用</dt><dd><p><a class="reference internal" href="#sqlalchemy.engine.Connection.execution_options.params.isolation_level" title="sqlalchemy.engine.Connection.execution_options"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Connection.execution_options.isolation_level</span></code></a>   参数以前隔离级别。上一个部分说明了一个尝试调用
<a class="reference internal" href="#sqlalchemy.engine.Connection.begin" title="sqlalchemy.engine.Connection.begin"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.begin()</span></code></a>   来开始事务，而在自动提交正在进行的情况下，我们可以重写该示例来实现：</p>
<blockquote>
<div><p># 如果我们想在单个连接上打开自动提交和关闭自动提交，我们应该这样做…
with engine.connect() as connection:</p>
<blockquote>
<div><p>connection.execution_options(isolation_level=”AUTOCOMMIT”)</p>
<p># 在自动提交模式下运行语句
connection.execute(“&lt;statement&gt;”)</p>
<p># “提交”自动启动 “transaction。”
connection.commit()</p>
<p># 切换到默认隔离级别
connection.execution_options(isolation_level=connection.default_isolation_level)</p>
<p># 使用begin block
with connection.begin() as trans:</p>
<blockquote>
<div><p>connection.execute(“&lt;statement&gt;”)</p>
</div></blockquote>
</div></blockquote>
</div></blockquote>
</dd>
</dl>
<p>上面，在手动恢复隔离级别时，我们使用了  <a class="reference internal" href="#sqlalchemy.engine.Connection.default_isolation_level" title="sqlalchemy.engine.Connection.default_isolation_level"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Connection.default_isolation_level</span></code></a>  以恢复默认隔离级别
（假设这就是我们在这里想要的）。但是，这可能更好地使用   <a class="reference internal" href="#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a>  的体系结构， 利用它在检入时自动处理隔离级别重置的现有工作。
写入上述代码的**首选**方法是使用两个块：</p>
<blockquote>
<div><p># 使用自动提交块
with engine.connect().execution_options(isolation_level=”AUTOCOMMIT”) as connection:</p>
<blockquote>
<div><p># 在自动提交模式下运行语句
connection.execute(“&lt;statement&gt;”)</p>
</div></blockquote>
<p># 使用常规块
with engine.begin() as connection:</p>
<blockquote>
<div><p>connection.execute(“&lt;statement&gt;”)</p>
</div></blockquote>
</div></blockquote>
<p>总结：</p>
<ol class="arabic simple">
<li><p>“DBAPI 级别的自动提交”隔离级别完全独立于   <a class="reference internal" href="#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a>  对象的“开始”和“提交”概念。</p></li>
<li><p>使用单个   <a class="reference internal" href="#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a>  检出每个隔离级别。 避免尝试在单个连接检出之间来回切换“自动提交”； 让引擎做恢复默认隔离级别的工作。</p></li>
</ol>
<p id="engine-stream-results">使用服务器端光标（又称流式结果）
——————————————–一些后端支持“服务器端游标”和“客户机端游标”的概念。客户端游标在这里意味着在结果集返回之前，数据库驱动程序将所有行完全提取到内存中。像 PostgreSQL 和 MySQL/MariaDB 这样的驱动程序通常默认使用客户端游标。相比之下，“服务器端游标”表示结果行在客户端消耗时仍保留在数据库服务器的状态中。例如，Oracle 的驱动程序通常使用“服务器端”模型，而 SQLite 方言虽然不使用真正的“客户端/服务器”架构，但仍使用未缓冲的结果提取方法，在消耗结果行之前，将其保留在进程内存之外。</p>
<aside class="topic">
<p class="topic-title">其实我们的意思是“缓存”与“不缓存”结果</p>
<p>服务器端游标还暗示了与关系数据库相关的更广泛的功能，例如滚动光标向前和向后的能力。SQLAlchemy 不包括任何针对这些行为的明确支持；在 SQLAlchemy 本身中，通用术语“服务器端游标”应被视为“未缓冲的结果”，而“客户端游标”表示“在返回第一行之前，结果行被缓冲到内存中”。要使用特定于某个 DBAPI 驱动程序的更丰富的“服务器端游标”特性集，请参见   <a class="reference internal" href="#dbapi-connections-cursor"><span class="std std-ref">直接与DBAPI游标交互</span></a>  部分。</p>
</aside>
<p>从这个基本架构出发，可以得出“服务器端游标”在提取非常大的结果集时更加内存高效，同时可能引入更复杂的客户端/服务器通信过程，并且对小结果集 (通常少于 10000 行) 的效率不高。</p>
<p>对于那些有条件支持缓冲或未缓冲结果的方言，通常有使用“未缓冲”或服务器端游标模式的警告。例如，使用 psycopg2 方言时，如果使用服务器端游标对任何类型的 DML 或 DDL 语句进行了设置，就会引发错误。使用服务器端游标的 MySQL 驱动程序处于更为脆弱的状态，它不会像缓存式游标那样优雅地从错误条件中恢复，也不允许在游标完全关闭之前执行回滚。</p>
<p>因此，SQLAlchemy 的方言始终默认使用更少出错的游标，因此对于 PostgreSQL 和 MySQL 方言，它默认使用缓存、“客户端”游标，在从游标调用任何获取方法之前，将完整的结果集拉入内存。这种操作模式适用于 <strong>绝大多数</strong> 情况；未缓冲的游标通常只在应用程序以很大的块获取大量行的不寻常情况下才有用，这些行的处理在获取更多行之前就可以完成。</p>
<p>对于提供客户端和服务器端游标选项的数据库驱动程序，  <a class="reference internal" href="#sqlalchemy.engine.Connection.execution_options.params.stream_results" title="sqlalchemy.engine.Connection.execution_options"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Connection.execution_options.stream_results</span></code></a>   和  :paramref:` _engine.Connection.execution_options.yield_per`  执行选项在基于   <a class="reference internal" href="#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a>  或语句的基础上提供“服务器端游标”的访问。使用 ORM   :class:` _orm.Session`  时也存在类似的选项。</p>
</section>
</section>
<section id="yield-per">
<h3>通过 yield_per 使用固定大小的缓冲进行流处理<a class="headerlink" href="#yield-per" title="Permalink to this heading">¶</a></h3>
<p>由于每个完全未缓存的服务器端游标的单个行提取操作通常比一次提取多行的批处理更昂贵，因此  <a class="reference internal" href="#sqlalchemy.engine.Connection.execution_options.params.yield_per" title="sqlalchemy.engine.Connection.execution_options"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Connection.execution_options.yield_per</span></code></a>  执行选项将为使用服务器端游标的   :class:` _engine.Connection`  或语句配置一定的以行批为单位的固定大小缓冲，以便在消耗它们时从服务器中检索这些行。可以使用  <a class="reference internal" href="#sqlalchemy.engine.Connection.execution_options" title="sqlalchemy.engine.Connection.execution_options"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.execution_options()</span></code></a>  方法在   :class:` _engine.Connection`  上或在语句上使用  <a class="reference internal" href="selectable.html#sqlalchemy.sql.expression.Executable.execution_options" title="sqlalchemy.sql.expression.Executable.execution_options"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Executable.execution_options()</span></code></a>  方法将此参数配置为正整数值。</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.4.40: </span><a class="reference internal" href="#sqlalchemy.engine.Connection.execution_options.params.yield_per" title="sqlalchemy.engine.Connection.execution_options"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Connection.execution_options.yield_per</span></code></a>  属于 Core 级别的选项，是 SQLAlchemy 1.4.40 新增的；对于之前的 1.4 版本，要结合  :paramref:` _engine.Connection.execution_options.stream_results`  和   <a class="reference internal" href="#sqlalchemy.engine.Result.yield_per" title="sqlalchemy.engine.Result.yield_per"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.yield_per()</span></code></a>  使用。</p>
</div>
<p>使用此选项等效于手动设置  <a class="reference internal" href="#sqlalchemy.engine.Connection.execution_options.params.stream_results" title="sqlalchemy.engine.Connection.execution_options"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Connection.execution_options.stream_results</span></code></a>  选项（下文将描述为“stream”选项），然后调用  :meth:` _engine.Result.yield_per`  方法并为给定的整数值。在这两种情况下，此组合的效果包括：</p>
<ul class="simple">
<li><p>选择了给定后端的服务器端游标模式（如果可用且不是该后端的默认行为）</p></li>
<li><p>由于获取结果行时，它们将被分批缓冲，因此在调用  <a class="reference internal" href="#sqlalchemy.engine.Connection.execution_options.params.yield_per" title="sqlalchemy.engine.Connection.execution_options"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Connection.execution_options.yield_per</span></code></a>  选项或  :meth:` _engine.Result.yield_per`  方法之前，每个批的大小将等于传递给它们的整数参数；然后最后一批与剩下的行的大小相同或更少</p></li>
<li><p>如果使用那个函数，则  <a class="reference internal" href="#sqlalchemy.engine.Result.partitions" title="sqlalchemy.engine.Result.partitions"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.partitions()</span></code></a>  方法使用的默认分区大小，将与该整数大小相同。</p></li>
</ul>
<p>下面示例说明这三种行为：</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="go">with engine.connect() as conn:</span>
<span class="go">    with conn.execution_options(yield_per=100).execute(</span>
<span class="go">        text(&quot;select * from table&quot;)</span>
<span class="go">    ) as result:</span>
<span class="go">        for partition in result.partitions():</span>
<span class="go">            # partition is an iterable that will be at most 100 items</span>
<span class="go">            for row in partition:</span>
<span class="go">                print(f&quot;{row}&quot;)</span></pre></div>
</div>
<p>上面的示例演示了组合使用 <code class="docutils literal notranslate"><span class="pre">yield_per=100</span></code> 以及使用  <a class="reference internal" href="#sqlalchemy.engine.Result.partitions" title="sqlalchemy.engine.Result.partitions"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.partitions()</span></code></a>  方法在与从服务器检索的大小匹配的批处理中运行处理。使用  :meth:` _engine.Result.partitions`  是可选的，如果直接迭代   <a class="reference internal" href="#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a> ，则会为每 100 行获取一批新行。不应使用  :meth:` _engine.Result.all`  等方法，因为这样会立即获取所有剩余行，从而破坏使用 <code class="docutils literal notranslate"><span class="pre">yield_per</span></code> 的目的。</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<blockquote>
<div><p>可以像上面示例中那样使用   <a class="reference internal" href="#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a>  对象作为上下文管理器。使用服务器端游标迭代时，这是确保   :class:` .Result`  对象被关闭的最佳方法，即使在迭代过程中引发异常。</p>
</div></blockquote>
<p><a class="reference internal" href="#sqlalchemy.engine.Connection.execution_options.params.yield_per" title="sqlalchemy.engine.Connection.execution_options"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Connection.execution_options.yield_per</span></code></a>   选项也可移植到 ORM 中，由   :class:` _engine.Engine`  使用，然后将该引擎传递给   <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> 。在使用   :class:` _orm.Session`  获取 ORM 对象时也会使用此选项，该选项还限制了一次生成的 ORM 对象的数量。有关如何在 ORM 中使用  <a class="reference internal" href="#sqlalchemy.engine.Connection.execution_options.params.yield_per" title="sqlalchemy.engine.Connection.execution_options"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Connection.execution_options.yield_per</span></code></a>  的背景信息，请参见   :ref:` orm_queryguide_yield_per`  部分，其位于   <a class="reference internal" href="../orm/queryguide/index.html"><span class="std std-ref">ORM 查询指南</span></a>  中。</p>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.4.40: </span>新增了  <a class="reference internal" href="#sqlalchemy.engine.Connection.execution_options.params.yield_per" title="sqlalchemy.engine.Connection.execution_options"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Connection.execution_options.yield_per</span></code></a>  作为 Core 级别的执行选项，以方便设置流式结果、缓冲区大小和分区大小，与 ORM 的类似用例相对应。</p>
</div>
</section>
<section id="stream-results">
<span id="engine-stream-results-sr"></span><h3>使用 stream_results 动态增长的缓冲区进行流处理<a class="headerlink" href="#stream-results" title="Permalink to this heading">¶</a></h3>
<p>要使用 stream_results 选项启用服务器端游标而不指定分区大小，可以使用  <a class="reference internal" href="#sqlalchemy.engine.Connection.execution_options.params.stream_results" title="sqlalchemy.engine.Connection.execution_options"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Connection.execution_options.stream_results</span></code></a>  选项，在   :class:` _engine.Connection`  对象或语句对象上调用该选项。</p>
<p>当使用  <a class="reference internal" href="#sqlalchemy.engine.Connection.execution_options.params.stream_results" title="sqlalchemy.engine.Connection.execution_options"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Connection.execution_options.stream_results</span></code></a>  选项交付的   :class:` _engine.Result`  对象直接进行迭代时，将使用一种默认缓冲方案内部获取行，该方案首先缓冲少量行，然后在每次获取时缓冲越来越多的行，直到达到预配置的限制 1000 行。使用  <a class="reference internal" href="#sqlalchemy.engine.Connection.execution_options.params.max_row_buffer" title="sqlalchemy.engine.Connection.execution_options"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Connection.execution_options.max_row_buffer</span></code></a>  执行选项可以影响此缓冲区的最大大小:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">engine</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">execution_options</span><span class="p">(</span><span class="n">stream_results</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">max_row_buffer</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
        <span class="n">text</span><span class="p">(</span><span class="s2">&quot;select * from table&quot;</span><span class="p">)</span>
    <span class="p">)</span> <span class="k">as</span> <span class="n">result</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
            <span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">row</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></pre></div>
</div>
<p>虽然  <a class="reference internal" href="#sqlalchemy.engine.Connection.execution_options.params.stream_results" title="sqlalchemy.engine.Connection.execution_options"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Connection.execution_options.stream_results</span></code></a>  选项可以与使用  :meth:` _engine.Result.partitions`  方法结合使用，但应为  <a class="reference internal" href="#sqlalchemy.engine.Result.partitions" title="sqlalchemy.engine.Result.partitions"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.partitions()</span></code></a>  方法提供特定的分区大小，以便不获取整个结果。使用  :paramref:` _engine.Connection.execution_options.yield_per`  选项通常更直接。</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<blockquote>
<div><p><span class="xref std std-ref">orm_queryguide_yield_per</span>  - 位于   :ref:` queryguide_toplevel`</p>
</div></blockquote>
<p><a class="reference internal" href="#sqlalchemy.engine.Result.partitions" title="sqlalchemy.engine.Result.partitions"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.partitions()</span></code></a></p>
<p><a class="reference internal" href="#sqlalchemy.engine.Result.yield_per" title="sqlalchemy.engine.Result.yield_per"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.yield_per()</span></code></a></p>
</div>
</section>
</section>
<section id="schema-translating">
<span id="id16"></span><h2>翻译模式名称<a class="headerlink" href="#schema-translating" title="Permalink to this heading">¶</a></h2>
<p>为支持将常见的表分发到多个架构的多租户应用程序，可以使用  <a class="reference internal" href="#sqlalchemy.engine.Connection.execution_options.params.schema_translate_map" title="sqlalchemy.engine.Connection.execution_options"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Connection.execution_options.schema_translate_map</span></code></a>  执行选项，将一组   :class:` _schema.Table`  对象重新用于不同的模式名称，而不需要进行任何更改。</p>
<p>给定一个表:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">user_table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span>
    <span class="s2">&quot;user&quot;</span><span class="p">,</span>
    <span class="n">metadata_obj</span><span class="p">,</span>
    <span class="n">Column</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="n">Column</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">)),</span>
<span class="p">)</span></pre></div>
</div>
<p>“模式”由  <a class="reference internal" href="metadata.html#sqlalchemy.schema.Table.params.schema" title="sqlalchemy.schema.Table"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Table.schema</span></code></a>  属性定义，例如   :class:` _schema.Table`  这个没有。  <a class="reference internal" href="#sqlalchemy.engine.Connection.execution_options.params.schema_translate_map" title="sqlalchemy.engine.Connection.execution_options"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Connection.execution_options.schema_translate_map</span></code></a>   可以指定，在未指定模式的情况下，所有   :class:` _schema.Table`  对象都将被呈现为不同于 <code class="docutils literal notranslate"><span class="pre">user_schema_one</span></code> 架构的模式:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">connection</span> <span class="o">=</span> <span class="n">engine</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span><span class="o">.</span><span class="n">execution_options</span><span class="p">(</span>
    <span class="n">schema_translate_map</span><span class="o">=</span><span class="p">{</span><span class="kc">None</span><span class="p">:</span> <span class="s2">&quot;user_schema_one&quot;</span><span class="p">}</span>
<span class="p">)</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">user_table</span><span class="o">.</span><span class="n">select</span><span class="p">())</span></pre></div>
</div>
<p>上面的代码将在数据库上执行类似如下的 SQL：</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="n">user_schema_one</span><span class="p">.</span><span class="k">user</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">user_schema_one</span><span class="p">.</span><span class="k">user</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">FROM</span>
<span class="n">user_schema_one</span><span class="p">.</span><span class="k">user</span></pre></div>
</div>
<p>也就是说，方案名称已经被替换为我们的翻译名称。映射可以指定任意数量的目标-&gt;目标模式：</p>
<blockquote>
<div><blockquote>
<div><dl>
<dt>connection = engine.connect().execution_options(</dt><dd><dl class="simple">
<dt>schema_translate_map={</dt><dd><p>None: “user_schema_one”,  # no schema name -&gt; “user_schema_one”
“special”: “special_schema”,  # schema=”special” becomes “special_schema”
“public”: None,  # Table objects with schema=”public” will render with no schema</p>
</dd>
</dl>
<p>}</p>
</dd>
</dl>
<p>)</p>
</div></blockquote>
<p><a class="reference internal" href="#sqlalchemy.engine.Connection.execution_options.params.schema_translate_map" title="sqlalchemy.engine.Connection.execution_options"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Connection.execution_options.schema_translate_map</span></code></a>   参数影响从 SQL 表达式语言生成的所有 DDL 和 SQL constructs，这些 constructs 是从   :class:` _schema.Table`  或   <a class="reference internal" href="defaults.html#sqlalchemy.schema.Sequence" title="sqlalchemy.schema.Sequence"><code class="xref py py-class docutils literal notranslate"><span class="pre">Sequence</span></code></a>  表格派生的。它不会影响通过   :func:` _expression.text`  构造的文字字符串 SQL，也不会影响传递了纯字符串到  <a class="reference internal" href="#sqlalchemy.engine.Connection.execute" title="sqlalchemy.engine.Connection.execute"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.execute()</span></code></a>  方法的操作。</p>
</div></blockquote>
<p>此功能仅在那些直接从   <a class="reference internal" href="metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal notranslate"><span class="pre">Table</span></code></a>  或   :class:` .Sequence`  中派生模式名称的情况下发生作用，并且不会影响   <code class="xref py py-class docutils literal notranslate"><span class="pre">Inspector</span></code>  对象的操作，因为模式名称是显式传递给这些方法的。</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>要在 ORM   <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code>  上使用翻译方案特性，请在   :class:` _engine.Engine`  级别设置该选项，然后将该引擎传递给   <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> 。  :class:` _orm.Session`  为每个事务使用一个新   <a class="reference internal" href="#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a> 。</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>默认情况下，使用 ORM   <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> ，仅支持 <strong>每个会话的单个模式转换映射</strong>，如果在每个语句的基础上给出了不同的模式转换映射，则它将 <strong>无效</strong>，因为 ORM   :class:` _orm.Session`  不考虑当前模式转换值。要使用具有多个 <code class="docutils literal notranslate"><span class="pre">schema_translate_map</span></code> 配置的单个   <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code> ，可以使用   :ref:` horizontal_sharding_toplevel`  扩展。有关示例，请参见   <a class="reference internal" href="../orm/examples.html#examples-sharding"><span class="std std-ref">水平分片</span></a> 。</p>
</div>
</div>
</section>
<section id="sql">
<span id="sql-caching"></span><h2>SQL 编译缓存<a class="headerlink" href="#sql" title="Permalink to this heading">¶</a></h2>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.4: </span>SQLAlchemy 现在具有透明的查询缓存系统，在 Core 和 ORM 之间都能显著降低 Python 计算开销。有关详细信息，请参见   <a class="reference internal" href="../changelog/migration_14.html#change-4639"><span class="std std-ref">所有DQL、DML语句现在都包含透明的SQL编译缓存</span></a> 。</p>
</div>
<p>SQLAlchemy 包括用于 SQL 编译器及其 ORM 变体的全面缓存系统。该缓存系统在   <a class="reference internal" href="#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a>  内部是透明的，它提供了一个特定的 Core 或 ORM SQL 语句的 SQL 编译过程，以及与该语句相关的计算结果，在该语句对象和具有相同结构的所有语句对象中只会发生一次，在引擎的“编译缓存”中。按照“具有相同结构的语句对象”，这通常对应于在函数中构造的 SQL 语句，并在每次运行该函数时构建:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">run_my_statement</span><span class="p">(</span><span class="n">connection</span><span class="p">,</span> <span class="n">parameter</span><span class="p">):</span>
    <span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
    <span class="n">stmt</span> <span class="o">=</span> <span class="n">stmt</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">col</span> <span class="o">==</span> <span class="n">parameter</span><span class="p">)</span>
    <span class="n">stmt</span> <span class="o">=</span> <span class="n">stmt</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">connection</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span></pre></div>
</div>
<p>上面的语句将生成类似于“SELECT id, col FROM table WHERE col = :col ORDER BY id”的 SQL，尽管“parameter” 的值是纯 Python 对象，例如字符串或整数，但字符串 SQL 形式不包括这个值，它使用绑定的参数。随后的对于上面的“run_my_statement()”函数的调用将使用长期有效的编译结构在“connection.execute()”调用的范围内，以提高性能。</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>重要的一点是，SQL 编译缓存仅缓存传递给数据库的**SQL字符串而已**，并且**不缓存**查询返回的数据。它不以任何方式是一个数据缓存，并且不会与获取结果行相关的任何内存使用。</p>
</div>
<p>虽然 SQLAlchemy 早期 1.x 系列自带了简单的语句缓存，但另外还提供了“Baked Query”扩展来提高缓存的效率，但是这些系统都需要高度特殊的 API 以使缓存生效。 2020 年 7 月开始，1.4 版本引入了新的缓存系统，这个缓存系统完全自动且不需要任何特殊步骤才能生效。</p>
<p>这个缓存系统会透明地在   <code class="xref py py-class docutils literal notranslate"><span class="pre">_Engine</span></code>  内部使用类似的机制（由底层编译缓存机制驱动）。那么一个给定的 Core 或 ORM SQL 声明语句的 SQL 编译过程，以及为该语句集装配检索结果机制的相关计算，将仅针对该构造对象的某个具体结构执行一次，并保留在特定结构在引擎的“编译缓存”中的持续时间内。所有 SQLAlchemy 支持的 struct‌　类型都被缓存，including   :class:` .Select` .Insert`构造、  <a class="reference internal" href="dml.html#sqlalchemy.sql.expression.Update" title="sqlalchemy.sql.expression.Update"><code class="xref py py-class docutils literal notranslate"><span class="pre">Update</span></code></a> .Delete` 构造等。</p>
<section id="id17">
<h3>配置<a class="headerlink" href="#id17" title="Permalink to this heading">¶</a></h3>
<p>缓存本身是类似字典的对象，称为“LRUCache”。这是一个内部 SQLAlchemy 字典子类，可跟踪特定键的使用情况，并在缓存大小达到一定阈值时执行定期“修剪”步骤，以删除最近未使用的项目。缓存的大小默认为 500 ，可以使用  <code class="xref py py-paramref docutils literal notranslate"><span class="pre">create_engine.query_cache_size</span></code>  参数进行配置：</p>
<blockquote>
<div><dl class="simple">
<dt>engine = create_engine(</dt><dd><p>“postgresql+psycopg2://scott:tiger&#64;localhost/test”, query_cache_size=1200</p>
</dd>
</dl>
<p>)</p>
</div></blockquote>
<p>缓存的大小可以增长到给定大小的 150%，然后被修剪回目标大小。 一个缓存大小为 1200 的缓存因此可以增长到 1800 个元素大小，然后将被剪回到 1200 个大小。</p>
<p>缓存的大小基于每个唯一的渲染 SQL 语句，按引擎分配一个条目。 从 Core 和 ORM 生成的 SQL 语句被视为相同。 DDL 语句通常不会被缓存。 为了确定缓存正在执行什么操作，引擎记录会包括有关缓存行为的详细信息，在下一节中描述。</p>
</section>
<section id="sql-caching-logging">
<span id="id18"></span><h3>使用日志记录估计缓存性能<a class="headerlink" href="#sql-caching-logging" title="Permalink to this heading">¶</a></h3>
<p>上面的 1200 缓存大小相当大。对于小型应用程序，大小 100 可能已足够。为了估计缓存的最佳大小，假设目标主机上存在足够的内存，则缓存的大小应基于可以为目标引擎呈现的唯一 SQL 字符串的数量。最直接的启用 SQL 回显的方法可能是使用  <code class="xref py py-paramref docutils literal notranslate"><span class="pre">create_engine.echo</span></code>  标志，或使用 Python 日志；有关日志配置的背景，请参见   :ref:` dbengine_logging`  部分。</p>
<p>例如，我们将检查以下程序生成的日志：</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="go">from sqlalchemy import Column</span>
<span class="go">from sqlalchemy import create_engine</span>
<span class="go">from sqlalchemy import ForeignKey</span>
<span class="go">from sqlalchemy import Integer</span>
<span class="go">from sqlalchemy import select</span>
<span class="go">from sqlalchemy import String</span>
<span class="go">from sqlalchemy.ext.declarative import declarative_base</span>
<span class="go">from sqlalchemy.orm import relationship</span>
<span class="go">from sqlalchemy.orm import Session</span>

<span class="go">Base = declarative_base()</span>


<span class="go">class A(Base):</span>
<span class="go">    __tablename__ = &quot;a&quot;</span>

<span class="go">    id = Column(Integer, primary_key=True)</span>
<span class="go">    data = Column(String)</span>
<span class="go">    bs = relationship(&quot;B&quot;)</span>


<span class="go">class B(Base):</span>
<span class="go">    __tablename__ = &quot;b&quot;</span>
<span class="go">    id = Column(Integer, primary_key=True)</span>
<span class="go">    a_id = Column(ForeignKey(&quot;a.id&quot;))</span>
<span class="go">    data = Column(String)</span>


<span class="go">e = create_engine(&quot;sqlite://&quot;, echo=True)</span>
<span class="go">Base.metadata.create_all(e)</span>

<span class="go">s = Session(e)</span>

<span class="go">s.add_all([A(bs=[B(), B(), B()]), A(bs=[B(), B(), B()]), A(bs=[B(), B(), B()])])</span>
<span class="go">s.commit()</span>

<span class="go">for a_rec in s.scalars(select(A)):</span>
<span class="go">    print(a_rec.bs)</span></pre></div>
</div>
<p>当运行时，每个日志语句都会在参数左侧包含括号括起来的缓存统计。可以看到，我们可能会看到以下四种类型的消息：</p>
<ul class="simple">
<li><p>“[raw sql]”-驱动程序或最终用户使用  <a class="reference internal" href="#sqlalchemy.engine.Connection.exec_driver_sql" title="sqlalchemy.engine.Connection.exec_driver_sql"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.exec_driver_sql()</span></code></a>  直接向数据库发送原始 SQL-缓存不适用</p></li>
<li><p>“[no key]”-语句对象是DDL语句，因此不会缓存；或者语句对象包含不可缓存元素，例如用户定义构造或任意的大操作数 VALUES 子句。</p></li>
<li><p>“[generated in Xs]”- 该语句是一个**缓存未命中**语句，并且必须被编译，然后存储在缓存中。编译构造的时间为 X 秒。数字 X 将是非常小的小数秒数。</p></li>
<li><p>“[cached since Xs ago]”-该语句是一个**缓存命中**语句，并且无需重新编译即可获得。该语句自 X 秒前开始存储在缓存中。数字 X 与应用程序运行时间和语句驻留缓存中的时间长相应关，例如可以为 24 小时的期间达到 86400。</p></li>
</ul>
<p>下面更详细地描述了每个徽章。</p>
<p>我们会看到的前两个语句是 SQLite 方言检查 “a” 和 “b” 表的存在：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>INFO sqlalchemy.engine.Engine PRAGMA temp.table_info(&quot;a&quot;)
INFO sqlalchemy.engine.Engine [raw sql] ()
INFO sqlalchemy.engine.Engine PRAGMA main.table_info(&quot;b&quot;)
INFO sqlalchemy.engine.Engine [raw sql] ()</pre></div>
</div>
<p>对于上述两个 SQLite PRAGMA 语句，徽章为“[raw sql]”，这表示驱动程序正在使用  <a class="reference internal" href="#sqlalchemy.engine.Connection.exec_driver_sql" title="sqlalchemy.engine.Connection.exec_driver_sql"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.exec_driver_sql()</span></code></a>  直接将 Python 字符串发送到数据库中。不会对此类语句执行缓存，因为它们已以字符串形式存在，而且不知道将返回哪些类型的结果行，因为 SQLAlchemy 不会提前解析 SQL 字符串。</p>
<p>接下来我们看到了 CREATE TABLE 语句：</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="n">INFO</span><span class="w"> </span><span class="n">sqlalchemy</span><span class="p">.</span><span class="n">engine</span><span class="p">.</span><span class="n">Engine</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="n">id</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">  </span><span class="k">data</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">,</span>
<span class="w">  </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">INFO</span><span class="w"> </span><span class="n">sqlalchemy</span><span class="p">.</span><span class="n">engine</span><span class="p">.</span><span class="n">Engine</span><span class="w"> </span><span class="p">[</span><span class="k">no</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">00007</span><span class="n">s</span><span class="p">]</span><span class="w"> </span><span class="p">()</span>
<span class="n">INFO</span><span class="w"> </span><span class="n">sqlalchemy</span><span class="p">.</span><span class="n">engine</span><span class="p">.</span><span class="n">Engine</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="n">id</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">  </span><span class="n">a_id</span><span class="w"> </span><span class="nb">INTEGER</span><span class="p">,</span>
<span class="w">  </span><span class="k">data</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">,</span>
<span class="w">  </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">),</span>
<span class="w">  </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="p">(</span><span class="n">a_id</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">INFO</span><span class="w"> </span><span class="n">sqlalchemy</span><span class="p">.</span><span class="n">engine</span><span class="p">.</span><span class="n">Engine</span><span class="w"> </span><span class="p">[</span><span class="k">no</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">00006</span><span class="n">s</span><span class="p">]</span><span class="w"> </span><span class="p">()</span></pre></div>
</div>
<p>对于这两个语句，徽章为“[no key 0.00006s]”。这表示这两个特殊语句均未缓存，原因是 DDL 相关的   <code class="xref py py-class docutils literal notranslate"><span class="pre">CreateTable</span></code>  构造没有生成缓存键。DDL 构造通常不参与缓存，因为它们通常不会被重复使用，而且 DDL 还是数据库配置步骤，性能不是那么重要。</p>
<p>“[no key]” 徽章也非常重要，因为它可能会为可缓存的 SQL 语句生成，但某些子构造当前不能缓存而产生。此类示例包括没有定义缓存参数的自定义用户定义 SQL 元素，以及生成任意长且不可复制的 SQL 字符串的某些构造形式，主要是   <a class="reference internal" href="selectable.html#sqlalchemy.sql.expression.Values" title="sqlalchemy.sql.expression.Values"><code class="xref py py-class docutils literal notranslate"><span class="pre">Values</span></code></a>  构造和使用  :meth:` .Insert.values`  方法的“多属性插入”。</p>
<p>到目前为止，我们的缓存仍为空。然后缓存的语句将被缓存，一个段落看起来像：</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="n">INFO</span><span class="w"> </span><span class="n">sqlalchemy</span><span class="p">.</span><span class="n">engine</span><span class="p">.</span><span class="n">Engine</span><span class="w"> </span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="p">(</span><span class="k">data</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="o">?</span><span class="p">)</span>
<span class="n">INFO</span><span class="w"> </span><span class="n">sqlalchemy</span><span class="p">.</span><span class="n">engine</span><span class="p">.</span><span class="n">Engine</span><span class="w"> </span><span class="p">[</span><span class="k">generated</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">00011</span><span class="n">s</span><span class="p">]</span><span class="w"> </span><span class="p">(</span><span class="k">None</span><span class="p">,)</span>
<span class="n">INFO</span><span class="w"> </span><span class="n">sqlalchemy</span><span class="p">.</span><span class="n">engine</span><span class="p">.</span><span class="n">Engine</span><span class="w"> </span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="p">(</span><span class="k">data</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="o">?</span><span class="p">)</span>
<span class="n">INFO</span><span class="w"> </span><span class="n">sqlalchemy</span><span class="p">.</span><span class="n">engine</span><span class="p">.</span><span class="n">Engine</span><span class="w"> </span><span class="p">[</span><span class="n">cached</span><span class="w"> </span><span class="n">since</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">0003533</span><span class="n">s</span><span class="w"> </span><span class="n">ago</span><span class="p">]</span><span class="w"> </span><span class="p">(</span><span class="k">None</span><span class="p">,)</span>
<span class="n">INFO</span><span class="w"> </span><span class="n">sqlalchemy</span><span class="p">.</span><span class="n">engine</span><span class="p">.</span><span class="n">Engine</span><span class="w"> </span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="p">(</span><span class="k">data</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="o">?</span><span class="p">)</span>
<span class="n">INFO</span><span class="w"> </span><span class="n">sqlalchemy</span><span class="p">.</span><span class="n">engine</span><span class="p">.</span><span class="n">Engine</span><span class="w"> </span><span class="p">[</span><span class="n">cached</span><span class="w"> </span><span class="n">since</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">0005326</span><span class="n">s</span><span class="w"> </span><span class="n">ago</span><span class="p">]</span><span class="w"> </span><span class="p">(</span><span class="k">None</span><span class="p">,)</span>
<span class="n">INFO</span><span class="w"> </span><span class="n">sqlalchemy</span><span class="p">.</span><span class="n">engine</span><span class="p">.</span><span class="n">Engine</span><span class="w"> </span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="p">(</span><span class="n">a_id</span><span class="p">,</span><span class="w"> </span><span class="k">data</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="o">?</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="p">)</span>
<span class="n">INFO</span><span class="w"> </span><span class="n">sqlalchemy</span><span class="p">.</span><span class="n">engine</span><span class="p">.</span><span class="n">Engine</span><span class="w"> </span><span class="p">[</span><span class="k">generated</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">00010</span><span class="n">s</span><span class="p">]</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="k">None</span><span class="p">)</span>
<span class="n">INFO</span><span class="w"> </span><span class="n">sqlalchemy</span><span class="p">.</span><span class="n">engine</span><span class="p">.</span><span class="n">Engine</span><span class="w"> </span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="p">(</span><span class="n">a_id</span><span class="p">,</span><span class="w"> </span><span class="k">data</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="o">?</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="p">)</span>
<span class="n">INFO</span><span class="w"> </span><span class="n">sqlalchemy</span><span class="p">.</span><span class="n">engine</span><span class="p">.</span><span class="n">Engine</span><span class="w"> </span><span class="p">[</span><span class="n">cached</span><span class="w"> </span><span class="n">since</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">0003232</span><span class="n">s</span><span class="w"> </span><span class="n">ago</span><span class="p">]</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="k">None</span><span class="p">)</span>
<span class="n">INFO</span><span class="w"> </span><span class="n">sqlalchemy</span><span class="p">.</span><span class="n">engine</span><span class="p">.</span><span class="n">Engine</span><span class="w"> </span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="p">(</span><span class="n">a_id</span><span class="p">,</span><span class="w"> </span><span class="k">data</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="o">?</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="p">)</span>
<span class="n">INFO</span><span class="w"> </span><span class="n">sqlalchemy</span><span class="p">.</span><span class="n">engine</span><span class="p">.</span><span class="n">Engine</span><span class="w"> </span><span class="p">[</span><span class="n">cached</span><span class="w"> </span><span class="n">since</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">0004887</span><span class="n">s</span><span class="w"> </span><span class="n">ago</span><span class="p">]</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="k">None</span><span class="p">)</span></pre></div>
</div>
<p>上面，我们真正看到的是两个唯一的 SQL 字符串：“INSERT INTO a (data) VALUES (?)”以及“INSERT INTO b (a_id, data) VALUES (?, ?)”在参数是完全不同的情况下被重复使用，由于 SQLAlchemy 对所有行值使用绑定参数，因此即使这些语句多次重复使用，SQL 语句的实际字符串保持不变。</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>上面的两个语句是由 ORM 工作单元过程生成的，并且实际上将在每个映射器上缓存使用本地缓存。但是机制和术语是一样的。  <a class="reference internal" href="#engine-compiled-cache"><span class="std std-ref">禁用或使用其他字典缓存一些（或全部）语句</span></a>  将描述用户面向代码如何使用可在线程间共享其缓存容器。</p>
</div>
<p>对于上面两个唯一的 SQL 字符串，我们可以看到第一次出现每个语句时的缓存徽标是“[generated in 0.00011s]”。这表示该语句是**不在缓存中的，它被编译为一个字符串，需要 0.00011 秒，并且然后被缓存**。当我们使用“[generated]”徽章时，我们知道这意味着缓存未命中。这可以预期为特定语句的首次出现。然而，如果在长时间运行的应用程序中看到了许多新的“[generated]”标记，而该应用程序通常一遍又一遍地使用同一系列 SQL 语句，则表示  <code class="xref py py-paramref docutils literal notranslate"><span class="pre">create_engine.query_cache_size</span></code>  参数可能太小。当从缓存中删除时，如果该语句被剪掉，则显示“[generated]”标记，则下次使用它时，它将再次导致缓存未命中。</p>
<p>我们示例程序中的程序执行一些查询，我们可以看到相同的“生成”然后是“缓存”，就如“a”表的 select 以及之后的“b”表的后续的懒惰加载：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>INFO sqlalchemy.engine.Engine SELECT a.id AS a_id, a.data AS a_data
FROM a
INFO sqlalchemy.engine.Engine [generated in 0.00009s] ()
INFO sqlalchemy.engine.Engine SELECT b.id AS b_id, b.a_id AS b_a_id, b.data AS b_data
FROM b
WHERE ? = b.a_id
INFO sqlalchemy.engine.Engine [generated in 0.00010s] (1,)
INFO sqlalchemy.engine.Engine SELECT b.id AS b_id, b.a_id AS b_a_id, b.data AS b_data
FROM b
WHERE ? = b.a_id
INFO sqlalchemy.engine.Engine [cached since 0.0005922s ago] (2,)</pre></div>
</div>
<p>INFO sqlalchemy.engine.Engine SELECT b.id AS b_id, b.a_id AS b_a_id, b.data AS b_data
FROM b
WHERE ? = b.a_id</p>
<p>从上面的程序可以看出，总共缓存了4个不同的SQL语句。这表明缓存大小为4就足够了。显然，这个大小非常小，通常可以将默认大小500保持不变。</p>
</section>
<section id="id19">
<h3>缓存使用了多少内存？<a class="headerlink" href="#id19" title="Permalink to this heading">¶</a></h3>
<p>上一节详细介绍了一些技术，用于检查:paramref: _sa.create_engine.query_cache_size是否需要更大。我们如何知道缓存不太大？我们可能希望将:paramref: _sa.create_engine.query_cache_size设置为不高于某个特定数字，因为我们有一个可能会使用大量不同语句的应用程序，例如从搜索UX动态构建查询，并且我们不希望如果过去24小时运行了十万个不同的查询并且它们都被缓存，主机就会耗尽内存。</p>
<p>测量Python数据结构占用的内存极其困难，不过使用一个进程来度量通过连续一系列添加到缓存中的250个新语句的内存增长，暗示一个中等核心语句占用约12K的内存，而ORM中的小语句占用约20 K，包括结构获取的结构，其中ORM的这些结构将更大。</p>
</section>
<section id="engine-compiled-cache">
<span id="id20"></span><h3>禁用或使用其他字典缓存一些（或全部）语句<a class="headerlink" href="#engine-compiled-cache" title="Permalink to this heading">¶</a></h3>
<p>内部使用的缓存称为“LRUCache”，但这主要只是一个字典。任何字典都可以作为任何一系列语句的缓存来使用，方法是使用:paramref: .Connection.execution_options.compiled_cache选项作为执行选项。执行选项可以在语句、  <a href="#id21"><span class="problematic" id="id22">:clas:`_engine.Engine`</span></a>  或  :clas:` _engine.Connection`  上设置，以及在使用ORM的  <code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.execute()</span></code>  方法时进行设置，用于SQLAlchemy-2.0样式的调用。例如，要运行一系列SQL语句并将它们缓存在特定的字典中：</p>
<p>my_cache = {}
with engine.connect().execution_options(compiled_cache=my_cache) as conn:</p>
<blockquote>
<div><p>conn.execute(table.select())</p>
</div></blockquote>
<p>SQLAlchemy ORM使用上述技术来在工作单元“flush”过程中保留独立于 <a class="reference internal" href="#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a> 上配置的默认缓存的每个映射器缓存，以及某些关系加载器查询。</p>
<p>也可以使用此参数禁用缓存，方法是发送值为`None`：</p>
<p># disable caching for this connection
with engine.connect().execution_options(compiled_cache=None) as conn:</p>
<blockquote>
<div><p>conn.execute(table.select())</p>
</div></blockquote>
</section>
<section id="engine-thirdparty-caching">
<span id="id23"></span><h3>第三方方言的缓存<a class="headerlink" href="#engine-thirdparty-caching" title="Permalink to this heading">¶</a></h3>
<p>缓存功能要求方言的编译器生成安全重用的SQL字符串，以给定针对该SQL字符串键入的特定缓存键。这意味着语句中的任何文字值，例如SELECT的LIMIT / OFFSET值，都不能在方言的编译方案中硬编码，因为编译后的字符串将无法重新使用。SQLAlchemy支持使用:meth:<cite>_sql.BindParameter.render_literal_execute</cite> 方法呈现绑定参数的渲染限制/偏移子句，该方法可以通过自定义编译器应用于现有的`Select._limit_clause`和`Select._offset_clause`属性，如本节稍后的演示。</p>
<p>由于有许多第三方方言，并且其中许多可能会从SQL语句中生成文字值，而没有使用新的“字面执行”功能的好处，SQLAlchemy从版本1.4.5开始添加了称为  <a class="reference internal" href="internals.html#sqlalchemy.engine.Dialect.supports_statement_cache" title="sqlalchemy.engine.Dialect.supports_statement_cache"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Dialect.supports_statement_cache</span></code></a>   的方言属性。此属性在运行时直接在特定方言类上检查其是否存在，即使在超类上已经存在，因此即使在继承现有可缓存的SQLAlchemy方言（例如` ` sqlalchemy.dialects.postgresql.PGDialect``）的第三方方言也必须显式包括此属性才能启用缓存。一旦方言已被修改为需要并经过可重用编译的SQL语句进行测试，就应该启用该属性。对于不支持此属性的所有第三方方言，日志记录将指示“方言不支持缓存”。</p>
<p>测试完成方言的缓存后，特别是SQL编译器已更新为不直接呈现任何文本LIMIT / OFFSET，编译器作者可以如下应用该属性：</p>
<p>from sqlalchemy.engine.default import DefaultDialect</p>
<dl class="simple">
<dt>class MyDialect(DefaultDialect):</dt><dd><p>supports_statement_cache = True</p>
</dd>
</dl>
<p>flag还需要应用于方言的所有子类，例如：</p>
<dl class="simple">
<dt>class MyDBAPIForMyDialect(MyDialect):</dt><dd><p>supports_statement_cache = True</p>
</dd>
</dl>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.4.5: </span>添加了  <a class="reference internal" href="internals.html#sqlalchemy.engine.Dialect.supports_statement_cache" title="sqlalchemy.engine.Dialect.supports_statement_cache"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Dialect.supports_statement_cache</span></code></a>  属性。</p>
</div>
<p>通常的方言修改情况如下。</p>
<section id="limit-offset">
<h4>示例：使用后编译参数呈现LIMIT / OFFSET<a class="headerlink" href="#limit-offset" title="Permalink to this heading">¶</a></h4>
<p>例如，假设方言重写了  <code class="xref py py-meth docutils literal notranslate"><span class="pre">SQLCompiler.limit_clause()</span></code>  方法，该方法为SQL语句生成“LIMIT / OFFSET”子句，如下所示：</p>
<p># pre 1.4 style code
def limit_clause(self, select, <a href="#id24"><span class="problematic" id="id25">**</span></a>kw):</p>
<blockquote>
<div><p>text = “”
if select._limit is not None:</p>
<blockquote>
<div><p>text += “ n LIMIT %d” % (select._limit,)</p>
</div></blockquote>
<dl class="simple">
<dt>if select._offset is not None:</dt><dd><p>text += “ n OFFSET %d” % (select._offset,)</p>
</dd>
</dl>
<p>return text</p>
</div></blockquote>
<p>上面的例程将：attr:<cite>.Select._limit</cite> 和  <code class="xref py py-attr docutils literal notranslate"><span class="pre">Select._offset</span></code>   整数值呈现为嵌入在SQL语句中的文字整数。这是对于不支持SELECT语句的LIMIT / OFFSET子句中使用绑定参数的数据库的常见要求。但是，在初始编译阶段呈现整数值本身直接与缓存不兼容：  :class:` .Select` .Select`语句无法正确生成可重复使用的值。</p>
<p>上述代码的纠正是将文字整数移动到SQLAlchemy的  <a class="reference internal" href="../changelog/migration_14.html#change-4808"><span class="std std-ref">post-compile</span></a>  工具中，该工具将文字整数在初始编译阶段之外呈现，而是在发送到DBAPI的语句执行之前就执行了。在编译阶段中，可以使用  :meth:` _sql.BindParameter.render_literal_execute`  方法，结合  <code class="xref py py-attr docutils literal notranslate"><span class="pre">Select._limit_clause</span></code>   和  :attr:` .Select._offset_clause`   属性来表示LIMIT / OFFSET，这些属性表示将LIMIT / OFFSET显示为完整的SQL表达式，如下所示：</p>
<p># 1.4 cache-compatible code
def limit_clause(self, select, <a href="#id26"><span class="problematic" id="id27">**</span></a>kw):</p>
<blockquote>
<div><p>text = “”</p>
<p>limit_clause = select._limit_clause
offset_clause = select._offset_clause</p>
<dl>
<dt>if select._simple_int_clause(limit_clause):</dt><dd><dl class="simple">
<dt>text += “ n LIMIT %s” % (</dt><dd><p>self.process(limit_clause.render_literal_execute(), <a href="#id28"><span class="problematic" id="id29">**</span></a>kw)</p>
</dd>
</dl>
<p>)</p>
</dd>
<dt>elif limit_clause is not None:</dt><dd><p># assuming the DB doesn’t support SQL expressions for LIMIT.
# Otherwise render here normally
raise exc.CompileError(</p>
<blockquote>
<div><p>“dialect ‘mydialect’ can only render simple integers for LIMIT”</p>
</div></blockquote>
<p>)</p>
</dd>
<dt>if select._simple_int_clause(offset_clause):</dt><dd><dl class="simple">
<dt>text += “ n OFFSET %s” % (</dt><dd><p>self.process(offset_clause.render_literal_execute(), <a href="#id30"><span class="problematic" id="id31">**</span></a>kw)</p>
</dd>
</dl>
<p>)</p>
</dd>
<dt>elif offset_clause is not None:</dt><dd><p># assuming the DB doesn’t support SQL expressions for OFFSET.
# Otherwise render here normally
raise exc.CompileError(</p>
<blockquote>
<div><p>“dialect ‘mydialect’ can only render simple integers for OFFSET”</p>
</div></blockquote>
<p>)</p>
</dd>
</dl>
<p>return text</p>
</div></blockquote>
<p>上述方法将生成一个编译过的SELECT语句，其样貌如下：</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">y</span>
<span class="k">LIMIT</span><span class="w"> </span><span class="n">__</span><span class="p">[</span><span class="n">POSTCOMPILE_param_1</span><span class="p">]</span>
<span class="k">OFFSET</span><span class="w"> </span><span class="n">__</span><span class="p">[</span><span class="n">POSTCOMPILE_param_2</span><span class="p">]</span></pre></div>
</div>
<p>上面，“__[POSTCOMPILE_param_1]”和“__[POSTCOMPILE_param_2]”指示符将在语句执行时间之前用其相应的整数值填充从缓存中检索到的SQL字符串。</p>
<p>完成上述更改后，  <a class="reference internal" href="internals.html#sqlalchemy.engine.Dialect.supports_statement_cache" title="sqlalchemy.engine.Dialect.supports_statement_cache"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Dialect.supports_statement_cache</span></code></a>  标志应设置为“ True” 。强烈建议第三方方言使用  :ref:` examples_performance`中的 <a href="#id55"><span class="problematic" id="id56">`dialect第三方测试套件&lt;https://github.com/sqlalchemy/sqlalchemy/blob/main/README.dialects.rst&gt;`_</span></a>，以确保正确呈现和缓存诸如SELECT with LIMIT / OFFSET之类的操作。</p>
</section>
</section>
<section id="lambda">
<span id="engine-lambda-caching"></span><h3>使用Lambda在语句生成中添加显着的速度增益<a class="headerlink" href="#lambda" title="Permalink to this heading">¶</a></h3>
<div class="admonition deepalchemy">
<p class="admonition-title">Deep Alchemy</p>
<p>这种技术在非常性能密集的场景下通常不是必需的，并且适用于经验丰富的Python程序员。虽然相当简单直接，不过它涉及到不适合初学者Python程序员的元编程概念。Lambda方法可以稍后应用于现有代码，而无需进行任何努力。</p>
</div>
<p>通常，Python函数，通常表示为lambda，可以用于生成基于lambda函数本身以及lambda内的闭包变量的SQL表达式，这可以基于应用程序运行中的Python代码位置和闭包变量来缓存不仅是SQL字符串编译形式，正如SQLAlchemy在不使用lambda系统时的正常行为，还缓存SQL表达式结构本身的维护。</p>
<p>注：重要的是注意，即使不使用lambda系统，SQLAlchemy中已有SQL缓存。 lambda系统只通过将构建SQL结构本身的缓存和使用更简单的缓存密钥一个附加的操作量来减少每个SQL语句作为缓存渐近性调用的工作量。</p>
<section id="id32">
<h4>简要指南对于Lambda<a class="headerlink" href="#id32" title="Permalink to this heading">¶</a></h4>
<p>关键是，重点在于lambda SQL系统确保生成lambda的缓存键与它将生成的SQL字符串永远不会不匹配。  <a class="reference internal" href="foundation.html#sqlalchemy.sql.expression.LambdaElement" title="sqlalchemy.sql.expression.LambdaElement"><code class="xref py py-class docutils literal notranslate"><span class="pre">LambdaElement</span></code></a> 和相关对象将在每次运行时运行并分析给定的lambda，以计算如何在每次运行时缓存它，试图检测任何潜在问题。基本准则包括：</p>
<ul>
<li><p><strong>支持任何类型的声明符</strong> - 虽然有望  <a class="reference internal" href="selectable.html#sqlalchemy.sql.expression.select" title="sqlalchemy.sql.expression.select"><code class="xref py py-meth docutils literal notranslate"><span class="pre">sqlalchemy.sql.expression.select()</span></code></a>  构造函数是  :func:` _sql.lambda_stmt`  和  <a class="reference internal" href="dml.html#sqlalchemy.sql.expression.update" title="sqlalchemy.sql.expression.update"><code class="xref py py-meth docutils literal notranslate"><span class="pre">sqlalchemy.sql.expression.update()</span></code></a>  也可用：：</p>
<blockquote>
<div><dl class="simple">
<dt>def upd(<a href="#id57"><span class="problematic" id="id58">id_</span></a>, newname):</dt><dd><p>stmt = lambda_stmt(lambda: users.update())
stmt += lambda s: s.values(name=newname)
stmt += lambda s: s.where(users.c.id == <a href="#id59"><span class="problematic" id="id60">id_</span></a>)
return stmt</p>
</dd>
<dt>with engine.begin() as conn:</dt><dd><p>conn.execute(upd(7, “foo”))</p>
</dd>
</dl>
</div></blockquote>
</li>
<li><p><strong>ORM用例直接支持</strong> -   <a class="reference internal" href="sqlelement.html#sqlalchemy.sql.expression.lambda_stmt" title="sqlalchemy.sql.expression.lambda_stmt"><code class="xref py py-func docutils literal notranslate"><span class="pre">lambda_stmt()</span></code></a>  直接使用：：</p>
<blockquote>
<div><dl>
<dt>def select_user(session, name):</dt><dd><p>stmt = lambda_stmt(lambda: select(User))
stmt += lambda s: s.where(User.name == name)</p>
<p>row = session.execute(stmt).first()
return row</p>
</dd>
</dl>
</div></blockquote>
</li>
<li><p><strong>绑定参数会自动适应</strong> - 与SQLAlchemy以前的“烤好的查询”系统不同，lambda SQL系统自动适应由Python操作符产生的文字值，这些文字值会自动成为SQL绑定参数。这意味着即使一个给定的lambda只运行一次，生成的闭包变量中的纯量值在每次运行时也是从lambda中提取出来的：</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">my_stmt</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
<span class="go">...     stmt = lambda_stmt(lambda: select(column(&quot;q&quot;)))</span>
<span class="go">...     stmt += lambda s: s.where(column(&quot;q&quot;) &gt; x)</span>
<span class="go">...     stmt += lambda s: s.where(column(&quot;q&quot;) == y)</span>
<span class="go">...     return stmt</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s2">&quot;sqlite://&quot;</span><span class="p">,</span> <span class="n">echo</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">engine</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
<span class="go">...     print(conn.scalar(my_stmt(5, 10)))</span>
<span class="go">...     print(conn.scalar(my_stmt(12, 8)))</span>
<span class="go">SELECT q</span>
<span class="go">FROM anon_1</span>
<span class="go">WHERE q &gt; ? AND q = ?</span>
<span class="go">[generated in 0.00099s] (5, 10){stop}</span>
<span class="go">10</span>
<span class="go">SELECT q</span>
<span class="go">FROM anon_1</span>
<span class="go">WHERE q &gt; ? AND q = ?</span>
<span class="go">[generated in 0.00029s] (12, 8){stop}</span>
<span class="go">12</span></pre></div>
</div>
<p>上面的例子表明  <a class="reference internal" href="foundation.html#sqlalchemy.sql.expression.StatementLambdaElement" title="sqlalchemy.sql.expression.StatementLambdaElement"><code class="xref py py-class docutils literal notranslate"><span class="pre">StatementLambdaElement</span></code></a> ` x``和``y``的值，因此它们会在lambda调用之前的缓存构造中替换为相应的值。</p>
</li>
<li><p><strong>lambda理想上应该在所有情况下生成一致的SQL结构</strong> - 避免在lambda中使用有条件或自定义可调用程序，因为这可能会使其根据输入生成不同的SQL; 如果一个函数可能有条件地使用两个不同的SQL片段，那么使用两个不同的lambda：</p>
<blockquote>
<div><p># <strong>不要</strong> 这样做：</p>
<dl>
<dt>def my_stmt(parameter, thing=False):</dt><dd><p>stmt = lambda_stmt(lambda: select(table))
stmt += (</p>
<blockquote>
<div><p>lambda s: s.where(table.c.x &gt; parameter)
if thing
else s.where(table.c.y == parameter)</p>
</div></blockquote>
<p>)
return stmt</p>
</dd>
</dl>
<p># <strong>要</strong> 这样做：</p>
<dl>
<dt>def my_stmt(parameter, thing=False):</dt><dd><p>stmt = lambda_stmt(lambda: select(table))
if thing:</p>
<blockquote>
<div><p>stmt += lambda s: s.where(table.c.x &gt; parameter)</p>
</div></blockquote>
<dl class="simple">
<dt>else:</dt><dd><p>stmt += lambda s: s.where(table.c.y == parameter)</p>
</dd>
</dl>
<p>return stmt</p>
</dd>
</dl>
</div></blockquote>
<p>如果Lambda不能生成一致的SQL结构，可能会发生各种故障，其中一些可能无法轻松检测。</p>
</li>
<li><p><strong>不要在Lambda内部引用Lambda用于生成绑定值的函数</strong> - 绑定值跟踪方法要求在lambda的闭包中存在要在SQL语句中用于绑定的实际值。如果值从其他函数生成，则不可能这样做，而且  <a class="reference internal" href="foundation.html#sqlalchemy.sql.expression.LambdaElement" title="sqlalchemy.sql.expression.LambdaElement"><code class="xref py py-class docutils literal notranslate"><span class="pre">LambdaElement</span></code></a> 通常抛出错误如果尝试这样做</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">my_stmt</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">get_x</span><span class="p">():</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="n">x</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">get_y</span><span class="p">():</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="n">y</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="n">stmt</span> <span class="o">=</span> <span class="n">lambda_stmt</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">select</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">get_x</span><span class="p">(),</span> <span class="n">get_y</span><span class="p">())))</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">stmt</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s2">&quot;sqlite://&quot;</span><span class="p">,</span> <span class="n">echo</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">engine</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">print</span><span class="p">(</span><span class="n">conn</span><span class="o">.</span><span class="n">scalar</span><span class="p">(</span><span class="n">my_stmt</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">)))</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="gr">  # ...</span>
<span class="gr">sqlalchemy.exc.InvalidRequestError</span>: <span class="n">Can&#39;t invoke Python callable get_x()</span>
<span class="x">inside of lambda expression argument at</span>
<span class="x">&lt;code object &lt;lambda&gt; at 0x7fed15f35450, file</span>
<span class="x">&quot;&lt;stdin&gt;&quot;, line 6&gt;;</span>
<span class="x">lambda SQL constructs should not invoke functions from closure variables</span>
<span class="x">to produce literal values since the lambda SQL system normally extracts</span>
<span class="x">bound values without actually invoking the lambda or any functions within it.</span></pre></div>
</div>
<p>上述错误表示  <a class="reference internal" href="foundation.html#sqlalchemy.sql.expression.LambdaElement" title="sqlalchemy.sql.expression.LambdaElement"><code class="xref py py-class docutils literal notranslate"><span class="pre">LambdaElement</span></code></a> ` Foo``对象将始终保持相同的行为并且默认情况下不会将其用作缓存键。如果使用``Foo``对象作为缓存键，如果有许多不同的``Foo``对象，则会填充缓存具有重复信息，并且还将为所有这些对象保持长时间参考。解决上述情况的最佳方法是不要在lambda中引用``foo``，而是在lambda之外引用它：</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">my_stmt</span><span class="p">(</span><span class="n">foo</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">x_param</span><span class="p">,</span> <span class="n">y_param</span> <span class="o">=</span> <span class="n">foo</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">foo</span><span class="o">.</span><span class="n">y</span>
<span class="gp">... </span>    <span class="n">stmt</span> <span class="o">=</span> <span class="n">lambda_stmt</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">select</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">x_param</span><span class="p">,</span> <span class="n">y_param</span><span class="p">)))</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">stmt</span></pre></div>
</div>
<p>在某些情况下，如果保证lambda基于输入永远不会更改其SQL结构，则可以通过传递``track_closure_variables=False``来禁用任何跟踪除用于绑定参数的变量外其他闭包变量的默认情况：</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">my_stmt</span><span class="p">(</span><span class="n">foo</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">stmt</span> <span class="o">=</span> <span class="n">lambda_stmt</span><span class="p">(</span>
<span class="gp">... </span>        <span class="k">lambda</span><span class="p">:</span> <span class="n">select</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">foo</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">foo</span><span class="o">.</span><span class="n">y</span><span class="p">)),</span> <span class="n">track_closure_variables</span><span class="o">=</span><span class="kc">False</span>
<span class="gp">... </span>    <span class="p">)</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">stmt</span></pre></div>
</div>
<p>还有一个选项可以将对象添加到元素中，以显式形式构成缓存键，使用``track_on`` 参数; 使用此参数允许指定的值用作缓存键，并且还将防止考虑其他闭包变量。这对于来自某些上下文对象的一部分SQL构造，这些对象可能具有许多不同的值的情况很有用。在下面的示例中，SELECT语句的第一个段将禁用变量``foo``的跟踪，而第二个段将显式跟踪“self”作为缓存键的一部分:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">my_stmt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">foo</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">stmt</span> <span class="o">=</span> <span class="n">lambda_stmt</span><span class="p">(</span>
<span class="gp">... </span>        <span class="k">lambda</span><span class="p">:</span> <span class="n">select</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">column_expressions</span><span class="p">),</span> <span class="n">track_closure_variables</span><span class="o">=</span><span class="kc">False</span>
<span class="gp">... </span>    <span class="p">)</span>
<span class="gp">... </span>    <span class="n">stmt</span> <span class="o">=</span> <span class="n">stmt</span><span class="o">.</span><span class="n">add_criteria</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">where_criteria</span><span class="p">,</span> <span class="n">track_on</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="p">])</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">stmt</span></pre></div>
</div>
<p>使用``track_on``意味着在lambda的内部缓存中长期存储给定对象，并且在缓存不清除这些对象（默认情况下使用1000个条目的LRU方案）的时间内具有较强的引用。</p>
</li>
</ul>
</section>
<section id="id33">
<h4>缓存密钥生成<a class="headerlink" href="#id33" title="Permalink to this heading">¶</a></h4>
<p>为了了解有关lambda SQL构造的某些选项和行为，有助于了解缓存系统是如何工作的。SQLAlchemy的缓存系统通常通过从给定SQL表达式构造表示构造缓存密钥来生成缓存密钥，该表示构成为所有可能发生变化的对象表示构成：</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">select</span><span class="p">,</span> <span class="n">column</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">column</span><span class="p">(</span><span class="s2">&quot;q&quot;</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cache_key</span> <span class="o">=</span> <span class="n">stmt</span><span class="o">.</span><span class="n">_generate_cache_key</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">print</span><span class="p">(</span><span class="n">cache_key</span><span class="p">)</span>  <span class="c1"># somewhat paraphrased</span>
<span class="go">CacheKey(key=(</span>
<span class="go">  &#39;0&#39;,</span>
<span class="go">  &lt;class &#39;sqlalchemy.sql.selectable.Select&#39;&gt;,</span>
<span class="go">  &#39;_raw_columns&#39;,</span>
<span class="go">  (</span>
<span class="go">    (</span>
<span class="go">      &#39;1&#39;,</span>
<span class="go">      &lt;class &#39;sqlalchemy.sql.elements.ColumnClause&#39;&gt;,</span>
<span class="go">      &#39;name&#39;,</span>
<span class="go">      &#39;q&#39;,</span>
<span class="go">      &#39;type&#39;,</span>
<span class="go">      (</span>
<span class="go">        &lt;class &#39;sqlalchemy.sql.sqltypes.NullType&#39;&gt;,</span>
<span class="go">      ),</span>
<span class="go">    ),</span>
<span class="go">  ),</span>
<span class="go">  # a few more elements are here, and many more for a more</span>
<span class="go">  # complicated SELECT statement</span>
<span class="go">),)</span></pre></div>
</div>
<p>以上密钥存储在缓存中，该缓存实际上是一个字典，而值是某种结构，其中包含SQL语句的字符串形式，即短语“SELECT q”。我们可以观察到，即使对于非常短的查询，缓存密钥也非常详细，因为它必须表示关于正在呈现和可能执行的一切的所有州。</p>
<p>相比之下，lambda构造系统创建了一种不同类型的缓存密钥：</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">lambda_stmt</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="n">lambda_stmt</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">select</span><span class="p">(</span><span class="n">column</span><span class="p">(</span><span class="s2">&quot;q&quot;</span><span class="p">)))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cache_key</span> <span class="o">=</span> <span class="n">stmt</span><span class="o">.</span><span class="n">_generate_cache_key</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">print</span><span class="p">(</span><span class="n">cache_key</span><span class="p">)</span>
<span class="go">CacheKey(key=(</span>
<span class="go">  &lt;code object &lt;lambda&gt; at 0x7fed1617c710, file &quot;&lt;stdin&gt;&quot;, line 1&gt;,</span>
<span class="go">  &lt;class &#39;sqlalchemy.sql.lambdas.StatementLambdaElement&#39;&gt;,</span>
<span class="go">),)</span></pre></div>
</div>
<p>上面，我们看到一个比非lambda语句短得多的缓存密钥，另外，甚至不需要生成“select(column(“q”))”构造， Python lambda本身带有一个称为“__code__”的属性，该属性引用在应用程序的运行时是不可变且永久的Python代码对象。</p>
<p>当lambda还包括闭包变量时，通常情况下，如果这些变量引用SQL构造，例如列对象，则它们成为缓存密钥的一部分，或者，如果它们引用将绑定的文字值，则它们放置在缓存密钥的另一个元素中。 ：</p>
<blockquote>
<div><div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">my_stmt</span><span class="p">(</span><span class="n">parameter</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">col</span> <span class="o">=</span> <span class="n">column</span><span class="p">(</span><span class="s2">&quot;q&quot;</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">stmt</span> <span class="o">=</span> <span class="n">lambda_stmt</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">select</span><span class="p">(</span><span class="n">col</span><span class="p">))</span>
<span class="gp">... </span>    <span class="n">stmt</span> <span class="o">+=</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">col</span> <span class="o">==</span> <span class="n">parameter</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">stmt</span></pre></div>
</div>
<p><a class="reference internal" href="foundation.html#sqlalchemy.sql.expression.StatementLambdaElement" title="sqlalchemy.sql.expression.StatementLambdaElement"><code class="xref py py-class docutils literal notranslate"><span class="pre">StatementLambdaElement</span></code></a> 具有两个lambda，两个lambda都引用“col”闭包变量，因此缓存密钥将表示这两个段以及“column()”对象：</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="n">my_stmt</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">key</span> <span class="o">=</span> <span class="n">stmt</span><span class="o">.</span><span class="n">_generate_cache_key</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">print</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
<span class="go">CacheKey(key=(</span>
<span class="go">  &lt;code object &lt;lambda&gt; at 0x7f07323c50e0, file &quot;&lt;stdin&gt;&quot;, line 3&gt;,</span>
<span class="go">  (</span>
<span class="go">    &#39;0&#39;,</span>
<span class="go">    &lt;class &#39;sqlalchemy.sql.elements.ColumnClause&#39;&gt;,</span>
<span class="go">    &#39;name&#39;,</span>
<span class="go">    &#39;q&#39;,</span>
<span class="go">    &#39;type&#39;,</span>
<span class="go">    (</span>
<span class="go">      &lt;class &#39;sqlalchemy.sql.sqltypes.NullType&#39;&gt;,</span>
<span class="go">    ),</span>
<span class="go">  ),</span>
<span class="go">  &lt;code object &lt;lambda&gt; at 0x7f07323c5190, file &quot;&lt;stdin&gt;&quot;, line 4&gt;,</span>
<span class="go">  &lt;class &#39;sqlalchemy.sql.lambdas.LinkedLambdaElement&#39;&gt;,</span>
<span class="go">  (</span>
<span class="go">    &#39;0&#39;,</span>
<span class="go">    &lt;class &#39;sqlalchemy.sql.elements.ColumnClause&#39;&gt;,</span>
<span class="go">    &#39;name&#39;,</span>
<span class="go">    &#39;q&#39;,</span>
<span class="go">    &#39;type&#39;,</span>
<span class="go">    (</span>
<span class="go">      &lt;class &#39;sqlalchemy.sql.sqltypes.NullType&#39;&gt;,</span>
<span class="go">    ),</span>
<span class="go">  ),</span>
<span class="go">  (</span>
<span class="go">    &#39;0&#39;,</span>
<span class="go">    &lt;class &#39;sqlalchemy.sql.elements.ColumnClause&#39;&gt;,</span>
<span class="go">    &#39;name&#39;,</span>
<span class="go">    &#39;q&#39;,</span>
<span class="go">    &#39;type&#39;,</span>
<span class="go">    (</span>
<span class="go">      &lt;class &#39;sqlalchemy.sql.sqltypes.NullType&#39;&gt;,</span>
<span class="go">    ),</span>
<span class="go">  ),</span>
<span class="go">),)</span></pre></div>
</div>
</div></blockquote>
<p>缓存密钥的第二个部分检索将在语句调用时使用的绑定参数：</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">key</span><span class="o">.</span><span class="n">bindparams</span>
<span class="go">[BindParameter(&#39;%(139668884281280 parameter)s&#39;, 5, type_=Integer())]</span></pre></div>
</div>
<p>如果想要了解具有性能比较的“lambda”缓存的一系列示例，请参见  <a class="reference internal" href="../orm/examples.html#examples-performance"><span class="std std-ref">性能</span></a> 中的“short_selects”测试套件。</p>
<p id="engine-insertmanyvalues">INSERT语句的“插入多个值”行为
————————————————- ——————</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 2.0: </span>有关更改的背景信息，请参见  <span class="xref std std-ref">change_6047</span> ，其中包括示例性能测试</p>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p><span class="xref std std-term">insertmanyvalues</span>  。</p>
</div>
<p>随着SQLite和MariaDB增加对RETURNING的支持，SQLAlchemy不再需要依赖于大多数后端提供的仅限单行的`cursor.lastrowid &lt;<a class="reference external" href="https://peps.python.org/pep-0249/#lastrowid">https://peps.python.org/pep-0249/#lastrowid</a>&gt;`_属性； RETURNING现在可以用于除MySQL以外的所有  <a class="reference internal" href="../dialects/index.html#included-dialects"><span class="std std-ref">SQLAlchemy-included</span></a> ` executemany()``并改为重组单个INSERT语句来解决，每个语句都可容纳大量的行在一次语句中，该语句使用``cursor.execute()``调用。这种方法源自于“psycopg2快速执行帮手”&lt;<a class="reference external" href="https://www.psycopg.org/docs/extras.html#fast-execution-helpers">https://www.psycopg.org/docs/extras.html#fast-execution-helpers</a>&gt;功能，SQLAlchemy在最近的发布系列中逐步增加了对此功能的支持。</p>
</section>
</section>
<section id="id34">
<h3>当前支持<a class="headerlink" href="#id34" title="Permalink to this heading">¶</a></h3>
<p>该功能适用于SQLAlchemy中包含支持RETURNING的后端，但Oracle除外，因为cx_Oracle和OracleDB驱动程序都提供自己的等效特性。使用  <a class="reference internal" href="#sqlalchemy.engine.Connection.execute.params.parameters" title="sqlalchemy.engine.Connection.execute"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Connection.execute.parameters</span></code></a>  参数将字典列表传递给  :meth:` _engine.Connection.execute`  或  <code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.execute()</span></code>  方法（以及  :ref:` asyncio &lt;asyncio_toplevel&gt;`  ）并使用  <span class="xref std std-term">executemany</span>  执行时，通常会发生特征发生。当使用  :meth:` _orm.Session.add`  和  <code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.add_all()</span></code>  添加行时，它也将在ORM  :term:` unit of work`  过程中发生。</p>
<p>对于SQLAlchemy的包含方言，当前支持或等效支持如下：</p>
<ul class="simple">
<li><p>SQLite-受SQLite 3.35及以上版本支持</p></li>
<li><p>PostgreSQL-所有受支持的Postgresql版本（9及以上）</p></li>
<li><p>SQL Server-受支持的所有SQL Server版本[#]_</p></li>
<li><p>MariaDB-受MariaDB版本10.5及以上支持</p></li>
<li><p>MySQL-不支持，没有RETURNING特性</p></li>
<li><p>Oracle-使用本机cx_Oracle / OracleDB的executemany支持RETURNINGAPI，在所有支持的Oracle版本9及以上使用多行OUT参数。这不是”executemanyvalues”的相同实现，但具有相同的使用模式和等效的性能。</p></li>
</ul>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 2.0.10: </span></p>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="id35" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></span>
<p>”insertmanyvalues”支持Microsoft SQL Server的临时禁用在版本2.0.9中被恢复。</p>
</aside>
</aside>
</div>
</section>
<section id="id36">
<h3>禁用功能<a class="headerlink" href="#id36" title="Permalink to this heading">¶</a></h3>
<p>要为某个后端禁用“insertmanyvalues”功能，请在  <code class="xref py py-meth docutils literal notranslate"><span class="pre">sqlalchemy.create_engine()</span></code>  中将  :paramref:` _sa.create_engine.use_insertmanyvalues`  参数设置为``False``：</p>
<blockquote>
<div><dl class="simple">
<dt>engine = create_engine(</dt><dd><p>“mariadb+mariadbconnector://scott:tiger&#64;host/db”, use_insertmanyvalues=False</p>
</dd>
</dl>
<p>)</p>
</div></blockquote>
<p>也可以通过传递  <a class="reference internal" href="metadata.html#sqlalchemy.schema.Table.params.implicit_returning" title="sqlalchemy.schema.Table"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Table.implicit_returning</span></code></a>  参数为` <cite>False``来禁用这一特性，从而不会在一个特定的 :class:</cite>._schema.Table` 对象中使用隐式的返回特性。：</p>
<blockquote>
<div><dl class="simple">
<dt>t = Table(</dt><dd><p>“t”,
metadata,
Column(“id”, Integer, primary_key=True),
Column(“x”, Integer),
implicit_returning=False,</p>
</dd>
</dl>
<p>)</p>
</div></blockquote>
<p>禁用返回特性的原因是解决特定于后端的限制。</p>
</section>
<section id="id37">
<h3>批操作模式<a class="headerlink" href="#id37" title="Permalink to this heading">¶</a></h3>
<p>该功能有两种操作模式，可以在每个方言和 <a class="reference internal" href="metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal notranslate"><span class="pre">Table</span></code></a> 基础上选中。 一个是“批处理模式”，它通过重新编写INSERT语句的形式来减少数据库往返次数：</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="p">(</span><span class="k">data</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="o">%</span><span class="p">(</span><span class="k">data</span><span class="p">)</span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="k">RETURNING</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">id</span></pre></div>
</div>
<p>将其转换为类似于以下形式的“分批”形式：</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="p">(</span><span class="k">data</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span>
<span class="w">    </span><span class="p">(</span><span class="o">%</span><span class="p">(</span><span class="n">data_0</span><span class="p">)</span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="p">(</span><span class="n">x_0</span><span class="p">)</span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="p">(</span><span class="n">y_0</span><span class="p">)</span><span class="n">s</span><span class="p">),</span>
<span class="w">    </span><span class="p">(</span><span class="o">%</span><span class="p">(</span><span class="n">data_1</span><span class="p">)</span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="p">(</span><span class="n">x_1</span><span class="p">)</span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="p">(</span><span class="n">y_1</span><span class="p">)</span><span class="n">s</span><span class="p">),</span>
<span class="w">    </span><span class="p">(</span><span class="o">%</span><span class="p">(</span><span class="n">data_2</span><span class="p">)</span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="p">(</span><span class="n">x_2</span><span class="p">)</span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="p">(</span><span class="n">y_2</span><span class="p">)</span><span class="n">s</span><span class="p">),</span>
<span class="w">    </span><span class="p">...</span>
<span class="w">    </span><span class="p">(</span><span class="o">%</span><span class="p">(</span><span class="n">data_78</span><span class="p">)</span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="p">(</span><span class="n">x_78</span><span class="p">)</span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="p">(</span><span class="n">y_78</span><span class="p">)</span><span class="n">s</span><span class="p">)</span>
<span class="k">RETURNING</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">id</span></pre></div>
</div>
<p>在上面，语句是针对输入数据的子集（即“批”）进行组织的，其大小由数据库后端以及每批参数对应于语句大小/参数数的已知限制来确定。该特征然后对每个输入数据的批执行一次INSERT语句，直到消耗所有记录，并将每个批的RETURNING结果连接到一个单个大行集合中，该集合可以从单个  <a class="reference internal" href="#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a>  对象中获得。</p>
<p>这种“分批”形式允许使用较少的数据库往返次数插入许多行，并已经被证明对大多数后端都可以实现显着的性能提升。</p>
</section>
<section id="returning">
<span id="engine-insertmanyvalues-returning-order"></span><h3>将RETURNING行与参数集相关联<a class="headerlink" href="#returning" title="Permalink to this heading">¶</a></h3>
<div class="versionadded">
<p><span class="versionmodified added">New in version 2.0.10.</span></p>
</div>
<p>在前面一节中说明的“分批”模式查询不保证返回的记录的顺序与输入数据的顺序相对应。当被SQLAlchemy ORM  <span class="xref std std-term">unit of work</span>  处理或对于将返回的服务器生成的值与输入数据相关联的应用程序时，  :meth:` _dml.Insert.returning`  和  <a class="reference internal" href="dml.html#sqlalchemy.sql.expression.UpdateBase.return_defaults" title="sqlalchemy.sql.expression.UpdateBase.return_defaults"><code class="xref py py-meth docutils literal notranslate"><span class="pre">UpdateBase.return_defaults()</span></code></a>  方法包括一个选项:paramref :` _dml.Insert.returning.sort_by_parameter_order`，表示 “insertmanyvalues” 模式应保证此对应关系。这与记录实际被数据库后端插入的顺序无关，其在任何情况下都不被假定；只是应该假定在接收到返回的记录时，应按照传递原始输入数据的顺序组织这些记录。</p>
<p>当出现  <a class="reference internal" href="dml.html#sqlalchemy.sql.expression.Insert.returning.params.sort_by_parameter_order" title="sqlalchemy.sql.expression.Insert.returning"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Insert.returning.sort_by_parameter_order</span></code></a>  参数时，对于使用诸如“IDENTITY”、PostgreSQL“SERIAL”、MariaDB“AUTO_INCREMENT”或SQLite的“ROWID”方案等服务器生成的整数主键值的表，可能会代替“分批”模式，使用更复杂的INSERT..RETURNING形式，结合基于返回值的行的后期排序，如果不存在这样的形式，则“insertmanyvalues”特性可能会以一种优雅的方式降级为“非分批”模式，该方式为每个参数集运行单个INSERT语句。</p>
<p>例如，在SQL Server上，当自动增加的“IDENTITY”列用作主键时，将使用以下SQL形式：</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="p">(</span><span class="k">data</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">)</span>
<span class="k">OUTPUT</span><span class="w"> </span><span class="n">inserted</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">inserted</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">id__1</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">p0</span><span class="p">,</span><span class="w"> </span><span class="n">p1</span><span class="p">,</span><span class="w"> </span><span class="n">p2</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="p">(</span><span class="k">VALUES</span>
<span class="w">    </span><span class="p">(</span><span class="o">?</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="o">?</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="o">?</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">),</span>
<span class="w">    </span><span class="p">...</span>
<span class="w">    </span><span class="p">(</span><span class="o">?</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="p">,</span><span class="w"> </span><span class="mi">77</span><span class="p">)</span>
<span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">imp_sen</span><span class="p">(</span><span class="n">p0</span><span class="p">,</span><span class="w"> </span><span class="n">p1</span><span class="p">,</span><span class="w"> </span><span class="n">p2</span><span class="p">,</span><span class="w"> </span><span class="n">sen_counter</span><span class="p">)</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">sen_counter</span></pre></div>
</div>
<p>当PostgreSQL的主键列使用SERIAL或IDENTITY时，将使用类似的形式。上述形式**不能**保证插入行的顺序。但是，它保证IDENTITY或SERIAL值随每个参数集按顺序创建。然后，“insertmanyvalues”功能根据递增整数标识符对返回的行进行排序。</p>
<p>对于SQLite数据库，没有适当的INSERT表单可以将新的ROWID值与传递的参数集的顺序相关联。因此，在使用后端生成的主键值时，SQLite后端将降级为“非分批”模式，当请求有序RETURNING时将运行单个INSERT语句。</p>
<p>对于MariaDB，insertmanyvalues使用的默认INSERT表单是足够的，因为这个数据库后端在使用InnoDB时将自动将：AUTO_INCREMENT的顺序与输入数据的顺序对齐[#]_。</p>
<p>对于具有其他类型的服务器生成的主键值的 <a class="reference internal" href="metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal notranslate"><span class="pre">Table</span></code></a> 配置，以及不能提供确定性地对多个参数集对齐的服务器已生成值的后端，当要求保证RETURNING排序时，”insertmanyvalues”模式将使用**非分批**模式。</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="id38" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></span>
</aside>
</aside>
<ul>
<li><p>Microsoft SQL Server论证</p>
<p>“使用SELECT和ORDER BY填充行的INSERT查询保证如何计算标识值，但不保证插入行的顺序。”
<a class="reference external" href="https://learn.microsoft.com/en-us/sql/t-sql/statements/insert-transact-sql?view=sql-server-ver16#limitations-and-restrictions">https://learn.microsoft.com/en-us/sql/t-sql/statements/insert-transact-sql?view=sql-server-ver16#limitations-and-restrictions</a></p>
</li>
<li><p>PostgreSQL batched INSERT讨论</p>
<p>2018年原始描述https:<a class="reference external" href="mailto://www&#46;postgresql&#46;org/message-id/29386&#46;1528813619&#37;&#52;&#48;sss&#46;pgh&#46;pa&#46;us">//www<span>&#46;</span>postgresql<span>&#46;</span>org/message-id/29386<span>&#46;</span>1528813619<span>&#64;</span>sss<span>&#46;</span>pgh<span>&#46;</span>pa<span>&#46;</span>us</a></p>
<p>2023年后续 - <a class="reference external" href="https://www.postgresql.org/message-id/be108555-da2a-4abc-a46b-acbe8b55bd25%40app.fastmail.com">https://www.postgresql.org/message-id/be108555-da2a-4abc-a46b-acbe8b55bd25%40app.fastmail.com</a></p>
</li>
</ul>
</div>
</section>
<section id="engine-insertmanyvalues-non-batch">
<span id="id39"></span><h3>非批次模式操作<a class="headerlink" href="#engine-insertmanyvalues-non-batch" title="Permalink to this heading">¶</a></h3>
<p>对于不具有客户端主键值的  <a class="reference internal" href="metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal notranslate"><span class="pre">Table</span></code></a>  的需求的 :class:` _dml.Insert`语句进行有保证的RETURNING排序时，当不支持此类值时，”insertmanyvalues”特征可能会减少分批模式，而使用**非批次**模式。</p>
<p>在这种模式下，保留INSERT语句的原始SQL形式，“insertmanyvalues”特性将为每个参数集单独运行该语句，将返回的行组织为完整的结果集。与先前的SQLAlchemy版本不同，它确实以最小化Python开销为基础进行循环。在某些情况下，例如在SQLite上，“非分批”模式的性能与“分批”模式完全相同。</p>
</section>
<section id="id40">
<h3>语句执行模型<a class="headerlink" href="#id40" title="Permalink to this heading">¶</a></h3>
<p>对于“分批”和“非分批”两种模式，该特征将必然使用DBAPI``cursor.execute（）``方法在Core级别的  <a class="reference internal" href="#sqlalchemy.engine.Connection.execute" title="sqlalchemy.engine.Connection.execute"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.execute()</span></code></a>  方法的范围内调用**多个INSERT语句**，每个语句最多包含一定数量的参数集。该限制可以根据下文的  :ref:` engine_insertmanyvalues_page_size` <cite>cursor.execute()``调用被单独记录并传递给事件侦听器，例如  :meth:</cite>.ConnectionEvents.before_cursor_execute`  （请参见  :ref:` engine_insertmanyvalues_events` ）。</p>
<p>…</p>
</section>
<section id="engine-insertmanyvalues-page-size">
<span id="id41"></span><h3>控制批量大小<a class="headerlink" href="#engine-insertmanyvalues-page-size" title="Permalink to this heading">¶</a></h3>
<p>“insertmanyvalues”的一个重要特征是，INSERT语句的大小限制为固定的最大“值”子句数，以及每次表示的绑定参数的固定总数，在一次执行中不能表示大于此数量的参数字典。当给定的参数字典的数量超过固定限制，或者当要呈现在单个INSERT语句中的绑定参数总数超过固定限制时（两个固定限制是单独的），将在单个  <a class="reference internal" href="#sqlalchemy.engine.Connection.execute" title="sqlalchemy.engine.Connection.execute"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.execute()</span></code></a>  调用的范围内调用多个INSERT语句，每个INSERT语句都适用于一个参数字典的一部分，称为“批”。每个“批”的参数字典数然后被称为“批量”。例如，批量大小为500意味着每个INSERT语句最多插入500行。</p>
<p>重要的是能够调整批量大小，因为较大的批量大小可能对输入本身相对较小的插入效果更高，并且较小的批量大小可能对使用非常大的值集的插入更合适，其中使用最小化后端行为和内存约束的固定大小显然是必要的。因此，批量大小可以在每个 <a class="reference internal" href="#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a> 以及每个语句的基础上进行配置。限制参数另一方面是基于正在使用的数据库的已知特征的固定参数。</p>
<p>对于大多数后端，默认情况下，批量大小为1000，具有额外的每方言“最大参数数”限制因素，该限制因素可以根据需要在每个语句的基础上进一步降低。最大参数数因方言和服务器版本而异；最大大小为32700（选择为健康的距离PostgreSQL 32767和SQLite现代限制32766，同时留有余地以便于语句中的附加参数以及DBAPI古怪行），较旧的SQLite版本（3.32.0以前）将此值设置为999。MariaDB没有确定的限制，但32700仍然是SQL消息大小的限制因素。</p>
<p>批量大小的值可以通过   <a class="reference internal" href="#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a>  参数设置在各后端上。例如，要使INSERT语句包含100个参数集：</p>
<blockquote>
<div><p>e = create_engine(“sqlite://”, insertmanyvalues_page_size=100)</p>
</div></blockquote>
<p>批量大小也可以使用  <a class="reference internal" href="#sqlalchemy.engine.Connection.execution_options.params.insertmanyvalues_page_size" title="sqlalchemy.engine.Connection.execution_options"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Connection.execution_options.insertmanyvalues_page_size</span></code></a>  执行选项每个语句地受影响，如下所示:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">e</span><span class="o">.</span><span class="n">begin</span><span class="p">()</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
        <span class="n">table</span><span class="o">.</span><span class="n">insert</span><span class="p">()</span><span class="o">.</span><span class="n">returning</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">id</span><span class="p">),</span>
        <span class="n">parameterlist</span><span class="p">,</span>
        <span class="n">execution_options</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;insertmanyvalues_page_size&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">},</span>
    <span class="p">)</span></pre></div>
</div>
<p>或者在语句本身上进行配置:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">stmt</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">table</span><span class="o">.</span><span class="n">insert</span><span class="p">()</span>
    <span class="o">.</span><span class="n">returning</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
    <span class="o">.</span><span class="n">execution_options</span><span class="p">(</span><span class="n">insertmanyvalues_page_size</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="p">)</span>
<span class="k">with</span> <span class="n">e</span><span class="o">.</span><span class="n">begin</span><span class="p">()</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">stmt</span><span class="p">,</span> <span class="n">parameterlist</span><span class="p">)</span></pre></div>
</div>
</section>
<section id="engine-insertmanyvalues-events">
<span id="id42"></span><h3>日志和事件<a class="headerlink" href="#engine-insertmanyvalues-events" title="Permalink to this heading">¶</a></h3>
<p>“insertmanyvalues”功能完全与SQLAlchemy的  <span class="xref std std-ref">statement logging</span> .ConnectionEvents.before_cursor_execute` ）集成。当参数列表被分成单独的批次时，“每个INSERT语句都会单独记录并传递给事件处理程序”<a href="#id43"><span class="problematic" id="id44">**</span></a>。这是与仅限于psycopg2的功能在SQLAlchemy 1.x系列中的工作方式的主要更改，其中多个INSERT语句的生成被隐藏在记录和事件之外。日志显示将截断参数的长列表以便于阅读，并且还将指示每个语句的特定批次。下面的示例说明了这种记录的摘录：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>INSERT INTO a (data, x, y) VALUES (?, ?, ?), ... 795 characters truncated ...  (?, ?, ?), (?, ?, ?) RETURNING id
[generated in 0.00177s (insertmanyvalues) 1/10 (unordered)] (&#39;d0&#39;, 0, 0, &#39;d1&#39;,  ...
INSERT INTO a (data, x, y) VALUES (?, ?, ?), ... 795 characters truncated ...  (?, ?, ?), (?, ?, ?) RETURNING id
[insertmanyvalues 2/10 (unordered)] (&#39;d100&#39;, 100, 1000, &#39;d101&#39;, ...

...

INSERT INTO a (data, x, y) VALUES (?, ?, ?), ... 795 characters truncated ...  (?, ?, ?), (?, ?, ?) RETURNING id
[insertmanyvalues 10/10 (unordered)] (&#39;d900&#39;, 900, 9000, &#39;d901&#39;, ...</pre></div>
</div>
<p>当进行 <a class="reference internal" href="#engine-insertmanyvalues-non-batch"><span class="std std-ref">非批处理模式</span></a> 时，日志将指示此操作与insertmanyvalues消息一起发生：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>...

INSERT INTO a (data, x, y) VALUES (?, ?, ?) RETURNING id
[insertmanyvalues 67/78 (ordered; batch not supported)] (&#39;d66&#39;, 66, 66)
INSERT INTO a (data, x, y) VALUES (?, ?, ?) RETURNING id
[insertmanyvalues 68/78 (ordered; batch not supported)] (&#39;d67&#39;, 67, 67)
INSERT INTO a (data, x, y) VALUES (?, ?, ?) RETURNING id
[insertmanyvalues 69/78 (ordered; batch not supported)] (&#39;d68&#39;, 68, 68)
INSERT INTO a (data, x, y) VALUES (?, ?, ?) RETURNING id
[insertmanyvalues 70/78 (ordered; batch not supported)] (&#39;d69&#39;, 69, 69)

...</pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><span class="xref std std-ref">dbengine_logging</span></p>
</div>
</section>
<section id="upsert-support">
<h3>Upsert Support<a class="headerlink" href="#upsert-support" title="Permalink to this heading">¶</a></h3>
<p>PostgreSQL、SQLite和MariaDB方言提供了特定于后端的“upsert”构造  <a class="reference internal" href="../dialects/postgresql.html#sqlalchemy.dialects.postgresql.insert" title="sqlalchemy.dialects.postgresql.insert"><code class="xref py py-func docutils literal notranslate"><span class="pre">insert()</span></code></a> 、  :func:` _sqlite.insert` ，它们均为 <a class="reference internal" href="dml.html#sqlalchemy.sql.expression.Insert" title="sqlalchemy.sql.expression.Insert"><code class="xref py py-class docutils literal notranslate"><span class="pre">Insert</span></code></a> 构造，具有另外的方法，如“on_conflict_do_update()”或“on_duplicate_key()”。当这些构造函数和RETURNING一起使用时，还支持“insertmanyvalues”行为，从而允许高效的upsert with RETURNING。</p>
</section>
</section>
<section id="engine-disposal">
<span id="id45"></span><h2>引擎处理<a class="headerlink" href="#engine-disposal" title="Permalink to this heading">¶</a></h2>
<blockquote>
<div><p><a class="reference internal" href="#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a> .QueuePool` 的正常默认池实现。</p>
<p><a class="reference internal" href="#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a> ._engine.Engine` ；相反，它是一个注册表，维护连接池以及关于正在使用的数据库和DBAPI的配置信息，以及一些程度的内部缓存。每个数据库资源的缓存。</p>
</div></blockquote>
<p>然而，有很多情况可以在全部关闭由  <a class="reference internal" href="#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a>  方法显式处理  :class:` _engine.Engine` 。这会处理引擎的底层连接池，并用空的连接池替换它。只要此时放弃了 <a class="reference internal" href="#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a> 并且不再使用它，则所有已检入的连接将完全关闭。</p>
<p>调用  <a class="reference internal" href="#sqlalchemy.engine.Engine.dispose" title="sqlalchemy.engine.Engine.dispose"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Engine.dispose()</span></code></a>  的有效用例包括：</p>
<ul class="simple">
<li><p>当程序想要释放连接池中仍存在的任何剩余检入连接，并且期望将来不再连接到该数据库以进行任何未来操作时。</p></li>
<li><p>当程序使用 multiprocessing 或“fork()”时，将  <a class="reference internal" href="#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a>  ，以便引擎创建专门针对该fork的全新数据库连接。通常情况下，数据库连接不会穿越进程边界。在这种情况下，在参数  :paramref:` .Engine.dispose.close`  设置为False。请参见 <span class="xref std std-ref">pooling_multiprocessing</span> 部分以获取有关此用例的更多背景知识。</p></li>
<li><p>在测试套件或多租户场景中，可能会创建许多临时的、短寿命的 <a class="reference internal" href="#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a> 对象，并进行处置。</p></li>
</ul>
<p>当引用的有  <a class="reference internal" href="#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a>  或垃圾回收时被丢弃，因为这些连接仍然在应用程序的其他地方被强烈引用。但是，在调用  :meth:` _engine.Engine.dispose`  后，这些连接不再与该  <a class="reference internal" href="#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a>  。</p>
<blockquote>
<div><p><a class="reference internal" href="#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a>  时不随之被释放，因为这些句柄仍然在应用程序的其他地方存在。如果您还有其他共享同一池的  :class:` _engine.Engine` ，请确保我们通过实际调用  <a class="reference internal" href="pooling.html#sqlalchemy.pool.QueuePool.dispose" title="sqlalchemy.pool.QueuePool.dispose"><code class="xref py py-meth docutils literal notranslate"><span class="pre">QueuePool.dispose()</span></code></a>  或其它方法释放废弃池中的连接。完全兼容DBAPI连接池</p>
</div></blockquote>
<hr class="docutils" />
<p>SQLAlchemy包含一个内置的连接池实现，它提供了对程序中使用的所有连接的管理。
这就避免了每次需要连接时都要重新创建连接的开销。默认情况下，连接池在连接
不再需要时并不会将其释放回DBAPI。相反，它们只是被返回给池中。这通常只会对
使用新连接产生一些轻微性能影响，并且意味着当连接签入时，它被完全关闭，
而不会在内存中保留。请参见  <a class="reference internal" href="pooling.html#pool-switching"><span class="std std-ref">切换连接池实现</span></a> 获取有关如何禁用池的指南。</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><span class="xref std std-ref">pooling_toplevel</span></p>
<p><span class="xref std std-ref">pooling_multiprocessing</span></p>
</div>
</section>
<section id="driver-sql-raw-dbapi-connections">
<span id="dbapi-connections"></span><h2>使用Driver SQL和 Raw DBAPI Connections 工作<a class="headerlink" href="#driver-sql-raw-dbapi-connections" title="Permalink to this heading">¶</a></h2>
<blockquote>
<div><p><a class="reference internal" href="#sqlalchemy.engine.Connection.execute" title="sqlalchemy.engine.Connection.execute"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.execute()</span></code></a>  方法的介绍使用了  :func:` _expression.text`</p>
</div></blockquote>
<p>构造以说明如何调用文本SQL语句。 使用SQLAlchemy时，文本SQL实际上更多的是
一个例外，而不是规则，因为Core表达式语言和ORM都抽象了SQL的文本表示。
然而， <a class="reference internal" href="sqlelement.html#sqlalchemy.sql.expression.text" title="sqlalchemy.sql.expression.text"><code class="xref py py-func docutils literal notranslate"><span class="pre">text()</span></code></a> 构造本身也提供了对文本SQL的抽象，因为它规范化了
如何传递绑定参数，并支持参数和结果集行的数据类型行为。</p>
<section id="id46">
<h3>直接向驱动程序调用SQL字符串<a class="headerlink" href="#id46" title="Permalink to this heading">¶</a></h3>
<p>对于需要直接传递给底层驱动程序（称为  <span class="xref std std-term">DBAPI</span>  ）的文本SQL的用例，
可以使用  <a class="reference internal" href="#sqlalchemy.engine.Connection.exec_driver_sql" title="sqlalchemy.engine.Connection.exec_driver_sql"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.exec_driver_sql()</span></code></a>  方法:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">engine</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">exec_driver_sql</span><span class="p">(</span><span class="s2">&quot;SET param=&#39;bar&#39;&quot;</span><span class="p">)</span></pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.4: </span>Added the  <a class="reference internal" href="#sqlalchemy.engine.Connection.exec_driver_sql" title="sqlalchemy.engine.Connection.exec_driver_sql"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.exec_driver_sql()</span></code></a>  method.</p>
</div>
</section>
<section id="dbapi-connections-cursor">
<span id="id47"></span><h3>直接与DBAPI游标交互<a class="headerlink" href="#dbapi-connections-cursor" title="Permalink to this heading">¶</a></h3>
<p>在某些情况下，SQLAlchemy无法提供一种通用的方式来访问一些  <span class="xref std std-term">DBAPI</span>  函数，
比如调用存储过程以及处理多个结果集。在这些情况下，直接使用原始的
DBAPI连接方法同样方便。</p>
<p>访问原始DBAPI连接的最常见方式是直接从已经存在的 <a class="reference internal" href="#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a> 对象
中获取它。它使用  <a class="reference internal" href="#sqlalchemy.engine.Connection.connection" title="sqlalchemy.engine.Connection.connection"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Connection.connection</span></code></a>  属性进行访问:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">connection</span> <span class="o">=</span> <span class="n">engine</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
<span class="n">dbapi_conn</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">connection</span></pre></div>
</div>
<p>在这里，DBAPI连接实际上是“代理”的，因为它们起始于连接池，但这是一个能够忽略的
实现细节。由于该DBAPI连接仍然包含在拥有的 <a class="reference internal" href="#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a> 对象的范围内，
因此最好使用 <a class="reference internal" href="#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a> 对象来进行大多数特性使用，
如事务控制以及调用  <a class="reference internal" href="#sqlalchemy.engine.Connection.close" title="sqlalchemy.engine.Connection.close"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.close()</span></code></a>  方法；如果在DBAPI连接上直接执行
这些操作，则拥有的 <a class="reference internal" href="#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a> 将不会知道这些状态的更改。</p>
<p>为了克服由拥有的 <a class="reference internal" href="#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a> 维护的DBAPI连接所施加的限制，
还有一种DBAPI连接可用，而不需要获取</p>
<blockquote>
<div><dl>
<dt><a class="reference internal" href="#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a> 首先使用 <a class="reference internal" href="#sqlalchemy.engine.Engine.raw_connection" title="sqlalchemy.engine.Engine.raw_connection"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Engine.raw_connection()</span></code></a> 方法</dt><dd><p><a class="reference internal" href="#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dbapi_conn</span> <span class="o">=</span> <span class="n">engine</span><span class="o">.</span><span class="n">raw_connection</span><span class="p">()</span></pre></div>
</div>
</dd>
</dl>
</div></blockquote>
<p>在这里，DBAPI连接再次是“代理”形式，如之前所述。这种代理的目的现在显而易见，
当我们调用``close()``这个连接的方法时，DBAPI连接通常并没有真正关闭，而是将其
：term:<a href="#id48"><span class="problematic" id="id49">`</span></a>released`回引擎的连接池。</p>
<blockquote>
<div><p>dbapi_conn.close()</p>
</div></blockquote>
<p>虽然在未来，SQLAlchemy可能会为更多的DBAPI用例添加内置模式，
但是这些用例往往很少使用，而且还高度依赖于使用的DBAPI类型，
因此在任何情况下，直接DBAPI调用模式总是存在于需要的情况下。</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../faq/connections.html#faq-dbapi-connection"><span class="std std-ref">使用Engine时如何获取原始的DBAPI连接？</span></a>  - 包括有关如何访问DBAPI连接以及使用asyncio驱动程序时的“驱动程序”连接的其他详细信息。</p>
</div>
<p>DBAPI连接使用的一些示例见下文。</p>
</section>
<section id="stored-procedures">
<span id="id50"></span><h3>调用存储过程和用户定义函数<a class="headerlink" href="#stored-procedures" title="Permalink to this heading">¶</a></h3>
<p>SQLAlchemy支持以多种方式调用存储过程和用户定义函数。
请注意，所有的DBAPI都有不同的做法，因此必须查阅底层DBAPI的文档以获得有关特定用法的详细信息。
以下示例是假设的，可能无法在您的底层DBAPI中使用。</p>
<p>对于具有特殊语法或参数问题的存储过程或函数，
可以使用DBAPI级别的`callproc &lt;<a class="reference external" href="https://legacy.python.org/dev/peps/pep-0249/#callproc">https://legacy.python.org/dev/peps/pep-0249/#callproc</a>&gt;`_
来使用您的DBAPI。此模式的示例如下:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">connection</span> <span class="o">=</span> <span class="n">engine</span><span class="o">.</span><span class="n">raw_connection</span><span class="p">()</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">cursor_obj</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
    <span class="n">cursor_obj</span><span class="o">.</span><span class="n">callproc</span><span class="p">(</span><span class="s2">&quot;my_procedure&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">])</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">list</span><span class="p">(</span><span class="n">cursor_obj</span><span class="o">.</span><span class="n">fetchall</span><span class="p">())</span>
    <span class="n">cursor_obj</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<span class="k">finally</span><span class="p">:</span>
    <span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>并非所有DBAPI都使用`callproc`，总体使用详情会有所不同。上面的示例仅说明了如何使用特定的DBAPI函数。</p>
</div>
<p>您的DBAPI可能没有``callproc``要求，或者可能要求以另一种模式（例如使用普通的SQLAlchemy连接使用）来调用存储过程或用户定义函数。在编写本文档时，例如用psycopg2 DBAPI在PostgreSQL数据库中执行存储过程应该使用普通连接使用:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">connection</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;CALL my_procedure();&quot;</span><span class="p">)</span></pre></div>
</div>
<p>以上示例是假设性的。底层数据库不保证在这些情况下支持“CALL”或“SELECT”，关键字可能因存储过程或用户定义函数而异。在这些情况下，您应查阅底层DBAPI和数据库文档，以确定要使用的正确语法和模式。</p>
</section>
<section id="id51">
<h3>多个结果集<a class="headerlink" href="#id51" title="Permalink to this heading">¶</a></h3>
<p>从原始的DBAPI游标可以使用’nextset &lt;<a class="reference external" href="https://legacy.python.org/dev/peps/pep-0249/#nextset">https://legacy.python.org/dev/peps/pep-0249/#nextset</a>&gt;`_方法支持多个结果集:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">connection</span> <span class="o">=</span> <span class="n">engine</span><span class="o">.</span><span class="n">raw_connection</span><span class="p">()</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">cursor_obj</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
    <span class="n">cursor_obj</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;select * from table1; select * from table2&quot;</span><span class="p">)</span>
    <span class="n">results_one</span> <span class="o">=</span> <span class="n">cursor_obj</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
    <span class="n">cursor_obj</span><span class="o">.</span><span class="n">nextset</span><span class="p">()</span>
    <span class="n">results_two</span> <span class="o">=</span> <span class="n">cursor_obj</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
    <span class="n">cursor_obj</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="k">finally</span><span class="p">:</span>
    <span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></pre></div>
</div>
</section>
</section>
<section id="id52">
<h2>注册新方言<a class="headerlink" href="#id52" title="Permalink to this heading">¶</a></h2>
<blockquote>
<div><p><code class="xref py py-func docutils literal notranslate"><span class="pre">create_engine()</span></code> 函数调用会使用setuptools entrypoints查找给定方言。</p>
</div></blockquote>
<p>这些条目可以在setup.py脚本中为第三方方言建立。
例如，要创建一个新的方言”foodialect：//”，步骤如下：</p>
<ol class="arabic">
<li><p>创建一个名为“foodialect”的包。</p></li>
<li><p>该包应具有包含方言类的模块，通常是 <a class="reference internal" href="internals.html#sqlalchemy.engine.default.DefaultDialect" title="sqlalchemy.engine.default.DefaultDialect"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.engine.default.DefaultDialect</span></code></a> 的子类。在这个例子中，我们假设它叫做“FooDialect”，并且它的模块是通过“foodialect.dialect”访问的。</p></li>
<li><p>可以在“setup.cfg”中这样建立条目：</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[options.entry_points]</span>
<span class="na">sqlalchemy.dialects</span><span class="w"> </span><span class="o">=</span>
<span class="w">    </span><span class="na">foodialect</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">foodialect.dialect:FooDialect</span></pre></div>
</div>
<p>如果方言为特定的DBAPI提供了对已支持的SQLAlchemy支持的数据库的支持，
则可以给出名称，包括数据库资格。例如，如果“FooDialect”实际上是MySQL方言，则可以这样建立条目：</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[options.entry_points]</span>
<span class="na">sqlalchemy.dialects</span>
<span class="w">    </span><span class="na">mysql.foodialect</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">foodialect.dialect:FooDialect</span></pre></div>
</div>
<p>上述入口点将在使用 <code class="docutils literal notranslate"><span class="pre">create_engine(&quot;mysql+foodialect://&quot;)</span></code> 时被访问。</p>
</li>
</ol>
<section id="id53">
<h3>在进程中注册方言<a class="headerlink" href="#id53" title="Permalink to this heading">¶</a></h3>
<p>SQLAlchemy还允许在当前进程中注册方言，绕过需要单独安装的要求。使用 <code class="docutils literal notranslate"><span class="pre">register()</span></code> 函数如下:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy.dialects</span> <span class="kn">import</span> <span class="n">registry</span>


<span class="n">registry</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s2">&quot;mysql.foodialect&quot;</span><span class="p">,</span> <span class="s2">&quot;myapp.dialect&quot;</span><span class="p">,</span> <span class="s2">&quot;MyMySQLDialect&quot;</span><span class="p">)</span></pre></div>
</div>
<p>上述内容将响应 <code class="docutils literal notranslate"><span class="pre">create_engine(&quot;mysql+foodialect://&quot;)</span></code> 并从 <code class="docutils literal notranslate"><span class="pre">myapp.dialect</span></code> 模块加载 <code class="docutils literal notranslate"><span class="pre">MyMySQLDialect</span></code> 类。</p>
</section>
</section>
<section id="api">
<h2>连接/引擎API<a class="headerlink" href="#api" title="Permalink to this heading">¶</a></h2>
<table class="longtable docutils align-default">
<thead>
<tr class="row-odd"><th class="head">Object Name</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.engine.Connection"><span class="sig-name descname">Connection</span></a></p></td>
<td><p>Provides high-level functionality for a wrapped DB-API connection.</p></td>
</tr>
<tr class="row-odd"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.engine.CreateEnginePlugin"><span class="sig-name descname">CreateEnginePlugin</span></a></p></td>
<td><p>A set of hooks intended to augment the construction of an
<a class="reference internal" href="#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a> object based on entrypoint names in a URL.</p></td>
</tr>
<tr class="row-even"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.engine.Engine"><span class="sig-name descname">Engine</span></a></p></td>
<td><p>Connects a <a class="reference internal" href="pooling.html#sqlalchemy.pool.Pool" title="sqlalchemy.pool.Pool"><code class="xref py py-class docutils literal notranslate"><span class="pre">Pool</span></code></a> and
<a class="reference internal" href="internals.html#sqlalchemy.engine.Dialect" title="sqlalchemy.engine.interfaces.Dialect"><code class="xref py py-class docutils literal notranslate"><span class="pre">Dialect</span></code></a> together to provide a
source of database connectivity and behavior.</p></td>
</tr>
<tr class="row-odd"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.engine.ExceptionContext"><span class="sig-name descname">ExceptionContext</span></a></p></td>
<td><p>Encapsulate information about an error condition in progress.</p></td>
</tr>
<tr class="row-even"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.engine.NestedTransaction"><span class="sig-name descname">NestedTransaction</span></a></p></td>
<td><p>Represent a ‘nested’, or SAVEPOINT transaction.</p></td>
</tr>
<tr class="row-odd"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.engine.RootTransaction"><span class="sig-name descname">RootTransaction</span></a></p></td>
<td><p>Represent the “root” transaction on a <a class="reference internal" href="#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a>.</p></td>
</tr>
<tr class="row-even"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.engine.Transaction"><span class="sig-name descname">Transaction</span></a></p></td>
<td><p>Represent a database transaction in progress.</p></td>
</tr>
<tr class="row-odd"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.engine.TwoPhaseTransaction"><span class="sig-name descname">TwoPhaseTransaction</span></a></p></td>
<td><p>Represent a two-phase transaction.</p></td>
</tr>
</tbody>
</table>
<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.engine.Connection">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.engine.</span></span><span class="sig-name descname"><span class="pre">Connection</span></span><a class="headerlink" href="#sqlalchemy.engine.Connection" title="Permalink to this definition">¶</a></dt>
<dd><p>Provides high-level functionality for a wrapped DB-API connection.</p>
<p>The <a class="reference internal" href="#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a> object is procured by calling the
<a class="reference internal" href="#sqlalchemy.engine.Engine.connect" title="sqlalchemy.engine.Engine.connect"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Engine.connect()</span></code></a> method of the <a class="reference internal" href="#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a>
object, and provides services for execution of SQL statements as well
as transaction control.</p>
<p>The Connection object is <strong>not</strong> thread-safe. While a Connection can be
shared among threads using properly synchronized access, it is still
possible that the underlying DBAPI connection may not support shared
access between threads. Check the DBAPI documentation for details.</p>
<div class="class-members docutils container">
<p><strong>Members</strong></p>
<p><a class="reference internal" href="#sqlalchemy.engine.Connection.__init__"><span class="sig-name descname">__init__()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.Connection.begin"><span class="sig-name descname">begin()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.Connection.begin_nested"><span class="sig-name descname">begin_nested()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.Connection.begin_twophase"><span class="sig-name descname">begin_twophase()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.Connection.close"><span class="sig-name descname">close()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.Connection.closed"><span class="sig-name descname">closed</span></a>, <a class="reference internal" href="#sqlalchemy.engine.Connection.commit"><span class="sig-name descname">commit()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.Connection.connection"><span class="sig-name descname">connection</span></a>, <a class="reference internal" href="#sqlalchemy.engine.Connection.default_isolation_level"><span class="sig-name descname">default_isolation_level</span></a>, <a class="reference internal" href="#sqlalchemy.engine.Connection.detach"><span class="sig-name descname">detach()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.Connection.exec_driver_sql"><span class="sig-name descname">exec_driver_sql()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.Connection.execute"><span class="sig-name descname">execute()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.Connection.execution_options"><span class="sig-name descname">execution_options()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.Connection.get_execution_options"><span class="sig-name descname">get_execution_options()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.Connection.get_isolation_level"><span class="sig-name descname">get_isolation_level()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.Connection.get_nested_transaction"><span class="sig-name descname">get_nested_transaction()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.Connection.get_transaction"><span class="sig-name descname">get_transaction()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.Connection.in_nested_transaction"><span class="sig-name descname">in_nested_transaction()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.Connection.in_transaction"><span class="sig-name descname">in_transaction()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.Connection.info"><span class="sig-name descname">info</span></a>, <a class="reference internal" href="#sqlalchemy.engine.Connection.invalidate"><span class="sig-name descname">invalidate()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.Connection.invalidated"><span class="sig-name descname">invalidated</span></a>, <a class="reference internal" href="#sqlalchemy.engine.Connection.rollback"><span class="sig-name descname">rollback()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.Connection.scalar"><span class="sig-name descname">scalar()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.Connection.scalars"><span class="sig-name descname">scalars()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.Connection.schema_for_object"><span class="sig-name descname">schema_for_object()</span></a></p>
</div>
<p>The Connection object represents a single DBAPI connection checked out
from the connection pool. In this state, the connection pool has no
affect upon the connection, including its expiration or timeout state.
For the connection pool to properly manage connections, connections
should be returned to the connection pool (i.e. <code class="docutils literal notranslate"><span class="pre">connection.close()</span></code>)
whenever the connection is not in use.</p>
<div class="class-bases docutils container" id="index-0">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.engine.Connection</span></code></a> (<code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.engine.interfaces.ConnectionEventsTarget</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.inspection.Inspectable</span></code>)</p>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.Connection.__init__">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.Connection"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.Connection.</span></code></a><span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">engine</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><span class="pre">Engine</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">connection</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="pooling.html#sqlalchemy.pool.PoolProxiedConnection" title="sqlalchemy.pool.PoolProxiedConnection"><span class="pre">PoolProxiedConnection</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">_has_events</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">_allow_revalidate</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">_allow_autobegin</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.engine.Connection.__init__" title="Permalink to this definition">¶</a></dt>
<dd><p>Construct a new Connection.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.Connection.begin">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.Connection"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.Connection.</span></code></a><span class="sig-name descname"><span class="pre">begin</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#sqlalchemy.engine.RootTransaction" title="sqlalchemy.engine.base.RootTransaction"><span class="pre">RootTransaction</span></a></span></span><a class="headerlink" href="#sqlalchemy.engine.Connection.begin" title="Permalink to this definition">¶</a></dt>
<dd><p>Begin a transaction prior to autobegin occurring.</p>
<p>E.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">engine</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">begin</span><span class="p">()</span> <span class="k">as</span> <span class="n">trans</span><span class="p">:</span>
        <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">insert</span><span class="p">(),</span> <span class="p">{</span><span class="s2">&quot;username&quot;</span><span class="p">:</span> <span class="s2">&quot;sandy&quot;</span><span class="p">})</span></pre></div>
</div>
<p>The returned object is an instance of <a class="reference internal" href="#sqlalchemy.engine.RootTransaction" title="sqlalchemy.engine.RootTransaction"><code class="xref py py-class docutils literal notranslate"><span class="pre">RootTransaction</span></code></a>.
This object represents the “scope” of the transaction,
which completes when either the <a class="reference internal" href="#sqlalchemy.engine.Transaction.rollback" title="sqlalchemy.engine.Transaction.rollback"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Transaction.rollback()</span></code></a>
or <a class="reference internal" href="#sqlalchemy.engine.Transaction.commit" title="sqlalchemy.engine.Transaction.commit"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Transaction.commit()</span></code></a> method is called; the object
also works as a context manager as illustrated above.</p>
<p>The <a class="reference internal" href="#sqlalchemy.engine.Connection.begin" title="sqlalchemy.engine.Connection.begin"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.begin()</span></code></a> method begins a
transaction that normally will be begun in any case when the connection
is first used to execute a statement.  The reason this method might be
used would be to invoke the <a class="reference internal" href="events.html#sqlalchemy.events.ConnectionEvents.begin" title="sqlalchemy.events.ConnectionEvents.begin"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ConnectionEvents.begin()</span></code></a>
event at a specific time, or to organize code within the scope of a
connection checkout in terms of context managed blocks, such as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">engine</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">begin</span><span class="p">():</span>
        <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
        <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">begin</span><span class="p">():</span>
        <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
        <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="o">...</span><span class="p">)</span></pre></div>
</div>
<p>The above code is not  fundamentally any different in its behavior than
the following code  which does not use
<a class="reference internal" href="#sqlalchemy.engine.Connection.begin" title="sqlalchemy.engine.Connection.begin"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.begin()</span></code></a>; the below style is referred towards
as “commit as you go” style:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">engine</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

    <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span></pre></div>
</div>
<p>From a database point of view, the <a class="reference internal" href="#sqlalchemy.engine.Connection.begin" title="sqlalchemy.engine.Connection.begin"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.begin()</span></code></a>
method does not emit any SQL or change the state of the underlying
DBAPI connection in any way; the Python DBAPI does not have any
concept of explicit transaction begin.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../tutorial/dbapi_transactions.html#tutorial-working-with-transactions"><span class="std std-ref">使用事务和DBAPI</span></a> - in the
<a class="reference internal" href="../tutorial/index.html#unified-tutorial"><span class="std std-ref">SQLAlchemy统一教程</span></a></p>
<p><a class="reference internal" href="#sqlalchemy.engine.Connection.begin_nested" title="sqlalchemy.engine.Connection.begin_nested"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.begin_nested()</span></code></a> - use a SAVEPOINT</p>
<p><a class="reference internal" href="#sqlalchemy.engine.Connection.begin_twophase" title="sqlalchemy.engine.Connection.begin_twophase"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.begin_twophase()</span></code></a> -
use a two phase /XID transaction</p>
<p><a class="reference internal" href="#sqlalchemy.engine.Engine.begin" title="sqlalchemy.engine.Engine.begin"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Engine.begin()</span></code></a> - context manager available from
<a class="reference internal" href="#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.Connection.begin_nested">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.Connection"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.Connection.</span></code></a><span class="sig-name descname"><span class="pre">begin_nested</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#sqlalchemy.engine.NestedTransaction" title="sqlalchemy.engine.base.NestedTransaction"><span class="pre">NestedTransaction</span></a></span></span><a class="headerlink" href="#sqlalchemy.engine.Connection.begin_nested" title="Permalink to this definition">¶</a></dt>
<dd><p>Begin a nested transaction (i.e. SAVEPOINT) and return a transaction
handle that controls the scope of the SAVEPOINT.</p>
<p>E.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">engine</span><span class="o">.</span><span class="n">begin</span><span class="p">()</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">connection</span><span class="o">.</span><span class="n">begin_nested</span><span class="p">():</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">insert</span><span class="p">(),</span> <span class="p">{</span><span class="s2">&quot;username&quot;</span><span class="p">:</span> <span class="s2">&quot;sandy&quot;</span><span class="p">})</span></pre></div>
</div>
<p>The returned object is an instance of
<a class="reference internal" href="#sqlalchemy.engine.NestedTransaction" title="sqlalchemy.engine.NestedTransaction"><code class="xref py py-class docutils literal notranslate"><span class="pre">NestedTransaction</span></code></a>, which includes transactional
methods <a class="reference internal" href="#sqlalchemy.engine.NestedTransaction.commit" title="sqlalchemy.engine.NestedTransaction.commit"><code class="xref py py-meth docutils literal notranslate"><span class="pre">NestedTransaction.commit()</span></code></a> and
<a class="reference internal" href="#sqlalchemy.engine.NestedTransaction.rollback" title="sqlalchemy.engine.NestedTransaction.rollback"><code class="xref py py-meth docutils literal notranslate"><span class="pre">NestedTransaction.rollback()</span></code></a>; for a nested transaction,
these methods correspond to the operations “RELEASE SAVEPOINT &lt;name&gt;”
and “ROLLBACK TO SAVEPOINT &lt;name&gt;”. The name of the savepoint is local
to the <a class="reference internal" href="#sqlalchemy.engine.NestedTransaction" title="sqlalchemy.engine.NestedTransaction"><code class="xref py py-class docutils literal notranslate"><span class="pre">NestedTransaction</span></code></a> object and is generated
automatically. Like any other <a class="reference internal" href="#sqlalchemy.engine.Transaction" title="sqlalchemy.engine.Transaction"><code class="xref py py-class docutils literal notranslate"><span class="pre">Transaction</span></code></a>, the
<a class="reference internal" href="#sqlalchemy.engine.NestedTransaction" title="sqlalchemy.engine.NestedTransaction"><code class="xref py py-class docutils literal notranslate"><span class="pre">NestedTransaction</span></code></a> may be used as a context manager as
illustrated above which will “release” or “rollback” corresponding to
if the operation within the block were successful or raised an
exception.</p>
<p>Nested transactions require SAVEPOINT support in the underlying
database, else the behavior is undefined. SAVEPOINT is commonly used to
run operations within a transaction that may fail, while continuing the
outer transaction. E.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">exc</span>

<span class="k">with</span> <span class="n">engine</span><span class="o">.</span><span class="n">begin</span><span class="p">()</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
    <span class="n">trans</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">begin_nested</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">insert</span><span class="p">(),</span> <span class="p">{</span><span class="s2">&quot;username&quot;</span><span class="p">:</span> <span class="s2">&quot;sandy&quot;</span><span class="p">})</span>
        <span class="n">trans</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
    <span class="k">except</span> <span class="n">exc</span><span class="o">.</span><span class="n">IntegrityError</span><span class="p">:</span>  <span class="c1"># catch for duplicate username</span>
        <span class="n">trans</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>  <span class="c1"># rollback to savepoint</span>

    <span class="c1"># outer transaction continues</span>
    <span class="n">connection</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span> <span class="o">...</span> <span class="p">)</span></pre></div>
</div>
<p>If <a class="reference internal" href="#sqlalchemy.engine.Connection.begin_nested" title="sqlalchemy.engine.Connection.begin_nested"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.begin_nested()</span></code></a> is called without first
calling <a class="reference internal" href="#sqlalchemy.engine.Connection.begin" title="sqlalchemy.engine.Connection.begin"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.begin()</span></code></a> or
<a class="reference internal" href="#sqlalchemy.engine.Engine.begin" title="sqlalchemy.engine.Engine.begin"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Engine.begin()</span></code></a>, the <a class="reference internal" href="#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a> object
will “autobegin” the outer transaction first. This outer transaction
may be committed using “commit-as-you-go” style, e.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">engine</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>  <span class="c1"># begin() wasn&#39;t called</span>

    <span class="k">with</span> <span class="n">connection</span><span class="o">.</span><span class="n">begin_nested</span><span class="p">():</span> <span class="n">will</span> <span class="n">auto</span><span class="o">-</span><span class="s2">&quot;begin()&quot;</span> <span class="n">first</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span> <span class="o">...</span> <span class="p">)</span>
    <span class="c1"># savepoint is released</span>

    <span class="n">connection</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span> <span class="o">...</span> <span class="p">)</span>

    <span class="c1"># explicitly commit outer transaction</span>
    <span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

    <span class="c1"># can continue working with connection here</span></pre></div>
</div>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 2.0: </span><a class="reference internal" href="#sqlalchemy.engine.Connection.begin_nested" title="sqlalchemy.engine.Connection.begin_nested"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.begin_nested()</span></code></a> will now participate
in the connection “autobegin” behavior that is new as of
2.0 / “future” style connections in 1.4.</p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#sqlalchemy.engine.Connection.begin" title="sqlalchemy.engine.Connection.begin"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.begin()</span></code></a></p>
<p><a class="reference internal" href="../orm/session_transaction.html#session-begin-nested"><span class="std std-ref">使用 SAVEPOINT</span></a> - ORM support for SAVEPOINT</p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.Connection.begin_twophase">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.Connection"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.Connection.</span></code></a><span class="sig-name descname"><span class="pre">begin_twophase</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">xid</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#sqlalchemy.engine.TwoPhaseTransaction" title="sqlalchemy.engine.base.TwoPhaseTransaction"><span class="pre">TwoPhaseTransaction</span></a></span></span><a class="headerlink" href="#sqlalchemy.engine.Connection.begin_twophase" title="Permalink to this definition">¶</a></dt>
<dd><p>Begin a two-phase or XA transaction and return a transaction
handle.</p>
<p>The returned object is an instance of <a class="reference internal" href="#sqlalchemy.engine.TwoPhaseTransaction" title="sqlalchemy.engine.TwoPhaseTransaction"><code class="xref py py-class docutils literal notranslate"><span class="pre">TwoPhaseTransaction</span></code></a>,
which in addition to the methods provided by
<a class="reference internal" href="#sqlalchemy.engine.Transaction" title="sqlalchemy.engine.Transaction"><code class="xref py py-class docutils literal notranslate"><span class="pre">Transaction</span></code></a>, also provides a
<a class="reference internal" href="#sqlalchemy.engine.TwoPhaseTransaction.prepare" title="sqlalchemy.engine.TwoPhaseTransaction.prepare"><code class="xref py py-meth docutils literal notranslate"><span class="pre">TwoPhaseTransaction.prepare()</span></code></a> method.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><span class="target" id="sqlalchemy.engine.Connection.begin_twophase.params.xid"></span><strong>xid</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.engine.Connection.begin_twophase.params.xid">¶</a> – the two phase transaction id.  If not supplied, a
random id will be generated.</p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#sqlalchemy.engine.Connection.begin" title="sqlalchemy.engine.Connection.begin"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.begin()</span></code></a></p>
<p><a class="reference internal" href="#sqlalchemy.engine.Connection.begin_twophase" title="sqlalchemy.engine.Connection.begin_twophase"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.begin_twophase()</span></code></a></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.Connection.close">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.Connection"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.Connection.</span></code></a><span class="sig-name descname"><span class="pre">close</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.engine.Connection.close" title="Permalink to this definition">¶</a></dt>
<dd><p>Close this <a class="reference internal" href="#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a>.</p>
<p>This results in a release of the underlying database
resources, that is, the DBAPI connection referenced
internally. The DBAPI connection is typically restored
back to the connection-holding <a class="reference internal" href="pooling.html#sqlalchemy.pool.Pool" title="sqlalchemy.pool.Pool"><code class="xref py py-class docutils literal notranslate"><span class="pre">Pool</span></code></a> referenced
by the <a class="reference internal" href="#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a> that produced this
<a class="reference internal" href="#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a>. Any transactional state present on
the DBAPI connection is also unconditionally released via
the DBAPI connection’s <code class="docutils literal notranslate"><span class="pre">rollback()</span></code> method, regardless
of any <a class="reference internal" href="#sqlalchemy.engine.Transaction" title="sqlalchemy.engine.Transaction"><code class="xref py py-class docutils literal notranslate"><span class="pre">Transaction</span></code></a> object that may be
outstanding with regards to this <a class="reference internal" href="#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a>.</p>
<p>This has the effect of also calling <a class="reference internal" href="#sqlalchemy.engine.Connection.rollback" title="sqlalchemy.engine.Connection.rollback"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.rollback()</span></code></a>
if any transaction is in place.</p>
<p>After <a class="reference internal" href="#sqlalchemy.engine.Connection.close" title="sqlalchemy.engine.Connection.close"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.close()</span></code></a> is called, the
<a class="reference internal" href="#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a> is permanently in a closed state,
and will allow no further operations.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.engine.Connection.closed">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.engine.Connection"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.Connection.</span></code></a><span class="sig-name descname"><span class="pre">closed</span></span><a class="headerlink" href="#sqlalchemy.engine.Connection.closed" title="Permalink to this definition">¶</a></dt>
<dd><p>Return True if this connection is closed.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.Connection.commit">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.Connection"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.Connection.</span></code></a><span class="sig-name descname"><span class="pre">commit</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.engine.Connection.commit" title="Permalink to this definition">¶</a></dt>
<dd><p>Commit the transaction that is currently in progress.</p>
<p>This method commits the current transaction if one has been started.
If no transaction was started, the method has no effect, assuming
the connection is in a non-invalidated state.</p>
<p>A transaction is begun on a <a class="reference internal" href="#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a> automatically
whenever a statement is first executed, or when the
<a class="reference internal" href="#sqlalchemy.engine.Connection.begin" title="sqlalchemy.engine.Connection.begin"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.begin()</span></code></a> method is called.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <a class="reference internal" href="#sqlalchemy.engine.Connection.commit" title="sqlalchemy.engine.Connection.commit"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.commit()</span></code></a> method only acts upon
the primary database transaction that is linked to the
<a class="reference internal" href="#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a> object.  It does not operate upon a
SAVEPOINT that would have been invoked from the
<a class="reference internal" href="#sqlalchemy.engine.Connection.begin_nested" title="sqlalchemy.engine.Connection.begin_nested"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.begin_nested()</span></code></a> method; for control of a
SAVEPOINT, call <a class="reference internal" href="#sqlalchemy.engine.NestedTransaction.commit" title="sqlalchemy.engine.NestedTransaction.commit"><code class="xref py py-meth docutils literal notranslate"><span class="pre">NestedTransaction.commit()</span></code></a> on the
<a class="reference internal" href="#sqlalchemy.engine.NestedTransaction" title="sqlalchemy.engine.NestedTransaction"><code class="xref py py-class docutils literal notranslate"><span class="pre">NestedTransaction</span></code></a> that is returned by the
<a class="reference internal" href="#sqlalchemy.engine.Connection.begin_nested" title="sqlalchemy.engine.Connection.begin_nested"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.begin_nested()</span></code></a> method itself.</p>
</div>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.engine.Connection.connection">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.engine.Connection"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.Connection.</span></code></a><span class="sig-name descname"><span class="pre">connection</span></span><a class="headerlink" href="#sqlalchemy.engine.Connection.connection" title="Permalink to this definition">¶</a></dt>
<dd><p>The underlying DB-API connection managed by this Connection.</p>
<p>This is a SQLAlchemy connection-pool proxied connection
which then has the attribute
<code class="xref py py-attr docutils literal notranslate"><span class="pre">_ConnectionFairy.dbapi_connection</span></code> that refers to the
actual driver connection.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#dbapi-connections"><span class="std std-ref">使用Driver SQL和 Raw DBAPI Connections 工作</span></a></p>
</div>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.engine.Connection.default_isolation_level">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.engine.Connection"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.Connection.</span></code></a><span class="sig-name descname"><span class="pre">default_isolation_level</span></span><a class="headerlink" href="#sqlalchemy.engine.Connection.default_isolation_level" title="Permalink to this definition">¶</a></dt>
<dd><p>The initial-connection time isolation level associated with the
<a class="reference internal" href="internals.html#sqlalchemy.engine.Dialect" title="sqlalchemy.engine.Dialect"><code class="xref py py-class docutils literal notranslate"><span class="pre">Dialect</span></code></a> in use.</p>
<p>This value is independent of the
<a class="reference internal" href="#sqlalchemy.engine.Connection.execution_options.params.isolation_level" title="sqlalchemy.engine.Connection.execution_options"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Connection.execution_options.isolation_level</span></code></a> and
<a class="reference internal" href="#sqlalchemy.engine.Engine.execution_options.params.isolation_level" title="sqlalchemy.engine.Engine.execution_options"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Engine.execution_options.isolation_level</span></code></a> execution
options, and is determined by the <a class="reference internal" href="internals.html#sqlalchemy.engine.Dialect" title="sqlalchemy.engine.Dialect"><code class="xref py py-class docutils literal notranslate"><span class="pre">Dialect</span></code></a> when the
first connection is created, by performing a SQL query against the
database for the current isolation level before any additional commands
have been emitted.</p>
<p>Calling this accessor does not invoke any new SQL queries.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#sqlalchemy.engine.Connection.get_isolation_level" title="sqlalchemy.engine.Connection.get_isolation_level"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.get_isolation_level()</span></code></a>
- view current actual isolation level</p>
<p><code class="xref py py-paramref docutils literal notranslate"><span class="pre">create_engine.isolation_level</span></code>
- set per <a class="reference internal" href="#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a> isolation level</p>
<p><a class="reference internal" href="#sqlalchemy.engine.Connection.execution_options.params.isolation_level" title="sqlalchemy.engine.Connection.execution_options"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Connection.execution_options.isolation_level</span></code></a>
- set per <a class="reference internal" href="#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a> isolation level</p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.Connection.detach">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.Connection"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.Connection.</span></code></a><span class="sig-name descname"><span class="pre">detach</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.engine.Connection.detach" title="Permalink to this definition">¶</a></dt>
<dd><p>Detach the underlying DB-API connection from its connection pool.</p>
<p>E.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">engine</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">text</span><span class="p">(</span><span class="s2">&quot;SET search_path TO schema1, schema2&quot;</span><span class="p">))</span>

    <span class="c1"># work with connection</span>

<span class="c1"># connection is fully closed (since we used &quot;with:&quot;, can</span>
<span class="c1"># also call .close())</span></pre></div>
</div>
<p>This <a class="reference internal" href="#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a> instance will remain usable.
When closed
(or exited from a context manager context as above),
the DB-API connection will be literally closed and not
returned to its originating pool.</p>
<p>This method can be used to insulate the rest of an application
from a modified state on a connection (such as a transaction
isolation level or similar).</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.Connection.exec_driver_sql">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.Connection"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.Connection.</span></code></a><span class="sig-name descname"><span class="pre">exec_driver_sql</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">statement</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">parameters</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_DBAPIAnyExecuteParams</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">execution_options</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">CoreExecuteOptionsParameter</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#sqlalchemy.engine.CursorResult" title="sqlalchemy.engine.CursorResult"><span class="pre">CursorResult</span></a><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#sqlalchemy.engine.Connection.exec_driver_sql" title="Permalink to this definition">¶</a></dt>
<dd><p>Executes a string SQL statement on the DBAPI cursor directly,
without any SQL compilation steps.</p>
<p>This can be used to pass any string directly to the
<code class="docutils literal notranslate"><span class="pre">cursor.execute()</span></code> method of the DBAPI in use.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.engine.Connection.exec_driver_sql.params.statement"></span><strong>statement</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.engine.Connection.exec_driver_sql.params.statement">¶</a> – The statement str to be executed.   Bound parameters
must use the underlying DBAPI’s paramstyle, such as “qmark”,
“pyformat”, “format”, etc.</p></li>
<li><p><span class="target" id="sqlalchemy.engine.Connection.exec_driver_sql.params.parameters"></span><strong>parameters</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.engine.Connection.exec_driver_sql.params.parameters">¶</a> – represent bound parameter values to be used in the
execution.  The format is one of:   a dictionary of named parameters,
a tuple of positional parameters, or a list containing either
dictionaries or tuples for multiple-execute support.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><p>a <a class="reference internal" href="#sqlalchemy.engine.CursorResult" title="sqlalchemy.engine.CursorResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">CursorResult</span></code></a>.</p>
<p>E.g. multiple dictionaries:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">conn</span><span class="o">.</span><span class="n">exec_driver_sql</span><span class="p">(</span>
    <span class="s2">&quot;INSERT INTO table (id, value) VALUES (</span><span class="si">%(id)s</span><span class="s2">, </span><span class="si">%(value)s</span><span class="s2">)&quot;</span><span class="p">,</span>
    <span class="p">[{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span><span class="s2">&quot;v1&quot;</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span><span class="s2">&quot;v2&quot;</span><span class="p">}]</span>
<span class="p">)</span></pre></div>
</div>
<p>Single dictionary:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">conn</span><span class="o">.</span><span class="n">exec_driver_sql</span><span class="p">(</span>
    <span class="s2">&quot;INSERT INTO table (id, value) VALUES (</span><span class="si">%(id)s</span><span class="s2">, </span><span class="si">%(value)s</span><span class="s2">)&quot;</span><span class="p">,</span>
    <span class="n">dict</span><span class="p">(</span><span class="n">id</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;v1&quot;</span><span class="p">)</span>
<span class="p">)</span></pre></div>
</div>
<p>Single tuple:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">conn</span><span class="o">.</span><span class="n">exec_driver_sql</span><span class="p">(</span>
    <span class="s2">&quot;INSERT INTO table (id, value) VALUES (?, ?)&quot;</span><span class="p">,</span>
    <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;v1&#39;</span><span class="p">)</span>
<span class="p">)</span></pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <a class="reference internal" href="#sqlalchemy.engine.Connection.exec_driver_sql" title="sqlalchemy.engine.Connection.exec_driver_sql"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.exec_driver_sql()</span></code></a> method does
not participate in the
<a class="reference internal" href="events.html#sqlalchemy.events.ConnectionEvents.before_execute" title="sqlalchemy.events.ConnectionEvents.before_execute"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ConnectionEvents.before_execute()</span></code></a> and
<a class="reference internal" href="events.html#sqlalchemy.events.ConnectionEvents.after_execute" title="sqlalchemy.events.ConnectionEvents.after_execute"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ConnectionEvents.after_execute()</span></code></a> events.   To
intercept calls to <a class="reference internal" href="#sqlalchemy.engine.Connection.exec_driver_sql" title="sqlalchemy.engine.Connection.exec_driver_sql"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.exec_driver_sql()</span></code></a>, use
<a class="reference internal" href="events.html#sqlalchemy.events.ConnectionEvents.before_cursor_execute" title="sqlalchemy.events.ConnectionEvents.before_cursor_execute"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ConnectionEvents.before_cursor_execute()</span></code></a> and
<a class="reference internal" href="events.html#sqlalchemy.events.ConnectionEvents.after_cursor_execute" title="sqlalchemy.events.ConnectionEvents.after_cursor_execute"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ConnectionEvents.after_cursor_execute()</span></code></a>.</p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><span class="target" id="index-1"></span><a class="pep reference external" href="https://peps.python.org/pep-0249/"><strong>PEP 249</strong></a></p>
</div>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.Connection.execute">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.Connection"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.Connection.</span></code></a><span class="sig-name descname"><span class="pre">execute</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">statement</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="selectable.html#sqlalchemy.sql.expression.Executable" title="sqlalchemy.sql.expression.Executable"><span class="pre">Executable</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">parameters</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_CoreAnyExecuteParams</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">execution_options</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">CoreExecuteOptionsParameter</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#sqlalchemy.engine.CursorResult" title="sqlalchemy.engine.CursorResult"><span class="pre">CursorResult</span></a><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#sqlalchemy.engine.Connection.execute" title="Permalink to this definition">¶</a></dt>
<dd><p>Executes a SQL statement construct and returns a
<a class="reference internal" href="#sqlalchemy.engine.CursorResult" title="sqlalchemy.engine.CursorResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">CursorResult</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.engine.Connection.execute.params.statement"></span><strong>statement</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.engine.Connection.execute.params.statement">¶</a> – <p>The statement to be executed.  This is always
an object that is in both the <a class="reference internal" href="foundation.html#sqlalchemy.sql.expression.ClauseElement" title="sqlalchemy.sql.expression.ClauseElement"><code class="xref py py-class docutils literal notranslate"><span class="pre">ClauseElement</span></code></a> and
<a class="reference internal" href="selectable.html#sqlalchemy.sql.expression.Executable" title="sqlalchemy.sql.expression.Executable"><code class="xref py py-class docutils literal notranslate"><span class="pre">Executable</span></code></a> hierarchies, including:</p>
<ul>
<li><p><a class="reference internal" href="selectable.html#sqlalchemy.sql.expression.Select" title="sqlalchemy.sql.expression.Select"><code class="xref py py-class docutils literal notranslate"><span class="pre">Select</span></code></a></p></li>
<li><p><a class="reference internal" href="dml.html#sqlalchemy.sql.expression.Insert" title="sqlalchemy.sql.expression.Insert"><code class="xref py py-class docutils literal notranslate"><span class="pre">Insert</span></code></a>, <a class="reference internal" href="dml.html#sqlalchemy.sql.expression.Update" title="sqlalchemy.sql.expression.Update"><code class="xref py py-class docutils literal notranslate"><span class="pre">Update</span></code></a>,
<a class="reference internal" href="dml.html#sqlalchemy.sql.expression.Delete" title="sqlalchemy.sql.expression.Delete"><code class="xref py py-class docutils literal notranslate"><span class="pre">Delete</span></code></a></p></li>
<li><p><a class="reference internal" href="sqlelement.html#sqlalchemy.sql.expression.TextClause" title="sqlalchemy.sql.expression.TextClause"><code class="xref py py-class docutils literal notranslate"><span class="pre">TextClause</span></code></a> and
<a class="reference internal" href="selectable.html#sqlalchemy.sql.expression.TextualSelect" title="sqlalchemy.sql.expression.TextualSelect"><code class="xref py py-class docutils literal notranslate"><span class="pre">TextualSelect</span></code></a></p></li>
<li><p><code class="xref py py-class docutils literal notranslate"><span class="pre">DDL</span></code> and objects which inherit from
<code class="xref py py-class docutils literal notranslate"><span class="pre">ExecutableDDLElement</span></code></p></li>
</ul>
</p></li>
<li><p><span class="target" id="sqlalchemy.engine.Connection.execute.params.parameters"></span><strong>parameters</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.engine.Connection.execute.params.parameters">¶</a> – parameters which will be bound into the statement.
This may be either a dictionary of parameter names to values,
or a mutable sequence (e.g. a list) of dictionaries.  When a
list of dictionaries is passed, the underlying statement execution
will make use of the DBAPI <code class="docutils literal notranslate"><span class="pre">cursor.executemany()</span></code> method.
When a single dictionary is passed, the DBAPI <code class="docutils literal notranslate"><span class="pre">cursor.execute()</span></code>
method will be used.</p></li>
<li><p><span class="target" id="sqlalchemy.engine.Connection.execute.params.execution_options"></span><strong>execution_options</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.engine.Connection.execute.params.execution_options">¶</a> – optional dictionary of execution options,
which will be associated with the statement execution.  This
dictionary can provide a subset of the options that are accepted
by <a class="reference internal" href="#sqlalchemy.engine.Connection.execution_options" title="sqlalchemy.engine.Connection.execution_options"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.execution_options()</span></code></a>.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>a <a class="reference internal" href="#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a> object.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.Connection.execution_options">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.Connection"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.Connection.</span></code></a><span class="sig-name descname"><span class="pre">execution_options</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">opt</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#sqlalchemy.engine.Connection" title="sqlalchemy.engine.base.Connection"><span class="pre">Connection</span></a></span></span><a class="headerlink" href="#sqlalchemy.engine.Connection.execution_options" title="Permalink to this definition">¶</a></dt>
<dd><p>Set non-SQL options for the connection which take effect
during execution.</p>
<p>This method modifies this <a class="reference internal" href="#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a> <strong>in-place</strong>;
the return value is the same <a class="reference internal" href="#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a> object
upon which the method is called.   Note that this is in contrast
to the behavior of the <code class="docutils literal notranslate"><span class="pre">execution_options</span></code> methods on other
objects such as <a class="reference internal" href="#sqlalchemy.engine.Engine.execution_options" title="sqlalchemy.engine.Engine.execution_options"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Engine.execution_options()</span></code></a> and
<a class="reference internal" href="selectable.html#sqlalchemy.sql.expression.Executable.execution_options" title="sqlalchemy.sql.expression.Executable.execution_options"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Executable.execution_options()</span></code></a>.  The rationale is that many
such execution options necessarily modify the state of the base
DBAPI connection in any case so there is no feasible means of
keeping the effect of such an option localized to a “sub” connection.</p>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 2.0: </span>The <a class="reference internal" href="#sqlalchemy.engine.Connection.execution_options" title="sqlalchemy.engine.Connection.execution_options"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.execution_options()</span></code></a>
method, in contrast to other objects with this method, modifies
the connection in-place without creating copy of it.</p>
</div>
<p>As discussed elsewhere, the <a class="reference internal" href="#sqlalchemy.engine.Connection.execution_options" title="sqlalchemy.engine.Connection.execution_options"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.execution_options()</span></code></a>
method accepts any arbitrary parameters including user defined names.
All parameters given are consumable in a number of ways including
by using the <a class="reference internal" href="#sqlalchemy.engine.Connection.get_execution_options" title="sqlalchemy.engine.Connection.get_execution_options"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.get_execution_options()</span></code></a> method.
See the examples at <a class="reference internal" href="selectable.html#sqlalchemy.sql.expression.Executable.execution_options" title="sqlalchemy.sql.expression.Executable.execution_options"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Executable.execution_options()</span></code></a>
and <a class="reference internal" href="#sqlalchemy.engine.Engine.execution_options" title="sqlalchemy.engine.Engine.execution_options"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Engine.execution_options()</span></code></a>.</p>
<p>The keywords that are currently recognized by SQLAlchemy itself
include all those listed under <a class="reference internal" href="selectable.html#sqlalchemy.sql.expression.Executable.execution_options" title="sqlalchemy.sql.expression.Executable.execution_options"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Executable.execution_options()</span></code></a>,
as well as others that are specific to <a class="reference internal" href="#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.engine.Connection.execution_options.params.compiled_cache"></span><strong>compiled_cache</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.engine.Connection.execution_options.params.compiled_cache">¶</a> – <p>Available on: <a class="reference internal" href="#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a>,
<a class="reference internal" href="#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a>.</p>
<p>A dictionary where <a class="reference internal" href="internals.html#sqlalchemy.engine.Compiled" title="sqlalchemy.engine.Compiled"><code class="xref py py-class docutils literal notranslate"><span class="pre">Compiled</span></code></a> objects
will be cached when the <a class="reference internal" href="#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a>
compiles a clause
expression into a <a class="reference internal" href="internals.html#sqlalchemy.engine.Compiled" title="sqlalchemy.engine.Compiled"><code class="xref py py-class docutils literal notranslate"><span class="pre">Compiled</span></code></a> object.  This dictionary will
supersede the statement cache that may be configured on the
<a class="reference internal" href="#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a> itself.   If set to None, caching
is disabled, even if the engine has a configured cache size.</p>
<p>Note that the ORM makes use of its own “compiled” caches for
some operations, including flush operations.  The caching
used by the ORM internally supersedes a cache dictionary
specified here.</p>
</p></li>
<li><p><span class="target" id="sqlalchemy.engine.Connection.execution_options.params.logging_token"></span><strong>logging_token</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.engine.Connection.execution_options.params.logging_token">¶</a> – <p>Available on: <a class="reference internal" href="#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a>,
<a class="reference internal" href="#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a>, <a class="reference internal" href="selectable.html#sqlalchemy.sql.expression.Executable" title="sqlalchemy.sql.expression.Executable"><code class="xref py py-class docutils literal notranslate"><span class="pre">Executable</span></code></a>.</p>
<p>Adds the specified string token surrounded by brackets in log
messages logged by the connection, i.e. the logging that’s enabled
either via the <code class="xref py py-paramref docutils literal notranslate"><span class="pre">create_engine.echo</span></code> flag or via the
<code class="docutils literal notranslate"><span class="pre">logging.getLogger(&quot;sqlalchemy.engine&quot;)</span></code> logger. This allows a
per-connection or per-sub-engine token to be available which is
useful for debugging concurrent connection scenarios.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.4.0b2.</span></p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><span class="xref std std-ref">dbengine_logging_tokens</span> - usage example</p>
<p><code class="xref py py-paramref docutils literal notranslate"><span class="pre">create_engine.logging_name</span></code> - adds a name to the
name used by the Python logger object itself.</p>
</div>
</p></li>
<li><p><span class="target" id="sqlalchemy.engine.Connection.execution_options.params.isolation_level"></span><strong>isolation_level</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.engine.Connection.execution_options.params.isolation_level">¶</a> – <p>Available on: <a class="reference internal" href="#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a>,
<a class="reference internal" href="#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a>.</p>
<p>Set the transaction isolation level for the lifespan of this
<a class="reference internal" href="#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a> object.
Valid values include those string
values accepted by the <code class="xref py py-paramref docutils literal notranslate"><span class="pre">create_engine.isolation_level</span></code>
parameter passed to <code class="xref py py-func docutils literal notranslate"><span class="pre">create_engine()</span></code>.  These levels are
semi-database specific; see individual dialect documentation for
valid levels.</p>
<p>The isolation level option applies the isolation level by emitting
statements on the DBAPI connection, and <strong>necessarily affects the
original Connection object overall</strong>. The isolation level will remain
at the given setting until explicitly changed, or when the DBAPI
connection itself is <span class="xref std std-term">released</span> to the connection pool, i.e. the
<a class="reference internal" href="#sqlalchemy.engine.Connection.close" title="sqlalchemy.engine.Connection.close"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.close()</span></code></a> method is called, at which time an
event handler will emit additional statements on the DBAPI connection
in order to revert the isolation level change.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">isolation_level</span></code> execution option may only be
established before the <a class="reference internal" href="#sqlalchemy.engine.Connection.begin" title="sqlalchemy.engine.Connection.begin"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.begin()</span></code></a> method is
called, as well as before any SQL statements are emitted which
would otherwise trigger “autobegin”, or directly after a call to
<a class="reference internal" href="#sqlalchemy.engine.Connection.commit" title="sqlalchemy.engine.Connection.commit"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.commit()</span></code></a> or
<a class="reference internal" href="#sqlalchemy.engine.Connection.rollback" title="sqlalchemy.engine.Connection.rollback"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.rollback()</span></code></a>. A database cannot change the
isolation level on a transaction in progress.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">isolation_level</span></code> execution option is implicitly
reset if the <a class="reference internal" href="#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a> is invalidated, e.g. via
the <a class="reference internal" href="#sqlalchemy.engine.Connection.invalidate" title="sqlalchemy.engine.Connection.invalidate"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.invalidate()</span></code></a> method, or if a
disconnection error occurs. The new connection produced after the
invalidation will <strong>not</strong> have the selected isolation level
re-applied to it automatically.</p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#dbapi-autocommit"><span class="std std-ref">设置事务隔离级别，包括 DBAPI 自动提交</span></a></p>
<p><a class="reference internal" href="#sqlalchemy.engine.Connection.get_isolation_level" title="sqlalchemy.engine.Connection.get_isolation_level"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.get_isolation_level()</span></code></a>
- view current actual level</p>
</div>
</p></li>
<li><p><span class="target" id="sqlalchemy.engine.Connection.execution_options.params.no_parameters"></span><strong>no_parameters</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.engine.Connection.execution_options.params.no_parameters">¶</a> – <p>Available on: <a class="reference internal" href="#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a>,
<a class="reference internal" href="selectable.html#sqlalchemy.sql.expression.Executable" title="sqlalchemy.sql.expression.Executable"><code class="xref py py-class docutils literal notranslate"><span class="pre">Executable</span></code></a>.</p>
<p>When <code class="docutils literal notranslate"><span class="pre">True</span></code>, if the final parameter
list or dictionary is totally empty, will invoke the
statement on the cursor as <code class="docutils literal notranslate"><span class="pre">cursor.execute(statement)</span></code>,
not passing the parameter collection at all.
Some DBAPIs such as psycopg2 and mysql-python consider
percent signs as significant only when parameters are
present; this option allows code to generate SQL
containing percent signs (and possibly other characters)
that is neutral regarding whether it’s executed by the DBAPI
or piped into a script that’s later invoked by
command line tools.</p>
</p></li>
<li><p><span class="target" id="sqlalchemy.engine.Connection.execution_options.params.stream_results"></span><strong>stream_results</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.engine.Connection.execution_options.params.stream_results">¶</a> – <p>Available on: <a class="reference internal" href="#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a>,
<a class="reference internal" href="selectable.html#sqlalchemy.sql.expression.Executable" title="sqlalchemy.sql.expression.Executable"><code class="xref py py-class docutils literal notranslate"><span class="pre">Executable</span></code></a>.</p>
<p>Indicate to the dialect that results should be
“streamed” and not pre-buffered, if possible.  For backends
such as PostgreSQL, MySQL and MariaDB, this indicates the use of
a “server side cursor” as opposed to a client side cursor.
Other backends such as that of Oracle may already use server
side cursors by default.</p>
<p>The usage of
<a class="reference internal" href="#sqlalchemy.engine.Connection.execution_options.params.stream_results" title="sqlalchemy.engine.Connection.execution_options"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Connection.execution_options.stream_results</span></code></a> is
usually combined with setting a fixed number of rows to to be fetched
in batches, to allow for efficient iteration of database rows while
at the same time not loading all result rows into memory at once;
this can be configured on a <a class="reference internal" href="#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a> object using the
<a class="reference internal" href="#sqlalchemy.engine.Result.yield_per" title="sqlalchemy.engine.Result.yield_per"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.yield_per()</span></code></a> method, after execution has
returned a new <a class="reference internal" href="#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a>.   If
<a class="reference internal" href="#sqlalchemy.engine.Result.yield_per" title="sqlalchemy.engine.Result.yield_per"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.yield_per()</span></code></a> is not used,
the <a class="reference internal" href="#sqlalchemy.engine.Connection.execution_options.params.stream_results" title="sqlalchemy.engine.Connection.execution_options"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Connection.execution_options.stream_results</span></code></a>
mode of operation will instead use a dynamically sized buffer
which buffers sets of rows at a time, growing on each batch
based on a fixed growth size up until a limit which may
be configured using the
<a class="reference internal" href="#sqlalchemy.engine.Connection.execution_options.params.max_row_buffer" title="sqlalchemy.engine.Connection.execution_options"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Connection.execution_options.max_row_buffer</span></code></a>
parameter.</p>
<p>When using the ORM to fetch ORM mapped objects from a result,
<a class="reference internal" href="#sqlalchemy.engine.Result.yield_per" title="sqlalchemy.engine.Result.yield_per"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.yield_per()</span></code></a> should always be used with
<a class="reference internal" href="#sqlalchemy.engine.Connection.execution_options.params.stream_results" title="sqlalchemy.engine.Connection.execution_options"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Connection.execution_options.stream_results</span></code></a>,
so that the ORM does not fetch all rows into new ORM objects at once.</p>
<p>For typical use, the
<a class="reference internal" href="#sqlalchemy.engine.Connection.execution_options.params.yield_per" title="sqlalchemy.engine.Connection.execution_options"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Connection.execution_options.yield_per</span></code></a> execution
option should be preferred, which sets up both
<a class="reference internal" href="#sqlalchemy.engine.Connection.execution_options.params.stream_results" title="sqlalchemy.engine.Connection.execution_options"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Connection.execution_options.stream_results</span></code></a> and
<a class="reference internal" href="#sqlalchemy.engine.Result.yield_per" title="sqlalchemy.engine.Result.yield_per"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.yield_per()</span></code></a> at once. This option is supported
both at a core level by <a class="reference internal" href="#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a> as well as by the
ORM <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code>; the latter is described at
<span class="xref std std-ref">orm_queryguide_yield_per</span>.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><span class="xref std std-ref">engine_stream_results</span> - background on
<a class="reference internal" href="#sqlalchemy.engine.Connection.execution_options.params.stream_results" title="sqlalchemy.engine.Connection.execution_options"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Connection.execution_options.stream_results</span></code></a></p>
<p><a class="reference internal" href="#sqlalchemy.engine.Connection.execution_options.params.max_row_buffer" title="sqlalchemy.engine.Connection.execution_options"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Connection.execution_options.max_row_buffer</span></code></a></p>
<p><a class="reference internal" href="#sqlalchemy.engine.Connection.execution_options.params.yield_per" title="sqlalchemy.engine.Connection.execution_options"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Connection.execution_options.yield_per</span></code></a></p>
<p><span class="xref std std-ref">orm_queryguide_yield_per</span> - in the <a class="reference internal" href="../orm/queryguide/index.html"><span class="std std-ref">ORM 查询指南</span></a>
describing the ORM version of <code class="docutils literal notranslate"><span class="pre">yield_per</span></code></p>
</div>
</p></li>
<li><p><span class="target" id="sqlalchemy.engine.Connection.execution_options.params.max_row_buffer"></span><strong>max_row_buffer</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.engine.Connection.execution_options.params.max_row_buffer">¶</a> – <p>Available on: <a class="reference internal" href="#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a>,
<a class="reference internal" href="selectable.html#sqlalchemy.sql.expression.Executable" title="sqlalchemy.sql.expression.Executable"><code class="xref py py-class docutils literal notranslate"><span class="pre">Executable</span></code></a>.  Sets a maximum
buffer size to use when the
<a class="reference internal" href="#sqlalchemy.engine.Connection.execution_options.params.stream_results" title="sqlalchemy.engine.Connection.execution_options"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Connection.execution_options.stream_results</span></code></a>
execution option is used on a backend that supports server side
cursors.  The default value if not specified is 1000.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#sqlalchemy.engine.Connection.execution_options.params.stream_results" title="sqlalchemy.engine.Connection.execution_options"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Connection.execution_options.stream_results</span></code></a></p>
<p><span class="xref std std-ref">engine_stream_results</span></p>
</div>
</p></li>
<li><p><span class="target" id="sqlalchemy.engine.Connection.execution_options.params.yield_per"></span><strong>yield_per</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.engine.Connection.execution_options.params.yield_per">¶</a> – <p>Available on: <a class="reference internal" href="#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a>,
<a class="reference internal" href="selectable.html#sqlalchemy.sql.expression.Executable" title="sqlalchemy.sql.expression.Executable"><code class="xref py py-class docutils literal notranslate"><span class="pre">Executable</span></code></a>.  Integer value applied which will
set the <a class="reference internal" href="#sqlalchemy.engine.Connection.execution_options.params.stream_results" title="sqlalchemy.engine.Connection.execution_options"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Connection.execution_options.stream_results</span></code></a>
execution option and invoke <a class="reference internal" href="#sqlalchemy.engine.Result.yield_per" title="sqlalchemy.engine.Result.yield_per"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.yield_per()</span></code></a>
automatically at once.  Allows equivalent functionality as
is present when using this parameter with the ORM.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.4.40.</span></p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><span class="xref std std-ref">engine_stream_results</span> - background and examples
on using server side cursors with Core.</p>
<p><span class="xref std std-ref">orm_queryguide_yield_per</span> - in the <a class="reference internal" href="../orm/queryguide/index.html"><span class="std std-ref">ORM 查询指南</span></a>
describing the ORM version of <code class="docutils literal notranslate"><span class="pre">yield_per</span></code></p>
</div>
</p></li>
<li><p><span class="target" id="sqlalchemy.engine.Connection.execution_options.params.insertmanyvalues_page_size"></span><strong>insertmanyvalues_page_size</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.engine.Connection.execution_options.params.insertmanyvalues_page_size">¶</a> – <p>Available on: <a class="reference internal" href="#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a>,
<a class="reference internal" href="#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a>. Number of rows to format into an
INSERT statement when the statement uses “insertmanyvalues” mode,
which is a paged form of bulk insert that is used for many backends
when using <span class="xref std std-term">executemany</span> execution typically in conjunction
with RETURNING. Defaults to 1000. May also be modified on a
per-engine basis using the
<code class="xref py py-paramref docutils literal notranslate"><span class="pre">create_engine.insertmanyvalues_page_size</span></code> parameter.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 2.0.</span></p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><span class="xref std std-ref">engine_insertmanyvalues</span></p>
</div>
</p></li>
<li><p><span class="target" id="sqlalchemy.engine.Connection.execution_options.params.schema_translate_map"></span><strong>schema_translate_map</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.engine.Connection.execution_options.params.schema_translate_map">¶</a> – <p>Available on: <a class="reference internal" href="#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a>,
<a class="reference internal" href="#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a>, <a class="reference internal" href="selectable.html#sqlalchemy.sql.expression.Executable" title="sqlalchemy.sql.expression.Executable"><code class="xref py py-class docutils literal notranslate"><span class="pre">Executable</span></code></a>.</p>
<p>A dictionary mapping schema names to schema names, that will be
applied to the <a class="reference internal" href="metadata.html#sqlalchemy.schema.Table.params.schema" title="sqlalchemy.schema.Table"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Table.schema</span></code></a> element of each
<a class="reference internal" href="metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal notranslate"><span class="pre">Table</span></code></a>
encountered when SQL or DDL expression elements
are compiled into strings; the resulting schema name will be
converted based on presence in the map of the original name.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#schema-translating"><span class="std std-ref">翻译模式名称</span></a></p>
</div>
</p></li>
</ul>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#sqlalchemy.engine.Engine.execution_options" title="sqlalchemy.engine.Engine.execution_options"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Engine.execution_options()</span></code></a></p>
<p><a class="reference internal" href="selectable.html#sqlalchemy.sql.expression.Executable.execution_options" title="sqlalchemy.sql.expression.Executable.execution_options"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Executable.execution_options()</span></code></a></p>
<p><a class="reference internal" href="#sqlalchemy.engine.Connection.get_execution_options" title="sqlalchemy.engine.Connection.get_execution_options"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.get_execution_options()</span></code></a></p>
<p><a class="reference internal" href="../orm/queryguide/api.html#orm-queryguide-execution-options"><span class="std std-ref">ORM执行选项</span></a> - documentation on all
ORM-specific execution options</p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.Connection.get_execution_options">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.Connection"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.Connection.</span></code></a><span class="sig-name descname"><span class="pre">get_execution_options</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">_ExecuteOptions</span></span></span><a class="headerlink" href="#sqlalchemy.engine.Connection.get_execution_options" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the non-SQL options which will take effect during execution.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.3.</span></p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#sqlalchemy.engine.Connection.execution_options" title="sqlalchemy.engine.Connection.execution_options"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.execution_options()</span></code></a></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.Connection.get_isolation_level">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.Connection"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.Connection.</span></code></a><span class="sig-name descname"><span class="pre">get_isolation_level</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Literal</span><span class="p"><span class="pre">[</span></span><span class="s"><span class="pre">'SERIALIZABLE'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'REPEATABLE</span> <span class="pre">READ'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'READ</span> <span class="pre">COMMITTED'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'READ</span> <span class="pre">UNCOMMITTED'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'AUTOCOMMIT'</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#sqlalchemy.engine.Connection.get_isolation_level" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the current <strong>actual</strong> isolation level that’s present on
the database within the scope of this connection.</p>
<p>This attribute will perform a live SQL operation against the database
in order to procure the current isolation level, so the value returned
is the actual level on the underlying DBAPI connection regardless of
how this state was set. This will be one of the four actual isolation
modes <code class="docutils literal notranslate"><span class="pre">READ</span> <span class="pre">UNCOMMITTED</span></code>, <code class="docutils literal notranslate"><span class="pre">READ</span> <span class="pre">COMMITTED</span></code>, <code class="docutils literal notranslate"><span class="pre">REPEATABLE</span> <span class="pre">READ</span></code>,
<code class="docutils literal notranslate"><span class="pre">SERIALIZABLE</span></code>. It will <strong>not</strong> include the <code class="docutils literal notranslate"><span class="pre">AUTOCOMMIT</span></code> isolation
level setting. Third party dialects may also feature additional
isolation level settings.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This method <strong>will not report</strong> on the <code class="docutils literal notranslate"><span class="pre">AUTOCOMMIT</span></code>
isolation level, which is a separate <span class="xref std std-term">dbapi</span> setting that’s
independent of <strong>actual</strong> isolation level.  When <code class="docutils literal notranslate"><span class="pre">AUTOCOMMIT</span></code> is
in use, the database connection still has a “traditional” isolation
mode in effect, that is typically one of the four values
<code class="docutils literal notranslate"><span class="pre">READ</span> <span class="pre">UNCOMMITTED</span></code>, <code class="docutils literal notranslate"><span class="pre">READ</span> <span class="pre">COMMITTED</span></code>, <code class="docutils literal notranslate"><span class="pre">REPEATABLE</span> <span class="pre">READ</span></code>,
<code class="docutils literal notranslate"><span class="pre">SERIALIZABLE</span></code>.</p>
</div>
<p>Compare to the <a class="reference internal" href="#sqlalchemy.engine.Connection.default_isolation_level" title="sqlalchemy.engine.Connection.default_isolation_level"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Connection.default_isolation_level</span></code></a>
accessor which returns the isolation level that is present on the
database at initial connection time.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#sqlalchemy.engine.Connection.default_isolation_level" title="sqlalchemy.engine.Connection.default_isolation_level"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Connection.default_isolation_level</span></code></a>
- view default level</p>
<p><code class="xref py py-paramref docutils literal notranslate"><span class="pre">create_engine.isolation_level</span></code>
- set per <a class="reference internal" href="#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a> isolation level</p>
<p><a class="reference internal" href="#sqlalchemy.engine.Connection.execution_options.params.isolation_level" title="sqlalchemy.engine.Connection.execution_options"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Connection.execution_options.isolation_level</span></code></a>
- set per <a class="reference internal" href="#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a> isolation level</p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.Connection.get_nested_transaction">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.Connection"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.Connection.</span></code></a><span class="sig-name descname"><span class="pre">get_nested_transaction</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#sqlalchemy.engine.NestedTransaction" title="sqlalchemy.engine.base.NestedTransaction"><span class="pre">NestedTransaction</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.engine.Connection.get_nested_transaction" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the current nested transaction in progress, if any.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.4.</span></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.Connection.get_transaction">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.Connection"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.Connection.</span></code></a><span class="sig-name descname"><span class="pre">get_transaction</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#sqlalchemy.engine.RootTransaction" title="sqlalchemy.engine.base.RootTransaction"><span class="pre">RootTransaction</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.engine.Connection.get_transaction" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the current root transaction in progress, if any.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.4.</span></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.Connection.in_nested_transaction">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.Connection"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.Connection.</span></code></a><span class="sig-name descname"><span class="pre">in_nested_transaction</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">bool</span></span></span><a class="headerlink" href="#sqlalchemy.engine.Connection.in_nested_transaction" title="Permalink to this definition">¶</a></dt>
<dd><p>Return True if a transaction is in progress.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.Connection.in_transaction">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.Connection"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.Connection.</span></code></a><span class="sig-name descname"><span class="pre">in_transaction</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">bool</span></span></span><a class="headerlink" href="#sqlalchemy.engine.Connection.in_transaction" title="Permalink to this definition">¶</a></dt>
<dd><p>Return True if a transaction is in progress.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.engine.Connection.info">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.engine.Connection"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.Connection.</span></code></a><span class="sig-name descname"><span class="pre">info</span></span><a class="headerlink" href="#sqlalchemy.engine.Connection.info" title="Permalink to this definition">¶</a></dt>
<dd><p>Info dictionary associated with the underlying DBAPI connection
referred to by this <a class="reference internal" href="#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a>, allowing user-defined
data to be associated with the connection.</p>
<p>The data here will follow along with the DBAPI connection including
after it is returned to the connection pool and used again
in subsequent instances of <a class="reference internal" href="#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a>.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.Connection.invalidate">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.Connection"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.Connection.</span></code></a><span class="sig-name descname"><span class="pre">invalidate</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">exception</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">BaseException</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.engine.Connection.invalidate" title="Permalink to this definition">¶</a></dt>
<dd><p>Invalidate the underlying DBAPI connection associated with
this <a class="reference internal" href="#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a>.</p>
<p>An attempt will be made to close the underlying DBAPI connection
immediately; however if this operation fails, the error is logged
but not raised.  The connection is then discarded whether or not
close() succeeded.</p>
<p>Upon the next use (where “use” typically means using the
<a class="reference internal" href="#sqlalchemy.engine.Connection.execute" title="sqlalchemy.engine.Connection.execute"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.execute()</span></code></a> method or similar),
this <a class="reference internal" href="#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a> will attempt to
procure a new DBAPI connection using the services of the
<a class="reference internal" href="pooling.html#sqlalchemy.pool.Pool" title="sqlalchemy.pool.Pool"><code class="xref py py-class docutils literal notranslate"><span class="pre">Pool</span></code></a> as a source of connectivity (e.g.
a “reconnection”).</p>
<p>If a transaction was in progress (e.g. the
<a class="reference internal" href="#sqlalchemy.engine.Connection.begin" title="sqlalchemy.engine.Connection.begin"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.begin()</span></code></a> method has been called) when
<a class="reference internal" href="#sqlalchemy.engine.Connection.invalidate" title="sqlalchemy.engine.Connection.invalidate"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.invalidate()</span></code></a> method is called, at the DBAPI
level all state associated with this transaction is lost, as
the DBAPI connection is closed.  The <a class="reference internal" href="#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a>
will not allow a reconnection to proceed until the
<a class="reference internal" href="#sqlalchemy.engine.Transaction" title="sqlalchemy.engine.Transaction"><code class="xref py py-class docutils literal notranslate"><span class="pre">Transaction</span></code></a> object is ended, by calling the
<a class="reference internal" href="#sqlalchemy.engine.Transaction.rollback" title="sqlalchemy.engine.Transaction.rollback"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Transaction.rollback()</span></code></a> method; until that point, any attempt at
continuing to use the <a class="reference internal" href="#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a> will raise an
<a class="reference internal" href="exceptions.html#sqlalchemy.exc.InvalidRequestError" title="sqlalchemy.exc.InvalidRequestError"><code class="xref py py-class docutils literal notranslate"><span class="pre">InvalidRequestError</span></code></a>.
This is to prevent applications from accidentally
continuing an ongoing transactional operations despite the
fact that the transaction has been lost due to an
invalidation.</p>
<p>The <a class="reference internal" href="#sqlalchemy.engine.Connection.invalidate" title="sqlalchemy.engine.Connection.invalidate"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.invalidate()</span></code></a> method,
just like auto-invalidation,
will at the connection pool level invoke the
<a class="reference internal" href="events.html#sqlalchemy.events.PoolEvents.invalidate" title="sqlalchemy.events.PoolEvents.invalidate"><code class="xref py py-meth docutils literal notranslate"><span class="pre">PoolEvents.invalidate()</span></code></a> event.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><span class="target" id="sqlalchemy.engine.Connection.invalidate.params.exception"></span><strong>exception</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.engine.Connection.invalidate.params.exception">¶</a> – an optional <code class="docutils literal notranslate"><span class="pre">Exception</span></code> instance that’s the
reason for the invalidation.  is passed along to event handlers
and logging functions.</p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="pooling.html#pool-connection-invalidation"><span class="std std-ref">关于无效化的更多信息</span></a></p>
</div>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.engine.Connection.invalidated">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.engine.Connection"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.Connection.</span></code></a><span class="sig-name descname"><span class="pre">invalidated</span></span><a class="headerlink" href="#sqlalchemy.engine.Connection.invalidated" title="Permalink to this definition">¶</a></dt>
<dd><p>Return True if this connection was invalidated.</p>
<p>This does not indicate whether or not the connection was
invalidated at the pool level, however</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.Connection.rollback">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.Connection"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.Connection.</span></code></a><span class="sig-name descname"><span class="pre">rollback</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.engine.Connection.rollback" title="Permalink to this definition">¶</a></dt>
<dd><p>Roll back the transaction that is currently in progress.</p>
<p>This method rolls back the current transaction if one has been started.
If no transaction was started, the method has no effect.  If a
transaction was started and the connection is in an invalidated state,
the transaction is cleared using this method.</p>
<p>A transaction is begun on a <a class="reference internal" href="#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a> automatically
whenever a statement is first executed, or when the
<a class="reference internal" href="#sqlalchemy.engine.Connection.begin" title="sqlalchemy.engine.Connection.begin"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.begin()</span></code></a> method is called.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <a class="reference internal" href="#sqlalchemy.engine.Connection.rollback" title="sqlalchemy.engine.Connection.rollback"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.rollback()</span></code></a> method only acts
upon the primary database transaction that is linked to the
<a class="reference internal" href="#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a> object.  It does not operate upon a
SAVEPOINT that would have been invoked from the
<a class="reference internal" href="#sqlalchemy.engine.Connection.begin_nested" title="sqlalchemy.engine.Connection.begin_nested"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.begin_nested()</span></code></a> method; for control of a
SAVEPOINT, call <a class="reference internal" href="#sqlalchemy.engine.NestedTransaction.rollback" title="sqlalchemy.engine.NestedTransaction.rollback"><code class="xref py py-meth docutils literal notranslate"><span class="pre">NestedTransaction.rollback()</span></code></a> on the
<a class="reference internal" href="#sqlalchemy.engine.NestedTransaction" title="sqlalchemy.engine.NestedTransaction"><code class="xref py py-class docutils literal notranslate"><span class="pre">NestedTransaction</span></code></a> that is returned by the
<a class="reference internal" href="#sqlalchemy.engine.Connection.begin_nested" title="sqlalchemy.engine.Connection.begin_nested"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.begin_nested()</span></code></a> method itself.</p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.Connection.scalar">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.Connection"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.Connection.</span></code></a><span class="sig-name descname"><span class="pre">scalar</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">statement</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="selectable.html#sqlalchemy.sql.expression.Executable" title="sqlalchemy.sql.expression.Executable"><span class="pre">Executable</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">parameters</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_CoreSingleExecuteParams</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">execution_options</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">CoreExecuteOptionsParameter</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Any</span></span></span><a class="headerlink" href="#sqlalchemy.engine.Connection.scalar" title="Permalink to this definition">¶</a></dt>
<dd><p>Executes a SQL statement construct and returns a scalar object.</p>
<p>This method is shorthand for invoking the
<a class="reference internal" href="#sqlalchemy.engine.Result.scalar" title="sqlalchemy.engine.Result.scalar"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.scalar()</span></code></a> method after invoking the
<a class="reference internal" href="#sqlalchemy.engine.Connection.execute" title="sqlalchemy.engine.Connection.execute"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.execute()</span></code></a> method.  Parameters are equivalent.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>a scalar Python value representing the first column of the
first row returned.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.Connection.scalars">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.Connection"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.Connection.</span></code></a><span class="sig-name descname"><span class="pre">scalars</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">statement</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="selectable.html#sqlalchemy.sql.expression.Executable" title="sqlalchemy.sql.expression.Executable"><span class="pre">Executable</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">parameters</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_CoreAnyExecuteParams</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">execution_options</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">CoreExecuteOptionsParameter</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#sqlalchemy.engine.ScalarResult" title="sqlalchemy.engine.ScalarResult"><span class="pre">ScalarResult</span></a><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#sqlalchemy.engine.Connection.scalars" title="Permalink to this definition">¶</a></dt>
<dd><p>Executes and returns a scalar result set, which yields scalar values
from the first column of each row.</p>
<p>This method is equivalent to calling <a class="reference internal" href="#sqlalchemy.engine.Connection.execute" title="sqlalchemy.engine.Connection.execute"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.execute()</span></code></a>
to receive a <a class="reference internal" href="#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a> object, then invoking the
<a class="reference internal" href="#sqlalchemy.engine.Result.scalars" title="sqlalchemy.engine.Result.scalars"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.scalars()</span></code></a> method to produce a
<a class="reference internal" href="#sqlalchemy.engine.ScalarResult" title="sqlalchemy.engine.ScalarResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">ScalarResult</span></code></a> instance.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>a <a class="reference internal" href="#sqlalchemy.engine.ScalarResult" title="sqlalchemy.engine.ScalarResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">ScalarResult</span></code></a></p>
</dd>
</dl>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.4.24.</span></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.Connection.schema_for_object">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.Connection"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.Connection.</span></code></a><span class="sig-name descname"><span class="pre">schema_for_object</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">obj</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">HasSchemaAttr</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.engine.Connection.schema_for_object" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the schema name for the given schema item taking into
account current schema translate map.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.engine.CreateEnginePlugin">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.engine.</span></span><span class="sig-name descname"><span class="pre">CreateEnginePlugin</span></span><a class="headerlink" href="#sqlalchemy.engine.CreateEnginePlugin" title="Permalink to this definition">¶</a></dt>
<dd><p>A set of hooks intended to augment the construction of an
<a class="reference internal" href="#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a> object based on entrypoint names in a URL.</p>
<p>The purpose of <a class="reference internal" href="#sqlalchemy.engine.CreateEnginePlugin" title="sqlalchemy.engine.CreateEnginePlugin"><code class="xref py py-class docutils literal notranslate"><span class="pre">CreateEnginePlugin</span></code></a> is to allow third-party
systems to apply engine, pool and dialect level event listeners without
the need for the target application to be modified; instead, the plugin
names can be added to the database URL.  Target applications for
<a class="reference internal" href="#sqlalchemy.engine.CreateEnginePlugin" title="sqlalchemy.engine.CreateEnginePlugin"><code class="xref py py-class docutils literal notranslate"><span class="pre">CreateEnginePlugin</span></code></a> include:</p>
<ul class="simple">
<li><p>connection and SQL performance tools, e.g. which use events to track
number of checkouts and/or time spent with statements</p></li>
<li><p>connectivity plugins such as proxies</p></li>
</ul>
<p>A rudimentary <a class="reference internal" href="#sqlalchemy.engine.CreateEnginePlugin" title="sqlalchemy.engine.CreateEnginePlugin"><code class="xref py py-class docutils literal notranslate"><span class="pre">CreateEnginePlugin</span></code></a> that attaches a logger
to an <a class="reference internal" href="#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a> object might look like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">logging</span>

<span class="kn">from</span> <span class="nn">sqlalchemy.engine</span> <span class="kn">import</span> <span class="n">CreateEnginePlugin</span>
<span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">event</span>

<span class="k">class</span> <span class="nc">LogCursorEventsPlugin</span><span class="p">(</span><span class="n">CreateEnginePlugin</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># consume the parameter &quot;log_cursor_logging_name&quot; from the</span>
        <span class="c1"># URL query</span>
        <span class="n">logging_name</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;log_cursor_logging_name&quot;</span><span class="p">,</span> <span class="s2">&quot;log_cursor&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">logging_name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">):</span>
        <span class="s2">&quot;update the URL to one that no longer includes our parameters&quot;</span>
        <span class="k">return</span> <span class="n">url</span><span class="o">.</span><span class="n">difference_update_query</span><span class="p">([</span><span class="s2">&quot;log_cursor_logging_name&quot;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">engine_created</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">engine</span><span class="p">):</span>
        <span class="s2">&quot;attach an event listener after the new Engine is constructed&quot;</span>
        <span class="n">event</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="n">engine</span><span class="p">,</span> <span class="s2">&quot;before_cursor_execute&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_event</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">_log_event</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">conn</span><span class="p">,</span>
        <span class="n">cursor</span><span class="p">,</span>
        <span class="n">statement</span><span class="p">,</span>
        <span class="n">parameters</span><span class="p">,</span>
        <span class="n">context</span><span class="p">,</span>
        <span class="n">executemany</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Plugin logged cursor event: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">statement</span><span class="p">)</span></pre><div class="code-non-annotations-key"></div></div>
</div>
<p>Plugins are registered using entry points in a similar way as that
of dialects:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">entry_points</span><span class="o">=</span><span class="p">{</span>
    <span class="s1">&#39;sqlalchemy.plugins&#39;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s1">&#39;log_cursor_plugin = myapp.plugins:LogCursorEventsPlugin&#39;</span>
    <span class="p">]</span></pre></div>
</div>
<p>A plugin that uses the above names would be invoked from a database
URL as in:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">create_engine</span>

<span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span>
    <span class="s2">&quot;mysql+pymysql://scott:tiger@localhost/test?&quot;</span>
    <span class="s2">&quot;plugin=log_cursor_plugin&amp;log_cursor_logging_name=mylogger&quot;</span>
<span class="p">)</span></pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">plugin</span></code> URL parameter supports multiple instances, so that a URL
may specify multiple plugins; they are loaded in the order stated
in the URL:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span>
  <span class="s2">&quot;mysql+pymysql://scott:tiger@localhost/test?&quot;</span>
  <span class="s2">&quot;plugin=plugin_one&amp;plugin=plugin_twp&amp;plugin=plugin_three&quot;</span><span class="p">)</span></pre></div>
</div>
<p>The plugin names may also be passed directly to <code class="xref py py-func docutils literal notranslate"><span class="pre">create_engine()</span></code>
using the <code class="xref py py-paramref docutils literal notranslate"><span class="pre">create_engine.plugins</span></code> argument:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span>
  <span class="s2">&quot;mysql+pymysql://scott:tiger@localhost/test&quot;</span><span class="p">,</span>
  <span class="n">plugins</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;myplugin&quot;</span><span class="p">])</span></pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.2.3: </span>plugin names can also be specified
to <code class="xref py py-func docutils literal notranslate"><span class="pre">create_engine()</span></code> as a list</p>
</div>
<p>A plugin may consume plugin-specific arguments from the
<code class="xref py py-class docutils literal notranslate"><span class="pre">URL</span></code> object as well as the <code class="docutils literal notranslate"><span class="pre">kwargs</span></code> dictionary, which is
the dictionary of arguments passed to the <code class="xref py py-func docutils literal notranslate"><span class="pre">create_engine()</span></code>
call.  “Consuming” these arguments includes that they must be removed
when the plugin initializes, so that the arguments are not passed along
to the <a class="reference internal" href="internals.html#sqlalchemy.engine.Dialect" title="sqlalchemy.engine.Dialect"><code class="xref py py-class docutils literal notranslate"><span class="pre">Dialect</span></code></a> constructor, where they will raise an
<a class="reference internal" href="exceptions.html#sqlalchemy.exc.ArgumentError" title="sqlalchemy.exc.ArgumentError"><code class="xref py py-class docutils literal notranslate"><span class="pre">ArgumentError</span></code></a> because they are not known by the dialect.</p>
<p>As of version 1.4 of SQLAlchemy, arguments should continue to be consumed
from the <code class="docutils literal notranslate"><span class="pre">kwargs</span></code> dictionary directly, by removing the values with a
method such as <code class="docutils literal notranslate"><span class="pre">dict.pop</span></code>. Arguments from the <code class="xref py py-class docutils literal notranslate"><span class="pre">URL</span></code> object
should be consumed by implementing the
<a class="reference internal" href="#sqlalchemy.engine.CreateEnginePlugin.update_url" title="sqlalchemy.engine.CreateEnginePlugin.update_url"><code class="xref py py-meth docutils literal notranslate"><span class="pre">CreateEnginePlugin.update_url()</span></code></a> method, returning a new copy
of the <code class="xref py py-class docutils literal notranslate"><span class="pre">URL</span></code> with plugin-specific parameters removed:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyPlugin</span><span class="p">(</span><span class="n">CreateEnginePlugin</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">my_argument_one</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="n">query</span><span class="p">[</span><span class="s1">&#39;my_argument_one&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">my_argument_two</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="n">query</span><span class="p">[</span><span class="s1">&#39;my_argument_two&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">my_argument_three</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;my_argument_three&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">url</span><span class="o">.</span><span class="n">difference_update_query</span><span class="p">(</span>
            <span class="p">[</span><span class="s2">&quot;my_argument_one&quot;</span><span class="p">,</span> <span class="s2">&quot;my_argument_two&quot;</span><span class="p">]</span>
        <span class="p">)</span></pre><div class="code-non-annotations-key"></div></div>
</div>
<p>Arguments like those illustrated above would be consumed from a
<code class="xref py py-func docutils literal notranslate"><span class="pre">create_engine()</span></code> call such as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">create_engine</span>

<span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span>
  <span class="s2">&quot;mysql+pymysql://scott:tiger@localhost/test?&quot;</span>
  <span class="s2">&quot;plugin=myplugin&amp;my_argument_one=foo&amp;my_argument_two=bar&quot;</span><span class="p">,</span>
  <span class="n">my_argument_three</span><span class="o">=</span><span class="s1">&#39;bat&#39;</span>
<span class="p">)</span></pre></div>
</div>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 1.4: </span>The <code class="xref py py-class docutils literal notranslate"><span class="pre">URL</span></code> object is now immutable; a
<a class="reference internal" href="#sqlalchemy.engine.CreateEnginePlugin" title="sqlalchemy.engine.CreateEnginePlugin"><code class="xref py py-class docutils literal notranslate"><span class="pre">CreateEnginePlugin</span></code></a> that needs to alter the
<code class="xref py py-class docutils literal notranslate"><span class="pre">URL</span></code> should implement the newly added
<a class="reference internal" href="#sqlalchemy.engine.CreateEnginePlugin.update_url" title="sqlalchemy.engine.CreateEnginePlugin.update_url"><code class="xref py py-meth docutils literal notranslate"><span class="pre">CreateEnginePlugin.update_url()</span></code></a> method, which
is invoked after the plugin is constructed.</p>
<p>For migration, construct the plugin in the following way, checking
for the existence of the <a class="reference internal" href="#sqlalchemy.engine.CreateEnginePlugin.update_url" title="sqlalchemy.engine.CreateEnginePlugin.update_url"><code class="xref py py-meth docutils literal notranslate"><span class="pre">CreateEnginePlugin.update_url()</span></code></a>
method to detect which version is running:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyPlugin</span><span class="p">(</span><span class="n">CreateEnginePlugin</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">hasattr</span><span class="p">(</span><span class="n">CreateEnginePlugin</span><span class="p">,</span> <span class="s2">&quot;update_url&quot;</span><span class="p">):</span>
            <span class="c1"># detect the 1.4 API</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">my_argument_one</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="n">query</span><span class="p">[</span><span class="s1">&#39;my_argument_one&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">my_argument_two</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="n">query</span><span class="p">[</span><span class="s1">&#39;my_argument_two&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># detect the 1.3 and earlier API - mutate the</span>
            <span class="c1"># URL directly</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">my_argument_one</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;my_argument_one&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">my_argument_two</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;my_argument_two&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">my_argument_three</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;my_argument_three&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">):</span>
        <span class="c1"># this method is only called in the 1.4 version</span>
        <span class="k">return</span> <span class="n">url</span><span class="o">.</span><span class="n">difference_update_query</span><span class="p">(</span>
            <span class="p">[</span><span class="s2">&quot;my_argument_one&quot;</span><span class="p">,</span> <span class="s2">&quot;my_argument_two&quot;</span><span class="p">]</span>
        <span class="p">)</span></pre><div class="code-non-annotations-key"></div></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><span class="xref std std-ref">change_5526</span> - overview of the <code class="xref py py-class docutils literal notranslate"><span class="pre">URL</span></code> change which
also includes notes regarding <a class="reference internal" href="#sqlalchemy.engine.CreateEnginePlugin" title="sqlalchemy.engine.CreateEnginePlugin"><code class="xref py py-class docutils literal notranslate"><span class="pre">CreateEnginePlugin</span></code></a>.</p>
</div>
</div>
<div class="class-members docutils container">
<p><strong>Members</strong></p>
<p><a class="reference internal" href="#sqlalchemy.engine.CreateEnginePlugin.__init__"><span class="sig-name descname">__init__()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.CreateEnginePlugin.engine_created"><span class="sig-name descname">engine_created()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.CreateEnginePlugin.handle_dialect_kwargs"><span class="sig-name descname">handle_dialect_kwargs()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.CreateEnginePlugin.handle_pool_kwargs"><span class="sig-name descname">handle_pool_kwargs()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.CreateEnginePlugin.update_url"><span class="sig-name descname">update_url()</span></a></p>
</div>
<p>When the engine creation process completes and produces the
<a class="reference internal" href="#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a> object, it is again passed to the plugin via the
<a class="reference internal" href="#sqlalchemy.engine.CreateEnginePlugin.engine_created" title="sqlalchemy.engine.CreateEnginePlugin.engine_created"><code class="xref py py-meth docutils literal notranslate"><span class="pre">CreateEnginePlugin.engine_created()</span></code></a> hook.  In this hook, additional
changes can be made to the engine, most typically involving setup of
events (e.g. those defined in <a class="reference internal" href="events.html"><span class="std std-ref">Core事件</span></a>).</p>
<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.CreateEnginePlugin.__init__">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.CreateEnginePlugin"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.CreateEnginePlugin.</span></code></a><span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">url</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">URL</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">kwargs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.engine.CreateEnginePlugin.__init__" title="Permalink to this definition">¶</a></dt>
<dd><p>Construct a new <a class="reference internal" href="#sqlalchemy.engine.CreateEnginePlugin" title="sqlalchemy.engine.CreateEnginePlugin"><code class="xref py py-class docutils literal notranslate"><span class="pre">CreateEnginePlugin</span></code></a>.</p>
<p>The plugin object is instantiated individually for each call
to <code class="xref py py-func docutils literal notranslate"><span class="pre">create_engine()</span></code>.  A single <code class="xref py py-class docutils literal notranslate">
<span class="pre">Engine</span></code> will be
passed to the <a class="reference internal" href="#sqlalchemy.engine.CreateEnginePlugin.engine_created" title="sqlalchemy.engine.CreateEnginePlugin.engine_created"><code class="xref py py-meth docutils literal notranslate"><span class="pre">CreateEnginePlugin.engine_created()</span></code></a> method
corresponding to this URL.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.engine.CreateEnginePlugin.params.url"></span><strong>url</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.engine.CreateEnginePlugin.params.url">¶</a> – <p>the <code class="xref py py-class docutils literal notranslate"><span class="pre">URL</span></code> object.  The plugin may inspect
the <code class="xref py py-class docutils literal notranslate"><span class="pre">URL</span></code> for arguments.  Arguments used by the
plugin should be removed, by returning an updated <code class="xref py py-class docutils literal notranslate"><span class="pre">URL</span></code>
from the <a class="reference internal" href="#sqlalchemy.engine.CreateEnginePlugin.update_url" title="sqlalchemy.engine.CreateEnginePlugin.update_url"><code class="xref py py-meth docutils literal notranslate"><span class="pre">CreateEnginePlugin.update_url()</span></code></a> method.</p>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 1.4: </span>The <code class="xref py py-class docutils literal notranslate"><span class="pre">URL</span></code> object is now immutable, so a
<a class="reference internal" href="#sqlalchemy.engine.CreateEnginePlugin" title="sqlalchemy.engine.CreateEnginePlugin"><code class="xref py py-class docutils literal notranslate"><span class="pre">CreateEnginePlugin</span></code></a> that needs to alter the
<code class="xref py py-class docutils literal notranslate"><span class="pre">URL</span></code> object should implement the
<a class="reference internal" href="#sqlalchemy.engine.CreateEnginePlugin.update_url" title="sqlalchemy.engine.CreateEnginePlugin.update_url"><code class="xref py py-meth docutils literal notranslate"><span class="pre">CreateEnginePlugin.update_url()</span></code></a> method.</p>
</div>
</p></li>
<li><p><span class="target" id="sqlalchemy.engine.CreateEnginePlugin.params.kwargs"></span><strong>kwargs</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.engine.CreateEnginePlugin.params.kwargs">¶</a> – The keyword arguments passed to
<code class="xref py py-func docutils literal notranslate"><span class="pre">create_engine()</span></code>.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.CreateEnginePlugin.engine_created">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.CreateEnginePlugin"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.CreateEnginePlugin.</span></code></a><span class="sig-name descname"><span class="pre">engine_created</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">engine</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><span class="pre">Engine</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.engine.CreateEnginePlugin.engine_created" title="Permalink to this definition">¶</a></dt>
<dd><p>Receive the <a class="reference internal" href="#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a>
object when it is fully constructed.</p>
<p>The plugin may make additional changes to the engine, such as
registering engine or connection pool events.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.CreateEnginePlugin.handle_dialect_kwargs">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.CreateEnginePlugin"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.CreateEnginePlugin.</span></code></a><span class="sig-name descname"><span class="pre">handle_dialect_kwargs</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dialect_cls</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Type</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="internals.html#sqlalchemy.engine.Dialect" title="sqlalchemy.engine.interfaces.Dialect"><span class="pre">Dialect</span></a><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dialect_args</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.engine.CreateEnginePlugin.handle_dialect_kwargs" title="Permalink to this definition">¶</a></dt>
<dd><p>parse and modify dialect kwargs</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.CreateEnginePlugin.handle_pool_kwargs">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.CreateEnginePlugin"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.CreateEnginePlugin.</span></code></a><span class="sig-name descname"><span class="pre">handle_pool_kwargs</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">pool_cls</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Type</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="pooling.html#sqlalchemy.pool.Pool" title="sqlalchemy.pool.base.Pool"><span class="pre">Pool</span></a><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pool_args</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.engine.CreateEnginePlugin.handle_pool_kwargs" title="Permalink to this definition">¶</a></dt>
<dd><p>parse and modify pool kwargs</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.CreateEnginePlugin.update_url">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.CreateEnginePlugin"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.CreateEnginePlugin.</span></code></a><span class="sig-name descname"><span class="pre">update_url</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">url</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">URL</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">URL</span></span></span><a class="headerlink" href="#sqlalchemy.engine.CreateEnginePlugin.update_url" title="Permalink to this definition">¶</a></dt>
<dd><p>Update the <code class="xref py py-class docutils literal notranslate"><span class="pre">URL</span></code>.</p>
<p>A new <code class="xref py py-class docutils literal notranslate"><span class="pre">URL</span></code> should be returned.   This method is
typically used to consume configuration arguments from the
<code class="xref py py-class docutils literal notranslate"><span class="pre">URL</span></code> which must be removed, as they will not be
recognized by the dialect.  The
<code class="xref py py-meth docutils literal notranslate"><span class="pre">URL.difference_update_query()</span></code> method is available
to remove these arguments.   See the docstring at
<a class="reference internal" href="#sqlalchemy.engine.CreateEnginePlugin" title="sqlalchemy.engine.CreateEnginePlugin"><code class="xref py py-class docutils literal notranslate"><span class="pre">CreateEnginePlugin</span></code></a> for an example.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.4.</span></p>
</div>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.engine.Engine">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.engine.</span></span><span class="sig-name descname"><span class="pre">Engine</span></span><a class="headerlink" href="#sqlalchemy.engine.Engine" title="Permalink to this definition">¶</a></dt>
<dd><p>Connects a <a class="reference internal" href="pooling.html#sqlalchemy.pool.Pool" title="sqlalchemy.pool.Pool"><code class="xref py py-class docutils literal notranslate"><span class="pre">Pool</span></code></a> and
<a class="reference internal" href="internals.html#sqlalchemy.engine.Dialect" title="sqlalchemy.engine.interfaces.Dialect"><code class="xref py py-class docutils literal notranslate"><span class="pre">Dialect</span></code></a> together to provide a
source of database connectivity and behavior.</p>
<p>An <a class="reference internal" href="#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a> object is instantiated publicly using the
<code class="xref py py-func docutils literal notranslate"><span class="pre">create_engine()</span></code> function.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="engines.html"><span class="doc">引擎配置</span></a></p>
<p><a class="reference internal" href="#"><span class="std std-ref">使用 Engine 和 Connections</span></a></p>
</div>
<div class="class-members docutils container">
<p><strong>Members</strong></p>
<p><a class="reference internal" href="#sqlalchemy.engine.Engine.begin"><span class="sig-name descname">begin()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.Engine.clear_compiled_cache"><span class="sig-name descname">clear_compiled_cache()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.Engine.connect"><span class="sig-name descname">connect()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.Engine.dispose"><span class="sig-name descname">dispose()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.Engine.driver"><span class="sig-name descname">driver</span></a>, <a class="reference internal" href="#sqlalchemy.engine.Engine.engine"><span class="sig-name descname">engine</span></a>, <a class="reference internal" href="#sqlalchemy.engine.Engine.execution_options"><span class="sig-name descname">execution_options()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.Engine.get_execution_options"><span class="sig-name descname">get_execution_options()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.Engine.name"><span class="sig-name descname">name</span></a>, <a class="reference internal" href="#sqlalchemy.engine.Engine.raw_connection"><span class="sig-name descname">raw_connection()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.Engine.update_execution_options"><span class="sig-name descname">update_execution_options()</span></a></p>
</div>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.engine.Engine</span></code></a> (<code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.engine.interfaces.ConnectionEventsTarget</span></code>, <a class="reference internal" href="internals.html#sqlalchemy.log.Identified" title="sqlalchemy.log.Identified"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.log.Identified</span></code></a>, <code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.inspection.Inspectable</span></code>)</p>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.Engine.begin">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.Engine"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.Engine.</span></code></a><span class="sig-name descname"><span class="pre">begin</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Iterator</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#sqlalchemy.engine.Connection" title="sqlalchemy.engine.base.Connection"><span class="pre">Connection</span></a><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#sqlalchemy.engine.Engine.begin" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a context manager delivering a <a class="reference internal" href="#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a>
with a <a class="reference internal" href="#sqlalchemy.engine.Transaction" title="sqlalchemy.engine.Transaction"><code class="xref py py-class docutils literal notranslate"><span class="pre">Transaction</span></code></a> established.</p>
<p>E.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">engine</span><span class="o">.</span><span class="n">begin</span><span class="p">()</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
        <span class="n">text</span><span class="p">(</span><span class="s2">&quot;insert into table (x, y, z) values (1, 2, 3)&quot;</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">text</span><span class="p">(</span><span class="s2">&quot;my_special_procedure(5)&quot;</span><span class="p">))</span></pre></div>
</div>
<p>Upon successful operation, the <a class="reference internal" href="#sqlalchemy.engine.Transaction" title="sqlalchemy.engine.Transaction"><code class="xref py py-class docutils literal notranslate"><span class="pre">Transaction</span></code></a>
is committed.  If an error is raised, the <a class="reference internal" href="#sqlalchemy.engine.Transaction" title="sqlalchemy.engine.Transaction"><code class="xref py py-class docutils literal notranslate"><span class="pre">Transaction</span></code></a>
is rolled back.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#sqlalchemy.engine.Engine.connect" title="sqlalchemy.engine.Engine.connect"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Engine.connect()</span></code></a> - procure a
<a class="reference internal" href="#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a> from
an <a class="reference internal" href="#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a>.</p>
<p><a class="reference internal" href="#sqlalchemy.engine.Connection.begin" title="sqlalchemy.engine.Connection.begin"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.begin()</span></code></a> - start a <a class="reference internal" href="#sqlalchemy.engine.Transaction" title="sqlalchemy.engine.Transaction"><code class="xref py py-class docutils literal notranslate"><span class="pre">Transaction</span></code></a>
for a particular <a class="reference internal" href="#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a>.</p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.Engine.clear_compiled_cache">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.Engine"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.Engine.</span></code></a><span class="sig-name descname"><span class="pre">clear_compiled_cache</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.engine.Engine.clear_compiled_cache" title="Permalink to this definition">¶</a></dt>
<dd><p>Clear the compiled cache associated with the dialect.</p>
<p>This applies <strong>only</strong> to the built-in cache that is established
via the <code class="xref py py-paramref docutils literal notranslate"><span class="pre">create_engine.query_cache_size</span></code> parameter.
It will not impact any dictionary caches that were passed via the
<a class="reference internal" href="#sqlalchemy.engine.Connection.execution_options.params.query_cache" title="sqlalchemy.engine.Connection.execution_options"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Connection.execution_options.query_cache</span></code></a> parameter.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.4.</span></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.Engine.connect">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.Engine"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.Engine.</span></code></a><span class="sig-name descname"><span class="pre">connect</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#sqlalchemy.engine.Connection" title="sqlalchemy.engine.base.Connection"><span class="pre">Connection</span></a></span></span><a class="headerlink" href="#sqlalchemy.engine.Engine.connect" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a new <a class="reference internal" href="#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a> object.</p>
<p>The <a class="reference internal" href="#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a> acts as a Python context manager, so
the typical use of this method looks like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">engine</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
    <span class="n">connection</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">text</span><span class="p">(</span><span class="s2">&quot;insert into table values (&#39;foo&#39;)&quot;</span><span class="p">))</span>
    <span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span></pre></div>
</div>
<p>Where above, after the block is completed, the connection is “closed”
and its underlying DBAPI resources are returned to the connection pool.
This also has the effect of rolling back any transaction that
was explicitly begun or was begun via autobegin, and will
emit the <a class="reference internal" href="events.html#sqlalchemy.events.ConnectionEvents.rollback" title="sqlalchemy.events.ConnectionEvents.rollback"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ConnectionEvents.rollback()</span></code></a> event if one was
started and is still in progress.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#sqlalchemy.engine.Engine.begin" title="sqlalchemy.engine.Engine.begin"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Engine.begin()</span></code></a></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.Engine.dispose">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.Engine"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.Engine.</span></code></a><span class="sig-name descname"><span class="pre">dispose</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">close</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.engine.Engine.dispose" title="Permalink to this definition">¶</a></dt>
<dd><p>Dispose of the connection pool used by this
<a class="reference internal" href="#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a>.</p>
<p>A new connection pool is created immediately after the old one has been
disposed. The previous connection pool is disposed either actively, by
closing out all currently checked-in connections in that pool, or
passively, by losing references to it but otherwise not closing any
connections. The latter strategy is more appropriate for an initializer
in a forked Python process.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><span class="target" id="sqlalchemy.engine.Engine.dispose.params.close"></span><strong>close</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.engine.Engine.dispose.params.close">¶</a> – <p>if left at its default of <code class="docutils literal notranslate"><span class="pre">True</span></code>, has the
effect of fully closing all <strong>currently checked in</strong>
database connections.  Connections that are still checked out
will <strong>not</strong> be closed, however they will no longer be associated
with this <a class="reference internal" href="#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a>,
so when they are closed individually, eventually the
<a class="reference internal" href="pooling.html#sqlalchemy.pool.Pool" title="sqlalchemy.pool.Pool"><code class="xref py py-class docutils literal notranslate"><span class="pre">Pool</span></code></a> which they are associated with will
be garbage collected and they will be closed out fully, if
not already closed on checkin.</p>
<p>If set to <code class="docutils literal notranslate"><span class="pre">False</span></code>, the previous connection pool is de-referenced,
and otherwise not touched in any way.</p>
</p>
</dd>
</dl>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.4.33: </span>Added the <a class="reference internal" href="#sqlalchemy.engine.Engine.dispose.params.close" title="sqlalchemy.engine.Engine.dispose"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Engine.dispose.close</span></code></a>
parameter to allow the replacement of a connection pool in a child
process without interfering with the connections used by the parent
process.</p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#engine-disposal"><span class="std std-ref">引擎处理</span></a></p>
<p><span class="xref std std-ref">pooling_multiprocessing</span></p>
</div>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.engine.Engine.driver">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.engine.Engine"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.Engine.</span></code></a><span class="sig-name descname"><span class="pre">driver</span></span><a class="headerlink" href="#sqlalchemy.engine.Engine.driver" title="Permalink to this definition">¶</a></dt>
<dd><p>Driver name of the <a class="reference internal" href="internals.html#sqlalchemy.engine.Dialect" title="sqlalchemy.engine.interfaces.Dialect"><code class="xref py py-class docutils literal notranslate"><span class="pre">Dialect</span></code></a>
in use by this <a class="reference internal" href="#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a>.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.engine.Engine.engine">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.engine.Engine"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.Engine.</span></code></a><span class="sig-name descname"><span class="pre">engine</span></span><a class="headerlink" href="#sqlalchemy.engine.Engine.engine" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns this <a class="reference internal" href="#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a>.</p>
<p>Used for legacy schemes that accept <a class="reference internal" href="#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a> /
<a class="reference internal" href="#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a> objects within the same variable.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.Engine.execution_options">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.Engine"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.Engine.</span></code></a><span class="sig-name descname"><span class="pre">execution_options</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">opt</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">OptionEngine</span></span></span><a class="headerlink" href="#sqlalchemy.engine.Engine.execution_options" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a new <a class="reference internal" href="#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a> that will provide
<a class="reference internal" href="#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a> objects with the given execution options.</p>
<p>The returned <a class="reference internal" href="#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a> remains related to the original
<a class="reference internal" href="#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a> in that it shares the same connection pool and
other state:</p>
<ul class="simple">
<li><p>The <a class="reference internal" href="pooling.html#sqlalchemy.pool.Pool" title="sqlalchemy.pool.Pool"><code class="xref py py-class docutils literal notranslate"><span class="pre">Pool</span></code></a> used by the new <a class="reference internal" href="#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a>
is the
same instance.  The <a class="reference internal" href="#sqlalchemy.engine.Engine.dispose" title="sqlalchemy.engine.Engine.dispose"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Engine.dispose()</span></code></a>
method will replace
the connection pool instance for the parent engine as well
as this one.</p></li>
<li><p>Event listeners are “cascaded” - meaning, the new
<a class="reference internal" href="#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a>
inherits the events of the parent, and new events can be associated
with the new <a class="reference internal" href="#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a> individually.</p></li>
<li><p>The logging configuration and logging_name is copied from the parent
<a class="reference internal" href="#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a>.</p></li>
</ul>
<p>The intent of the <a class="reference internal" href="#sqlalchemy.engine.Engine.execution_options" title="sqlalchemy.engine.Engine.execution_options"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Engine.execution_options()</span></code></a> method is
to implement schemes where multiple <a class="reference internal" href="#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a>
objects refer to the same connection pool, but are differentiated
by options that affect some execution-level behavior for each
engine.    One such example is breaking into separate “reader” and
“writer” <a class="reference internal" href="#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a> instances, where one
<a class="reference internal" href="#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a>
has a lower <span class="xref std std-term">isolation level</span> setting configured or is even
transaction-disabled using “autocommit”.  An example of this
configuration is at <a class="reference internal" href="#dbapi-autocommit-multiple"><span class="std std-ref">对于单个引擎维护多个隔离级别</span></a>.</p>
<p>Another example is one that
uses a custom option <code class="docutils literal notranslate"><span class="pre">shard_id</span></code> which is consumed by an event
to change the current schema on a database connection:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">event</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.engine</span> <span class="kn">import</span> <span class="n">Engine</span>

<span class="n">primary_engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s2">&quot;mysql+mysqldb://&quot;</span><span class="p">)</span>
<span class="n">shard1</span> <span class="o">=</span> <span class="n">primary_engine</span><span class="o">.</span><span class="n">execution_options</span><span class="p">(</span><span class="n">shard_id</span><span class="o">=</span><span class="s2">&quot;shard1&quot;</span><span class="p">)</span>
<span class="n">shard2</span> <span class="o">=</span> <span class="n">primary_engine</span><span class="o">.</span><span class="n">execution_options</span><span class="p">(</span><span class="n">shard_id</span><span class="o">=</span><span class="s2">&quot;shard2&quot;</span><span class="p">)</span>

<span class="n">shards</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="s2">&quot;base&quot;</span><span class="p">,</span> <span class="s2">&quot;shard_1&quot;</span><span class="p">:</span> <span class="s2">&quot;db1&quot;</span><span class="p">,</span> <span class="s2">&quot;shard_2&quot;</span><span class="p">:</span> <span class="s2">&quot;db2&quot;</span><span class="p">}</span>

<span class="nd">@event</span><span class="o">.</span><span class="n">listens_for</span><span class="p">(</span><span class="n">Engine</span><span class="p">,</span> <span class="s2">&quot;before_cursor_execute&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">_switch_shard</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="n">cursor</span><span class="p">,</span> <span class="n">stmt</span><span class="p">,</span>
        <span class="n">params</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">executemany</span><span class="p">):</span>
    <span class="n">shard_id</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">get_execution_options</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;shard_id&#39;</span><span class="p">,</span> <span class="s2">&quot;default&quot;</span><span class="p">)</span>
    <span class="n">current_shard</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;current_shard&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">current_shard</span> <span class="o">!=</span> <span class="n">shard_id</span><span class="p">:</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;use </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">shards</span><span class="p">[</span><span class="n">shard_id</span><span class="p">])</span>
        <span class="n">conn</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s2">&quot;current_shard&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">shard_id</span></pre></div>
</div>
<p>The above recipe illustrates two <a class="reference internal" href="#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a> objects that
will each serve as factories for <a class="reference internal" href="#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a> objects
that have pre-established “shard_id” execution options present. A
<a class="reference internal" href="events.html#sqlalchemy.events.ConnectionEvents.before_cursor_execute" title="sqlalchemy.events.ConnectionEvents.before_cursor_execute"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ConnectionEvents.before_cursor_execute()</span></code></a> event handler
then interprets this execution option to emit a MySQL <code class="docutils literal notranslate"><span class="pre">use</span></code> statement
to switch databases before a statement execution, while at the same
time keeping track of which database we’ve established using the
<a class="reference internal" href="#sqlalchemy.engine.Connection.info" title="sqlalchemy.engine.Connection.info"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Connection.info</span></code></a> dictionary.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#sqlalchemy.engine.Connection.execution_options" title="sqlalchemy.engine.Connection.execution_options"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.execution_options()</span></code></a>
- update execution options
on a <a class="reference internal" href="#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a> object.</p>
<p><a class="reference internal" href="#sqlalchemy.engine.Engine.update_execution_options" title="sqlalchemy.engine.Engine.update_execution_options"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Engine.update_execution_options()</span></code></a>
- update the execution
options for a given <a class="reference internal" href="#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a> in place.</p>
<p><a class="reference internal" href="#sqlalchemy.engine.Engine.get_execution_options" title="sqlalchemy.engine.Engine.get_execution_options"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Engine.get_execution_options()</span></code></a></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.Engine.get_execution_options">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.Engine"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.Engine.</span></code></a><span class="sig-name descname"><span class="pre">get_execution_options</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">_ExecuteOptions</span></span></span><a class="headerlink" href="#sqlalchemy.engine.Engine.get_execution_options" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the non-SQL options which will take effect during execution.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#sqlalchemy.engine.Engine.execution_options" title="sqlalchemy.engine.Engine.execution_options"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Engine.execution_options()</span></code></a></p>
</div>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.engine.Engine.name">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.engine.Engine"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.Engine.</span></code></a><span class="sig-name descname"><span class="pre">name</span></span><a class="headerlink" href="#sqlalchemy.engine.Engine.name" title="Permalink to this definition">¶</a></dt>
<dd><p>String name of the <a class="reference internal" href="internals.html#sqlalchemy.engine.Dialect" title="sqlalchemy.engine.interfaces.Dialect"><code class="xref py py-class docutils literal notranslate"><span class="pre">Dialect</span></code></a>
in use by this <a class="reference internal" href="#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a>.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.Engine.raw_connection">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.Engine"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.Engine.</span></code></a><span class="sig-name descname"><span class="pre">raw_connection</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="pooling.html#sqlalchemy.pool.PoolProxiedConnection" title="sqlalchemy.pool.PoolProxiedConnection"><span class="pre">PoolProxiedConnection</span></a></span></span><a class="headerlink" href="#sqlalchemy.engine.Engine.raw_connection" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a “raw” DBAPI connection from the connection pool.</p>
<p>The returned object is a proxied version of the DBAPI
connection object used by the underlying driver in use.
The object will have all the same behavior as the real DBAPI
connection, except that its <code class="docutils literal notranslate"><span class="pre">close()</span></code> method will result in the
connection being returned to the pool, rather than being closed
for real.</p>
<p>This method provides direct DBAPI connection access for
special situations when the API provided by
<a class="reference internal" href="#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a>
is not needed.   When a <a class="reference internal" href="#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a> object is already
present, the DBAPI connection is available using
the <a class="reference internal" href="#sqlalchemy.engine.Connection.connection" title="sqlalchemy.engine.Connection.connection"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Connection.connection</span></code></a> accessor.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#dbapi-connections"><span class="std std-ref">使用Driver SQL和 Raw DBAPI Connections 工作</span></a></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.Engine.update_execution_options">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.Engine"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.Engine.</span></code></a><span class="sig-name descname"><span class="pre">update_execution_options</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">opt</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.engine.Engine.update_execution_options" title="Permalink to this definition">¶</a></dt>
<dd><p>Update the default execution_options dictionary
of this <a class="reference internal" href="#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a>.</p>
<p>The given keys/values in **opt are added to the
default execution options that will be used for
all connections.  The initial contents of this dictionary
can be sent via the <code class="docutils literal notranslate"><span class="pre">execution_options</span></code> parameter
to <code class="xref py py-func docutils literal notranslate"><span class="pre">create_engine()</span></code>.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#sqlalchemy.engine.Connection.execution_options" title="sqlalchemy.engine.Connection.execution_options"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.execution_options()</span></code></a></p>
<p><a class="reference internal" href="#sqlalchemy.engine.Engine.execution_options" title="sqlalchemy.engine.Engine.execution_options"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Engine.execution_options()</span></code></a></p>
</div>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.engine.ExceptionContext">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.engine.</span></span><span class="sig-name descname"><span class="pre">ExceptionContext</span></span><a class="headerlink" href="#sqlalchemy.engine.ExceptionContext" title="Permalink to this definition">¶</a></dt>
<dd><p>Encapsulate information about an error condition in progress.</p>
<div class="class-members docutils container">
<p><strong>Members</strong></p>
<p><a class="reference internal" href="#sqlalchemy.engine.ExceptionContext.chained_exception"><span class="sig-name descname">chained_exception</span></a>, <a class="reference internal" href="#sqlalchemy.engine.ExceptionContext.connection"><span class="sig-name descname">connection</span></a>, <a class="reference internal" href="#sqlalchemy.engine.ExceptionContext.cursor"><span class="sig-name descname">cursor</span></a>, <a class="reference internal" href="#sqlalchemy.engine.ExceptionContext.dialect"><span class="sig-name descname">dialect</span></a>, <a class="reference internal" href="#sqlalchemy.engine.ExceptionContext.engine"><span class="sig-name descname">engine</span></a>, <a class="reference internal" href="#sqlalchemy.engine.ExceptionContext.execution_context"><span class="sig-name descname">execution_context</span></a>, <a class="reference internal" href="#sqlalchemy.engine.ExceptionContext.invalidate_pool_on_disconnect"><span class="sig-name descname">invalidate_pool_on_disconnect</span></a>, <a class="reference internal" href="#sqlalchemy.engine.ExceptionContext.is_disconnect"><span class="sig-name descname">is_disconnect</span></a>, <a class="reference internal" href="#sqlalchemy.engine.ExceptionContext.is_pre_ping"><span class="sig-name descname">is_pre_ping</span></a>, <a class="reference internal" href="#sqlalchemy.engine.ExceptionContext.original_exception"><span class="sig-name descname">original_exception</span></a>, <a class="reference internal" href="#sqlalchemy.engine.ExceptionContext.parameters"><span class="sig-name descname">parameters</span></a>, <a class="reference internal" href="#sqlalchemy.engine.ExceptionContext.sqlalchemy_exception"><span class="sig-name descname">sqlalchemy_exception</span></a>, <a class="reference internal" href="#sqlalchemy.engine.ExceptionContext.statement"><span class="sig-name descname">statement</span></a></p>
</div>
<p>This object exists solely to be passed to the
<a class="reference internal" href="events.html#sqlalchemy.events.DialectEvents.handle_error" title="sqlalchemy.events.DialectEvents.handle_error"><code class="xref py py-meth docutils literal notranslate"><span class="pre">DialectEvents.handle_error()</span></code></a> event,
supporting an interface that
can be extended without backwards-incompatibility.</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.engine.ExceptionContext.chained_exception">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.engine.ExceptionContext"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.ExceptionContext.</span></code></a><span class="sig-name descname"><span class="pre">chained_exception</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">BaseException</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></em><a class="headerlink" href="#sqlalchemy.engine.ExceptionContext.chained_exception" title="Permalink to this definition">¶</a></dt>
<dd><p>The exception that was returned by the previous handler in the
exception chain, if any.</p>
<p>If present, this exception will be the one ultimately raised by
SQLAlchemy unless a subsequent handler replaces it.</p>
<p>May be None.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.engine.ExceptionContext.connection">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.engine.ExceptionContext"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.ExceptionContext.</span></code></a><span class="sig-name descname"><span class="pre">connection</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference internal" href="#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><span class="pre">Connection</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></em><a class="headerlink" href="#sqlalchemy.engine.ExceptionContext.connection" title="Permalink to this definition">¶</a></dt>
<dd><p>The <a class="reference internal" href="#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a> in use during the exception.</p>
<p>This member is present, except in the case of a failure when
first connecting.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#sqlalchemy.engine.ExceptionContext.engine" title="sqlalchemy.engine.ExceptionContext.engine"><code class="xref py py-attr docutils literal notranslate"><span class="pre">ExceptionContext.engine</span></code></a></p>
</div>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.engine.ExceptionContext.cursor">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.engine.ExceptionContext"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.ExceptionContext.</span></code></a><span class="sig-name descname"><span class="pre">cursor</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference internal" href="internals.html#sqlalchemy.engine.interfaces.DBAPICursor" title="sqlalchemy.engine.interfaces.DBAPICursor"><span class="pre">DBAPICursor</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></em><a class="headerlink" href="#sqlalchemy.engine.ExceptionContext.cursor" title="Permalink to this definition">¶</a></dt>
<dd><p>The DBAPI cursor object.</p>
<p>May be None.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.engine.ExceptionContext.dialect">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.engine.ExceptionContext"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.ExceptionContext.</span></code></a><span class="sig-name descname"><span class="pre">dialect</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference internal" href="internals.html#sqlalchemy.engine.Dialect" title="sqlalchemy.engine.Dialect"><span class="pre">Dialect</span></a></em><a class="headerlink" href="#sqlalchemy.engine.ExceptionContext.dialect" title="Permalink to this definition">¶</a></dt>
<dd><p>The <a class="reference internal" href="internals.html#sqlalchemy.engine.Dialect" title="sqlalchemy.engine.Dialect"><code class="xref py py-class docutils literal notranslate"><span class="pre">Dialect</span></code></a> in use.</p>
<p>This member is present for all invocations of the event hook.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 2.0.</span></p>
</div>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.engine.ExceptionContext.engine">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.engine.ExceptionContext"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.ExceptionContext.</span></code></a><span class="sig-name descname"><span class="pre">engine</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference internal" href="#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><span class="pre">Engine</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></em><a class="headerlink" href="#sqlalchemy.engine.ExceptionContext.engine" title="Permalink to this definition">¶</a></dt>
<dd><p>The <a class="reference internal" href="#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a> in use during the exception.</p>
<p>This member is present in all cases except for when handling an error
within the connection pool “pre-ping” process.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.engine.ExceptionContext.execution_context">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.engine.ExceptionContext"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.ExceptionContext.</span></code></a><span class="sig-name descname"><span class="pre">execution_context</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference internal" href="internals.html#sqlalchemy.engine.ExecutionContext" title="sqlalchemy.engine.ExecutionContext"><span class="pre">ExecutionContext</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></em><a class="headerlink" href="#sqlalchemy.engine.ExceptionContext.execution_context" title="Permalink to this definition">¶</a></dt>
<dd><p>The <a class="reference internal" href="internals.html#sqlalchemy.engine.ExecutionContext" title="sqlalchemy.engine.ExecutionContext"><code class="xref py py-class docutils literal notranslate"><span class="pre">ExecutionContext</span></code></a> corresponding to the execution
operation in progress.</p>
<p>This is present for statement execution operations, but not for
operations such as transaction begin/end.  It also is not present when
the exception was raised before the <a class="reference internal" href="internals.html#sqlalchemy.engine.ExecutionContext" title="sqlalchemy.engine.ExecutionContext"><code class="xref py py-class docutils literal notranslate"><span class="pre">ExecutionContext</span></code></a>
could be constructed.</p>
<p>Note that the <a class="reference internal" href="#sqlalchemy.engine.ExceptionContext.statement" title="sqlalchemy.engine.ExceptionContext.statement"><code class="xref py py-attr docutils literal notranslate"><span class="pre">ExceptionContext.statement</span></code></a> and
<a class="reference internal" href="#sqlalchemy.engine.ExceptionContext.parameters" title="sqlalchemy.engine.ExceptionContext.parameters"><code class="xref py py-attr docutils literal notranslate"><span class="pre">ExceptionContext.parameters</span></code></a> members may represent a
different value than that of the <a class="reference internal" href="internals.html#sqlalchemy.engine.ExecutionContext" title="sqlalchemy.engine.ExecutionContext"><code class="xref py py-class docutils literal notranslate"><span class="pre">ExecutionContext</span></code></a>,
potentially in the case where a
<a class="reference internal" href="events.html#sqlalchemy.events.ConnectionEvents.before_cursor_execute" title="sqlalchemy.events.ConnectionEvents.before_cursor_execute"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ConnectionEvents.before_cursor_execute()</span></code></a> event or similar
modified the statement/parameters to be sent.</p>
<p>May be None.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.engine.ExceptionContext.invalidate_pool_on_disconnect">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.engine.ExceptionContext"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.ExceptionContext.</span></code></a><span class="sig-name descname"><span class="pre">invalidate_pool_on_disconnect</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">bool</span></em><a class="headerlink" href="#sqlalchemy.engine.ExceptionContext.invalidate_pool_on_disconnect" title="Permalink to this definition">¶</a></dt>
<dd><p>Represent whether all connections in the pool should be invalidated
when a “disconnect” condition is in effect.</p>
<p>Setting this flag to False within the scope of the
<a class="reference internal" href="events.html#sqlalchemy.events.DialectEvents.handle_error" title="sqlalchemy.events.DialectEvents.handle_error"><code class="xref py py-meth docutils literal notranslate"><span class="pre">DialectEvents.handle_error()</span></code></a>
event will have the effect such
that the full collection of connections in the pool will not be
invalidated during a disconnect; only the current connection that is the
subject of the error will actually be invalidated.</p>
<p>The purpose of this flag is for custom disconnect-handling schemes where
the invalidation of other connections in the pool is to be performed
based on other conditions, or even on a per-connection basis.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.engine.ExceptionContext.is_disconnect">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.engine.ExceptionContext"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.ExceptionContext.</span></code></a><span class="sig-name descname"><span class="pre">is_disconnect</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">bool</span></em><a class="headerlink" href="#sqlalchemy.engine.ExceptionContext.is_disconnect" title="Permalink to this definition">¶</a></dt>
<dd><p>Represent whether the exception as occurred represents a “disconnect”
condition.</p>
<p>This flag will always be True or False within the scope of the
<a class="reference internal" href="events.html#sqlalchemy.events.DialectEvents.handle_error" title="sqlalchemy.events.DialectEvents.handle_error"><code class="xref py py-meth docutils literal notranslate"><span class="pre">DialectEvents.handle_error()</span></code></a> handler.</p>
<p>SQLAlchemy will defer to this flag in order to determine whether or not
the connection should be invalidated subsequently.    That is, by
assigning to this flag, a “disconnect” event which then results in
a connection and pool invalidation can be invoked or prevented by
changing this flag.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The pool “pre_ping” handler enabled using the
<code class="xref py py-paramref docutils literal notranslate"><span class="pre">create_engine.pool_pre_ping</span></code> parameter does <strong>not</strong>
consult this event before deciding if the “ping” returned false,
as opposed to receiving an unhandled error.   For this use case, the
<a class="reference internal" href="pooling.html#pool-disconnects-pessimistic-custom"><span class="std std-ref">legacy recipe based on engine_connect() may be used</span></a>.  A future API allow more
comprehensive customization of the “disconnect” detection mechanism
across all functions.</p>
</div>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.engine.ExceptionContext.is_pre_ping">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.engine.ExceptionContext"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.ExceptionContext.</span></code></a><span class="sig-name descname"><span class="pre">is_pre_ping</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">bool</span></em><a class="headerlink" href="#sqlalchemy.engine.ExceptionContext.is_pre_ping" title="Permalink to this definition">¶</a></dt>
<dd><p>Indicates if this error is occurring within the “pre-ping” step
performed when <code class="xref py py-paramref docutils literal notranslate"><span class="pre">create_engine.pool_pre_ping</span></code> is set to
<code class="docutils literal notranslate"><span class="pre">True</span></code>.  In this mode, the <a class="reference internal" href="#sqlalchemy.engine.ExceptionContext.engine" title="sqlalchemy.engine.ExceptionContext.engine"><code class="xref py py-attr docutils literal notranslate"><span class="pre">ExceptionContext.engine</span></code></a> attribute
will be <code class="docutils literal notranslate"><span class="pre">None</span></code>.  The dialect in use is accessible via the
<a class="reference internal" href="#sqlalchemy.engine.ExceptionContext.dialect" title="sqlalchemy.engine.ExceptionContext.dialect"><code class="xref py py-attr docutils literal notranslate"><span class="pre">ExceptionContext.dialect</span></code></a> attribute.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 2.0.5.</span></p>
</div>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.engine.ExceptionContext.original_exception">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.engine.ExceptionContext"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.ExceptionContext.</span></code></a><span class="sig-name descname"><span class="pre">original_exception</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">BaseException</span></em><a class="headerlink" href="#sqlalchemy.engine.ExceptionContext.original_exception" title="Permalink to this definition">¶</a></dt>
<dd><p>The exception object which was caught.</p>
<p>This member is always present.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.engine.ExceptionContext.parameters">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.engine.ExceptionContext"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.ExceptionContext.</span></code></a><span class="sig-name descname"><span class="pre">parameters</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">_DBAPIAnyExecuteParams</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></em><a class="headerlink" href="#sqlalchemy.engine.ExceptionContext.parameters" title="Permalink to this definition">¶</a></dt>
<dd><p>Parameter collection that was emitted directly to the DBAPI.</p>
<p>May be None.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.engine.ExceptionContext.sqlalchemy_exception">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.engine.ExceptionContext"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.ExceptionContext.</span></code></a><span class="sig-name descname"><span class="pre">sqlalchemy_exception</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference internal" href="exceptions.html#sqlalchemy.exc.StatementError" title="sqlalchemy.exc.StatementError"><span class="pre">StatementError</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></em><a class="headerlink" href="#sqlalchemy.engine.ExceptionContext.sqlalchemy_exception" title="Permalink to this definition">¶</a></dt>
<dd><p>The <a class="reference internal" href="exceptions.html#sqlalchemy.exc.StatementError" title="sqlalchemy.exc.StatementError"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.exc.StatementError</span></code></a> which wraps the original,
and will be raised if exception handling is not circumvented by the event.</p>
<p>May be None, as not all exception types are wrapped by SQLAlchemy.
For DBAPI-level exceptions that subclass the dbapi’s Error class, this
field will always be present.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.engine.ExceptionContext.statement">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.engine.ExceptionContext"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.ExceptionContext.</span></code></a><span class="sig-name descname"><span class="pre">statement</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></em><a class="headerlink" href="#sqlalchemy.engine.ExceptionContext.statement" title="Permalink to this definition">¶</a></dt>
<dd><p>String SQL statement that was emitted directly to the DBAPI.</p>
<p>May be None.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.engine.NestedTransaction">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.engine.</span></span><span class="sig-name descname"><span class="pre">NestedTransaction</span></span><a class="headerlink" href="#sqlalchemy.engine.NestedTransaction" title="Permalink to this definition">¶</a></dt>
<dd><p>Represent a ‘nested’, or SAVEPOINT transaction.</p>
<p>The <a class="reference internal" href="#sqlalchemy.engine.NestedTransaction" title="sqlalchemy.engine.NestedTransaction"><code class="xref py py-class docutils literal notranslate"><span class="pre">NestedTransaction</span></code></a> object is created by calling the
<a class="reference internal" href="#sqlalchemy.engine.Connection.begin_nested" title="sqlalchemy.engine.Connection.begin_nested"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.begin_nested()</span></code></a> method of
<a class="reference internal" href="#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a>.</p>
<p>When using <a class="reference internal" href="#sqlalchemy.engine.NestedTransaction" title="sqlalchemy.engine.NestedTransaction"><code class="xref py py-class docutils literal notranslate"><span class="pre">NestedTransaction</span></code></a>, the semantics of “begin” /
“commit” / “rollback” are as follows:</p>
<ul class="simple">
<li><p>the “begin” operation corresponds to the “BEGIN SAVEPOINT” command, where
the savepoint is given an explicit name that is part of the state
of this object.</p></li>
<li><p>The <a class="reference internal" href="#sqlalchemy.engine.NestedTransaction.commit" title="sqlalchemy.engine.NestedTransaction.commit"><code class="xref py py-meth docutils literal notranslate"><span class="pre">NestedTransaction.commit()</span></code></a> method corresponds to a
“RELEASE SAVEPOINT” operation, using the savepoint identifier associated
with this <a class="reference internal" href="#sqlalchemy.engine.NestedTransaction" title="sqlalchemy.engine.NestedTransaction"><code class="xref py py-class docutils literal notranslate"><span class="pre">NestedTransaction</span></code></a>.</p></li>
<li><p>The <a class="reference internal" href="#sqlalchemy.engine.NestedTransaction.rollback" title="sqlalchemy.engine.NestedTransaction.rollback"><code class="xref py py-meth docutils literal notranslate"><span class="pre">NestedTransaction.rollback()</span></code></a> method corresponds to a
“ROLLBACK TO SAVEPOINT” operation, using the savepoint identifier
associated with this <a class="reference internal" href="#sqlalchemy.engine.NestedTransaction" title="sqlalchemy.engine.NestedTransaction"><code class="xref py py-class docutils literal notranslate"><span class="pre">NestedTransaction</span></code></a>.</p></li>
</ul>
<p>The rationale for mimicking the semantics of an outer transaction in
terms of savepoints so that code may deal with a “savepoint” transaction
and an “outer” transaction in an agnostic way.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../orm/session_transaction.html#session-begin-nested"><span class="std std-ref">使用 SAVEPOINT</span></a> - ORM version of the SAVEPOINT API.</p>
</div>
<div class="class-members docutils container">
<p><strong>Members</strong></p>
<p><a class="reference internal" href="#sqlalchemy.engine.NestedTransaction.close"><span class="sig-name descname">close()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.NestedTransaction.commit"><span class="sig-name descname">commit()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.NestedTransaction.rollback"><span class="sig-name descname">rollback()</span></a></p>
</div>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.engine.NestedTransaction" title="sqlalchemy.engine.NestedTransaction"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.engine.NestedTransaction</span></code></a> (<a class="reference internal" href="#sqlalchemy.engine.Transaction" title="sqlalchemy.engine.Transaction"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.engine.Transaction</span></code></a>)</p>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.NestedTransaction.close">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.NestedTransaction"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.NestedTransaction.</span></code></a><span class="sig-name descname"><span class="pre">close</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.engine.NestedTransaction.close" title="Permalink to this definition">¶</a></dt>
<dd><div class="inherited-member docutils container">
<p><em>inherited from the</em> <a class="reference internal" href="#sqlalchemy.engine.Transaction.close" title="sqlalchemy.engine.Transaction.close"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Transaction.close()</span></code></a> <em>method of</em> <a class="reference internal" href="#sqlalchemy.engine.Transaction" title="sqlalchemy.engine.Transaction"><code class="xref py py-class docutils literal notranslate"><span class="pre">Transaction</span></code></a></p>
</div>
<p>Close this <a class="reference internal" href="#sqlalchemy.engine.Transaction" title="sqlalchemy.engine.Transaction"><code class="xref py py-class docutils literal notranslate"><span class="pre">Transaction</span></code></a>.</p>
<p>If this transaction is the base transaction in a begin/commit
nesting, the transaction will rollback().  Otherwise, the
method returns.</p>
<p>This is used to cancel a Transaction without affecting the scope of
an enclosing transaction.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.NestedTransaction.commit">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.NestedTransaction"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.NestedTransaction.</span></code></a><span class="sig-name descname"><span class="pre">commit</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.engine.NestedTransaction.commit" title="Permalink to this definition">¶</a></dt>
<dd><div class="inherited-member docutils container">
<p><em>inherited from the</em> <a class="reference internal" href="#sqlalchemy.engine.Transaction.commit" title="sqlalchemy.engine.Transaction.commit"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Transaction.commit()</span></code></a> <em>method of</em> <a class="reference internal" href="#sqlalchemy.engine.Transaction" title="sqlalchemy.engine.Transaction"><code class="xref py py-class docutils literal notranslate"><span class="pre">Transaction</span></code></a></p>
</div>
<p>Commit this <a class="reference internal" href="#sqlalchemy.engine.Transaction" title="sqlalchemy.engine.Transaction"><code class="xref py py-class docutils literal notranslate"><span class="pre">Transaction</span></code></a>.</p>
<p>The implementation of this may vary based on the type of transaction in
use:</p>
<ul class="simple">
<li><p>For a simple database transaction (e.g. <a class="reference internal" href="#sqlalchemy.engine.RootTransaction" title="sqlalchemy.engine.RootTransaction"><code class="xref py py-class docutils literal notranslate"><span class="pre">RootTransaction</span></code></a>),
it corresponds to a COMMIT.</p></li>
<li><p>For a <a class="reference internal" href="#sqlalchemy.engine.NestedTransaction" title="sqlalchemy.engine.NestedTransaction"><code class="xref py py-class docutils literal notranslate"><span class="pre">NestedTransaction</span></code></a>, it corresponds to a
“RELEASE SAVEPOINT” operation.</p></li>
<li><p>For a <a class="reference internal" href="#sqlalchemy.engine.TwoPhaseTransaction" title="sqlalchemy.engine.TwoPhaseTransaction"><code class="xref py py-class docutils literal notranslate"><span class="pre">TwoPhaseTransaction</span></code></a>, DBAPI-specific methods for two
phase transactions may be used.</p></li>
</ul>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.NestedTransaction.rollback">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.NestedTransaction"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.NestedTransaction.</span></code></a><span class="sig-name descname"><span class="pre">rollback</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.engine.NestedTransaction.rollback" title="Permalink to this definition">¶</a></dt>
<dd><div class="inherited-member docutils container">
<p><em>inherited from the</em> <a class="reference internal" href="#sqlalchemy.engine.Transaction.rollback" title="sqlalchemy.engine.Transaction.rollback"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Transaction.rollback()</span></code></a> <em>method of</em> <a class="reference internal" href="#sqlalchemy.engine.Transaction" title="sqlalchemy.engine.Transaction"><code class="xref py py-class docutils literal notranslate"><span class="pre">Transaction</span></code></a></p>
</div>
<p>Roll back this <a class="reference internal" href="#sqlalchemy.engine.Transaction" title="sqlalchemy.engine.Transaction"><code class="xref py py-class docutils literal notranslate"><span class="pre">Transaction</span></code></a>.</p>
<p>The implementation of this may vary based on the type of transaction in
use:</p>
<ul class="simple">
<li><p>For a simple database transaction (e.g. <a class="reference internal" href="#sqlalchemy.engine.RootTransaction" title="sqlalchemy.engine.RootTransaction"><code class="xref py py-class docutils literal notranslate"><span class="pre">RootTransaction</span></code></a>),
it corresponds to a ROLLBACK.</p></li>
<li><p>For a <a class="reference internal" href="#sqlalchemy.engine.NestedTransaction" title="sqlalchemy.engine.NestedTransaction"><code class="xref py py-class docutils literal notranslate"><span class="pre">NestedTransaction</span></code></a>, it corresponds to a
“ROLLBACK TO SAVEPOINT” operation.</p></li>
<li><p>For a <a class="reference internal" href="#sqlalchemy.engine.TwoPhaseTransaction" title="sqlalchemy.engine.TwoPhaseTransaction"><code class="xref py py-class docutils literal notranslate"><span class="pre">TwoPhaseTransaction</span></code></a>, DBAPI-specific methods for two
phase transactions may be used.</p></li>
</ul>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.engine.RootTransaction">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.engine.</span></span><span class="sig-name descname"><span class="pre">RootTransaction</span></span><a class="headerlink" href="#sqlalchemy.engine.RootTransaction" title="Permalink to this definition">¶</a></dt>
<dd><p>Represent the “root” transaction on a <a class="reference internal" href="#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a>.</p>
<p>This corresponds to the current “BEGIN/COMMIT/ROLLBACK” that’s occurring
for the <a class="reference internal" href="#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a>. The <a class="reference internal" href="#sqlalchemy.engine.RootTransaction" title="sqlalchemy.engine.RootTransaction"><code class="xref py py-class docutils literal notranslate"><span class="pre">RootTransaction</span></code></a>
is created by calling upon the <a class="reference internal" href="#sqlalchemy.engine.Connection.begin" title="sqlalchemy.engine.Connection.begin"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.begin()</span></code></a> method, and
remains associated with the <a class="reference internal" href="#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a> throughout its
active span. The current <a class="reference internal" href="#sqlalchemy.engine.RootTransaction" title="sqlalchemy.engine.RootTransaction"><code class="xref py py-class docutils literal notranslate"><span class="pre">RootTransaction</span></code></a> in use is
accessible via the <a class="reference internal" href="#sqlalchemy.engine.Connection.get_transaction" title="sqlalchemy.engine.Connection.get_transaction"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Connection.get_transaction</span></code></a> method of
<a class="reference internal" href="#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a>.</p>
<p>In <span class="xref std std-term">2.0 style</span> use, the <a class="reference internal" href="#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a> also employs
“autobegin” behavior that will create a new
<a class="reference internal" href="#sqlalchemy.engine.RootTransaction" title="sqlalchemy.engine.RootTransaction"><code class="xref py py-class docutils literal notranslate"><span class="pre">RootTransaction</span></code></a> whenever a connection in a
non-transactional state is used to emit commands on the DBAPI connection.
The scope of the <a class="reference internal" href="#sqlalchemy.engine.RootTransaction" title="sqlalchemy.engine.RootTransaction"><code class="xref py py-class docutils literal notranslate"><span class="pre">RootTransaction</span></code></a> in 2.0 style
use can be controlled using the <a class="reference internal" href="#sqlalchemy.engine.Connection.commit" title="sqlalchemy.engine.Connection.commit"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.commit()</span></code></a> and
<a class="reference internal" href="#sqlalchemy.engine.Connection.rollback" title="sqlalchemy.engine.Connection.rollback"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.rollback()</span></code></a> methods.</p>
<div class="class-members docutils container">
<p><strong>Members</strong></p>
<p><a class="reference internal" href="#sqlalchemy.engine.RootTransaction.close"><span class="sig-name descname">close()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.RootTransaction.commit"><span class="sig-name descname">commit()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.RootTransaction.rollback"><span class="sig-name descname">rollback()</span></a></p>
</div>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.engine.RootTransaction" title="sqlalchemy.engine.RootTransaction"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.engine.RootTransaction</span></code></a> (<a class="reference internal" href="#sqlalchemy.engine.Transaction" title="sqlalchemy.engine.Transaction"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.engine.Transaction</span></code></a>)</p>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.RootTransaction.close">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.RootTransaction"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.RootTransaction.</span></code></a><span class="sig-name descname"><span class="pre">close</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.engine.RootTransaction.close" title="Permalink to this definition">¶</a></dt>
<dd><div class="inherited-member docutils container">
<p><em>inherited from the</em> <a class="reference internal" href="#sqlalchemy.engine.Transaction.close" title="sqlalchemy.engine.Transaction.close"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Transaction.close()</span></code></a> <em>method of</em> <a class="reference internal" href="#sqlalchemy.engine.Transaction" title="sqlalchemy.engine.Transaction"><code class="xref py py-class docutils literal notranslate"><span class="pre">Transaction</span></code></a></p>
</div>
<p>Close this <a class="reference internal" href="#sqlalchemy.engine.Transaction" title="sqlalchemy.engine.Transaction"><code class="xref py py-class docutils literal notranslate"><span class="pre">Transaction</span></code></a>.</p>
<p>If this transaction is the base transaction in a begin/commit
nesting, the transaction will rollback().  Otherwise, the
method returns.</p>
<p>This is used to cancel a Transaction without affecting the scope of
an enclosing transaction.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.RootTransaction.commit">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.RootTransaction"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.RootTransaction.</span></code></a><span class="sig-name descname"><span class="pre">commit</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.engine.RootTransaction.commit" title="Permalink to this definition">¶</a></dt>
<dd><div class="inherited-member docutils container">
<p><em>inherited from the</em> <a class="reference internal" href="#sqlalchemy.engine.Transaction.commit" title="sqlalchemy.engine.Transaction.commit"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Transaction.commit()</span></code></a> <em>method of</em> <a class="reference internal" href="#sqlalchemy.engine.Transaction" title="sqlalchemy.engine.Transaction"><code class="xref py py-class docutils literal notranslate"><span class="pre">Transaction</span></code></a></p>
</div>
<p>Commit this <a class="reference internal" href="#sqlalchemy.engine.Transaction" title="sqlalchemy.engine.Transaction"><code class="xref py py-class docutils literal notranslate"><span class="pre">Transaction</span></code></a>.</p>
<p>The implementation of this may vary based on the type of transaction in
use:</p>
<ul class="simple">
<li><p>For a simple database transaction (e.g. <a class="reference internal" href="#sqlalchemy.engine.RootTransaction" title="sqlalchemy.engine.RootTransaction"><code class="xref py py-class docutils literal notranslate"><span class="pre">RootTransaction</span></code></a>),
it corresponds to a COMMIT.</p></li>
<li><p>For a <a class="reference internal" href="#sqlalchemy.engine.NestedTransaction" title="sqlalchemy.engine.NestedTransaction"><code class="xref py py-class docutils literal notranslate"><span class="pre">NestedTransaction</span></code></a>, it corresponds to a
“RELEASE SAVEPOINT” operation.</p></li>
<li><p>For a <a class="reference internal" href="#sqlalchemy.engine.TwoPhaseTransaction" title="sqlalchemy.engine.TwoPhaseTransaction"><code class="xref py py-class docutils literal notranslate"><span class="pre">TwoPhaseTransaction</span></code></a>, DBAPI-specific methods for two
phase transactions may be used.</p></li>
</ul>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.RootTransaction.rollback">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.RootTransaction"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.RootTransaction.</span></code></a><span class="sig-name descname"><span class="pre">rollback</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.engine.RootTransaction.rollback" title="Permalink to this definition">¶</a></dt>
<dd><div class="inherited-member docutils container">
<p><em>inherited from the</em> <a class="reference internal" href="#sqlalchemy.engine.Transaction.rollback" title="sqlalchemy.engine.Transaction.rollback"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Transaction.rollback()</span></code></a> <em>method of</em> <a class="reference internal" href="#sqlalchemy.engine.Transaction" title="sqlalchemy.engine.Transaction"><code class="xref py py-class docutils literal notranslate"><span class="pre">Transaction</span></code></a></p>
</div>
<p>Roll back this <a class="reference internal" href="#sqlalchemy.engine.Transaction" title="sqlalchemy.engine.Transaction"><code class="xref py py-class docutils literal notranslate"><span class="pre">Transaction</span></code></a>.</p>
<p>The implementation of this may vary based on the type of transaction in
use:</p>
<ul class="simple">
<li><p>For a simple database transaction (e.g. <a class="reference internal" href="#sqlalchemy.engine.RootTransaction" title="sqlalchemy.engine.RootTransaction"><code class="xref py py-class docutils literal notranslate"><span class="pre">RootTransaction</span></code></a>),
it corresponds to a ROLLBACK.</p></li>
<li><p>For a <a class="reference internal" href="#sqlalchemy.engine.NestedTransaction" title="sqlalchemy.engine.NestedTransaction"><code class="xref py py-class docutils literal notranslate"><span class="pre">NestedTransaction</span></code></a>, it corresponds to a
“ROLLBACK TO SAVEPOINT” operation.</p></li>
<li><p>For a <a class="reference internal" href="#sqlalchemy.engine.TwoPhaseTransaction" title="sqlalchemy.engine.TwoPhaseTransaction"><code class="xref py py-class docutils literal notranslate"><span class="pre">TwoPhaseTransaction</span></code></a>, DBAPI-specific methods for two
phase transactions may be used.</p></li>
</ul>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.engine.Transaction">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.engine.</span></span><span class="sig-name descname"><span class="pre">Transaction</span></span><a class="headerlink" href="#sqlalchemy.engine.Transaction" title="Permalink to this definition">¶</a></dt>
<dd><p>Represent a database transaction in progress.</p>
<p>The <a class="reference internal" href="#sqlalchemy.engine.Transaction" title="sqlalchemy.engine.Transaction"><code class="xref py py-class docutils literal notranslate"><span class="pre">Transaction</span></code></a> object is procured by
calling the <a class="reference internal" href="#sqlalchemy.engine.Connection.begin" title="sqlalchemy.engine.Connection.begin"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.begin()</span></code></a> method of
<a class="reference internal" href="#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">create_engine</span>
<span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s2">&quot;postgresql+psycopg2://scott:tiger@localhost/test&quot;</span><span class="p">)</span>
<span class="n">connection</span> <span class="o">=</span> <span class="n">engine</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
<span class="n">trans</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">begin</span><span class="p">()</span>
<span class="n">connection</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">text</span><span class="p">(</span><span class="s2">&quot;insert into x (a, b) values (1, 2)&quot;</span><span class="p">))</span>
<span class="n">trans</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span></pre></div>
</div>
<p>The object provides <a class="reference internal" href="#sqlalchemy.engine.Transaction.rollback" title="sqlalchemy.engine.Transaction.rollback"><code class="xref py py-meth docutils literal notranslate"><span class="pre">rollback()</span></code></a> and <a class="reference internal" href="#sqlalchemy.engine.Transaction.commit" title="sqlalchemy.engine.Transaction.commit"><code class="xref py py-meth docutils literal notranslate"><span class="pre">commit()</span></code></a>
methods in order to control transaction boundaries.  It
also implements a context manager interface so that
the Python <code class="docutils literal notranslate"><span class="pre">with</span></code> statement can be used with the
<a class="reference internal" href="#sqlalchemy.engine.Connection.begin" title="sqlalchemy.engine.Connection.begin"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.begin()</span></code></a> method:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">connection</span><span class="o">.</span><span class="n">begin</span><span class="p">():</span>
    <span class="n">connection</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">text</span><span class="p">(</span><span class="s2">&quot;insert into x (a, b) values (1, 2)&quot;</span><span class="p">))</span></pre></div>
</div>
<p>The Transaction object is <strong>not</strong> threadsafe.</p>
<div class="class-members docutils container">
<p><strong>Members</strong></p>
<p><a class="reference internal" href="#sqlalchemy.engine.Transaction.close"><span class="sig-name descname">close()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.Transaction.commit"><span class="sig-name descname">commit()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.Transaction.rollback"><span class="sig-name descname">rollback()</span></a></p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#sqlalchemy.engine.Connection.begin" title="sqlalchemy.engine.Connection.begin"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.begin()</span></code></a></p>
<p><a class="reference internal" href="#sqlalchemy.engine.Connection.begin_twophase" title="sqlalchemy.engine.Connection.begin_twophase"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.begin_twophase()</span></code></a></p>
<p><a class="reference internal" href="#sqlalchemy.engine.Connection.begin_nested" title="sqlalchemy.engine.Connection.begin_nested"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.begin_nested()</span></code></a></p>
</div>
<div class="class-bases docutils container" id="index-2">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.engine.Transaction" title="sqlalchemy.engine.Transaction"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.engine.Transaction</span></code></a> (<code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.engine.util.TransactionalContext</span></code>)</p>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.Transaction.close">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.Transaction"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.Transaction.</span></code></a><span class="sig-name descname"><span class="pre">close</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.engine.Transaction.close" title="Permalink to this definition">¶</a></dt>
<dd><p>Close this <a class="reference internal" href="#sqlalchemy.engine.Transaction" title="sqlalchemy.engine.Transaction"><code class="xref py py-class docutils literal notranslate"><span class="pre">Transaction</span></code></a>.</p>
<p>If this transaction is the base transaction in a begin/commit
nesting, the transaction will rollback().  Otherwise, the
method returns.</p>
<p>This is used to cancel a Transaction without affecting the scope of
an enclosing transaction.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.Transaction.commit">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.Transaction"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.Transaction.</span></code></a><span class="sig-name descname"><span class="pre">commit</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.engine.Transaction.commit" title="Permalink to this definition">¶</a></dt>
<dd><p>Commit this <a class="reference internal" href="#sqlalchemy.engine.Transaction" title="sqlalchemy.engine.Transaction"><code class="xref py py-class docutils literal notranslate"><span class="pre">Transaction</span></code></a>.</p>
<p>The implementation of this may vary based on the type of transaction in
use:</p>
<ul class="simple">
<li><p>For a simple database transaction (e.g. <a class="reference internal" href="#sqlalchemy.engine.RootTransaction" title="sqlalchemy.engine.RootTransaction"><code class="xref py py-class docutils literal notranslate"><span class="pre">RootTransaction</span></code></a>),
it corresponds to a COMMIT.</p></li>
<li><p>For a <a class="reference internal" href="#sqlalchemy.engine.NestedTransaction" title="sqlalchemy.engine.NestedTransaction"><code class="xref py py-class docutils literal notranslate"><span class="pre">NestedTransaction</span></code></a>, it corresponds to a
“RELEASE SAVEPOINT” operation.</p></li>
<li><p>For a <a class="reference internal" href="#sqlalchemy.engine.TwoPhaseTransaction" title="sqlalchemy.engine.TwoPhaseTransaction"><code class="xref py py-class docutils literal notranslate"><span class="pre">TwoPhaseTransaction</span></code></a>, DBAPI-specific methods for two
phase transactions may be used.</p></li>
</ul>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.Transaction.rollback">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.Transaction"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.Transaction.</span></code></a><span class="sig-name descname"><span class="pre">rollback</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.engine.Transaction.rollback" title="Permalink to this definition">¶</a></dt>
<dd><p>Roll back this <a class="reference internal" href="#sqlalchemy.engine.Transaction" title="sqlalchemy.engine.Transaction"><code class="xref py py-class docutils literal notranslate"><span class="pre">Transaction</span></code></a>.</p>
<p>The implementation of this may vary based on the type of transaction in
use:</p>
<ul class="simple">
<li><p>For a simple database transaction (e.g. <a class="reference internal" href="#sqlalchemy.engine.RootTransaction" title="sqlalchemy.engine.RootTransaction"><code class="xref py py-class docutils literal notranslate"><span class="pre">RootTransaction</span></code></a>),
it corresponds to a ROLLBACK.</p></li>
<li><p>For a <a class="reference internal" href="#sqlalchemy.engine.NestedTransaction" title="sqlalchemy.engine.NestedTransaction"><code class="xref py py-class docutils literal notranslate"><span class="pre">NestedTransaction</span></code></a>, it corresponds to a
“ROLLBACK TO SAVEPOINT” operation.</p></li>
<li><p>For a <a class="reference internal" href="#sqlalchemy.engine.TwoPhaseTransaction" title="sqlalchemy.engine.TwoPhaseTransaction"><code class="xref py py-class docutils literal notranslate"><span class="pre">TwoPhaseTransaction</span></code></a>, DBAPI-specific methods for two
phase transactions may be used.</p></li>
</ul>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.engine.TwoPhaseTransaction">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.engine.</span></span><span class="sig-name descname"><span class="pre">TwoPhaseTransaction</span></span><a class="headerlink" href="#sqlalchemy.engine.TwoPhaseTransaction" title="Permalink to this definition">¶</a></dt>
<dd><p>Represent a two-phase transaction.</p>
<p>A new <a class="reference internal" href="#sqlalchemy.engine.TwoPhaseTransaction" title="sqlalchemy.engine.TwoPhaseTransaction"><code class="xref py py-class docutils literal notranslate"><span class="pre">TwoPhaseTransaction</span></code></a> object may be procured
using the <a class="reference internal" href="#sqlalchemy.engine.Connection.begin_twophase" title="sqlalchemy.engine.Connection.begin_twophase"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.begin_twophase()</span></code></a> method.</p>
<p>The interface is the same as that of <a class="reference internal" href="#sqlalchemy.engine.Transaction" title="sqlalchemy.engine.Transaction"><code class="xref py py-class docutils literal notranslate"><span class="pre">Transaction</span></code></a>
with the addition of the <a class="reference internal" href="#sqlalchemy.engine.TwoPhaseTransaction.prepare" title="sqlalchemy.engine.TwoPhaseTransaction.prepare"><code class="xref py py-meth docutils literal notranslate"><span class="pre">prepare()</span></code></a> method.</p>
<div class="class-members docutils container">
<p><strong>Members</strong></p>
<p><a class="reference internal" href="#sqlalchemy.engine.TwoPhaseTransaction.close"><span class="sig-name descname">close()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.TwoPhaseTransaction.commit"><span class="sig-name descname">commit()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.TwoPhaseTransaction.prepare"><span class="sig-name descname">prepare()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.TwoPhaseTransaction.rollback"><span class="sig-name descname">rollback()</span></a></p>
</div>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.engine.TwoPhaseTransaction" title="sqlalchemy.engine.TwoPhaseTransaction"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.engine.TwoPhaseTransaction</span></code></a> (<a class="reference internal" href="#sqlalchemy.engine.RootTransaction" title="sqlalchemy.engine.RootTransaction"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.engine.RootTransaction</span></code></a>)</p>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.TwoPhaseTransaction.close">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.TwoPhaseTransaction"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.TwoPhaseTransaction.</span></code></a><span class="sig-name descname"><span class="pre">close</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.engine.TwoPhaseTransaction.close" title="Permalink to this definition">¶</a></dt>
<dd><div class="inherited-member docutils container">
<p><em>inherited from the</em> <a class="reference internal" href="#sqlalchemy.engine.Transaction.close" title="sqlalchemy.engine.Transaction.close"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Transaction.close()</span></code></a> <em>method of</em> <a class="reference internal" href="#sqlalchemy.engine.Transaction" title="sqlalchemy.engine.Transaction"><code class="xref py py-class docutils literal notranslate"><span class="pre">Transaction</span></code></a></p>
</div>
<p>Close this <a class="reference internal" href="#sqlalchemy.engine.Transaction" title="sqlalchemy.engine.Transaction"><code class="xref py py-class docutils literal notranslate"><span class="pre">Transaction</span></code></a>.</p>
<p>If this transaction is the base transaction in a begin/commit
nesting, the transaction will rollback().  Otherwise, the
method returns.</p>
<p>This is used to cancel a Transaction without affecting the scope of
an enclosing transaction.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.TwoPhaseTransaction.commit">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.TwoPhaseTransaction"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.TwoPhaseTransaction.</span></code></a><span class="sig-name descname"><span class="pre">commit</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.engine.TwoPhaseTransaction.commit" title="Permalink to this definition">¶</a></dt>
<dd><div class="inherited-member docutils container">
<p><em>inherited from the</em> <a class="reference internal" href="#sqlalchemy.engine.Transaction.commit" title="sqlalchemy.engine.Transaction.commit"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Transaction.commit()</span></code></a> <em>method of</em> <a class="reference internal" href="#sqlalchemy.engine.Transaction" title="sqlalchemy.engine.Transaction"><code class="xref py py-class docutils literal notranslate"><span class="pre">Transaction</span></code></a></p>
</div>
<p>Commit this <a class="reference internal" href="#sqlalchemy.engine.Transaction" title="sqlalchemy.engine.Transaction"><code class="xref py py-class docutils literal notranslate"><span class="pre">Transaction</span></code></a>.</p>
<p>The implementation of this may vary based on the type of transaction in
use:</p>
<ul class="simple">
<li><p>For a simple database transaction (e.g. <a class="reference internal" href="#sqlalchemy.engine.RootTransaction" title="sqlalchemy.engine.RootTransaction"><code class="xref py py-class docutils literal notranslate"><span class="pre">RootTransaction</span></code></a>),
it corresponds to a COMMIT.</p></li>
<li><p>For a <a class="reference internal" href="#sqlalchemy.engine.NestedTransaction" title="sqlalchemy.engine.NestedTransaction"><code class="xref py py-class docutils literal notranslate"><span class="pre">NestedTransaction</span></code></a>, it corresponds to a
“RELEASE SAVEPOINT” operation.</p></li>
<li><p>For a <a class="reference internal" href="#sqlalchemy.engine.TwoPhaseTransaction" title="sqlalchemy.engine.TwoPhaseTransaction"><code class="xref py py-class docutils literal notranslate"><span class="pre">TwoPhaseTransaction</span></code></a>, DBAPI-specific methods for two
phase transactions may be used.</p></li>
</ul>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.TwoPhaseTransaction.prepare">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.TwoPhaseTransaction"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.TwoPhaseTransaction.</span></code></a><span class="sig-name descname"><span class="pre">prepare</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.engine.TwoPhaseTransaction.prepare" title="Permalink to this definition">¶</a></dt>
<dd><p>Prepare this <a class="reference internal" href="#sqlalchemy.engine.TwoPhaseTransaction" title="sqlalchemy.engine.TwoPhaseTransaction"><code class="xref py py-class docutils literal notranslate"><span class="pre">TwoPhaseTransaction</span></code></a>.</p>
<p>After a PREPARE, the transaction can be committed.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.TwoPhaseTransaction.rollback">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.TwoPhaseTransaction"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.TwoPhaseTransaction.</span></code></a><span class="sig-name descname"><span class="pre">rollback</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.engine.TwoPhaseTransaction.rollback" title="Permalink to this definition">¶</a></dt>
<dd><div class="inherited-member docutils container">
<p><em>inherited from the</em> <a class="reference internal" href="#sqlalchemy.engine.Transaction.rollback" title="sqlalchemy.engine.Transaction.rollback"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Transaction.rollback()</span></code></a> <em>method of</em> <a class="reference internal" href="#sqlalchemy.engine.Transaction" title="sqlalchemy.engine.Transaction"><code class="xref py py-class docutils literal notranslate"><span class="pre">Transaction</span></code></a></p>
</div>
<p>Roll back this <a class="reference internal" href="#sqlalchemy.engine.Transaction" title="sqlalchemy.engine.Transaction"><code class="xref py py-class docutils literal notranslate"><span class="pre">Transaction</span></code></a>.</p>
<p>The implementation of this may vary based on the type of transaction in
use:</p>
<ul class="simple">
<li><p>For a simple database transaction (e.g. <a class="reference internal" href="#sqlalchemy.engine.RootTransaction" title="sqlalchemy.engine.RootTransaction"><code class="xref py py-class docutils literal notranslate"><span class="pre">RootTransaction</span></code></a>),
it corresponds to a ROLLBACK.</p></li>
<li><p>For a <a class="reference internal" href="#sqlalchemy.engine.NestedTransaction" title="sqlalchemy.engine.NestedTransaction"><code class="xref py py-class docutils literal notranslate"><span class="pre">NestedTransaction</span></code></a>, it corresponds to a
“ROLLBACK TO SAVEPOINT” operation.</p></li>
<li><p>For a <a class="reference internal" href="#sqlalchemy.engine.TwoPhaseTransaction" title="sqlalchemy.engine.TwoPhaseTransaction"><code class="xref py py-class docutils literal notranslate"><span class="pre">TwoPhaseTransaction</span></code></a>, DBAPI-specific methods for two
phase transactions may be used.</p></li>
</ul>
</dd></dl>

</dd></dl>

</section>
<section id="id54">
<h2>结果集API<a class="headerlink" href="#id54" title="Permalink to this heading">¶</a></h2>
<table class="longtable docutils align-default">
<thead>
<tr class="row-odd"><th class="head">Object Name</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.engine.ChunkedIteratorResult"><span class="sig-name descname">ChunkedIteratorResult</span></a></p></td>
<td><p>An <a class="reference internal" href="#sqlalchemy.engine.IteratorResult" title="sqlalchemy.engine.IteratorResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">IteratorResult</span></code></a> that works from an
iterator-producing callable.</p></td>
</tr>
<tr class="row-odd"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.engine.CursorResult"><span class="sig-name descname">CursorResult</span></a></p></td>
<td><p>A Result that is representing state from a DBAPI cursor.</p></td>
</tr>
<tr class="row-even"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.engine.FilterResult"><span class="sig-name descname">FilterResult</span></a></p></td>
<td><p>A wrapper for a <a class="reference internal" href="#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a> that returns objects other than
<a class="reference internal" href="#sqlalchemy.engine.Row" title="sqlalchemy.engine.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a> objects, such as dictionaries or scalar objects.</p></td>
</tr>
<tr class="row-odd"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.engine.FrozenResult"><span class="sig-name descname">FrozenResult</span></a></p></td>
<td><p>Represents a <a class="reference internal" href="#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a> object in a “frozen” state suitable
for caching.</p></td>
</tr>
<tr class="row-even"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.engine.IteratorResult"><span class="sig-name descname">IteratorResult</span></a></p></td>
<td><p>A <a class="reference internal" href="#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a> that gets data from a Python iterator of
<a class="reference internal" href="#sqlalchemy.engine.Row" title="sqlalchemy.engine.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a> objects or similar row-like data.</p></td>
</tr>
<tr class="row-odd"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.engine.MappingResult"><span class="sig-name descname">MappingResult</span></a></p></td>
<td><p>A wrapper for a <a class="reference internal" href="#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a> that returns dictionary values
rather than <a class="reference internal" href="#sqlalchemy.engine.Row" title="sqlalchemy.engine.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a> values.</p></td>
</tr>
<tr class="row-even"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.engine.MergedResult"><span class="sig-name descname">MergedResult</span></a></p></td>
<td><p>A <a class="reference internal" href="#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a> that is merged from any number of
<a class="reference internal" href="#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a> objects.</p></td>
</tr>
<tr class="row-odd"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.engine.Result"><span class="sig-name descname">Result</span></a></p></td>
<td><p>Represent a set of database results.</p></td>
</tr>
<tr class="row-even"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.engine.Row"><span class="sig-name descname">Row</span></a></p></td>
<td><p>Represent a single result row.</p></td>
</tr>
<tr class="row-odd"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.engine.RowMapping"><span class="sig-name descname">RowMapping</span></a></p></td>
<td><p>A <code class="docutils literal notranslate"><span class="pre">Mapping</span></code> that maps column names and objects to <a class="reference internal" href="#sqlalchemy.engine.Row" title="sqlalchemy.engine.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a>
values.</p></td>
</tr>
<tr class="row-even"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.engine.ScalarResult"><span class="sig-name descname">ScalarResult</span></a></p></td>
<td><p>A wrapper for a <a class="reference internal" href="#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a> that returns scalar values
rather than <a class="reference internal" href="#sqlalchemy.engine.Row" title="sqlalchemy.engine.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a> values.</p></td>
</tr>
<tr class="row-odd"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.engine.TupleResult"><span class="sig-name descname">TupleResult</span></a></p></td>
<td><p>A <a class="reference internal" href="#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a> that’s typed as returning plain
Python tuples instead of rows.</p></td>
</tr>
</tbody>
</table>
<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.engine.ChunkedIteratorResult">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.engine.</span></span><span class="sig-name descname"><span class="pre">ChunkedIteratorResult</span></span><a class="headerlink" href="#sqlalchemy.engine.ChunkedIteratorResult" title="Permalink to this definition">¶</a></dt>
<dd><p>An <a class="reference internal" href="#sqlalchemy.engine.IteratorResult" title="sqlalchemy.engine.IteratorResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">IteratorResult</span></code></a> that works from an
iterator-producing callable.</p>
<p>The given <code class="docutils literal notranslate"><span class="pre">chunks</span></code> argument is a function that is given a number of rows
to return in each chunk, or <code class="docutils literal notranslate"><span class="pre">None</span></code> for all rows.  The function should
then return an un-consumed iterator of lists, each list of the requested
size.</p>
<p>The function can be called at any time again, in which case it should
continue from the same result set but adjust the chunk size as given.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.4.</span></p>
</div>
<div class="class-members docutils container">
<p><strong>Members</strong></p>
<p><a class="reference internal" href="#sqlalchemy.engine.ChunkedIteratorResult.yield_per"><span class="sig-name descname">yield_per()</span></a></p>
</div>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.engine.ChunkedIteratorResult" title="sqlalchemy.engine.ChunkedIteratorResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.engine.ChunkedIteratorResult</span></code></a> (<a class="reference internal" href="#sqlalchemy.engine.IteratorResult" title="sqlalchemy.engine.IteratorResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.engine.IteratorResult</span></code></a>)</p>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.ChunkedIteratorResult.yield_per">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.ChunkedIteratorResult"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.ChunkedIteratorResult.</span></code></a><span class="sig-name descname"><span class="pre">yield_per</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">num</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Self</span></span></span><a class="headerlink" href="#sqlalchemy.engine.ChunkedIteratorResult.yield_per" title="Permalink to this definition">¶</a></dt>
<dd><p>Configure the row-fetching strategy to fetch <code class="docutils literal notranslate"><span class="pre">num</span></code> rows at a time.</p>
<p>This impacts the underlying behavior of the result when iterating over
the result object, or otherwise making use of  methods such as
<a class="reference internal" href="#sqlalchemy.engine.Result.fetchone" title="sqlalchemy.engine.Result.fetchone"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.fetchone()</span></code></a> that return one row at a time.   Data
from the underlying cursor or other data source will be buffered up to
this many rows in memory, and the buffered collection will then be
yielded out one row at a time or as many rows are requested. Each time
the buffer clears, it will be refreshed to this many rows or as many
rows remain if fewer remain.</p>
<p>The <a class="reference internal" href="#sqlalchemy.engine.Result.yield_per" title="sqlalchemy.engine.Result.yield_per"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.yield_per()</span></code></a> method is generally used in
conjunction with the
<a class="reference internal" href="#sqlalchemy.engine.Connection.execution_options.params.stream_results" title="sqlalchemy.engine.Connection.execution_options"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Connection.execution_options.stream_results</span></code></a>
execution option, which will allow the database dialect in use to make
use of a server side cursor, if the DBAPI supports a specific “server
side cursor” mode separate from its default mode of operation.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Consider using the
<a class="reference internal" href="#sqlalchemy.engine.Connection.execution_options.params.yield_per" title="sqlalchemy.engine.Connection.execution_options"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Connection.execution_options.yield_per</span></code></a>
execution option, which will simultaneously set
<a class="reference internal" href="#sqlalchemy.engine.Connection.execution_options.params.stream_results" title="sqlalchemy.engine.Connection.execution_options"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Connection.execution_options.stream_results</span></code></a>
to ensure the use of server side cursors, as well as automatically
invoke the <a class="reference internal" href="#sqlalchemy.engine.Result.yield_per" title="sqlalchemy.engine.Result.yield_per"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.yield_per()</span></code></a> method to establish
a fixed row buffer size at once.</p>
<p>The <a class="reference internal" href="#sqlalchemy.engine.Connection.execution_options.params.yield_per" title="sqlalchemy.engine.Connection.execution_options"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Connection.execution_options.yield_per</span></code></a>
execution option is available for ORM operations, with
<code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code>-oriented use described at
<span class="xref std std-ref">orm_queryguide_yield_per</span>. The Core-only version which works
with <a class="reference internal" href="#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a> is new as of SQLAlchemy 1.4.40.</p>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.4.</span></p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><span class="target" id="sqlalchemy.engine.ChunkedIteratorResult.yield_per.params.num"></span><strong>num</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.engine.ChunkedIteratorResult.yield_per.params.num">¶</a> – number of rows to fetch each time the buffer is refilled.
If set to a value below 1, fetches all rows for the next buffer.</p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><span class="xref std std-ref">engine_stream_results</span> - describes Core behavior for
<a class="reference internal" href="#sqlalchemy.engine.Result.yield_per" title="sqlalchemy.engine.Result.yield_per"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.yield_per()</span></code></a></p>
<p><span class="xref std std-ref">orm_queryguide_yield_per</span> - in the <a class="reference internal" href="../orm/queryguide/index.html"><span class="std std-ref">ORM 查询指南</span></a></p>
</div>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.engine.CursorResult">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.engine.</span></span><span class="sig-name descname"><span class="pre">CursorResult</span></span><a class="headerlink" href="#sqlalchemy.engine.CursorResult" title="Permalink to this definition">¶</a></dt>
<dd><p>A Result that is representing state from a DBAPI cursor.</p>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 1.4: </span>The <code class="xref py py-class docutils literal notranslate"><span class="pre">CursorResult`</span></code>
class replaces the previous <code class="xref py py-class docutils literal notranslate"><span class="pre">ResultProxy</span></code> interface.
This classes are based on the <a class="reference internal" href="#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a> calling API
which provides an updated usage model and calling facade for
SQLAlchemy Core and SQLAlchemy ORM.</p>
</div>
<p>Returns database rows via the <a class="reference internal" href="#sqlalchemy.engine.Row" title="sqlalchemy.engine.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a> class, which provides
additional API features and behaviors on top of the raw data returned by
the DBAPI.   Through the use of filters such as the <a class="reference internal" href="#sqlalchemy.engine.Result.scalars" title="sqlalchemy.engine.Result.scalars"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.scalars()</span></code></a>
method, other kinds of objects may also be returned.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../tutorial/data_select.html#tutorial-selecting-data"><span class="std std-ref">使用SELECT语句</span></a> - introductory material for accessing
<a class="reference internal" href="#sqlalchemy.engine.CursorResult" title="sqlalchemy.engine.CursorResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">CursorResult</span></code></a> and <a class="reference internal" href="#sqlalchemy.engine.Row" title="sqlalchemy.engine.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a> objects.</p>
</div>
<div class="class-members docutils container">
<p><strong>Members</strong></p>
<p><a class="reference internal" href="#sqlalchemy.engine.CursorResult.all"><span class="sig-name descname">all()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.CursorResult.close"><span class="sig-name descname">close()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.CursorResult.columns"><span class="sig-name descname">columns()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.CursorResult.fetchall"><span class="sig-name descname">fetchall()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.CursorResult.fetchmany"><span class="sig-name descname">fetchmany()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.CursorResult.fetchone"><span class="sig-name descname">fetchone()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.CursorResult.first"><span class="sig-name descname">first()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.CursorResult.freeze"><span class="sig-name descname">freeze()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.CursorResult.inserted_primary_key"><span class="sig-name descname">inserted_primary_key</span></a>, <a class="reference internal" href="#sqlalchemy.engine.CursorResult.inserted_primary_key_rows"><span class="sig-name descname">inserted_primary_key_rows</span></a>, <a class="reference internal" href="#sqlalchemy.engine.CursorResult.is_insert"><span class="sig-name descname">is_insert</span></a>, <a class="reference internal" href="#sqlalchemy.engine.CursorResult.keys"><span class="sig-name descname">keys()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.CursorResult.last_inserted_params"><span class="sig-name descname">last_inserted_params()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.CursorResult.last_updated_params"><span class="sig-name descname">last_updated_params()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.CursorResult.lastrow_has_defaults"><span class="sig-name descname">lastrow_has_defaults()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.CursorResult.lastrowid"><span class="sig-name descname">lastrowid</span></a>, <a class="reference internal" href="#sqlalchemy.engine.CursorResult.mappings"><span class="sig-name descname">mappings()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.CursorResult.merge"><span class="sig-name descname">merge()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.CursorResult.one"><span class="sig-name descname">one()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.CursorResult.one_or_none"><span class="sig-name descname">one_or_none()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.CursorResult.partitions"><span class="sig-name descname">partitions()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.CursorResult.postfetch_cols"><span class="sig-name descname">postfetch_cols()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.CursorResult.prefetch_cols"><span class="sig-name descname">prefetch_cols()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.CursorResult.returned_defaults"><span class="sig-name descname">returned_defaults</span></a>, <a class="reference internal" href="#sqlalchemy.engine.CursorResult.returned_defaults_rows"><span class="sig-name descname">returned_defaults_rows</span></a>, <a class="reference internal" href="#sqlalchemy.engine.CursorResult.returns_rows"><span class="sig-name descname">returns_rows</span></a>, <a class="reference internal" href="#sqlalchemy.engine.CursorResult.rowcount"><span class="sig-name descname">rowcount</span></a>, <a class="reference internal" href="#sqlalchemy.engine.CursorResult.scalar"><span class="sig-name descname">scalar()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.CursorResult.scalar_one"><span class="sig-name descname">scalar_one()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.CursorResult.scalar_one_or_none"><span class="sig-name descname">scalar_one_or_none()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.CursorResult.scalars"><span class="sig-name descname">scalars()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.CursorResult.splice_horizontally"><span class="sig-name descname">splice_horizontally()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.CursorResult.splice_vertically"><span class="sig-name descname">splice_vertically()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.CursorResult.supports_sane_multi_rowcount"><span class="sig-name descname">supports_sane_multi_rowcount()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.CursorResult.supports_sane_rowcount"><span class="sig-name descname">supports_sane_rowcount()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.CursorResult.t"><span class="sig-name descname">t</span></a>, <a class="reference internal" href="#sqlalchemy.engine.CursorResult.tuples"><span class="sig-name descname">tuples()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.CursorResult.unique"><span class="sig-name descname">unique()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.CursorResult.yield_per"><span class="sig-name descname">yield_per()</span></a></p>
</div>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.engine.CursorResult" title="sqlalchemy.engine.CursorResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.engine.CursorResult</span></code></a> (<a class="reference internal" href="#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.engine.Result</span></code></a>)</p>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.CursorResult.all">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.CursorResult"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.CursorResult.</span></code></a><span class="sig-name descname"><span class="pre">all</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Sequence</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#sqlalchemy.engine.Row" title="sqlalchemy.engine.row.Row"><span class="pre">Row</span></a><span class="p"><span class="pre">[</span></span><span class="pre">_TP</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#sqlalchemy.engine.CursorResult.all" title="Permalink to this definition">¶</a></dt>
<dd><div class="inherited-member docutils container">
<p><em>inherited from the</em> <a class="reference internal" href="#sqlalchemy.engine.Result.all" title="sqlalchemy.engine.Result.all"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.all()</span></code></a> <em>method of</em> <a class="reference internal" href="#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a></p>
</div>
<p>Return all rows in a list.</p>
<p>Closes the result set after invocation.   Subsequent invocations
will return an empty list.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.4.</span></p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>a list of <a class="reference internal" href="#sqlalchemy.engine.Row" title="sqlalchemy.engine.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a> objects.</p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><span class="xref std std-ref">engine_stream_results</span> - How to stream a large result set
without loading it completely in python.</p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.CursorResult.close">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.CursorResult"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.CursorResult.</span></code></a><span class="sig-name descname"><span class="pre">close</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Any</span></span></span><a class="headerlink" href="#sqlalchemy.engine.CursorResult.close" title="Permalink to this definition">¶</a></dt>
<dd><p>Close this <a class="reference internal" href="#sqlalchemy.engine.CursorResult" title="sqlalchemy.engine.CursorResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">CursorResult</span></code></a>.</p>
<p>This closes out the underlying DBAPI cursor corresponding to the
statement execution, if one is still present.  Note that the DBAPI
cursor is automatically released when the <a class="reference internal" href="#sqlalchemy.engine.CursorResult" title="sqlalchemy.engine.CursorResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">CursorResult</span></code></a>
exhausts all available rows.  <a class="reference internal" href="#sqlalchemy.engine.CursorResult.close" title="sqlalchemy.engine.CursorResult.close"><code class="xref py py-meth docutils literal notranslate"><span class="pre">CursorResult.close()</span></code></a> is
generally an optional method except in the case when discarding a
<a class="reference internal" href="#sqlalchemy.engine.CursorResult" title="sqlalchemy.engine.CursorResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">CursorResult</span></code></a> that still has additional rows pending
for fetch.</p>
<p>After this method is called, it is no longer valid to call upon
the fetch methods, which will raise a <a class="reference internal" href="exceptions.html#sqlalchemy.exc.ResourceClosedError" title="sqlalchemy.exc.ResourceClosedError"><code class="xref py py-class docutils literal notranslate"><span class="pre">ResourceClosedError</span></code></a>
on subsequent use.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#"><span class="std std-ref">使用 Engine 和 Connections</span></a></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.CursorResult.columns">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.CursorResult"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.CursorResult.</span></code></a><span class="sig-name descname"><span class="pre">columns</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">col_expressions</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_KeyIndexType</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Self</span></span></span><a class="headerlink" href="#sqlalchemy.engine.CursorResult.columns" title="Permalink to this definition">¶</a></dt>
<dd><div class="inherited-member docutils container">
<p><em>inherited from the</em> <a class="reference internal" href="#sqlalchemy.engine.Result.columns" title="sqlalchemy.engine.Result.columns"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.columns()</span></code></a> <em>method of</em> <a class="reference internal" href="#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a></p>
</div>
<p>Establish the columns that should be returned in each row.</p>
<p>This method may be used to limit the columns returned as well
as to reorder them.   The given list of expressions are normally
a series of integers or string key names.   They may also be
appropriate <a class="reference internal" href="sqlelement.html#sqlalchemy.sql.expression.ColumnElement" title="sqlalchemy.sql.expression.ColumnElement"><code class="xref py py-class docutils literal notranslate"><span class="pre">ColumnElement</span></code></a> objects which correspond to
a given statement construct.</p>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 2.0: </span>Due to a bug in 1.4, the
<a class="reference internal" href="#sqlalchemy.engine.Result.columns" title="sqlalchemy.engine.Result.columns"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.columns()</span></code></a> method had an incorrect behavior
where calling upon the method with just one index would cause the
<a class="reference internal" href="#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a> object to yield scalar values rather than
<a class="reference internal" href="#sqlalchemy.engine.Row" title="sqlalchemy.engine.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a> objects.   In version 2.0, this behavior
has been corrected such that calling upon
<a class="reference internal" href="#sqlalchemy.engine.Result.columns" title="sqlalchemy.engine.Result.columns"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.columns()</span></code></a> with a single index will
produce a <a class="reference internal" href="#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a> object that continues
to yield <a class="reference internal" href="#sqlalchemy.engine.Row" title="sqlalchemy.engine.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a> objects, which include
only a single column.</p>
</div>
<p>E.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">statement</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">z</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">statement</span><span class="p">)</span>

<span class="k">for</span> <span class="n">z</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">columns</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">):</span>
    <span class="c1"># ...</span></pre></div>
</div>
<p>Example of using the column objects from the statement itself:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">z</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">columns</span><span class="p">(</span>
        <span class="n">statement</span><span class="o">.</span><span class="n">selected_columns</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">z</span><span class="p">,</span>
        <span class="n">statement</span><span class="o">.</span><span class="n">selected_columns</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">y</span>
<span class="p">):</span>
    <span class="c1"># ...</span></pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.4.</span></p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><span class="target" id="sqlalchemy.engine.CursorResult.columns.params.*col_expressions"></span><strong>*col_expressions</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.engine.CursorResult.columns.params.*col_expressions">¶</a> – indicates columns to be returned.  Elements
may be integer row indexes, string column names, or appropriate
<a class="reference internal" href="sqlelement.html#sqlalchemy.sql.expression.ColumnElement" title="sqlalchemy.sql.expression.ColumnElement"><code class="xref py py-class docutils literal notranslate"><span class="pre">ColumnElement</span></code></a> objects corresponding to a select construct.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>this <a class="reference internal" href="#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a> object with the modifications
given.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.CursorResult.fetchall">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.CursorResult"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.CursorResult.</span></code></a><span class="sig-name descname"><span class="pre">fetchall</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Sequence</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#sqlalchemy.engine.Row" title="sqlalchemy.engine.row.Row"><span class="pre">Row</span></a><span class="p"><span class="pre">[</span></span><span class="pre">_TP</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#sqlalchemy.engine.CursorResult.fetchall" title="Permalink to this definition">¶</a></dt>
<dd><div class="inherited-member docutils container">
<p><em>inherited from the</em> <a class="reference internal" href="#sqlalchemy.engine.Result.fetchall" title="sqlalchemy.engine.Result.fetchall"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.fetchall()</span></code></a> <em>method of</em> <a class="reference internal" href="#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a></p>
</div>
<p>A synonym for the <a class="reference internal" href="#sqlalchemy.engine.Result.all" title="sqlalchemy.engine.Result.all"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.all()</span></code></a> method.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.CursorResult.fetchmany">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.CursorResult"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.CursorResult.</span></code></a><span class="sig-name descname"><span class="pre">fetchmany</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">size</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Sequence</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#sqlalchemy.engine.Row" title="sqlalchemy.engine.row.Row"><span class="pre">Row</span></a><span class="p"><span class="pre">[</span></span><span class="pre">_TP</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#sqlalchemy.engine.CursorResult.fetchmany" title="Permalink to this definition">¶</a></dt>
<dd><div class="inherited-member docutils container">
<p><em>inherited from the</em> <a class="reference internal" href="#sqlalchemy.engine.Result.fetchmany" title="sqlalchemy.engine.Result.fetchmany"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.fetchmany()</span></code></a> <em>method of</em> <a class="reference internal" href="#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a></p>
</div>
<p>Fetch many rows.</p>
<p>When all rows are exhausted, returns an empty list.</p>
<p>This method is provided for backwards compatibility with
SQLAlchemy 1.x.x.</p>
<p>To fetch rows in groups, use the <a class="reference internal" href="#sqlalchemy.engine.Result.partitions" title="sqlalchemy.engine.Result.partitions"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.partitions()</span></code></a>
method.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>a list of <a class="reference internal" href="#sqlalchemy.engine.Row" title="sqlalchemy.engine.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a> objects.</p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#sqlalchemy.engine.Result.partitions" title="sqlalchemy.engine.Result.partitions"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.partitions()</span></code></a></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.CursorResult.fetchone">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.CursorResult"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.CursorResult.</span></code></a><span class="sig-name descname"><span class="pre">fetchone</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#sqlalchemy.engine.Row" title="sqlalchemy.engine.row.Row"><span class="pre">Row</span></a><span class="p"><span class="pre">[</span></span><span class="pre">_TP</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.engine.CursorResult.fetchone" title="Permalink to this definition">¶</a></dt>
<dd><div class="inherited-member docutils container">
<p><em>inherited from the</em> <a class="reference internal" href="#sqlalchemy.engine.Result.fetchone" title="sqlalchemy.engine.Result.fetchone"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.fetchone()</span></code></a> <em>method of</em> <a class="reference internal" href="#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a></p>
</div>
<p>Fetch one row.</p>
<p>When all rows are exhausted, returns None.</p>
<p>This method is provided for backwards compatibility with
SQLAlchemy 1.x.x.</p>
<p>To fetch the first row of a result only, use the
<a class="reference internal" href="#sqlalchemy.engine.Result.first" title="sqlalchemy.engine.Result.first"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.first()</span></code></a> method.  To iterate through all
rows, iterate the <a class="reference internal" href="#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a> object directly.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>a <a class="reference internal" href="#sqlalchemy.engine.Row" title="sqlalchemy.engine.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a> object if no filters are applied,
or <code class="docutils literal notranslate"><span class="pre">None</span></code> if no rows remain.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.CursorResult.first">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.CursorResult"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.CursorResult.</span></code></a><span class="sig-name descname"><span class="pre">first</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#sqlalchemy.engine.Row" title="sqlalchemy.engine.row.Row"><span class="pre">Row</span></a><span class="p"><span class="pre">[</span></span><span class="pre">_TP</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.engine.CursorResult.first" title="Permalink to this definition">¶</a></dt>
<dd><div class="inherited-member docutils container">
<p><em>inherited from the</em> <a class="reference internal" href="#sqlalchemy.engine.Result.first" title="sqlalchemy.engine.Result.first"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.first()</span></code></a> <em>method of</em> <a class="reference internal" href="#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a></p>
</div>
<p>Fetch the first row or <code class="docutils literal notranslate"><span class="pre">None</span></code> if no row is present.</p>
<p>Closes the result set and discards remaining rows.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This method returns one <strong>row</strong>, e.g. tuple, by default.
To return exactly one single scalar value, that is, the first
column of the first row, use the
<a class="reference internal" href="#sqlalchemy.engine.Result.scalar" title="sqlalchemy.engine.Result.scalar"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.scalar()</span></code></a> method,
or combine <a class="reference internal" href="#sqlalchemy.engine.Result.scalars" title="sqlalchemy.engine.Result.scalars"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.scalars()</span></code></a> and
<a class="reference internal" href="#sqlalchemy.engine.Result.first" title="sqlalchemy.engine.Result.first"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.first()</span></code></a>.</p>
<p>Additionally, in contrast to the behavior of the legacy  ORM
<a class="reference internal" href="../orm/queryguide/query.html#sqlalchemy.orm.Query.first" title="sqlalchemy.orm.Query.first"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Query.first()</span></code></a> method, <strong>no limit is applied</strong> to the
SQL query which was invoked to produce this
<a class="reference internal" href="#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a>;
for a DBAPI driver that buffers results in memory before yielding
rows, all rows will be sent to the Python process and all but
the first row will be discarded.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../changelog/migration_20.html#migration-20-unify-select"><span class="std std-ref">ORM查询与核心选择器统一</span></a></p>
</div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>a <a class="reference internal" href="#sqlalchemy.engine.Row" title="sqlalchemy.engine.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a> object, or None
if no rows remain.</p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#sqlalchemy.engine.Result.scalar" title="sqlalchemy.engine.Result.scalar"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.scalar()</span></code></a></p>
<p><a class="reference internal" href="#sqlalchemy.engine.Result.one" title="sqlalchemy.engine.Result.one"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.one()</span></code></a></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.CursorResult.freeze">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.CursorResult"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.CursorResult.</span></code></a><span class="sig-name descname"><span class="pre">freeze</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#sqlalchemy.engine.FrozenResult" title="sqlalchemy.engine.result.FrozenResult"><span class="pre">FrozenResult</span></a><span class="p"><span class="pre">[</span></span><span class="pre">_TP</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#sqlalchemy.engine.CursorResult.freeze" title="Permalink to this definition">¶</a></dt>
<dd><div class="inherited-member docutils container">
<p><em>inherited from the</em> <a class="reference internal" href="#sqlalchemy.engine.Result.freeze" title="sqlalchemy.engine.Result.freeze"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.freeze()</span></code></a> <em>method of</em> <a class="reference internal" href="#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a></p>
</div>
<p>Return a callable object that will produce copies of this
<a class="reference internal" href="#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a> when invoked.</p>
<p>The callable object returned is an instance of
<a class="reference internal" href="#sqlalchemy.engine.FrozenResult" title="sqlalchemy.engine.FrozenResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">FrozenResult</span></code></a>.</p>
<p>This is used for result set caching.  The method must be called
on the result when it has been unconsumed, and calling the method
will consume the result fully.   When the <a class="reference internal" href="#sqlalchemy.engine.FrozenResult" title="sqlalchemy.engine.FrozenResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">FrozenResult</span></code></a>
is retrieved from a cache, it can be called any number of times where
it will produce a new <a class="reference internal" href="#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a> object each time
against its stored set of rows.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../orm/session_events.html#do-orm-execute-re-executing"><span class="std std-ref">重新执行语句</span></a> - example usage within the
ORM to implement a result-set cache.</p>
</div>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.engine.CursorResult.inserted_primary_key">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.engine.CursorResult"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.CursorResult.</span></code></a><span class="sig-name descname"><span class="pre">inserted_primary_key</span></span><a class="headerlink" href="#sqlalchemy.engine.CursorResult.inserted_primary_key" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the primary key for the row just inserted.</p>
<p>The return value is a <a class="reference internal" href="#sqlalchemy.engine.Row" title="sqlalchemy.engine.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a> object representing
a named tuple of primary key values in the order in which the
primary key columns are configured in the source
<a class="reference internal" href="metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal notranslate"><span class="pre">Table</span></code></a>.</p>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 1.4.8: </span>- the
<a class="reference internal" href="#sqlalchemy.engine.CursorResult.inserted_primary_key" title="sqlalchemy.engine.CursorResult.inserted_primary_key"><code class="xref py py-attr docutils literal notranslate"><span class="pre">CursorResult.inserted_primary_key</span></code></a>
value is now a named tuple via the <a class="reference internal" href="#sqlalchemy.engine.Row" title="sqlalchemy.engine.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a> class,
rather than a plain tuple.</p>
</div>
<p>This accessor only applies to single row <a class="reference internal" href="dml.html#sqlalchemy.sql.expression.insert" title="sqlalchemy.sql.expression.insert"><code class="xref py py-func docutils literal notranslate"><span class="pre">insert()</span></code></a>
constructs which did not explicitly specify
<a class="reference internal" href="dml.html#sqlalchemy.sql.expression.Insert.returning" title="sqlalchemy.sql.expression.Insert.returning"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Insert.returning()</span></code></a>.    Support for multirow inserts,
while not yet available for most backends, would be accessed using
the <a class="reference internal" href="#sqlalchemy.engine.CursorResult.inserted_primary_key_rows" title="sqlalchemy.engine.CursorResult.inserted_primary_key_rows"><code class="xref py py-attr docutils literal notranslate"><span class="pre">CursorResult.inserted_primary_key_rows</span></code></a> accessor.</p>
<p>Note that primary key columns which specify a server_default clause, or
otherwise do not qualify as “autoincrement” columns (see the notes at
<a class="reference internal" href="metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal notranslate"><span class="pre">Column</span></code></a>), and were generated using the database-side
default, will appear in this list as <code class="docutils literal notranslate"><span class="pre">None</span></code> unless the backend
supports “returning” and the insert statement executed with the
“implicit returning” enabled.</p>
<p>Raises <a class="reference internal" href="exceptions.html#sqlalchemy.exc.InvalidRequestError" title="sqlalchemy.exc.InvalidRequestError"><code class="xref py py-class docutils literal notranslate"><span class="pre">InvalidRequestError</span></code></a> if the executed
statement is not a compiled expression construct
or is not an insert() construct.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.engine.CursorResult.inserted_primary_key_rows">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.engine.CursorResult"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.CursorResult.</span></code></a><span class="sig-name descname"><span class="pre">inserted_primary_key_rows</span></span><a class="headerlink" href="#sqlalchemy.engine.CursorResult.inserted_primary_key_rows" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the value of
<a class="reference internal" href="#sqlalchemy.engine.CursorResult.inserted_primary_key" title="sqlalchemy.engine.CursorResult.inserted_primary_key"><code class="xref py py-attr docutils literal notranslate"><span class="pre">CursorResult.inserted_primary_key</span></code></a>
as a row contained within a list; some dialects may support a
multiple row form as well.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>As indicated below, in current SQLAlchemy versions this
accessor is only useful beyond what’s already supplied by
<a class="reference internal" href="#sqlalchemy.engine.CursorResult.inserted_primary_key" title="sqlalchemy.engine.CursorResult.inserted_primary_key"><code class="xref py py-attr docutils literal notranslate"><span class="pre">CursorResult.inserted_primary_key</span></code></a> when using the
<a class="reference internal" href="../dialects/postgresql.html#postgresql-psycopg2"><span class="std std-ref">psycopg2</span></a> dialect.   Future versions hope to
generalize this feature to more dialects.</p>
</div>
<p>This accessor is added to support dialects that offer the feature
that is currently implemented by the <a class="reference internal" href="../dialects/postgresql.html#psycopg2-executemany-mode"><span class="std std-ref">Psycopg2 Fast Execution Helpers</span></a>
feature, currently <strong>only the psycopg2 dialect</strong>, which provides
for many rows to be INSERTed at once while still retaining the
behavior of being able to return server-generated primary key values.</p>
<ul class="simple">
<li><p><strong>When using the psycopg2 dialect, or other dialects that may support
“fast executemany” style inserts in upcoming releases</strong> : When
invoking an INSERT statement while passing a list of rows as the
second argument to <a class="reference internal" href="#sqlalchemy.engine.Connection.execute" title="sqlalchemy.engine.Connection.execute"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.execute()</span></code></a>, this accessor
will then provide a list of rows, where each row contains the primary
key value for each row that was INSERTed.</p></li>
<li><p><strong>When using all other dialects / backends that don’t yet support
this feature</strong>: This accessor is only useful for <strong>single row INSERT
statements</strong>, and returns the same information as that of the
<a class="reference internal" href="#sqlalchemy.engine.CursorResult.inserted_primary_key" title="sqlalchemy.engine.CursorResult.inserted_primary_key"><code class="xref py py-attr docutils literal notranslate"><span class="pre">CursorResult.inserted_primary_key</span></code></a> within a
single-element list. When an INSERT statement is executed in
conjunction with a list of rows to be INSERTed, the list will contain
one row per row inserted in the statement, however it will contain
<code class="docutils literal notranslate"><span class="pre">None</span></code> for any server-generated values.</p></li>
</ul>
<p>Future releases of SQLAlchemy will further generalize the
“fast execution helper” feature of psycopg2 to suit other dialects,
thus allowing this accessor to be of more general use.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.4.</span></p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#sqlalchemy.engine.CursorResult.inserted_primary_key" title="sqlalchemy.engine.CursorResult.inserted_primary_key"><code class="xref py py-attr docutils literal notranslate"><span class="pre">CursorResult.inserted_primary_key</span></code></a></p>
</div>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.engine.CursorResult.is_insert">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.engine.CursorResult"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.CursorResult.</span></code></a><span class="sig-name descname"><span class="pre">is_insert</span></span><a class="headerlink" href="#sqlalchemy.engine.CursorResult.is_insert" title="Permalink to this definition">¶</a></dt>
<dd><p>True if this <a class="reference internal" href="#sqlalchemy.engine.CursorResult" title="sqlalchemy.engine.CursorResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">CursorResult</span></code></a> is the result
of a executing an expression language compiled
<a class="reference internal" href="dml.html#sqlalchemy.sql.expression.insert" title="sqlalchemy.sql.expression.insert"><code class="xref py py-func docutils literal notranslate"><span class="pre">insert()</span></code></a> construct.</p>
<p>When True, this implies that the
<a class="reference internal" href="#sqlalchemy.engine.CursorResult.inserted_primary_key" title="sqlalchemy.engine.CursorResult.inserted_primary_key"><code class="xref py py-attr docutils literal notranslate"><span class="pre">inserted_primary_key</span></code></a> attribute is accessible,
assuming the statement did not include
a user defined “returning” construct.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.CursorResult.keys">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.CursorResult"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.CursorResult.</span></code></a><span class="sig-name descname"><span class="pre">keys</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">RMKeyView</span></span></span><a class="headerlink" href="#sqlalchemy.engine.CursorResult.keys" title="Permalink to this definition">¶</a></dt>
<dd><div class="inherited-member docutils container">
<p><em>inherited from the</em> <code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine._WithKeys.keys</span></code> <em>method of</em> <code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine._WithKeys</span></code></p>
</div>
<p>Return an iterable view which yields the string keys that would
be represented by each <a class="reference internal" href="#sqlalchemy.engine.Row" title="sqlalchemy.engine.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a>.</p>
<p>The keys can represent the labels of the columns returned by a core
statement or the names of the orm classes returned by an orm
execution.</p>
<p>The view also can be tested for key containment using the Python
<code class="docutils literal notranslate"><span class="pre">in</span></code> operator, which will test both for the string keys represented
in the view, as well as for alternate keys such as column objects.</p>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 1.4: </span>a key view object is returned rather than a
plain list.</p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.CursorResult.last_inserted_params">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.CursorResult"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.CursorResult.</span></code></a><span class="sig-name descname"><span class="pre">last_inserted_params</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.engine.CursorResult.last_inserted_params" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the collection of inserted parameters from this
execution.</p>
<p>Raises <a class="reference internal" href="exceptions.html#sqlalchemy.exc.InvalidRequestError" title="sqlalchemy.exc.InvalidRequestError"><code class="xref py py-class docutils literal notranslate"><span class="pre">InvalidRequestError</span></code></a> if the executed
statement is not a compiled expression construct
or is not an insert() construct.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.CursorResult.last_updated_params">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.CursorResult"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.CursorResult.</span></code></a><span class="sig-name descname"><span class="pre">last_updated_params</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.engine.CursorResult.last_updated_params" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the collection of updated parameters from this
execution.</p>
<p>Raises <a class="reference internal" href="exceptions.html#sqlalchemy.exc.InvalidRequestError" title="sqlalchemy.exc.InvalidRequestError"><code class="xref py py-class docutils literal notranslate"><span class="pre">InvalidRequestError</span></code></a> if the executed
statement is not a compiled expression construct
or is not an update() construct.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.CursorResult.lastrow_has_defaults">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.CursorResult"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.CursorResult.</span></code></a><span class="sig-name descname"><span class="pre">lastrow_has_defaults</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.engine.CursorResult.lastrow_has_defaults" title="Permalink to this definition">¶</a></dt>
<dd><p>Return <code class="docutils literal notranslate"><span class="pre">lastrow_has_defaults()</span></code> from the underlying
<a class="reference internal" href="internals.html#sqlalchemy.engine.ExecutionContext" title="sqlalchemy.engine.ExecutionContext"><code class="xref py py-class docutils literal notranslate"><span class="pre">ExecutionContext</span></code></a>.</p>
<p>See <a class="reference internal" href="internals.html#sqlalchemy.engine.ExecutionContext" title="sqlalchemy.engine.ExecutionContext"><code class="xref py py-class docutils literal notranslate"><span class="pre">ExecutionContext</span></code></a> for details.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.engine.CursorResult.lastrowid">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.engine.CursorResult"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.CursorResult.</span></code></a><span class="sig-name descname"><span class="pre">lastrowid</span></span><a class="headerlink" href="#sqlalchemy.engine.CursorResult.lastrowid" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the ‘lastrowid’ accessor on the DBAPI cursor.</p>
<p>This is a DBAPI specific method and is only functional
for those backends which support it, for statements
where it is appropriate.  It’s behavior is not
consistent across backends.</p>
<p>Usage of this method is normally unnecessary when
using insert() expression constructs; the
<a class="reference internal" href="#sqlalchemy.engine.CursorResult.inserted_primary_key" title="sqlalchemy.engine.CursorResult.inserted_primary_key"><code class="xref py py-attr docutils literal notranslate"><span class="pre">CursorResult.inserted_primary_key</span></code></a> attribute provides a
tuple of primary key values for a newly inserted row,
regardless of database backend.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.CursorResult.mappings">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.CursorResult"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.CursorResult.</span></code></a><span class="sig-name descname"><span class="pre">mappings</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#sqlalchemy.engine.MappingResult" title="sqlalchemy.engine.result.MappingResult"><span class="pre">MappingResult</span></a></span></span><a class="headerlink" href="#sqlalchemy.engine.CursorResult.mappings" title="Permalink to this definition">¶</a></dt>
<dd><div class="inherited-member docutils container">
<p><em>inherited from the</em> <a class="reference internal" href="#sqlalchemy.engine.Result.mappings" title="sqlalchemy.engine.Result.mappings"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.mappings()</span></code></a> <em>method of</em> <a class="reference internal" href="#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a></p>
</div>
<p>Apply a mappings filter to returned rows, returning an instance of
<a class="reference internal" href="#sqlalchemy.engine.MappingResult" title="sqlalchemy.engine.MappingResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">MappingResult</span></code></a>.</p>
<p>When this filter is applied, fetching rows will return
<a class="reference internal" href="#sqlalchemy.engine.RowMapping" title="sqlalchemy.engine.RowMapping"><code class="xref py py-class docutils literal notranslate"><span class="pre">RowMapping</span></code></a> objects instead of <a class="reference internal" href="#sqlalchemy.engine.Row" title="sqlalchemy.engine.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a>
objects.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.4.</span></p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>a new <a class="reference internal" href="#sqlalchemy.engine.MappingResult" title="sqlalchemy.engine.MappingResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">MappingResult</span></code></a> filtering object
referring to this <a class="reference internal" href="#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a> object.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.CursorResult.merge">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.CursorResult"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.CursorResult.</span></code></a><span class="sig-name descname"><span class="pre">merge</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">others</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#sqlalchemy.engine.Result" title="sqlalchemy.engine.result.Result"><span class="pre">Result</span></a><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#sqlalchemy.engine.MergedResult" title="sqlalchemy.engine.result.MergedResult"><span class="pre">MergedResult</span></a><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#sqlalchemy.engine.CursorResult.merge" title="Permalink to this definition">¶</a></dt>
<dd><p>Merge this <a class="reference internal" href="#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a> with other compatible result
objects.</p>
<p>The object returned is an instance of <a class="reference internal" href="#sqlalchemy.engine.MergedResult" title="sqlalchemy.engine.MergedResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">MergedResult</span></code></a>,
which will be composed of iterators from the given result
objects.</p>
<p>The new result will use the metadata from this result object.
The subsequent result objects must be against an identical
set of result / cursor metadata, otherwise the behavior is
undefined.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.CursorResult.one">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.CursorResult"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.CursorResult.</span></code></a><span class="sig-name descname"><span class="pre">one</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#sqlalchemy.engine.Row" title="sqlalchemy.engine.row.Row"><span class="pre">Row</span></a><span class="p"><span class="pre">[</span></span><span class="pre">_TP</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#sqlalchemy.engine.CursorResult.one" title="Permalink to this definition">¶</a></dt>
<dd><div class="inherited-member docutils container">
<p><em>inherited from the</em> <a class="reference internal" href="#sqlalchemy.engine.Result.one" title="sqlalchemy.engine.Result.one"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.one()</span></code></a> <em>method of</em> <a class="reference internal" href="#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a></p>
</div>
<p>Return exactly one row or raise an exception.</p>
<p>Raises <a class="reference internal" href="exceptions.html#sqlalchemy.exc.NoResultFound" title="sqlalchemy.exc.NoResultFound"><code class="xref py py-class docutils literal notranslate"><span class="pre">NoResultFound</span></code></a> if the result returns no
rows, or <a class="reference internal" href="exceptions.html#sqlalchemy.exc.MultipleResultsFound" title="sqlalchemy.exc.MultipleResultsFound"><code class="xref py py-class docutils literal notranslate"><span class="pre">MultipleResultsFound</span></code></a> if multiple rows
would be returned.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This method returns one <strong>row</strong>, e.g. tuple, by default.
To return exactly one single scalar value, that is, the first
column of the first row, use the
<a class="reference internal" href="#sqlalchemy.engine.Result.scalar_one" title="sqlalchemy.engine.Result.scalar_one"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.scalar_one()</span></code></a> method, or combine
<a class="reference internal" href="#sqlalchemy.engine.Result.scalars" title="sqlalchemy.engine.Result.scalars"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.scalars()</span></code></a> and
<a class="reference internal" href="#sqlalchemy.engine.Result.one" title="sqlalchemy.engine.Result.one"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.one()</span></code></a>.</p>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.4.</span></p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>The first <a class="reference internal" href="#sqlalchemy.engine.Row" title="sqlalchemy.engine.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a>.</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><a class="reference internal" href="exceptions.html#sqlalchemy.exc.MultipleResultsFound" title="sqlalchemy.exc.MultipleResultsFound"><code class="xref py py-class docutils literal notranslate"><span class="pre">MultipleResultsFound</span></code></a>, <a class="reference internal" href="exceptions.html#sqlalchemy.exc.NoResultFound" title="sqlalchemy.exc.NoResultFound"><code class="xref py py-class docutils literal notranslate"><span class="pre">NoResultFound</span></code></a></p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#sqlalchemy.engine.Result.first" title="sqlalchemy.engine.Result.first"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.first()</span></code></a></p>
<p><a class="reference internal" href="#sqlalchemy.engine.Result.one_or_none" title="sqlalchemy.engine.Result.one_or_none"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.one_or_none()</span></code></a></p>
<p><a class="reference internal" href="#sqlalchemy.engine.Result.scalar_one" title="sqlalchemy.engine.Result.scalar_one"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.scalar_one()</span></code></a></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.CursorResult.one_or_none">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.CursorResult"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.CursorResult.</span></code></a><span class="sig-name descname"><span class="pre">one_or_none</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#sqlalchemy.engine.Row" title="sqlalchemy.engine.row.Row"><span class="pre">Row</span></a><span class="p"><span class="pre">[</span></span><span class="pre">_TP</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.engine.CursorResult.one_or_none" title="Permalink to this definition">¶</a></dt>
<dd><div class="inherited-member docutils container">
<p><em>inherited from the</em> <a class="reference internal" href="#sqlalchemy.engine.Result.one_or_none" title="sqlalchemy.engine.Result.one_or_none"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.one_or_none()</span></code></a> <em>method of</em> <a class="reference internal" href="#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a></p>
</div>
<p>Return at most one result or raise an exception.</p>
<p>Returns <code class="docutils literal notranslate"><span class="pre">None</span></code> if the result has no rows.
Raises <a class="reference internal" href="exceptions.html#sqlalchemy.exc.MultipleResultsFound" title="sqlalchemy.exc.MultipleResultsFound"><code class="xref py py-class docutils literal notranslate"><span class="pre">MultipleResultsFound</span></code></a>
if multiple rows are returned.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.4.</span></p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>The first <a class="reference internal" href="#sqlalchemy.engine.Row" title="sqlalchemy.engine.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a> or <code class="docutils literal notranslate"><span class="pre">None</span></code> if no row
is available.</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><a class="reference internal" href="exceptions.html#sqlalchemy.exc.MultipleResultsFound" title="sqlalchemy.exc.MultipleResultsFound"><code class="xref py py-class docutils literal notranslate"><span class="pre">MultipleResultsFound</span></code></a></p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#sqlalchemy.engine.Result.first" title="sqlalchemy.engine.Result.first"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.first()</span></code></a></p>
<p><a class="reference internal" href="#sqlalchemy.engine.Result.one" title="sqlalchemy.engine.Result.one"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.one()</span></code></a></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.CursorResult.partitions">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.CursorResult"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.CursorResult.</span></code></a><span class="sig-name descname"><span class="pre">partitions</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">size</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Iterator</span><span class="p"><span class="pre">[</span></span><span class="pre">Sequence</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#sqlalchemy.engine.Row" title="sqlalchemy.engine.row.Row"><span class="pre">Row</span></a><span class="p"><span class="pre">[</span></span><span class="pre">_TP</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#sqlalchemy.engine.CursorResult.partitions" title="Permalink to this definition">¶</a></dt>
<dd><div class="inherited-member docutils container">
<p><em>inherited from the</em> <a class="reference internal" href="#sqlalchemy.engine.Result.partitions" title="sqlalchemy.engine.Result.partitions"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.partitions()</span></code></a> <em>method of</em> <a class="reference internal" href="#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a></p>
</div>
<p>Iterate through sub-lists of rows of the size given.</p>
<p>Each list will be of the size given, excluding the last list to
be yielded, which may have a small number of rows.  No empty
lists will be yielded.</p>
<p>The result object is automatically closed when the iterator
is fully consumed.</p>
<p>Note that the backend driver will usually buffer the entire result
ahead of time unless the
<a class="reference internal" href="#sqlalchemy.engine.Connection.execution_options.params.stream_results" title="sqlalchemy.engine.Connection.execution_options"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Connection.execution_options.stream_results</span></code></a> execution
option is used indicating that the driver should not pre-buffer
results, if possible.   Not all drivers support this option and
the option is silently ignored for those who do not.</p>
<p>When using the ORM, the <a class="reference internal" href="#sqlalchemy.engine.Result.partitions" title="sqlalchemy.engine.Result.partitions"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.partitions()</span></code></a> method
is typically more effective from a memory perspective when it is
combined with use of the
<a class="reference internal" href="../orm/queryguide/api.html#orm-queryguide-yield-per"><span class="std std-ref">yield_per execution option</span></a>,
which instructs both the DBAPI driver to use server side cursors,
if available, as well as instructs the ORM loading internals to only
build a certain amount of ORM objects from a result at a time before
yielding them out.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.4.</span></p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><span class="target" id="sqlalchemy.engine.CursorResult.partitions.params.size"></span><strong>size</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.engine.CursorResult.partitions.params.size">¶</a> – indicate the maximum number of rows to be present
in each list yielded.  If None, makes use of the value set by
the <a class="reference internal" href="#sqlalchemy.engine.Result.yield_per" title="sqlalchemy.engine.Result.yield_per"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.yield_per()</span></code></a>, method, if it were called,
or the <a class="reference internal" href="#sqlalchemy.engine.Connection.execution_options.params.yield_per" title="sqlalchemy.engine.Connection.execution_options"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Connection.execution_options.yield_per</span></code></a>
execution option, which is equivalent in this regard.  If
yield_per weren’t set, it makes use of the
<a class="reference internal" href="#sqlalchemy.engine.Result.fetchmany" title="sqlalchemy.engine.Result.fetchmany"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.fetchmany()</span></code></a> default, which may be backend
specific and not well defined.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>iterator of lists</p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><span class="xref std std-ref">engine_stream_results</span></p>
<p><span class="xref std std-ref">orm_queryguide_yield_per</span> - in the <a class="reference internal" href="../orm/queryguide/index.html"><span class="std std-ref">ORM 查询指南</span></a></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.CursorResult.postfetch_cols">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.CursorResult"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.CursorResult.</span></code></a><span class="sig-name descname"><span class="pre">postfetch_cols</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.engine.CursorResult.postfetch_cols" title="Permalink to this definition">¶</a></dt>
<dd><p>Return <code class="docutils literal notranslate"><span class="pre">postfetch_cols()</span></code> from the underlying
<a class="reference internal" href="internals.html#sqlalchemy.engine.ExecutionContext" title="sqlalchemy.engine.ExecutionContext"><code class="xref py py-class docutils literal notranslate"><span class="pre">ExecutionContext</span></code></a>.</p>
<p>See <a class="reference internal" href="internals.html#sqlalchemy.engine.ExecutionContext" title="sqlalchemy.engine.ExecutionContext"><code class="xref py py-class docutils literal notranslate"><span class="pre">ExecutionContext</span></code></a> for details.</p>
<p>Raises <a class="reference internal" href="exceptions.html#sqlalchemy.exc.InvalidRequestError" title="sqlalchemy.exc.InvalidRequestError"><code class="xref py py-class docutils literal notranslate"><span class="pre">InvalidRequestError</span></code></a> if the executed
statement is not a compiled expression construct
or is not an insert() or update() construct.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.CursorResult.prefetch_cols">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.CursorResult"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.CursorResult.</span></code></a><span class="sig-name descname"><span class="pre">prefetch_cols</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.engine.CursorResult.prefetch_cols" title="Permalink to this definition">¶</a></dt>
<dd><p>Return <code class="docutils literal notranslate"><span class="pre">prefetch_cols()</span></code> from the underlying
<a class="reference internal" href="internals.html#sqlalchemy.engine.ExecutionContext" title="sqlalchemy.engine.ExecutionContext"><code class="xref py py-class docutils literal notranslate"><span class="pre">ExecutionContext</span></code></a>.</p>
<p>See <a class="reference internal" href="internals.html#sqlalchemy.engine.ExecutionContext" title="sqlalchemy.engine.ExecutionContext"><code class="xref py py-class docutils literal notranslate"><span class="pre">ExecutionContext</span></code></a> for details.</p>
<p>Raises <a class="reference internal" href="exceptions.html#sqlalchemy.exc.InvalidRequestError" title="sqlalchemy.exc.InvalidRequestError"><code class="xref py py-class docutils literal notranslate"><span class="pre">InvalidRequestError</span></code></a> if the executed
statement is not a compiled expression construct
or is not an insert() or update() construct.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.engine.CursorResult.returned_defaults">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.engine.CursorResult"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.CursorResult.</span></code></a><span class="sig-name descname"><span class="pre">returned_defaults</span></span><a class="headerlink" href="#sqlalchemy.engine.CursorResult.returned_defaults" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the values of default columns that were fetched using
the <code class="xref py py-meth docutils literal notranslate"><span class="pre">ValuesBase.return_defaults()</span></code> feature.</p>
<p>The value is an instance of <a class="reference internal" href="#sqlalchemy.engine.Row" title="sqlalchemy.engine.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a>, or <code class="docutils literal notranslate"><span class="pre">None</span></code>
if <code class="xref py py-meth docutils literal notranslate"><span class="pre">ValuesBase.return_defaults()</span></code> was not used or if the
backend does not support RETURNING.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><code class="xref py py-meth docutils literal notranslate"><span class="pre">ValuesBase.return_defaults()</span></code></p>
</div>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.engine.CursorResult.returned_defaults_rows">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.engine.CursorResult"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.CursorResult.</span></code></a><span class="sig-name descname"><span class="pre">returned_defaults_rows</span></span><a class="headerlink" href="#sqlalchemy.engine.CursorResult.returned_defaults_rows" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a list of rows each containing the values of default
columns that were fetched using
the <code class="xref py py-meth docutils literal notranslate"><span class="pre">ValuesBase.return_defaults()</span></code> feature.</p>
<p>The return value is a list of <a class="reference internal" href="#sqlalchemy.engine.Row" title="sqlalchemy.engine.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a> objects.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.4.</span></p>
</div>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.engine.CursorResult.returns_rows">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.engine.CursorResult"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.CursorResult.</span></code></a><span class="sig-name descname"><span class="pre">returns_rows</span></span><a class="headerlink" href="#sqlalchemy.engine.CursorResult.returns_rows" title="Permalink to this definition">¶</a></dt>
<dd><p>True if this <a class="reference internal" href="#sqlalchemy.engine.CursorResult" title="sqlalchemy.engine.CursorResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">CursorResult</span></code></a> returns zero or more
rows.</p>
<p>I.e. if it is legal to call the methods
<a class="reference internal" href="#sqlalchemy.engine.CursorResult.fetchone" title="sqlalchemy.engine.CursorResult.fetchone"><code class="xref py py-meth docutils literal notranslate"><span class="pre">CursorResult.fetchone()</span></code></a>,
<a class="reference internal" href="#sqlalchemy.engine.CursorResult.fetchmany" title="sqlalchemy.engine.CursorResult.fetchmany"><code class="xref py py-meth docutils literal notranslate"><span class="pre">CursorResult.fetchmany()</span></code></a>
<a class="reference internal" href="#sqlalchemy.engine.CursorResult.fetchall" title="sqlalchemy.engine.CursorResult.fetchall"><code class="xref py py-meth docutils literal notranslate"><span class="pre">CursorResult.fetchall()</span></code></a>.</p>
<p>Overall, the value of <a class="reference internal" href="#sqlalchemy.engine.CursorResult.returns_rows" title="sqlalchemy.engine.CursorResult.returns_rows"><code class="xref py py-attr docutils literal notranslate"><span class="pre">CursorResult.returns_rows</span></code></a> should
always be synonymous with whether or not the DBAPI cursor had a
<code class="docutils literal notranslate"><span class="pre">.description</span></code> attribute, indicating the presence of result columns,
noting that a cursor that returns zero rows still has a
<code class="docutils literal notranslate"><span class="pre">.description</span></code> if a row-returning statement was emitted.</p>
<p>This attribute should be True for all results that are against
SELECT statements, as well as for DML statements INSERT/UPDATE/DELETE
that use RETURNING.   For INSERT/UPDATE/DELETE statements that were
not using RETURNING, the value will usually be False, however
there are some dialect-specific exceptions to this, such as when
using the MSSQL / pyodbc dialect a SELECT is emitted inline in
order to retrieve an inserted primary key value.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.engine.CursorResult.rowcount">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.engine.CursorResult"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.CursorResult.</span></code></a><span class="sig-name descname"><span class="pre">rowcount</span></span><a class="headerlink" href="#sqlalchemy.engine.CursorResult.rowcount" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the ‘rowcount’ for this result.</p>
<p>The ‘rowcount’ reports the number of rows <em>matched</em>
by the WHERE criterion of an UPDATE or DELETE statement.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Notes regarding <a class="reference internal" href="#sqlalchemy.engine.CursorResult.rowcount" title="sqlalchemy.engine.CursorResult.rowcount"><code class="xref py py-attr docutils literal notranslate"><span class="pre">CursorResult.rowcount</span></code></a>:</p>
<ul class="simple">
<li><p>This attribute returns the number of rows <em>matched</em>,
which is not necessarily the same as the number of rows
that were actually <em>modified</em> - an UPDATE statement, for example,
may have no net change on a given row if the SET values
given are the same as those present in the row already.
Such a row would be matched but not modified.
On backends that feature both styles, such as MySQL,
rowcount is configured by default to return the match
count in all cases.</p></li>
<li><p><a class="reference internal" href="#sqlalchemy.engine.CursorResult.rowcount" title="sqlalchemy.engine.CursorResult.rowcount"><code class="xref py py-attr docutils literal notranslate"><span class="pre">CursorResult.rowcount</span></code></a>
is <em>only</em> useful in conjunction
with an UPDATE or DELETE statement.  Contrary to what the Python
DBAPI says, it does <em>not</em> return the
number of rows available from the results of a SELECT statement
as DBAPIs cannot support this functionality when rows are
unbuffered.</p></li>
<li><p><a class="reference internal" href="#sqlalchemy.engine.CursorResult.rowcount" title="sqlalchemy.engine.CursorResult.rowcount"><code class="xref py py-attr docutils literal notranslate"><span class="pre">CursorResult.rowcount</span></code></a>
may not be fully implemented by
all dialects.  In particular, most DBAPIs do not support an
aggregate rowcount result from an executemany call.
The <a class="reference internal" href="#sqlalchemy.engine.CursorResult.supports_sane_rowcount" title="sqlalchemy.engine.CursorResult.supports_sane_rowcount"><code class="xref py py-meth docutils literal notranslate"><span class="pre">CursorResult.supports_sane_rowcount()</span></code></a> and
<a class="reference internal" href="#sqlalchemy.engine.CursorResult.supports_sane_multi_rowcount" title="sqlalchemy.engine.CursorResult.supports_sane_multi_rowcount"><code class="xref py py-meth docutils literal notranslate"><span class="pre">CursorResult.supports_sane_multi_rowcount()</span></code></a> methods
will report from the dialect if each usage is known to be
supported.</p></li>
<li><p>Statements that use RETURNING may not return a correct
rowcount.</p></li>
</ul>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../tutorial/data_update.html#tutorial-update-delete-rowcount"><span class="std std-ref">从UPDATE、DELETE中获取受影响的行数</span></a> - in the <a class="reference internal" href="../tutorial/index.html#unified-tutorial"><span class="std std-ref">SQLAlchemy统一教程</span></a></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.CursorResult.scalar">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.CursorResult"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.CursorResult.</span></code></a><span class="sig-name descname"><span class="pre">scalar</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Any</span></span></span><a class="headerlink" href="#sqlalchemy.engine.CursorResult.scalar" title="Permalink to this definition">¶</a></dt>
<dd><div class="inherited-member docutils container">
<p><em>inherited from the</em> <a class="reference internal" href="#sqlalchemy.engine.Result.scalar" title="sqlalchemy.engine.Result.scalar"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.scalar()</span></code></a> <em>method of</em> <a class="reference internal" href="#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a></p>
</div>
<p>Fetch the first column of the first row, and close the result set.</p>
<p>Returns <code class="docutils literal notranslate"><span class="pre">None</span></code> if there are no rows to fetch.</p>
<p>No validation is performed to test if additional rows remain.</p>
<p>After calling this method, the object is fully closed,
e.g. the <a class="reference internal" href="#sqlalchemy.engine.CursorResult.close" title="sqlalchemy.engine.CursorResult.close"><code class="xref py py-meth docutils literal notranslate"><span class="pre">CursorResult.close()</span></code></a>
method will have been called.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>a Python scalar value, or <code class="docutils literal notranslate"><span class="pre">None</span></code> if no rows remain.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.CursorResult.scalar_one">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.CursorResult"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.CursorResult.</span></code></a><span class="sig-name descname"><span class="pre">scalar_one</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Any</span></span></span><a class="headerlink" href="#sqlalchemy.engine.CursorResult.scalar_one" title="Permalink to this definition">¶</a></dt>
<dd><div class="inherited-member docutils container">
<p><em>inherited from the</em> <a class="reference internal" href="#sqlalchemy.engine.Result.scalar_one" title="sqlalchemy.engine.Result.scalar_one"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.scalar_one()</span></code></a> <em>method of</em> <a class="reference internal" href="#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a></p>
</div>
<p>Return exactly one scalar result or raise an exception.</p>
<p>This is equivalent to calling <a class="reference internal" href="#sqlalchemy.engine.Result.scalars" title="sqlalchemy.engine.Result.scalars"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.scalars()</span></code></a> and
then <a class="reference internal" href="#sqlalchemy.engine.Result.one" title="sqlalchemy.engine.Result.one"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.one()</span></code></a>.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#sqlalchemy.engine.Result.one" title="sqlalchemy.engine.Result.one"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.one()</span></code></a></p>
<p><a class="reference internal" href="#sqlalchemy.engine.Result.scalars" title="sqlalchemy.engine.Result.scalars"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.scalars()</span></code></a></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.CursorResult.scalar_one_or_none">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.CursorResult"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.CursorResult.</span></code></a><span class="sig-name descname"><span class="pre">scalar_one_or_none</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Any</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.engine.CursorResult.scalar_one_or_none" title="Permalink to this definition">¶</a></dt>
<dd><div class="inherited-member docutils container">
<p><em>inherited from the</em> <a class="reference internal" href="#sqlalchemy.engine.Result.scalar_one_or_none" title="sqlalchemy.engine.Result.scalar_one_or_none"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.scalar_one_or_none()</span></code></a> <em>method of</em> <a class="reference internal" href="#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a></p>
</div>
<p>Return exactly one scalar result or <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p>
<p>This is equivalent to calling <a class="reference internal" href="#sqlalchemy.engine.Result.scalars" title="sqlalchemy.engine.Result.scalars"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.scalars()</span></code></a> and
then <a class="reference internal" href="#sqlalchemy.engine.Result.one_or_none" title="sqlalchemy.engine.Result.one_or_none"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.one_or_none()</span></code></a>.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#sqlalchemy.engine.Result.one_or_none" title="sqlalchemy.engine.Result.one_or_none"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.one_or_none()</span></code></a></p>
<p><a class="reference internal" href="#sqlalchemy.engine.Result.scalars" title="sqlalchemy.engine.Result.scalars"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.scalars()</span></code></a></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.CursorResult.scalars">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.CursorResult"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.CursorResult.</span></code></a><span class="sig-name descname"><span class="pre">scalars</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">index</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_KeyIndexType</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#sqlalchemy.engine.ScalarResult" title="sqlalchemy.engine.ScalarResult"><span class="pre">ScalarResult</span></a><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#sqlalchemy.engine.CursorResult.scalars" title="Permalink to this definition">¶</a></dt>
<dd><div class="inherited-member docutils container">
<p><em>inherited from the</em> <a class="reference internal" href="#sqlalchemy.engine.Result.scalars" title="sqlalchemy.engine.Result.scalars"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.scalars()</span></code></a> <em>method of</em> <a class="reference internal" href="#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a></p>
</div>
<p>Return a <a class="reference internal" href="#sqlalchemy.engine.ScalarResult" title="sqlalchemy.engine.ScalarResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">ScalarResult</span></code></a> filtering object which
will return single elements rather than <a class="reference internal" href="#sqlalchemy.engine.Row" title="sqlalchemy.engine.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a> objects.</p>
<p>E.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">text</span><span class="p">(</span><span class="s2">&quot;select int_id from table&quot;</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span><span class="o">.</span><span class="n">scalars</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="go">[1, 2, 3]</span></pre></div>
</div>
<p>When results are fetched from the <a class="reference internal" href="#sqlalchemy.engine.ScalarResult" title="sqlalchemy.engine.ScalarResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">ScalarResult</span></code></a>
filtering object, the single column-row that would be returned by the
<a class="reference internal" href="#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a> is instead returned as the column’s value.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.4.</span></p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><span class="target" id="sqlalchemy.engine.CursorResult.scalars.params.index"></span><strong>index</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.engine.CursorResult.scalars.params.index">¶</a> – integer or row key indicating the column to be fetched
from each row, defaults to <code class="docutils literal notranslate"><span class="pre">0</span></code> indicating the first column.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>a new <a class="reference internal" href="#sqlalchemy.engine.ScalarResult" title="sqlalchemy.engine.ScalarResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">ScalarResult</span></code></a> filtering object referring
to this <a class="reference internal" href="#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a> object.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.CursorResult.splice_horizontally">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.CursorResult"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.CursorResult.</span></code></a><span class="sig-name descname"><span class="pre">splice_horizontally</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">other</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.engine.CursorResult.splice_horizontally" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a new <a class="reference internal" href="#sqlalchemy.engine.CursorResult" title="sqlalchemy.engine.CursorResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">CursorResult</span></code></a> that “horizontally splices”
together the rows of this <a class="reference internal" href="#sqlalchemy.engine.CursorResult" title="sqlalchemy.engine.CursorResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">CursorResult</span></code></a> with that of another
<a class="reference internal" href="#sqlalchemy.engine.CursorResult" title="sqlalchemy.engine.CursorResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">CursorResult</span></code></a>.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>This method is for the benefit of the SQLAlchemy ORM and is
not intended for general use.</p>
</div>
<p>“horizontally splices” means that for each row in the first and second
result sets, a new row that concatenates the two rows together is
produced, which then becomes the new row.  The incoming
<a class="reference internal" href="#sqlalchemy.engine.CursorResult" title="sqlalchemy.engine.CursorResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">CursorResult</span></code></a> must have the identical number of rows.  It is
typically expected that the two result sets come from the same sort
order as well, as the result rows are spliced together based on their
position in the result.</p>
<p>The expected use case here is so that multiple INSERT..RETURNING
statements (which definitely need to be sorted) against different
tables can produce a single result that looks like a JOIN of those two
tables.</p>
<p>E.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">r1</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
    <span class="n">users</span><span class="o">.</span><span class="n">insert</span><span class="p">()</span><span class="o">.</span><span class="n">returning</span><span class="p">(</span>
        <span class="n">users</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">user_name</span><span class="p">,</span>
        <span class="n">users</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span>
        <span class="n">sort_by_parameter_order</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">),</span>
    <span class="n">user_values</span>
<span class="p">)</span>

<span class="n">r2</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
    <span class="n">addresses</span><span class="o">.</span><span class="n">insert</span><span class="p">()</span><span class="o">.</span><span class="n">returning</span><span class="p">(</span>
        <span class="n">addresses</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">address_id</span><span class="p">,</span>
        <span class="n">addresses</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">address</span><span class="p">,</span>
        <span class="n">addresses</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span>
        <span class="n">sort_by_parameter_order</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">),</span>
    <span class="n">address_values</span>
<span class="p">)</span>

<span class="n">rows</span> <span class="o">=</span> <span class="n">r1</span><span class="o">.</span><span class="n">splice_horizontally</span><span class="p">(</span><span class="n">r2</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="k">assert</span> <span class="p">(</span>
    <span class="n">rows</span> <span class="o">==</span>
    <span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;john&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;foo@bar.com&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;jack&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;bar@bat.com&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
    <span class="p">]</span>
<span class="p">)</span></pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 2.0.</span></p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#sqlalchemy.engine.CursorResult.splice_vertically" title="sqlalchemy.engine.CursorResult.splice_vertically"><code class="xref py py-meth docutils literal notranslate"><span class="pre">CursorResult.splice_vertically()</span></code></a></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.CursorResult.splice_vertically">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.CursorResult"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.CursorResult.</span></code></a><span class="sig-name descname"><span class="pre">splice_vertically</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">other</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.engine.CursorResult.splice_vertically" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a new <a class="reference internal" href="#sqlalchemy.engine.CursorResult" title="sqlalchemy.engine.CursorResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">CursorResult</span></code></a> that “vertically splices”,
i.e. “extends”, the rows of this <a class="reference internal" href="#sqlalchemy.engine.CursorResult" title="sqlalchemy.engine.CursorResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">CursorResult</span></code></a> with that of
another <a class="reference internal" href="#sqlalchemy.engine.CursorResult" title="sqlalchemy.engine.CursorResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">CursorResult</span></code></a>.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>This method is for the benefit of the SQLAlchemy ORM and is
not intended for general use.</p>
</div>
<p>“vertically splices” means the rows of the given result are appended to
the rows of this cursor result. The incoming <a class="reference internal" href="#sqlalchemy.engine.CursorResult" title="sqlalchemy.engine.CursorResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">CursorResult</span></code></a>
must have rows that represent the identical list of columns in the
identical order as they are in this <a class="reference internal" href="#sqlalchemy.engine.CursorResult" title="sqlalchemy.engine.CursorResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">CursorResult</span></code></a>.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 2.0.</span></p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#sqlalchemy.engine.CursorResult.splice_horizontally" title="sqlalchemy.engine.CursorResult.splice_horizontally"><code class="xref py py-meth docutils literal notranslate"><span class="pre">CursorResult.splice_horizontally()</span></code></a></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.CursorResult.supports_sane_multi_rowcount">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.CursorResult"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.CursorResult.</span></code></a><span class="sig-name descname"><span class="pre">supports_sane_multi_rowcount</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.engine.CursorResult.supports_sane_multi_rowcount" title="Permalink to this definition">¶</a></dt>
<dd><p>Return <code class="docutils literal notranslate"><span class="pre">supports_sane_multi_rowcount</span></code> from the dialect.</p>
<p>See <a class="reference internal" href="#sqlalchemy.engine.CursorResult.rowcount" title="sqlalchemy.engine.CursorResult.rowcount"><code class="xref py py-attr docutils literal notranslate"><span class="pre">CursorResult.rowcount</span></code></a> for background.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.CursorResult.supports_sane_rowcount">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.CursorResult"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.CursorResult.</span></code></a><span class="sig-name descname"><span class="pre">supports_sane_rowcount</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.engine.CursorResult.supports_sane_rowcount" title="Permalink to this definition">¶</a></dt>
<dd><p>Return <code class="docutils literal notranslate"><span class="pre">supports_sane_rowcount</span></code> from the dialect.</p>
<p>See <a class="reference internal" href="#sqlalchemy.engine.CursorResult.rowcount" title="sqlalchemy.engine.CursorResult.rowcount"><code class="xref py py-attr docutils literal notranslate"><span class="pre">CursorResult.rowcount</span></code></a> for background.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.engine.CursorResult.t">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.engine.CursorResult"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.CursorResult.</span></code></a><span class="sig-name descname"><span class="pre">t</span></span><a class="headerlink" href="#sqlalchemy.engine.CursorResult.t" title="Permalink to this definition">¶</a></dt>
<dd><div class="inherited-member docutils container">
<p><em>inherited from the</em> <a class="reference internal" href="#sqlalchemy.engine.Result.t" title="sqlalchemy.engine.Result.t"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Result.t</span></code></a> <em>attribute of</em> <a class="reference internal" href="#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a></p>
</div>
<p>Apply a “typed tuple” typing filter to returned rows.</p>
<p>The <a class="reference internal" href="#sqlalchemy.engine.Result.t" title="sqlalchemy.engine.Result.t"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Result.t</span></code></a> attribute is a synonym for
calling the <a class="reference internal" href="#sqlalchemy.engine.Result.tuples" title="sqlalchemy.engine.Result.tuples"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.tuples()</span></code></a> method.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 2.0.</span></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.CursorResult.tuples">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.CursorResult"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.CursorResult.</span></code></a><span class="sig-name descname"><span class="pre">tuples</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#sqlalchemy.engine.TupleResult" title="sqlalchemy.engine.result.TupleResult"><span class="pre">TupleResult</span></a><span class="p"><span class="pre">[</span></span><span class="pre">_TP</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#sqlalchemy.engine.CursorResult.tuples" title="Permalink to this definition">¶</a></dt>
<dd><div class="inherited-member docutils container">
<p><em>inherited from the</em> <a class="reference internal" href="#sqlalchemy.engine.Result.tuples" title="sqlalchemy.engine.Result.tuples"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.tuples()</span></code></a> <em>method of</em> <a class="reference internal" href="#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a></p>
</div>
<p>Apply a “typed tuple” typing filter to returned rows.</p>
<p>This method returns the same <a class="reference internal" href="#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a> object
at runtime,
however annotates as returning a <a class="reference internal" href="#sqlalchemy.engine.TupleResult" title="sqlalchemy.engine.TupleResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">TupleResult</span></code></a> object
that will indicate to <span class="target" id="index-3"></span><a class="pep reference external" href="https://peps.python.org/pep-0484/"><strong>PEP 484</strong></a> typing tools that plain typed
<code class="docutils literal notranslate"><span class="pre">Tuple</span></code> instances are returned rather than rows.  This allows
tuple unpacking and <code class="docutils literal notranslate"><span class="pre">__getitem__</span></code> access of <a class="reference internal" href="#sqlalchemy.engine.Row" title="sqlalchemy.engine.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a>
objects to by typed, for those cases where the statement invoked
itself included typing information.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 2.0.</span></p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>the <a class="reference internal" href="#sqlalchemy.engine.TupleResult" title="sqlalchemy.engine.TupleResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">TupleResult</span></code></a> type at typing time.</p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#sqlalchemy.engine.Result.t" title="sqlalchemy.engine.Result.t"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Result.t</span></code></a> - shorter synonym</p>
<p><a class="reference internal" href="#sqlalchemy.engine.Row._t" title="sqlalchemy.engine.Row._t"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Row._t</span></code></a> - <a class="reference internal" href="#sqlalchemy.engine.Row" title="sqlalchemy.engine.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a> version</p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.CursorResult.unique">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.CursorResult"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.CursorResult.</span></code></a><span class="sig-name descname"><span class="pre">unique</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">strategy</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Callable</span><span class="p"><span class="pre">[</span></span><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Self</span></span></span><a class="headerlink" href="#sqlalchemy.engine.CursorResult.unique" title="Permalink to this definition">¶</a></dt>
<dd><div class="inherited-member docutils container">
<p><em>inherited from the</em> <a class="reference internal" href="#sqlalchemy.engine.Result.unique" title="sqlalchemy.engine.Result.unique"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.unique()</span></code></a> <em>method of</em> <a class="reference internal" href="#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a></p>
</div>
<p>Apply unique filtering to the objects returned by this
<a class="reference internal" href="#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a>.</p>
<p>When this filter is applied with no arguments, the rows or objects
returned will filtered such that each row is returned uniquely. The
algorithm used to determine this uniqueness is by default the Python
hashing identity of the whole tuple.   In some cases a specialized
per-entity hashing scheme may be used, such as when using the ORM, a
scheme is applied which  works against the primary key identity of
returned objects.</p>
<p>The unique filter is applied <strong>after all other filters</strong>, which means
if the columns returned have been refined using a method such as the
<a class="reference internal" href="#sqlalchemy.engine.Result.columns" title="sqlalchemy.engine.Result.columns"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.columns()</span></code></a> or <a class="reference internal" href="#sqlalchemy.engine.Result.scalars" title="sqlalchemy.engine.Result.scalars"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.scalars()</span></code></a>
method, the uniquing is applied to <strong>only the column or columns
returned</strong>.   This occurs regardless of the order in which these
methods have been called upon the <a class="reference internal" href="#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a> object.</p>
<p>The unique filter also changes the calculus used for methods like
<a class="reference internal" href="#sqlalchemy.engine.Result.fetchmany" title="sqlalchemy.engine.Result.fetchmany"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.fetchmany()</span></code></a> and <a class="reference internal" href="#sqlalchemy.engine.Result.partitions" title="sqlalchemy.engine.Result.partitions"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.partitions()</span></code></a>.
When using <a class="reference internal" href="#sqlalchemy.engine.Result.unique" title="sqlalchemy.engine.Result.unique"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.unique()</span></code></a>, these methods will continue
to yield the number of rows or objects requested, after uniquing
has been applied.  However, this necessarily impacts the buffering
behavior of the underlying cursor or datasource, such that multiple
underlying calls to <code class="docutils literal notranslate"><span class="pre">cursor.fetchmany()</span></code> may be necessary in order
to accumulate enough objects in order to provide a unique collection
of the requested size.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><span class="target" id="sqlalchemy.engine.CursorResult.unique.params.strategy"></span><strong>strategy</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.engine.CursorResult.unique.params.strategy">¶</a> – a callable that will be applied to rows or objects
being iterated, which should return an object that represents the
unique value of the row.   A Python <code class="docutils literal notranslate"><span class="pre">set()</span></code> is used to store
these identities.   If not passed, a default uniqueness strategy
is used which may have been assembled by the source of this
<a class="reference internal" href="#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a> object.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.CursorResult.yield_per">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.CursorResult"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.CursorResult.</span></code></a><span class="sig-name descname"><span class="pre">yield_per</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">num</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Self</span></span></span><a class="headerlink" href="#sqlalchemy.engine.CursorResult.yield_per" title="Permalink to this definition">¶</a></dt>
<dd><p>Configure the row-fetching strategy to fetch <code class="docutils literal notranslate"><span class="pre">num</span></code> rows at a time.</p>
<p>This impacts the underlying behavior of the result when iterating over
the result object, or otherwise making use of  methods such as
<a class="reference internal" href="#sqlalchemy.engine.Result.fetchone" title="sqlalchemy.engine.Result.fetchone"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.fetchone()</span></code></a> that return one row at a time.   Data
from the underlying cursor or other data source will be buffered up to
this many rows in memory, and the buffered collection will then be
yielded out one row at a time or as many rows are requested. Each time
the buffer clears, it will be refreshed to this many rows or as many
rows remain if fewer remain.</p>
<p>The <a class="reference internal" href="#sqlalchemy.engine.Result.yield_per" title="sqlalchemy.engine.Result.yield_per"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.yield_per()</span></code></a> method is generally used in
conjunction with the
<a class="reference internal" href="#sqlalchemy.engine.Connection.execution_options.params.stream_results" title="sqlalchemy.engine.Connection.execution_options"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Connection.execution_options.stream_results</span></code></a>
execution option, which will allow the database dialect in use to make
use of a server side cursor, if the DBAPI supports a specific “server
side cursor” mode separate from its default mode of operation.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Consider using the
<a class="reference internal" href="#sqlalchemy.engine.Connection.execution_options.params.yield_per" title="sqlalchemy.engine.Connection.execution_options"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Connection.execution_options.yield_per</span></code></a>
execution option, which will simultaneously set
<a class="reference internal" href="#sqlalchemy.engine.Connection.execution_options.params.stream_results" title="sqlalchemy.engine.Connection.execution_options"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Connection.execution_options.stream_results</span></code></a>
to ensure the use of server side cursors, as well as automatically
invoke the <a class="reference internal" href="#sqlalchemy.engine.Result.yield_per" title="sqlalchemy.engine.Result.yield_per"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.yield_per()</span></code></a> method to establish
a fixed row buffer size at once.</p>
<p>The <a class="reference internal" href="#sqlalchemy.engine.Connection.execution_options.params.yield_per" title="sqlalchemy.engine.Connection.execution_options"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Connection.execution_options.yield_per</span></code></a>
execution option is available for ORM operations, with
<code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code>-oriented use described at
<span class="xref std std-ref">orm_queryguide_yield_per</span>. The Core-only version which works
with <a class="reference internal" href="#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a> is new as of SQLAlchemy 1.4.40.</p>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.4.</span></p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><span class="target" id="sqlalchemy.engine.CursorResult.yield_per.params.num"></span><strong>num</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.engine.CursorResult.yield_per.params.num">¶</a> – number of rows to fetch each time the buffer is refilled.
If set to a value below 1, fetches all rows for the next buffer.</p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><span class="xref std std-ref">engine_stream_results</span> - describes Core behavior for
<a class="reference internal" href="#sqlalchemy.engine.Result.yield_per" title="sqlalchemy.engine.Result.yield_per"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.yield_per()</span></code></a></p>
<p><span class="xref std std-ref">orm_queryguide_yield_per</span> - in the <a class="reference internal" href="../orm/queryguide/index.html"><span class="std std-ref">ORM 查询指南</span></a></p>
</div>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.engine.FilterResult">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.engine.</span></span><span class="sig-name descname"><span class="pre">FilterResult</span></span><a class="headerlink" href="#sqlalchemy.engine.FilterResult" title="Permalink to this definition">¶</a></dt>
<dd><p>A wrapper for a <a class="reference internal" href="#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a> that returns objects other than
<a class="reference internal" href="#sqlalchemy.engine.Row" title="sqlalchemy.engine.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a> objects, such as dictionaries or scalar objects.</p>
<p><a class="reference internal" href="#sqlalchemy.engine.FilterResult" title="sqlalchemy.engine.FilterResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">FilterResult</span></code></a> is the common base for additional result
APIs including <a class="reference internal" href="#sqlalchemy.engine.MappingResult" title="sqlalchemy.engine.MappingResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">MappingResult</span></code></a>,
<a class="reference internal" href="#sqlalchemy.engine.ScalarResult" title="sqlalchemy.engine.ScalarResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">ScalarResult</span></code></a> and <code class="xref py py-class docutils literal notranslate"><span class="pre">AsyncResult</span></code>.</p>
<div class="class-members docutils container">
<p><strong>Members</strong></p>
<p><a class="reference internal" href="#sqlalchemy.engine.FilterResult.close"><span class="sig-name descname">close()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.FilterResult.closed"><span class="sig-name descname">closed</span></a>, <a class="reference internal" href="#sqlalchemy.engine.FilterResult.yield_per"><span class="sig-name descname">yield_per()</span></a></p>
</div>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.engine.FilterResult" title="sqlalchemy.engine.FilterResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.engine.FilterResult</span></code></a> (<code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.engine.ResultInternal</span></code>)</p>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.FilterResult.close">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.FilterResult"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.FilterResult.</span></code></a><span class="sig-name descname"><span class="pre">close</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.engine.FilterResult.close" title="Permalink to this definition">¶</a></dt>
<dd><p>Close this <a class="reference internal" href="#sqlalchemy.engine.FilterResult" title="sqlalchemy.engine.FilterResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">FilterResult</span></code></a>.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.4.43.</span></p>
</div>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.engine.FilterResult.closed">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.engine.FilterResult"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.FilterResult.</span></code></a><span class="sig-name descname"><span class="pre">closed</span></span><a class="headerlink" href="#sqlalchemy.engine.FilterResult.closed" title="Permalink to this definition">¶</a></dt>
<dd><p>Return <code class="docutils literal notranslate"><span class="pre">True</span></code> if the underlying <a class="reference internal" href="#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a> reports
closed</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.4.43.</span></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.FilterResult.yield_per">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.FilterResult"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.FilterResult.</span></code></a><span class="sig-name descname"><span class="pre">yield_per</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">num</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Self</span></span></span><a class="headerlink" href="#sqlalchemy.engine.FilterResult.yield_per" title="Permalink to this definition">¶</a></dt>
<dd><p>Configure the row-fetching strategy to fetch <code class="docutils literal notranslate"><span class="pre">num</span></code> rows at a time.</p>
<p>The <a class="reference internal" href="#sqlalchemy.engine.FilterResult.yield_per" title="sqlalchemy.engine.FilterResult.yield_per"><code class="xref py py-meth docutils literal notranslate"><span class="pre">FilterResult.yield_per()</span></code></a> method is a pass through
to the <a class="reference internal" href="#sqlalchemy.engine.Result.yield_per" title="sqlalchemy.engine.Result.yield_per"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.yield_per()</span></code></a> method.  See that method’s
documentation for usage notes.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.4.40: </span>- added <a class="reference internal" href="#sqlalchemy.engine.FilterResult.yield_per" title="sqlalchemy.engine.FilterResult.yield_per"><code class="xref py py-meth docutils literal notranslate"><span class="pre">FilterResult.yield_per()</span></code></a>
so that the method is available on all result set implementations</p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><span class="xref std std-ref">engine_stream_results</span> - describes Core behavior for
<a class="reference internal" href="#sqlalchemy.engine.Result.yield_per" title="sqlalchemy.engine.Result.yield_per"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.yield_per()</span></code></a></p>
<p><span class="xref std std-ref">orm_queryguide_yield_per</span> - in the <a class="reference internal" href="../orm/queryguide/index.html"><span class="std std-ref">ORM 查询指南</span></a></p>
</div>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.engine.FrozenResult">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.engine.</span></span><span class="sig-name descname"><span class="pre">FrozenResult</span></span><a class="headerlink" href="#sqlalchemy.engine.FrozenResult" title="Permalink to this definition">¶</a></dt>
<dd><p>Represents a <a class="reference internal" href="#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a> object in a “frozen” state suitable
for caching.</p>
<p>The <a class="reference internal" href="#sqlalchemy.engine.FrozenResult" title="sqlalchemy.engine.FrozenResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">FrozenResult</span></code></a> object is returned from the
<a class="reference internal" href="#sqlalchemy.engine.Result.freeze" title="sqlalchemy.engine.Result.freeze"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.freeze()</span></code></a> method of any <a class="reference internal" href="#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a>
object.</p>
<p>A new iterable <a class="reference internal" href="#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a> object is generated from a fixed
set of data each time the <a class="reference internal" href="#sqlalchemy.engine.FrozenResult" title="sqlalchemy.engine.FrozenResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">FrozenResult</span></code></a> is invoked as
a callable:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>

<span class="n">frozen</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">freeze</span><span class="p">()</span>

<span class="n">unfrozen_result_one</span> <span class="o">=</span> <span class="n">frozen</span><span class="p">()</span>

<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">unfrozen_result_one</span><span class="p">:</span>
    <span class="n">print</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>

<span class="n">unfrozen_result_two</span> <span class="o">=</span> <span class="n">frozen</span><span class="p">()</span>
<span class="n">rows</span> <span class="o">=</span> <span class="n">unfrozen_result_two</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

<span class="c1"># ... etc</span></pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.4.</span></p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../orm/session_events.html#do-orm-execute-re-executing"><span class="std std-ref">重新执行语句</span></a> - example usage within the
ORM to implement a result-set cache.</p>
<p><code class="xref py py-func docutils literal notranslate"><span class="pre">merge_frozen_result()</span></code> - ORM function to merge
a frozen result back into a <code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code>.</p>
</div>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.engine.FrozenResult" title="sqlalchemy.engine.FrozenResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.engine.FrozenResult</span></code></a> (<code class="xref py py-class docutils literal notranslate"><span class="pre">typing.Generic</span></code>)</p>
</div>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.engine.IteratorResult">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.engine.</span></span><span class="sig-name descname"><span class="pre">IteratorResult</span></span><a class="headerlink" href="#sqlalchemy.engine.IteratorResult" title="Permalink to this definition">¶</a></dt>
<dd><p>A <a class="reference internal" href="#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a> that gets data from a Python iterator of
<a class="reference internal" href="#sqlalchemy.engine.Row" title="sqlalchemy.engine.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a> objects or similar row-like data.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.4.</span></p>
</div>
<div class="class-members docutils container">
<p><strong>Members</strong></p>
<p><a class="reference internal" href="#sqlalchemy.engine.IteratorResult.closed"><span class="sig-name descname">closed</span></a></p>
</div>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.engine.IteratorResult" title="sqlalchemy.engine.IteratorResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.engine.IteratorResult</span></code></a> (<a class="reference internal" href="#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.engine.Result</span></code></a>)</p>
</div>
<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.engine.IteratorResult.closed">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.engine.IteratorResult"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.IteratorResult.</span></code></a><span class="sig-name descname"><span class="pre">closed</span></span><a class="headerlink" href="#sqlalchemy.engine.IteratorResult.closed" title="Permalink to this definition">¶</a></dt>
<dd><p>Return <code class="docutils literal notranslate"><span class="pre">True</span></code> if this <a class="reference internal" href="#sqlalchemy.engine.IteratorResult" title="sqlalchemy.engine.IteratorResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">IteratorResult</span></code></a> has
been closed</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.4.43.</span></p>
</div>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.engine.MergedResult">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.engine.</span></span><span class="sig-name descname"><span class="pre">MergedResult</span></span><a class="headerlink" href="#sqlalchemy.engine.MergedResult" title="Permalink to this definition">¶</a></dt>
<dd><p>A <a class="reference internal" href="#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a> that is merged from any number of
<a class="reference internal" href="#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a> objects.</p>
<p>Returned by the <a class="reference internal" href="#sqlalchemy.engine.Result.merge" title="sqlalchemy.engine.Result.merge"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.merge()</span></code></a> method.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.4.</span></p>
</div>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.engine.MergedResult" title="sqlalchemy.engine.MergedResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.engine.MergedResult</span></code></a> (<a class="reference internal" href="#sqlalchemy.engine.IteratorResult" title="sqlalchemy.engine.IteratorResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.engine.IteratorResult</span></code></a>)</p>
</div>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.engine.Result">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.engine.</span></span><span class="sig-name descname"><span class="pre">Result</span></span><a class="headerlink" href="#sqlalchemy.engine.Result" title="Permalink to this definition">¶</a></dt>
<dd><p>Represent a set of database results.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.4: </span>The <a class="reference internal" href="#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a> object provides a
completely updated usage model and calling facade for SQLAlchemy
Core and SQLAlchemy ORM.   In Core, it forms the basis of the
<a class="reference internal" href="#sqlalchemy.engine.CursorResult" title="sqlalchemy.engine.CursorResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">CursorResult</span></code></a> object which replaces the previous
<code class="xref py py-class docutils literal notranslate"><span class="pre">ResultProxy</span></code> interface.   When using the ORM, a
higher level object called <a class="reference internal" href="#sqlalchemy.engine.ChunkedIteratorResult" title="sqlalchemy.engine.ChunkedIteratorResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">ChunkedIteratorResult</span></code></a>
is normally used.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In SQLAlchemy 1.4 and above, this object is
used for ORM results returned by <code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.execute()</span></code>, which can
yield instances of ORM mapped objects either individually or within
tuple-like rows. Note that the <a class="reference internal" href="#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a> object does not
deduplicate instances or rows automatically as is the case with the
legacy <a class="reference internal" href="../orm/queryguide/query.html#sqlalchemy.orm.Query" title="sqlalchemy.orm.Query"><code class="xref py py-class docutils literal notranslate"><span class="pre">Query</span></code></a> object. For in-Python de-duplication of
instances or rows, use the <a class="reference internal" href="#sqlalchemy.engine.Result.unique" title="sqlalchemy.engine.Result.unique"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.unique()</span></code></a> modifier
method.</p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../tutorial/dbapi_transactions.html#tutorial-fetching-rows"><span class="std std-ref">提取行数据</span></a> - in the <a class="reference internal" href="../tutorial/index.html"><span class="doc">SQLAlchemy统一教程</span></a></p>
</div>
<div class="class-members docutils container">
<p><strong>Members</strong></p>
<p><a class="reference internal" href="#sqlalchemy.engine.Result.all"><span class="sig-name descname">all()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.Result.close"><span class="sig-name descname">close()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.Result.closed"><span class="sig-name descname">closed</span></a>, <a class="reference internal" href="#sqlalchemy.engine.Result.columns"><span class="sig-name descname">columns()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.Result.fetchall"><span class="sig-name descname">fetchall()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.Result.fetchmany"><span class="sig-name descname">fetchmany()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.Result.fetchone"><span class="sig-name descname">fetchone()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.Result.first"><span class="sig-name descname">first()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.Result.freeze"><span class="sig-name descname">freeze()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.Result.keys"><span class="sig-name descname">keys()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.Result.mappings"><span class="sig-name descname">mappings()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.Result.merge"><span class="sig-name descname">merge()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.Result.one"><span class="sig-name descname">one()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.Result.one_or_none"><span class="sig-name descname">one_or_none()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.Result.partitions"><span class="sig-name descname">partitions()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.Result.scalar"><span class="sig-name descname">scalar()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.Result.scalar_one"><span class="sig-name descname">scalar_one()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.Result.scalar_one_or_none"><span class="sig-name descname">scalar_one_or_none()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.Result.scalars"><span class="sig-name descname">scalars()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.Result.t"><span class="sig-name descname">t</span></a>, <a class="reference internal" href="#sqlalchemy.engine.Result.tuples"><span class="sig-name descname">tuples()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.Result.unique"><span class="sig-name descname">unique()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.Result.yield_per"><span class="sig-name descname">yield_per()</span></a></p>
</div>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.engine.Result</span></code></a> (<code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine._WithKeys</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.engine.ResultInternal</span></code>)</p>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.Result.all">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.Result"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.Result.</span></code></a><span class="sig-name descname"><span class="pre">all</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Sequence</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#sqlalchemy.engine.Row" title="sqlalchemy.engine.row.Row"><span class="pre">Row</span></a><span class="p"><span class="pre">[</span></span><span class="pre">_TP</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#sqlalchemy.engine.Result.all" title="Permalink to this definition">¶</a></dt>
<dd><p>Return all rows in a list.</p>
<p>Closes the result set after invocation.   Subsequent invocations
will return an empty list.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.4.</span></p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>a list of <a class="reference internal" href="#sqlalchemy.engine.Row" title="sqlalchemy.engine.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a> objects.</p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><span class="xref std std-ref">engine_stream_results</span> - How to stream a large result set
without loading it completely in python.</p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.Result.close">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.Result"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.Result.</span></code></a><span class="sig-name descname"><span class="pre">close</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.engine.Result.close" title="Permalink to this definition">¶</a></dt>
<dd><p>close this <a class="reference internal" href="#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a>.</p>
<p>The behavior of this method is implementation specific, and is
not implemented by default.    The method should generally end
the resources in use by the result object and also cause any
subsequent iteration or row fetching to raise
<a class="reference internal" href="exceptions.html#sqlalchemy.exc.ResourceClosedError" title="sqlalchemy.exc.ResourceClosedError"><code class="xref py py-class docutils literal notranslate"><span class="pre">ResourceClosedError</span></code></a>.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.4.27: </span>- <code class="docutils literal notranslate"><span class="pre">.close()</span></code> was previously not generally
available for all <a class="reference internal" href="#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a> classes, instead only
being available on the <a class="reference internal" href="#sqlalchemy.engine.CursorResult" title="sqlalchemy.engine.CursorResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">CursorResult</span></code></a> returned for
Core statement executions. As most other result objects, namely the
ones used by the ORM, are proxying a <a class="reference internal" href="#sqlalchemy.engine.CursorResult" title="sqlalchemy.engine.CursorResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">CursorResult</span></code></a>
in any case, this allows the underlying cursor result to be closed
from the outside facade for the case when the ORM query is using
the <code class="docutils literal notranslate"><span class="pre">yield_per</span></code> execution option where it does not immediately
exhaust and autoclose the database cursor.</p>
</div>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.engine.Result.closed">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.engine.Result"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.Result.</span></code></a><span class="sig-name descname"><span class="pre">closed</span></span><a class="headerlink" href="#sqlalchemy.engine.Result.closed" title="Permalink to this definition">¶</a></dt>
<dd><p>return <code class="docutils literal notranslate"><span class="pre">True</span></code> if this <a class="reference internal" href="#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a> reports .closed</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.4.43.</span></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.Result.columns">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.Result"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.Result.</span></code></a><span class="sig-name descname"><span class="pre">columns</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">col_expressions</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_KeyIndexType</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Self</span></span></span><a class="headerlink" href="#sqlalchemy.engine.Result.columns" title="Permalink to this definition">¶</a></dt>
<dd><p>Establish the columns that should be returned in each row.</p>
<p>This method may be used to limit the columns returned as well
as to reorder them.   The given list of expressions are normally
a series of integers or string key names.   They may also be
appropriate <a class="reference internal" href="sqlelement.html#sqlalchemy.sql.expression.ColumnElement" title="sqlalchemy.sql.expression.ColumnElement"><code class="xref py py-class docutils literal notranslate"><span class="pre">ColumnElement</span></code></a> objects which correspond to
a given statement construct.</p>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 2.0: </span>Due to a bug in 1.4, the
<a class="reference internal" href="#sqlalchemy.engine.Result.columns" title="sqlalchemy.engine.Result.columns"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.columns()</span></code></a> method had an incorrect behavior
where calling upon the method with just one index would cause the
<a class="reference internal" href="#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a> object to yield scalar values rather than
<a class="reference internal" href="#sqlalchemy.engine.Row" title="sqlalchemy.engine.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a> objects.   In version 2.0, this behavior
has been corrected such that calling upon
<a class="reference internal" href="#sqlalchemy.engine.Result.columns" title="sqlalchemy.engine.Result.columns"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.columns()</span></code></a> with a single index will
produce a <a class="reference internal" href="#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a> object that continues
to yield <a class="reference internal" href="#sqlalchemy.engine.Row" title="sqlalchemy.engine.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a> objects, which include
only a single column.</p>
</div>
<p>E.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">statement</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">z</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">statement</span><span class="p">)</span>

<span class="k">for</span> <span class="n">z</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">columns</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">):</span>
    <span class="c1"># ...</span></pre></div>
</div>
<p>Example of using the column objects from the statement itself:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">z</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">columns</span><span class="p">(</span>
        <span class="n">statement</span><span class="o">.</span><span class="n">selected_columns</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">z</span><span class="p">,</span>
        <span class="n">statement</span><span class="o">.</span><span class="n">selected_columns</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">y</span>
<span class="p">):</span>
    <span class="c1"># ...</span></pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.4.</span></p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><span class="target" id="sqlalchemy.engine.Result.columns.params.*col_expressions"></span><strong>*col_expressions</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.engine.Result.columns.params.*col_expressions">¶</a> – indicates columns to be returned.  Elements
may be integer row indexes, string column names, or appropriate
<a class="reference internal" href="sqlelement.html#sqlalchemy.sql.expression.ColumnElement" title="sqlalchemy.sql.expression.ColumnElement"><code class="xref py py-class docutils literal notranslate"><span class="pre">ColumnElement</span></code></a> objects corresponding to a select construct.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>this <a class="reference internal" href="#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a> object with the modifications
given.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.Result.fetchall">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.Result"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.Result.</span></code></a><span class="sig-name descname"><span class="pre">fetchall</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Sequence</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#sqlalchemy.engine.Row" title="sqlalchemy.engine.row.Row"><span class="pre">Row</span></a><span class="p"><span class="pre">[</span></span><span class="pre">_TP</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#sqlalchemy.engine.Result.fetchall" title="Permalink to this definition">¶</a></dt>
<dd><p>A synonym for the <a class="reference internal" href="#sqlalchemy.engine.Result.all" title="sqlalchemy.engine.Result.all"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.all()</span></code></a> method.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.Result.fetchmany">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.Result"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.Result.</span></code></a><span class="sig-name descname"><span class="pre">fetchmany</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">size</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Sequence</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#sqlalchemy.engine.Row" title="sqlalchemy.engine.row.Row"><span class="pre">Row</span></a><span class="p"><span class="pre">[</span></span><span class="pre">_TP</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#sqlalchemy.engine.Result.fetchmany" title="Permalink to this definition">¶</a></dt>
<dd><p>Fetch many rows.</p>
<p>When all rows are exhausted, returns an empty list.</p>
<p>This method is provided for backwards compatibility with
SQLAlchemy 1.x.x.</p>
<p>To fetch rows in groups, use the <a class="reference internal" href="#sqlalchemy.engine.Result.partitions" title="sqlalchemy.engine.Result.partitions"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.partitions()</span></code></a>
method.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>a list of <a class="reference internal" href="#sqlalchemy.engine.Row" title="sqlalchemy.engine.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a> objects.</p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#sqlalchemy.engine.Result.partitions" title="sqlalchemy.engine.Result.partitions"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.partitions()</span></code></a></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.Result.fetchone">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.Result"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.Result.</span></code></a><span class="sig-name descname"><span class="pre">fetchone</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#sqlalchemy.engine.Row" title="sqlalchemy.engine.row.Row"><span class="pre">Row</span></a><span class="p"><span class="pre">[</span></span><span class="pre">_TP</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.engine.Result.fetchone" title="Permalink to this definition">¶</a></dt>
<dd><p>Fetch one row.</p>
<p>When all rows are exhausted, returns None.</p>
<p>This method is provided for backwards compatibility with
SQLAlchemy 1.x.x.</p>
<p>To fetch the first row of a result only, use the
<a class="reference internal" href="#sqlalchemy.engine.Result.first" title="sqlalchemy.engine.Result.first"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.first()</span></code></a> method.  To iterate through all
rows, iterate the <a class="reference internal" href="#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a> object directly.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>a <a class="reference internal" href="#sqlalchemy.engine.Row" title="sqlalchemy.engine.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a> object if no filters are applied,
or <code class="docutils literal notranslate"><span class="pre">None</span></code> if no rows remain.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.Result.first">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.Result"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.Result.</span></code></a><span class="sig-name descname"><span class="pre">first</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#sqlalchemy.engine.Row" title="sqlalchemy.engine.row.Row"><span class="pre">Row</span></a><span class="p"><span class="pre">[</span></span><span class="pre">_TP</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.engine.Result.first" title="Permalink to this definition">¶</a></dt>
<dd><p>Fetch the first row or <code class="docutils literal notranslate"><span class="pre">None</span></code> if no row is present.</p>
<p>Closes the result set and discards remaining rows.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This method returns one <strong>row</strong>, e.g. tuple, by default.
To return exactly one single scalar value, that is, the first
column of the first row, use the
<a class="reference internal" href="#sqlalchemy.engine.Result.scalar" title="sqlalchemy.engine.Result.scalar"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.scalar()</span></code></a> method,
or combine <a class="reference internal" href="#sqlalchemy.engine.Result.scalars" title="sqlalchemy.engine.Result.scalars"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.scalars()</span></code></a> and
<a class="reference internal" href="#sqlalchemy.engine.Result.first" title="sqlalchemy.engine.Result.first"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.first()</span></code></a>.</p>
<p>Additionally, in contrast to the behavior of the legacy  ORM
<a class="reference internal" href="../orm/queryguide/query.html#sqlalchemy.orm.Query.first" title="sqlalchemy.orm.Query.first"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Query.first()</span></code></a> method, <strong>no limit is applied</strong> to the
SQL query which was invoked to produce this
<a class="reference internal" href="#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a>;
for a DBAPI driver that buffers results in memory before yielding
rows, all rows will be sent to the Python process and all but
the first row will be discarded.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../changelog/migration_20.html#migration-20-unify-select"><span class="std std-ref">ORM查询与核心选择器统一</span></a></p>
</div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>a <a class="reference internal" href="#sqlalchemy.engine.Row" title="sqlalchemy.engine.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a> object, or None
if no rows remain.</p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#sqlalchemy.engine.Result.scalar" title="sqlalchemy.engine.Result.scalar"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.scalar()</span></code></a></p>
<p><a class="reference internal" href="#sqlalchemy.engine.Result.one" title="sqlalchemy.engine.Result.one"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.one()</span></code></a></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.Result.freeze">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.Result"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.Result.</span></code></a><span class="sig-name descname"><span class="pre">freeze</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#sqlalchemy.engine.FrozenResult" title="sqlalchemy.engine.result.FrozenResult"><span class="pre">FrozenResult</span></a><span class="p"><span class="pre">[</span></span><span class="pre">_TP</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#sqlalchemy.engine.Result.freeze" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a callable object that will produce copies of this
<a class="reference internal" href="#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a> when invoked.</p>
<p>The callable object returned is an instance of
<a class="reference internal" href="#sqlalchemy.engine.FrozenResult" title="sqlalchemy.engine.FrozenResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">FrozenResult</span></code></a>.</p>
<p>This is used for result set caching.  The method must be called
on the result when it has been unconsumed, and calling the method
will consume the result fully.   When the <a class="reference internal" href="#sqlalchemy.engine.FrozenResult" title="sqlalchemy.engine.FrozenResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">FrozenResult</span></code></a>
is retrieved from a cache, it can be called any number of times where
it will produce a new <a class="reference internal" href="#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a> object each time
against its stored set of rows.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../orm/session_events.html#do-orm-execute-re-executing"><span class="std std-ref">重新执行语句</span></a> - example usage within the
ORM to implement a result-set cache.</p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.Result.keys">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.Result"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.Result.</span></code></a><span class="sig-name descname"><span class="pre">keys</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">RMKeyView</span></span></span><a class="headerlink" href="#sqlalchemy.engine.Result.keys" title="Permalink to this definition">¶</a></dt>
<dd><div class="inherited-member docutils container">
<p><em>inherited from the</em> <code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine._WithKeys.keys</span></code> <em>method of</em> <code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine._WithKeys</span></code></p>
</div>
<p>Return an iterable view which yields the string keys that would
be represented by each <a class="reference internal" href="#sqlalchemy.engine.Row" title="sqlalchemy.engine.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a>.</p>
<p>The keys can represent the labels of the columns returned by a core
statement or the names of the orm classes returned by an orm
execution.</p>
<p>The view also can be tested for key containment using the Python
<code class="docutils literal notranslate"><span class="pre">in</span></code> operator, which will test both for the string keys represented
in the view, as well as for alternate keys such as column objects.</p>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 1.4: </span>a key view object is returned rather than a
plain list.</p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.Result.mappings">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.Result"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.Result.</span></code></a><span class="sig-name descname"><span class="pre">mappings</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#sqlalchemy.engine.MappingResult" title="sqlalchemy.engine.result.MappingResult"><span class="pre">MappingResult</span></a></span></span><a class="headerlink" href="#sqlalchemy.engine.Result.mappings" title="Permalink to this definition">¶</a></dt>
<dd><p>Apply a mappings filter to returned rows, returning an instance of
<a class="reference internal" href="#sqlalchemy.engine.MappingResult" title="sqlalchemy.engine.MappingResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">MappingResult</span></code></a>.</p>
<p>When this filter is applied, fetching rows will return
<a class="reference internal" href="#sqlalchemy.engine.RowMapping" title="sqlalchemy.engine.RowMapping"><code class="xref py py-class docutils literal notranslate"><span class="pre">RowMapping</span></code></a> objects instead of <a class="reference internal" href="#sqlalchemy.engine.Row" title="sqlalchemy.engine.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a>
objects.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.4.</span></p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>a new <a class="reference internal" href="#sqlalchemy.engine.MappingResult" title="sqlalchemy.engine.MappingResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">MappingResult</span></code></a> filtering object
referring to this <a class="reference internal" href="#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a> object.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.Result.merge">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.Result"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.Result.</span></code></a><span class="sig-name descname"><span class="pre">merge</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">others</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#sqlalchemy.engine.Result" title="sqlalchemy.engine.result.Result"><span class="pre">Result</span></a><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#sqlalchemy.engine.MergedResult" title="sqlalchemy.engine.result.MergedResult"><span class="pre">MergedResult</span></a><span class="p"><span class="pre">[</span></span><span class="pre">_TP</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#sqlalchemy.engine.Result.merge" title="Permalink to this definition">¶</a></dt>
<dd><p>Merge this <a class="reference internal" href="#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a> with other compatible result
objects.</p>
<p>The object returned is an instance of <a class="reference internal" href="#sqlalchemy.engine.MergedResult" title="sqlalchemy.engine.MergedResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">MergedResult</span></code></a>,
which will be composed of iterators from the given result
objects.</p>
<p>The new result will use the metadata from this result object.
The subsequent result objects must be against an identical
set of result / cursor metadata, otherwise the behavior is
undefined.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.Result.one">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.Result"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.Result.</span></code></a><span class="sig-name descname"><span class="pre">one</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#sqlalchemy.engine.Row" title="sqlalchemy.engine.row.Row"><span class="pre">Row</span></a><span class="p"><span class="pre">[</span></span><span class="pre">_TP</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#sqlalchemy.engine.Result.one" title="Permalink to this definition">¶</a></dt>
<dd><p>Return exactly one row or raise an exception.</p>
<p>Raises <a class="reference internal" href="exceptions.html#sqlalchemy.exc.NoResultFound" title="sqlalchemy.exc.NoResultFound"><code class="xref py py-class docutils literal notranslate"><span class="pre">NoResultFound</span></code></a> if the result returns no
rows, or <a class="reference internal" href="exceptions.html#sqlalchemy.exc.MultipleResultsFound" title="sqlalchemy.exc.MultipleResultsFound"><code class="xref py py-class docutils literal notranslate"><span class="pre">MultipleResultsFound</span></code></a> if multiple rows
would be returned.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This method returns one <strong>row</strong>, e.g. tuple, by default.
To return exactly one single scalar value, that is, the first
column of the first row, use the
<a class="reference internal" href="#sqlalchemy.engine.Result.scalar_one" title="sqlalchemy.engine.Result.scalar_one"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.scalar_one()</span></code></a> method, or combine
<a class="reference internal" href="#sqlalchemy.engine.Result.scalars" title="sqlalchemy.engine.Result.scalars"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.scalars()</span></code></a> and
<a class="reference internal" href="#sqlalchemy.engine.Result.one" title="sqlalchemy.engine.Result.one"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.one()</span></code></a>.</p>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.4.</span></p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>The first <a class="reference internal" href="#sqlalchemy.engine.Row" title="sqlalchemy.engine.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a>.</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><a class="reference internal" href="exceptions.html#sqlalchemy.exc.MultipleResultsFound" title="sqlalchemy.exc.MultipleResultsFound"><code class="xref py py-class docutils literal notranslate"><span class="pre">MultipleResultsFound</span></code></a>, <a class="reference internal" href="exceptions.html#sqlalchemy.exc.NoResultFound" title="sqlalchemy.exc.NoResultFound"><code class="xref py py-class docutils literal notranslate"><span class="pre">NoResultFound</span></code></a></p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#sqlalchemy.engine.Result.first" title="sqlalchemy.engine.Result.first"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.first()</span></code></a></p>
<p><a class="reference internal" href="#sqlalchemy.engine.Result.one_or_none" title="sqlalchemy.engine.Result.one_or_none"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.one_or_none()</span></code></a></p>
<p><a class="reference internal" href="#sqlalchemy.engine.Result.scalar_one" title="sqlalchemy.engine.Result.scalar_one"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.scalar_one()</span></code></a></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.Result.one_or_none">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.Result"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.Result.</span></code></a><span class="sig-name descname"><span class="pre">one_or_none</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#sqlalchemy.engine.Row" title="sqlalchemy.engine.row.Row"><span class="pre">Row</span></a><span class="p"><span class="pre">[</span></span><span class="pre">_TP</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.engine.Result.one_or_none" title="Permalink to this definition">¶</a></dt>
<dd><p>Return at most one result or raise an exception.</p>
<p>Returns <code class="docutils literal notranslate"><span class="pre">None</span></code> if the result has no rows.
Raises <a class="reference internal" href="exceptions.html#sqlalchemy.exc.MultipleResultsFound" title="sqlalchemy.exc.MultipleResultsFound"><code class="xref py py-class docutils literal notranslate"><span class="pre">MultipleResultsFound</span></code></a>
if multiple rows are returned.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.4.</span></p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>The first <a class="reference internal" href="#sqlalchemy.engine.Row" title="sqlalchemy.engine.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a> or <code class="docutils literal notranslate"><span class="pre">None</span></code> if no row
is available.</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><a class="reference internal" href="exceptions.html#sqlalchemy.exc.MultipleResultsFound" title="sqlalchemy.exc.MultipleResultsFound"><code class="xref py py-class docutils literal notranslate"><span class="pre">MultipleResultsFound</span></code></a></p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#sqlalchemy.engine.Result.first" title="sqlalchemy.engine.Result.first"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.first()</span></code></a></p>
<p><a class="reference internal" href="#sqlalchemy.engine.Result.one" title="sqlalchemy.engine.Result.one"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.one()</span></code></a></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.Result.partitions">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.Result"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.Result.</span></code></a><span class="sig-name descname"><span class="pre">partitions</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">size</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Iterator</span><span class="p"><span class="pre">[</span></span><span class="pre">Sequence</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#sqlalchemy.engine.Row" title="sqlalchemy.engine.row.Row"><span class="pre">Row</span></a><span class="p"><span class="pre">[</span></span><span class="pre">_TP</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#sqlalchemy.engine.Result.partitions" title="Permalink to this definition">¶</a></dt>
<dd><p>Iterate through sub-lists of rows of the size given.</p>
<p>Each list will be of the size given, excluding the last list to
be yielded, which may have a small number of rows.  No empty
lists will be yielded.</p>
<p>The result object is automatically closed when the iterator
is fully consumed.</p>
<p>Note that the backend driver will usually buffer the entire result
ahead of time unless the
<a class="reference internal" href="#sqlalchemy.engine.Connection.execution_options.params.stream_results" title="sqlalchemy.engine.Connection.execution_options"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Connection.execution_options.stream_results</span></code></a> execution
option is used indicating that the driver should not pre-buffer
results, if possible.   Not all drivers support this option and
the option is silently ignored for those who do not.</p>
<p>When using the ORM, the <a class="reference internal" href="#sqlalchemy.engine.Result.partitions" title="sqlalchemy.engine.Result.partitions"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.partitions()</span></code></a> method
is typically more effective from a memory perspective when it is
combined with use of the
<a class="reference internal" href="../orm/queryguide/api.html#orm-queryguide-yield-per"><span class="std std-ref">yield_per execution option</span></a>,
which instructs both the DBAPI driver to use server side cursors,
if available, as well as instructs the ORM loading internals to only
build a certain amount of ORM objects from a result at a time before
yielding them out.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.4.</span></p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><span class="target" id="sqlalchemy.engine.Result.partitions.params.size"></span><strong>size</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.engine.Result.partitions.params.size">¶</a> – indicate the maximum number of rows to be present
in each list yielded.  If None, makes use of the value set by
the <a class="reference internal" href="#sqlalchemy.engine.Result.yield_per" title="sqlalchemy.engine.Result.yield_per"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.yield_per()</span></code></a>, method, if it were called,
or the <a class="reference internal" href="#sqlalchemy.engine.Connection.execution_options.params.yield_per" title="sqlalchemy.engine.Connection.execution_options"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Connection.execution_options.yield_per</span></code></a>
execution option, which is equivalent in this regard.  If
yield_per weren’t set, it makes use of the
<a class="reference internal" href="#sqlalchemy.engine.Result.fetchmany" title="sqlalchemy.engine.Result.fetchmany"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.fetchmany()</span></code></a> default, which may be backend
specific and not well defined.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>iterator of lists</p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><span class="xref std std-ref">engine_stream_results</span></p>
<p><span class="xref std std-ref">orm_queryguide_yield_per</span> - in the <a class="reference internal" href="../orm/queryguide/index.html"><span class="std std-ref">ORM 查询指南</span></a></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.Result.scalar">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.Result"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.Result.</span></code></a><span class="sig-name descname"><span class="pre">scalar</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Any</span></span></span><a class="headerlink" href="#sqlalchemy.engine.Result.scalar" title="Permalink to this definition">¶</a></dt>
<dd><p>Fetch the first column of the first row, and close the result set.</p>
<p>Returns <code class="docutils literal notranslate"><span class="pre">None</span></code> if there are no rows to fetch.</p>
<p>No validation is performed to test if additional rows remain.</p>
<p>After calling this method, the object is fully closed,
e.g. the <a class="reference internal" href="#sqlalchemy.engine.CursorResult.close" title="sqlalchemy.engine.CursorResult.close"><code class="xref py py-meth docutils literal notranslate"><span class="pre">CursorResult.close()</span></code></a>
method will have been called.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>a Python scalar value, or <code class="docutils literal notranslate"><span class="pre">None</span></code> if no rows remain.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.Result.scalar_one">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.Result"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.Result.</span></code></a><span class="sig-name descname"><span class="pre">scalar_one</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Any</span></span></span><a class="headerlink" href="#sqlalchemy.engine.Result.scalar_one" title="Permalink to this definition">¶</a></dt>
<dd><p>Return exactly one scalar result or raise an exception.</p>
<p>This is equivalent to calling <a class="reference internal" href="#sqlalchemy.engine.Result.scalars" title="sqlalchemy.engine.Result.scalars"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.scalars()</span></code></a> and
then <a class="reference internal" href="#sqlalchemy.engine.Result.one" title="sqlalchemy.engine.Result.one"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.one()</span></code></a>.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#sqlalchemy.engine.Result.one" title="sqlalchemy.engine.Result.one"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.one()</span></code></a></p>
<p><a class="reference internal" href="#sqlalchemy.engine.Result.scalars" title="sqlalchemy.engine.Result.scalars"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.scalars()</span></code></a></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.Result.scalar_one_or_none">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.Result"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.Result.</span></code></a><span class="sig-name descname"><span class="pre">scalar_one_or_none</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Any</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.engine.Result.scalar_one_or_none" title="Permalink to this definition">¶</a></dt>
<dd><p>Return exactly one scalar result or <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p>
<p>This is equivalent to calling <a class="reference internal" href="#sqlalchemy.engine.Result.scalars" title="sqlalchemy.engine.Result.scalars"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.scalars()</span></code></a> and
then <a class="reference internal" href="#sqlalchemy.engine.Result.one_or_none" title="sqlalchemy.engine.Result.one_or_none"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.one_or_none()</span></code></a>.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#sqlalchemy.engine.Result.one_or_none" title="sqlalchemy.engine.Result.one_or_none"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.one_or_none()</span></code></a></p>
<p><a class="reference internal" href="#sqlalchemy.engine.Result.scalars" title="sqlalchemy.engine.Result.scalars"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.scalars()</span></code></a></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.Result.scalars">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.Result"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.Result.</span></code></a><span class="sig-name descname"><span class="pre">scalars</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">index</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_KeyIndexType</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#sqlalchemy.engine.ScalarResult" title="sqlalchemy.engine.ScalarResult"><span class="pre">ScalarResult</span></a><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#sqlalchemy.engine.Result.scalars" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a <a class="reference internal" href="#sqlalchemy.engine.ScalarResult" title="sqlalchemy.engine.ScalarResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">ScalarResult</span></code></a> filtering object which
will return single elements rather than <a class="reference internal" href="#sqlalchemy.engine.Row" title="sqlalchemy.engine.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a> objects.</p>
<p>E.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">text</span><span class="p">(</span><span class="s2">&quot;select int_id from table&quot;</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span><span class="o">.</span><span class="n">scalars</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="go">[1, 2, 3]</span></pre></div>
</div>
<p>When results are fetched from the <a class="reference internal" href="#sqlalchemy.engine.ScalarResult" title="sqlalchemy.engine.ScalarResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">ScalarResult</span></code></a>
filtering object, the single column-row that would be returned by the
<a class="reference internal" href="#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a> is instead returned as the column’s value.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.4.</span></p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><span class="target" id="sqlalchemy.engine.Result.scalars.params.index"></span><strong>index</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.engine.Result.scalars.params.index">¶</a> – integer or row key indicating the column to be fetched
from each row, defaults to <code class="docutils literal notranslate"><span class="pre">0</span></code> indicating the first column.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>a new <a class="reference internal" href="#sqlalchemy.engine.ScalarResult" title="sqlalchemy.engine.ScalarResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">ScalarResult</span></code></a> filtering object referring
to this <a class="reference internal" href="#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a> object.</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.engine.Result.t">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.engine.Result"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.Result.</span></code></a><span class="sig-name descname"><span class="pre">t</span></span><a class="headerlink" href="#sqlalchemy.engine.Result.t" title="Permalink to this definition">¶</a></dt>
<dd><p>Apply a “typed tuple” typing filter to returned rows.</p>
<p>The <a class="reference internal" href="#sqlalchemy.engine.Result.t" title="sqlalchemy.engine.Result.t"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Result.t</span></code></a> attribute is a synonym for
calling the <a class="reference internal" href="#sqlalchemy.engine.Result.tuples" title="sqlalchemy.engine.Result.tuples"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.tuples()</span></code></a> method.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 2.0.</span></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.Result.tuples">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.Result"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.Result.</span></code></a><span class="sig-name descname"><span class="pre">tuples</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#sqlalchemy.engine.TupleResult" title="sqlalchemy.engine.result.TupleResult"><span class="pre">TupleResult</span></a><span class="p"><span class="pre">[</span></span><span class="pre">_TP</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#sqlalchemy.engine.Result.tuples" title="Permalink to this definition">¶</a></dt>
<dd><p>Apply a “typed tuple” typing filter to returned rows.</p>
<p>This method returns the same <a class="reference internal" href="#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a> object
at runtime,
however annotates as returning a <a class="reference internal" href="#sqlalchemy.engine.TupleResult" title="sqlalchemy.engine.TupleResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">TupleResult</span></code></a> object
that will indicate to <span class="target" id="index-4"></span><a class="pep reference external" href="https://peps.python.org/pep-0484/"><strong>PEP 484</strong></a> typing tools that plain typed
<code class="docutils literal notranslate"><span class="pre">Tuple</span></code> instances are returned rather than rows.  This allows
tuple unpacking and <code class="docutils literal notranslate"><span class="pre">__getitem__</span></code> access of <a class="reference internal" href="#sqlalchemy.engine.Row" title="sqlalchemy.engine.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a>
objects to by typed, for those cases where the statement invoked
itself included typing information.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 2.0.</span></p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>the <a class="reference internal" href="#sqlalchemy.engine.TupleResult" title="sqlalchemy.engine.TupleResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">TupleResult</span></code></a> type at typing time.</p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#sqlalchemy.engine.Result.t" title="sqlalchemy.engine.Result.t"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Result.t</span></code></a> - shorter synonym</p>
<p><a class="reference internal" href="#sqlalchemy.engine.Row._t" title="sqlalchemy.engine.Row._t"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Row._t</span></code></a> - <a class="reference internal" href="#sqlalchemy.engine.Row" title="sqlalchemy.engine.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a> version</p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.Result.unique">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.Result"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.Result.</span></code></a><span class="sig-name descname"><span class="pre">unique</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">strategy</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Callable</span><span class="p"><span class="pre">[</span></span><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Self</span></span></span><a class="headerlink" href="#sqlalchemy.engine.Result.unique" title="Permalink to this definition">¶</a></dt>
<dd><p>Apply unique filtering to the objects returned by this
<a class="reference internal" href="#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a>.</p>
<p>When this filter is applied with no arguments, the rows or objects
returned will filtered such that each row is returned uniquely. The
algorithm used to determine this uniqueness is by default the Python
hashing identity of the whole tuple.   In some cases a specialized
per-entity hashing scheme may be used, such as when using the ORM, a
scheme is applied which  works against the primary key identity of
returned objects.</p>
<p>The unique filter is applied <strong>after all other filters</strong>, which means
if the columns returned have been refined using a method such as the
<a class="reference internal" href="#sqlalchemy.engine.Result.columns" title="sqlalchemy.engine.Result.columns"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.columns()</span></code></a> or <a class="reference internal" href="#sqlalchemy.engine.Result.scalars" title="sqlalchemy.engine.Result.scalars"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.scalars()</span></code></a>
method, the uniquing is applied to <strong>only the column or columns
returned</strong>.   This occurs regardless of the order in which these
methods have been called upon the <a class="reference internal" href="#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a> object.</p>
<p>The unique filter also changes the calculus used for methods like
<a class="reference internal" href="#sqlalchemy.engine.Result.fetchmany" title="sqlalchemy.engine.Result.fetchmany"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.fetchmany()</span></code></a> and <a class="reference internal" href="#sqlalchemy.engine.Result.partitions" title="sqlalchemy.engine.Result.partitions"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.partitions()</span></code></a>.
When using <a class="reference internal" href="#sqlalchemy.engine.Result.unique" title="sqlalchemy.engine.Result.unique"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.unique()</span></code></a>, these methods will continue
to yield the number of rows or objects requested, after uniquing
has been applied.  However, this necessarily impacts the buffering
behavior of the underlying cursor or datasource, such that multiple
underlying calls to <code class="docutils literal notranslate"><span class="pre">cursor.fetchmany()</span></code> may be necessary in order
to accumulate enough objects in order to provide a unique collection
of the requested size.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><span class="target" id="sqlalchemy.engine.Result.unique.params.strategy"></span><strong>strategy</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.engine.Result.unique.params.strategy">¶</a> – a callable that will be applied to rows or objects
being iterated, which should return an object that represents the
unique value of the row.   A Python <code class="docutils literal notranslate"><span class="pre">set()</span></code> is used to store
these identities.   If not passed, a default uniqueness strategy
is used which may have been assembled by the source of this
<a class="reference internal" href="#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a> object.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.Result.yield_per">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.Result"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.Result.</span></code></a><span class="sig-name descname"><span class="pre">yield_per</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">num</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Self</span></span></span><a class="headerlink" href="#sqlalchemy.engine.Result.yield_per" title="Permalink to this definition">¶</a></dt>
<dd><p>Configure the row-fetching strategy to fetch <code class="docutils literal notranslate"><span class="pre">num</span></code> rows at a time.</p>
<p>This impacts the underlying behavior of the result when iterating over
the result object, or otherwise making use of  methods such as
<a class="reference internal" href="#sqlalchemy.engine.Result.fetchone" title="sqlalchemy.engine.Result.fetchone"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.fetchone()</span></code></a> that return one row at a time.   Data
from the underlying cursor or other data source will be buffered up to
this many rows in memory, and the buffered collection will then be
yielded out one row at a time or as many rows are requested. Each time
the buffer clears, it will be refreshed to this many rows or as many
rows remain if fewer remain.</p>
<p>The <a class="reference internal" href="#sqlalchemy.engine.Result.yield_per" title="sqlalchemy.engine.Result.yield_per"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.yield_per()</span></code></a> method is generally used in
conjunction with the
<a class="reference internal" href="#sqlalchemy.engine.Connection.execution_options.params.stream_results" title="sqlalchemy.engine.Connection.execution_options"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Connection.execution_options.stream_results</span></code></a>
execution option, which will allow the database dialect in use to make
use of a server side cursor, if the DBAPI supports a specific “server
side cursor” mode separate from its default mode of operation.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Consider using the
<a class="reference internal" href="#sqlalchemy.engine.Connection.execution_options.params.yield_per" title="sqlalchemy.engine.Connection.execution_options"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Connection.execution_options.yield_per</span></code></a>
execution option, which will simultaneously set
<a class="reference internal" href="#sqlalchemy.engine.Connection.execution_options.params.stream_results" title="sqlalchemy.engine.Connection.execution_options"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Connection.execution_options.stream_results</span></code></a>
to ensure the use of server side cursors, as well as automatically
invoke the <a class="reference internal" href="#sqlalchemy.engine.Result.yield_per" title="sqlalchemy.engine.Result.yield_per"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.yield_per()</span></code></a> method to establish
a fixed row buffer size at once.</p>
<p>The <a class="reference internal" href="#sqlalchemy.engine.Connection.execution_options.params.yield_per" title="sqlalchemy.engine.Connection.execution_options"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Connection.execution_options.yield_per</span></code></a>
execution option is available for ORM operations, with
<code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code>-oriented use described at
<span class="xref std std-ref">orm_queryguide_yield_per</span>. The Core-only version which works
with <a class="reference internal" href="#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a> is new as of SQLAlchemy 1.4.40.</p>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.4.</span></p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><span class="target" id="sqlalchemy.engine.Result.yield_per.params.num"></span><strong>num</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.engine.Result.yield_per.params.num">¶</a> – number of rows to fetch each time the buffer is refilled.
If set to a value below 1, fetches all rows for the next buffer.</p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><span class="xref std std-ref">engine_stream_results</span> - describes Core behavior for
<a class="reference internal" href="#sqlalchemy.engine.Result.yield_per" title="sqlalchemy.engine.Result.yield_per"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.yield_per()</span></code></a></p>
<p><span class="xref std std-ref">orm_queryguide_yield_per</span> - in the <a class="reference internal" href="../orm/queryguide/index.html"><span class="std std-ref">ORM 查询指南</span></a></p>
</div>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.engine.ScalarResult">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.engine.</span></span><span class="sig-name descname"><span class="pre">ScalarResult</span></span><a class="headerlink" href="#sqlalchemy.engine.ScalarResult" title="Permalink to this definition">¶</a></dt>
<dd><p>A wrapper for a <a class="reference internal" href="#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a> that returns scalar values
rather than <a class="reference internal" href="#sqlalchemy.engine.Row" title="sqlalchemy.engine.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a> values.</p>
<p>The <a class="reference internal" href="#sqlalchemy.engine.ScalarResult" title="sqlalchemy.engine.ScalarResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">ScalarResult</span></code></a> object is acquired by calling the
<a class="reference internal" href="#sqlalchemy.engine.Result.scalars" title="sqlalchemy.engine.Result.scalars"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.scalars()</span></code></a> method.</p>
<p>A special limitation of <a class="reference internal" href="#sqlalchemy.engine.ScalarResult" title="sqlalchemy.engine.ScalarResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">ScalarResult</span></code></a> is that it has
no <code class="docutils literal notranslate"><span class="pre">fetchone()</span></code> method; since the semantics of <code class="docutils literal notranslate"><span class="pre">fetchone()</span></code> are that
the <code class="docutils literal notranslate"><span class="pre">None</span></code> value indicates no more results, this is not compatible
with <a class="reference internal" href="#sqlalchemy.engine.ScalarResult" title="sqlalchemy.engine.ScalarResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">ScalarResult</span></code></a> since there is no way to distinguish
between <code class="docutils literal notranslate"><span class="pre">None</span></code> as a row value versus <code class="docutils literal notranslate"><span class="pre">None</span></code> as an indicator.  Use
<code class="docutils literal notranslate"><span class="pre">next(result)</span></code> to receive values individually.</p>
<div class="class-members docutils container">
<p><strong>Members</strong></p>
<p><a class="reference internal" href="#sqlalchemy.engine.ScalarResult.all"><span class="sig-name descname">all()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.ScalarResult.close"><span class="sig-name descname">close()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.ScalarResult.closed"><span class="sig-name descname">closed</span></a>, <a class="reference internal" href="#sqlalchemy.engine.ScalarResult.fetchall"><span class="sig-name descname">fetchall()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.ScalarResult.fetchmany"><span class="sig-name descname">fetchmany()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.ScalarResult.first"><span class="sig-name descname">first()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.ScalarResult.one"><span class="sig-name descname">one()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.ScalarResult.one_or_none"><span class="sig-name descname">one_or_none()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.ScalarResult.partitions"><span class="sig-name descname">partitions()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.ScalarResult.unique"><span class="sig-name descname">unique()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.ScalarResult.yield_per"><span class="sig-name descname">yield_per()</span></a></p>
</div>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.engine.ScalarResult" title="sqlalchemy.engine.ScalarResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.engine.ScalarResult</span></code></a> (<a class="reference internal" href="#sqlalchemy.engine.FilterResult" title="sqlalchemy.engine.FilterResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.engine.FilterResult</span></code></a>)</p>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.ScalarResult.all">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.ScalarResult"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.ScalarResult.</span></code></a><span class="sig-name descname"><span class="pre">all</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Sequence</span><span class="p"><span class="pre">[</span></span><span class="pre">_R</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#sqlalchemy.engine.ScalarResult.all" title="Permalink to this definition">¶</a></dt>
<dd><p>Return all scalar values in a list.</p>
<p>Equivalent to <a class="reference internal" href="#sqlalchemy.engine.Result.all" title="sqlalchemy.engine.Result.all"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.all()</span></code></a> except that
scalar values, rather than <a class="reference internal" href="#sqlalchemy.engine.Row" title="sqlalchemy.engine.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a> objects,
are returned.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.ScalarResult.close">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.ScalarResult"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.ScalarResult.</span></code></a><span class="sig-name descname"><span class="pre">close</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.engine.ScalarResult.close" title="Permalink to this definition">¶</a></dt>
<dd><div class="inherited-member docutils container">
<p><em>inherited from the</em> <a class="reference internal" href="#sqlalchemy.engine.FilterResult.close" title="sqlalchemy.engine.FilterResult.close"><code class="xref py py-meth docutils literal notranslate"><span class="pre">FilterResult.close()</span></code></a> <em>method of</em> <a class="reference internal" href="#sqlalchemy.engine.FilterResult" title="sqlalchemy.engine.FilterResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">FilterResult</span></code></a></p>
</div>
<p>Close this <a class="reference internal" href="#sqlalchemy.engine.FilterResult" title="sqlalchemy.engine.FilterResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">FilterResult</span></code></a>.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.4.43.</span></p>
</div>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.engine.ScalarResult.closed">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.engine.ScalarResult"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.ScalarResult.</span></code></a><span class="sig-name descname"><span class="pre">closed</span></span><a class="headerlink" href="#sqlalchemy.engine.ScalarResult.closed" title="Permalink to this definition">¶</a></dt>
<dd><div class="inherited-member docutils container">
<p><em>inherited from the</em> <a class="reference internal" href="#sqlalchemy.engine.FilterResult.closed" title="sqlalchemy.engine.FilterResult.closed"><code class="xref py py-attr docutils literal notranslate"><span class="pre">FilterResult.closed</span></code></a> <em>attribute of</em> <a class="reference internal" href="#sqlalchemy.engine.FilterResult" title="sqlalchemy.engine.FilterResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">FilterResult</span></code></a></p>
</div>
<p>Return <code class="docutils literal notranslate"><span class="pre">True</span></code> if the underlying <a class="reference internal" href="#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a> reports
closed</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.4.43.</span></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.ScalarResult.fetchall">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.ScalarResult"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.ScalarResult.</span></code></a><span class="sig-name descname"><span class="pre">fetchall</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Sequence</span><span class="p"><span class="pre">[</span></span><span class="pre">_R</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#sqlalchemy.engine.ScalarResult.fetchall" title="Permalink to this definition">¶</a></dt>
<dd><p>A synonym for the <a class="reference internal" href="#sqlalchemy.engine.ScalarResult.all" title="sqlalchemy.engine.ScalarResult.all"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ScalarResult.all()</span></code></a> method.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.ScalarResult.fetchmany">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.ScalarResult"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.ScalarResult.</span></code></a><span class="sig-name descname"><span class="pre">fetchmany</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">size</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Sequence</span><span class="p"><span class="pre">[</span></span><span class="pre">_R</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#sqlalchemy.engine.ScalarResult.fetchmany" title="Permalink to this definition">¶</a></dt>
<dd><p>Fetch many objects.</p>
<p>Equivalent to <a class="reference internal" href="#sqlalchemy.engine.Result.fetchmany" title="sqlalchemy.engine.Result.fetchmany"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.fetchmany()</span></code></a> except that
scalar values, rather than <a class="reference internal" href="#sqlalchemy.engine.Row" title="sqlalchemy.engine.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a> objects,
are returned.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.ScalarResult.first">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.ScalarResult"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.ScalarResult.</span></code></a><span class="sig-name descname"><span class="pre">first</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">_R</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.engine.ScalarResult.first" title="Permalink to this definition">¶</a></dt>
<dd><p>Fetch the first object or <code class="docutils literal notranslate"><span class="pre">None</span></code> if no object is present.</p>
<p>Equivalent to <a class="reference internal" href="#sqlalchemy.engine.Result.first" title="sqlalchemy.engine.Result.first"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.first()</span></code></a> except that
scalar values, rather than <a class="reference internal" href="#sqlalchemy.engine.Row" title="sqlalchemy.engine.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a> objects,
are returned.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.ScalarResult.one">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.ScalarResult"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.ScalarResult.</span></code></a><span class="sig-name descname"><span class="pre">one</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">_R</span></span></span><a class="headerlink" href="#sqlalchemy.engine.ScalarResult.one" title="Permalink to this definition">¶</a></dt>
<dd><p>Return exactly one object or raise an exception.</p>
<p>Equivalent to <a class="reference internal" href="#sqlalchemy.engine.Result.one" title="sqlalchemy.engine.Result.one"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.one()</span></code></a> except that
scalar values, rather than <a class="reference internal" href="#sqlalchemy.engine.Row" title="sqlalchemy.engine.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a> objects,
are returned.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.ScalarResult.one_or_none">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.ScalarResult"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.ScalarResult.</span></code></a><span class="sig-name descname"><span class="pre">one_or_none</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">_R</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.engine.ScalarResult.one_or_none" title="Permalink to this definition">¶</a></dt>
<dd><p>Return at most one object or raise an exception.</p>
<p>Equivalent to <a class="reference internal" href="#sqlalchemy.engine.Result.one_or_none" title="sqlalchemy.engine.Result.one_or_none"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.one_or_none()</span></code></a> except that
scalar values, rather than <a class="reference internal" href="#sqlalchemy.engine.Row" title="sqlalchemy.engine.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a> objects,
are returned.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.ScalarResult.partitions">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.ScalarResult"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.ScalarResult.</span></code></a><span class="sig-name descname"><span class="pre">partitions</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">size</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Iterator</span><span class="p"><span class="pre">[</span></span><span class="pre">Sequence</span><span class="p"><span class="pre">[</span></span><span class="pre">_R</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#sqlalchemy.engine.ScalarResult.partitions" title="Permalink to this definition">¶</a></dt>
<dd><p>Iterate through sub-lists of elements of the size given.</p>
<p>Equivalent to <a class="reference internal" href="#sqlalchemy.engine.Result.partitions" title="sqlalchemy.engine.Result.partitions"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.partitions()</span></code></a> except that
scalar values, rather than <a class="reference internal" href="#sqlalchemy.engine.Row" title="sqlalchemy.engine.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a> objects,
are returned.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.ScalarResult.unique">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.ScalarResult"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.ScalarResult.</span></code></a><span class="sig-name descname"><span class="pre">unique</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">strategy</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Callable</span><span class="p"><span class="pre">[</span></span><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Self</span></span></span><a class="headerlink" href="#sqlalchemy.engine.ScalarResult.unique" title="Permalink to this definition">¶</a></dt>
<dd><p>Apply unique filtering to the objects returned by this
<a class="reference internal" href="#sqlalchemy.engine.ScalarResult" title="sqlalchemy.engine.ScalarResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">ScalarResult</span></code></a>.</p>
<p>See <a class="reference internal" href="#sqlalchemy.engine.Result.unique" title="sqlalchemy.engine.Result.unique"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.unique()</span></code></a> for usage details.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.ScalarResult.yield_per">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.ScalarResult"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.ScalarResult.</span></code></a><span class="sig-name descname"><span class="pre">yield_per</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">num</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Self</span></span></span><a class="headerlink" href="#sqlalchemy.engine.ScalarResult.yield_per" title="Permalink to this definition">¶</a></dt>
<dd><div class="inherited-member docutils container">
<p><em>inherited from the</em> <a class="reference internal" href="#sqlalchemy.engine.FilterResult.yield_per" title="sqlalchemy.engine.FilterResult.yield_per"><code class="xref py py-meth docutils literal notranslate"><span class="pre">FilterResult.yield_per()</span></code></a> <em>method of</em> <a class="reference internal" href="#sqlalchemy.engine.FilterResult" title="sqlalchemy.engine.FilterResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">FilterResult</span></code></a></p>
</div>
<p>Configure the row-fetching strategy to fetch <code class="docutils literal notranslate"><span class="pre">num</span></code> rows at a time.</p>
<p>The <a class="reference internal" href="#sqlalchemy.engine.FilterResult.yield_per" title="sqlalchemy.engine.FilterResult.yield_per"><code class="xref py py-meth docutils literal notranslate"><span class="pre">FilterResult.yield_per()</span></code></a> method is a pass through
to the <a class="reference internal" href="#sqlalchemy.engine.Result.yield_per" title="sqlalchemy.engine.Result.yield_per"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.yield_per()</span></code></a> method.  See that method’s
documentation for usage notes.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.4.40: </span>- added <a class="reference internal" href="#sqlalchemy.engine.FilterResult.yield_per" title="sqlalchemy.engine.FilterResult.yield_per"><code class="xref py py-meth docutils literal notranslate"><span class="pre">FilterResult.yield_per()</span></code></a>
so that the method is available on all result set implementations</p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><span class="xref std std-ref">engine_stream_results</span> - describes Core behavior for
<a class="reference internal" href="#sqlalchemy.engine.Result.yield_per" title="sqlalchemy.engine.Result.yield_per"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.yield_per()</span></code></a></p>
<p><span class="xref std std-ref">orm_queryguide_yield_per</span> - in the <a class="reference internal" href="../orm/queryguide/index.html"><span class="std std-ref">ORM 查询指南</span></a></p>
</div>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.engine.MappingResult">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.engine.</span></span><span class="sig-name descname"><span class="pre">MappingResult</span></span><a class="headerlink" href="#sqlalchemy.engine.MappingResult" title="Permalink to this definition">¶</a></dt>
<dd><p>A wrapper for a <a class="reference internal" href="#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a> that returns dictionary values
rather than <a class="reference internal" href="#sqlalchemy.engine.Row" title="sqlalchemy.engine.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a> values.</p>
<p>The <a class="reference internal" href="#sqlalchemy.engine.MappingResult" title="sqlalchemy.engine.MappingResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">MappingResult</span></code></a> object is acquired by calling the
<a class="reference internal" href="#sqlalchemy.engine.Result.mappings" title="sqlalchemy.engine.Result.mappings"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.mappings()</span></code></a> method.</p>
<div class="class-members docutils container">
<p><strong>Members</strong></p>
<p><a class="reference internal" href="#sqlalchemy.engine.MappingResult.all"><span class="sig-name descname">all()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.MappingResult.close"><span class="sig-name descname">close()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.MappingResult.closed"><span class="sig-name descname">closed</span></a>, <a class="reference internal" href="#sqlalchemy.engine.MappingResult.columns"><span class="sig-name descname">columns()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.MappingResult.fetchall"><span class="sig-name descname">fetchall()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.MappingResult.fetchmany"><span class="sig-name descname">fetchmany()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.MappingResult.fetchone"><span class="sig-name descname">fetchone()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.MappingResult.first"><span class="sig-name descname">first()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.MappingResult.keys"><span class="sig-name descname">keys()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.MappingResult.one"><span class="sig-name descname">one()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.MappingResult.one_or_none"><span class="sig-name descname">one_or_none()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.MappingResult.partitions"><span class="sig-name descname">partitions()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.MappingResult.unique"><span class="sig-name descname">unique()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.MappingResult.yield_per"><span class="sig-name descname">yield_per()</span></a></p>
</div>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.engine.MappingResult" title="sqlalchemy.engine.MappingResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.engine.MappingResult</span></code></a> (<code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine._WithKeys</span></code>, <a class="reference internal" href="#sqlalchemy.engine.FilterResult" title="sqlalchemy.engine.FilterResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.engine.FilterResult</span></code></a>)</p>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.MappingResult.all">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.MappingResult"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.MappingResult.</span></code></a><span class="sig-name descname"><span class="pre">all</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Sequence</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#sqlalchemy.engine.RowMapping" title="sqlalchemy.engine.row.RowMapping"><span class="pre">RowMapping</span></a><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#sqlalchemy.engine.MappingResult.all" title="Permalink to this definition">¶</a></dt>
<dd><p>Return all scalar values in a list.</p>
<p>Equivalent to <a class="reference internal" href="#sqlalchemy.engine.Result.all" title="sqlalchemy.engine.Result.all"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.all()</span></code></a> except that
<a class="reference internal" href="#sqlalchemy.engine.RowMapping" title="sqlalchemy.engine.RowMapping"><code class="xref py py-class docutils literal notranslate"><span class="pre">RowMapping</span></code></a> values, rather than <a class="reference internal" href="#sqlalchemy.engine.Row" title="sqlalchemy.engine.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a>
objects, are returned.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.MappingResult.close">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.MappingResult"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.MappingResult.</span></code></a><span class="sig-name descname"><span class="pre">close</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.engine.MappingResult.close" title="Permalink to this definition">¶</a></dt>
<dd><div class="inherited-member docutils container">
<p><em>inherited from the</em> <a class="reference internal" href="#sqlalchemy.engine.FilterResult.close" title="sqlalchemy.engine.FilterResult.close"><code class="xref py py-meth docutils literal notranslate"><span class="pre">FilterResult.close()</span></code></a> <em>method of</em> <a class="reference internal" href="#sqlalchemy.engine.FilterResult" title="sqlalchemy.engine.FilterResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">FilterResult</span></code></a></p>
</div>
<p>Close this <a class="reference internal" href="#sqlalchemy.engine.FilterResult" title="sqlalchemy.engine.FilterResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">FilterResult</span></code></a>.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.4.43.</span></p>
</div>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.engine.MappingResult.closed">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.engine.MappingResult"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.MappingResult.</span></code></a><span class="sig-name descname"><span class="pre">closed</span></span><a class="headerlink" href="#sqlalchemy.engine.MappingResult.closed" title="Permalink to this definition">¶</a></dt>
<dd><div class="inherited-member docutils container">
<p><em>inherited from the</em> <a class="reference internal" href="#sqlalchemy.engine.FilterResult.closed" title="sqlalchemy.engine.FilterResult.closed"><code class="xref py py-attr docutils literal notranslate"><span class="pre">FilterResult.closed</span></code></a> <em>attribute of</em> <a class="reference internal" href="#sqlalchemy.engine.FilterResult" title="sqlalchemy.engine.FilterResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">FilterResult</span></code></a></p>
</div>
<p>Return <code class="docutils literal notranslate"><span class="pre">True</span></code> if the underlying <a class="reference internal" href="#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a> reports
closed</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.4.43.</span></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.MappingResult.columns">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.MappingResult"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.MappingResult.</span></code></a><span class="sig-name descname"><span class="pre">columns</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">col_expressions</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_KeyIndexType</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Self</span></span></span><a class="headerlink" href="#sqlalchemy.engine.MappingResult.columns" title="Permalink to this definition">¶</a></dt>
<dd><p>Establish the columns that should be returned in each row.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.MappingResult.fetchall">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.MappingResult"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.MappingResult.</span></code></a><span class="sig-name descname"><span class="pre">fetchall</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Sequence</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#sqlalchemy.engine.RowMapping" title="sqlalchemy.engine.row.RowMapping"><span class="pre">RowMapping</span></a><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#sqlalchemy.engine.MappingResult.fetchall" title="Permalink to this definition">¶</a></dt>
<dd><p>A synonym for the <a class="reference internal" href="#sqlalchemy.engine.MappingResult.all" title="sqlalchemy.engine.MappingResult.all"><code class="xref py py-meth docutils literal notranslate"><span class="pre">MappingResult.all()</span></code></a> method.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.MappingResult.fetchmany">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.MappingResult"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.MappingResult.</span></code></a><span class="sig-name descname"><span class="pre">fetchmany</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">size</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Sequence</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#sqlalchemy.engine.RowMapping" title="sqlalchemy.engine.row.RowMapping"><span class="pre">RowMapping</span></a><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#sqlalchemy.engine.MappingResult.fetchmany" title="Permalink to this definition">¶</a></dt>
<dd><p>Fetch many objects.</p>
<p>Equivalent to <a class="reference internal" href="#sqlalchemy.engine.Result.fetchmany" title="sqlalchemy.engine.Result.fetchmany"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.fetchmany()</span></code></a> except that
<a class="reference internal" href="#sqlalchemy.engine.RowMapping" title="sqlalchemy.engine.RowMapping"><code class="xref py py-class docutils literal notranslate"><span class="pre">RowMapping</span></code></a> values, rather than <a class="reference internal" href="#sqlalchemy.engine.Row" title="sqlalchemy.engine.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a>
objects, are returned.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.MappingResult.fetchone">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.MappingResult"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.MappingResult.</span></code></a><span class="sig-name descname"><span class="pre">fetchone</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#sqlalchemy.engine.RowMapping" title="sqlalchemy.engine.row.RowMapping"><span class="pre">RowMapping</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.engine.MappingResult.fetchone" title="Permalink to this definition">¶</a></dt>
<dd><p>Fetch one object.</p>
<p>Equivalent to <a class="reference internal" href="#sqlalchemy.engine.Result.fetchone" title="sqlalchemy.engine.Result.fetchone"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.fetchone()</span></code></a> except that
<a class="reference internal" href="#sqlalchemy.engine.RowMapping" title="sqlalchemy.engine.RowMapping"><code class="xref py py-class docutils literal notranslate"><span class="pre">RowMapping</span></code></a> values, rather than <a class="reference internal" href="#sqlalchemy.engine.Row" title="sqlalchemy.engine.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a>
objects, are returned.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.MappingResult.first">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.MappingResult"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.MappingResult.</span></code></a><span class="sig-name descname"><span class="pre">first</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#sqlalchemy.engine.RowMapping" title="sqlalchemy.engine.row.RowMapping"><span class="pre">RowMapping</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.engine.MappingResult.first" title="Permalink to this definition">¶</a></dt>
<dd><p>Fetch the first object or <code class="docutils literal notranslate"><span class="pre">None</span></code> if no object is present.</p>
<p>Equivalent to <a class="reference internal" href="#sqlalchemy.engine.Result.first" title="sqlalchemy.engine.Result.first"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.first()</span></code></a> except that
<a class="reference internal" href="#sqlalchemy.engine.RowMapping" title="sqlalchemy.engine.RowMapping"><code class="xref py py-class docutils literal notranslate"><span class="pre">RowMapping</span></code></a> values, rather than <a class="reference internal" href="#sqlalchemy.engine.Row" title="sqlalchemy.engine.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a>
objects, are returned.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.MappingResult.keys">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.MappingResult"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.MappingResult.</span></code></a><span class="sig-name descname"><span class="pre">keys</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">RMKeyView</span></span></span><a class="headerlink" href="#sqlalchemy.engine.MappingResult.keys" title="Permalink to this definition">¶</a></dt>
<dd><div class="inherited-member docutils container">
<p><em>inherited from the</em> <code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine._WithKeys.keys</span></code> <em>method of</em> <code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine._WithKeys</span></code></p>
</div>
<p>Return an iterable view which yields the string keys that would
be represented by each <a class="reference internal" href="#sqlalchemy.engine.Row" title="sqlalchemy.engine.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a>.</p>
<p>The keys can represent the labels of the columns returned by a core
statement or the names of the orm classes returned by an orm
execution.</p>
<p>The view also can be tested for key containment using the Python
<code class="docutils literal notranslate"><span class="pre">in</span></code> operator, which will test both for the string keys represented
in the view, as well as for alternate keys such as column objects.</p>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 1.4: </span>a key view object is returned rather than a
plain list.</p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.MappingResult.one">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.MappingResult"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.MappingResult.</span></code></a><span class="sig-name descname"><span class="pre">one</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#sqlalchemy.engine.RowMapping" title="sqlalchemy.engine.row.RowMapping"><span class="pre">RowMapping</span></a></span></span><a class="headerlink" href="#sqlalchemy.engine.MappingResult.one" title="Permalink to this definition">¶</a></dt>
<dd><p>Return exactly one object or raise an exception.</p>
<p>Equivalent to <a class="reference internal" href="#sqlalchemy.engine.Result.one" title="sqlalchemy.engine.Result.one"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.one()</span></code></a> except that
<a class="reference internal" href="#sqlalchemy.engine.RowMapping" title="sqlalchemy.engine.RowMapping"><code class="xref py py-class docutils literal notranslate"><span class="pre">RowMapping</span></code></a> values, rather than <a class="reference internal" href="#sqlalchemy.engine.Row" title="sqlalchemy.engine.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a>
objects, are returned.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.MappingResult.one_or_none">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.MappingResult"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.MappingResult.</span></code></a><span class="sig-name descname"><span class="pre">one_or_none</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#sqlalchemy.engine.RowMapping" title="sqlalchemy.engine.row.RowMapping"><span class="pre">RowMapping</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.engine.MappingResult.one_or_none" title="Permalink to this definition">¶</a></dt>
<dd><p>Return at most one object or raise an exception.</p>
<p>Equivalent to <a class="reference internal" href="#sqlalchemy.engine.Result.one_or_none" title="sqlalchemy.engine.Result.one_or_none"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.one_or_none()</span></code></a> except that
<a class="reference internal" href="#sqlalchemy.engine.RowMapping" title="sqlalchemy.engine.RowMapping"><code class="xref py py-class docutils literal notranslate"><span class="pre">RowMapping</span></code></a> values, rather than <a class="reference internal" href="#sqlalchemy.engine.Row" title="sqlalchemy.engine.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a>
objects, are returned.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.MappingResult.partitions">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.MappingResult"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.MappingResult.</span></code></a><span class="sig-name descname"><span class="pre">partitions</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">size</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Iterator</span><span class="p"><span class="pre">[</span></span><span class="pre">Sequence</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#sqlalchemy.engine.RowMapping" title="sqlalchemy.engine.row.RowMapping"><span class="pre">RowMapping</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#sqlalchemy.engine.MappingResult.partitions" title="Permalink to this definition">¶</a></dt>
<dd><p>Iterate through sub-lists of elements of the size given.</p>
<p>Equivalent to <a class="reference internal" href="#sqlalchemy.engine.Result.partitions" title="sqlalchemy.engine.Result.partitions"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.partitions()</span></code></a> except that
<a class="reference internal" href="#sqlalchemy.engine.RowMapping" title="sqlalchemy.engine.RowMapping"><code class="xref py py-class docutils literal notranslate"><span class="pre">RowMapping</span></code></a> values, rather than <a class="reference internal" href="#sqlalchemy.engine.Row" title="sqlalchemy.engine.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a>
objects, are returned.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.MappingResult.unique">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.MappingResult"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.MappingResult.</span></code></a><span class="sig-name descname"><span class="pre">unique</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">strategy</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Callable</span><span class="p"><span class="pre">[</span></span><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Self</span></span></span><a class="headerlink" href="#sqlalchemy.engine.MappingResult.unique" title="Permalink to this definition">¶</a></dt>
<dd><p>Apply unique filtering to the objects returned by this
<a class="reference internal" href="#sqlalchemy.engine.MappingResult" title="sqlalchemy.engine.MappingResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">MappingResult</span></code></a>.</p>
<p>See <a class="reference internal" href="#sqlalchemy.engine.Result.unique" title="sqlalchemy.engine.Result.unique"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.unique()</span></code></a> for usage details.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.MappingResult.yield_per">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.MappingResult"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.MappingResult.</span></code></a><span class="sig-name descname"><span class="pre">yield_per</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">num</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Self</span></span></span><a class="headerlink" href="#sqlalchemy.engine.MappingResult.yield_per" title="Permalink to this definition">¶</a></dt>
<dd><div class="inherited-member docutils container">
<p><em>inherited from the</em> <a class="reference internal" href="#sqlalchemy.engine.FilterResult.yield_per" title="sqlalchemy.engine.FilterResult.yield_per"><code class="xref py py-meth docutils literal notranslate"><span class="pre">FilterResult.yield_per()</span></code></a> <em>method of</em> <a class="reference internal" href="#sqlalchemy.engine.FilterResult" title="sqlalchemy.engine.FilterResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">FilterResult</span></code></a></p>
</div>
<p>Configure the row-fetching strategy to fetch <code class="docutils literal notranslate"><span class="pre">num</span></code> rows at a time.</p>
<p>The <a class="reference internal" href="#sqlalchemy.engine.FilterResult.yield_per" title="sqlalchemy.engine.FilterResult.yield_per"><code class="xref py py-meth docutils literal notranslate"><span class="pre">FilterResult.yield_per()</span></code></a> method is a pass through
to the <a class="reference internal" href="#sqlalchemy.engine.Result.yield_per" title="sqlalchemy.engine.Result.yield_per"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.yield_per()</span></code></a> method.  See that method’s
documentation for usage notes.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.4.40: </span>- added <a class="reference internal" href="#sqlalchemy.engine.FilterResult.yield_per" title="sqlalchemy.engine.FilterResult.yield_per"><code class="xref py py-meth docutils literal notranslate"><span class="pre">FilterResult.yield_per()</span></code></a>
so that the method is available on all result set implementations</p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><span class="xref std std-ref">engine_stream_results</span> - describes Core behavior for
<a class="reference internal" href="#sqlalchemy.engine.Result.yield_per" title="sqlalchemy.engine.Result.yield_per"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.yield_per()</span></code></a></p>
<p><span class="xref std std-ref">orm_queryguide_yield_per</span> - in the <a class="reference internal" href="../orm/queryguide/index.html"><span class="std std-ref">ORM 查询指南</span></a></p>
</div>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.engine.Row">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.engine.</span></span><span class="sig-name descname"><span class="pre">Row</span></span><a class="headerlink" href="#sqlalchemy.engine.Row" title="Permalink to this definition">¶</a></dt>
<dd><p>Represent a single result row.</p>
<p>The <a class="reference internal" href="#sqlalchemy.engine.Row" title="sqlalchemy.engine.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a> object represents a row of a database result.  It is
typically associated in the 1.x series of SQLAlchemy with the
<a class="reference internal" href="#sqlalchemy.engine.CursorResult" title="sqlalchemy.engine.CursorResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">CursorResult</span></code></a> object, however is also used by the ORM for
tuple-like results as of SQLAlchemy 1.4.</p>
<p>The <a class="reference internal" href="#sqlalchemy.engine.Row" title="sqlalchemy.engine.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a> object seeks to act as much like a Python named
tuple as possible.   For mapping (i.e. dictionary) behavior on a row,
such as testing for containment of keys, refer to the <a class="reference internal" href="#sqlalchemy.engine.Row._mapping" title="sqlalchemy.engine.Row._mapping"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Row._mapping</span></code></a>
attribute.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../tutorial/data_select.html#tutorial-selecting-data"><span class="std std-ref">使用SELECT语句</span></a> - includes examples of selecting
rows from SELECT statements.</p>
</div>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 1.4: </span>Renamed <code class="docutils literal notranslate"><span class="pre">RowProxy</span></code> to <a class="reference internal" href="#sqlalchemy.engine.Row" title="sqlalchemy.engine.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a>. <a class="reference internal" href="#sqlalchemy.engine.Row" title="sqlalchemy.engine.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a> is no longer a
“proxy” object in that it contains the final form of data within it,
and now acts mostly like a named tuple. Mapping-like functionality is
moved to the <a class="reference internal" href="#sqlalchemy.engine.Row._mapping" title="sqlalchemy.engine.Row._mapping"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Row._mapping</span></code></a> attribute. See
<span class="xref std std-ref">change_4710_core</span> for background on this change.</p>
</div>
<div class="class-members docutils container">
<p><strong>Members</strong></p>
<p><a class="reference internal" href="#sqlalchemy.engine.Row._asdict"><span class="sig-name descname">_asdict()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.Row._fields"><span class="sig-name descname">_fields</span></a>, <a class="reference internal" href="#sqlalchemy.engine.Row._mapping"><span class="sig-name descname">_mapping</span></a>, <a class="reference internal" href="#sqlalchemy.engine.Row._t"><span class="sig-name descname">_t</span></a>, <a class="reference internal" href="#sqlalchemy.engine.Row._tuple"><span class="sig-name descname">_tuple()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.Row.count"><span class="sig-name descname">count</span></a>, <a class="reference internal" href="#sqlalchemy.engine.Row.index"><span class="sig-name descname">index</span></a>, <a class="reference internal" href="#sqlalchemy.engine.Row.t"><span class="sig-name descname">t</span></a>, <a class="reference internal" href="#sqlalchemy.engine.Row.tuple"><span class="sig-name descname">tuple()</span></a></p>
</div>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.engine.Row" title="sqlalchemy.engine.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.engine.Row</span></code></a> (<code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.engine._py_row.BaseRow</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">collections.abc.Sequence</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">typing.Generic</span></code>)</p>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.Row._asdict">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.Row"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.Row.</span></code></a><span class="sig-name descname"><span class="pre">_asdict</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#sqlalchemy.engine.Row._asdict" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a new dict which maps field names to their corresponding
values.</p>
<p>This method is analogous to the Python named tuple <code class="docutils literal notranslate"><span class="pre">._asdict()</span></code>
method, and works by applying the <code class="docutils literal notranslate"><span class="pre">dict()</span></code> constructor to the
<a class="reference internal" href="#sqlalchemy.engine.Row._mapping" title="sqlalchemy.engine.Row._mapping"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Row._mapping</span></code></a> attribute.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.4.</span></p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#sqlalchemy.engine.Row._mapping" title="sqlalchemy.engine.Row._mapping"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Row._mapping</span></code></a></p>
</div>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.engine.Row._fields">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.engine.Row"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.Row.</span></code></a><span class="sig-name descname"><span class="pre">_fields</span></span><a class="headerlink" href="#sqlalchemy.engine.Row._fields" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a tuple of string keys as represented by this
<a class="reference internal" href="#sqlalchemy.engine.Row" title="sqlalchemy.engine.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a>.</p>
<p>The keys can represent the labels of the columns returned by a core
statement or the names of the orm classes returned by an orm
execution.</p>
<p>This attribute is analogous to the Python named tuple <code class="docutils literal notranslate"><span class="pre">._fields</span></code>
attribute.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.4.</span></p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#sqlalchemy.engine.Row._mapping" title="sqlalchemy.engine.Row._mapping"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Row._mapping</span></code></a></p>
</div>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.engine.Row._mapping">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.engine.Row"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.Row.</span></code></a><span class="sig-name descname"><span class="pre">_mapping</span></span><a class="headerlink" href="#sqlalchemy.engine.Row._mapping" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a <a class="reference internal" href="#sqlalchemy.engine.RowMapping" title="sqlalchemy.engine.RowMapping"><code class="xref py py-class docutils literal notranslate"><span class="pre">RowMapping</span></code></a> for this <a class="reference internal" href="#sqlalchemy.engine.Row" title="sqlalchemy.engine.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a>.</p>
<p>This object provides a consistent Python mapping (i.e. dictionary)
interface for the data contained within the row.   The <a class="reference internal" href="#sqlalchemy.engine.Row" title="sqlalchemy.engine.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a>
by itself behaves like a named tuple.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#sqlalchemy.engine.Row._fields" title="sqlalchemy.engine.Row._fields"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Row._fields</span></code></a></p>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.4.</span></p>
</div>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.engine.Row._t">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.engine.Row"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.Row.</span></code></a><span class="sig-name descname"><span class="pre">_t</span></span><a class="headerlink" href="#sqlalchemy.engine.Row._t" title="Permalink to this definition">¶</a></dt>
<dd><p>A synonym for <a class="reference internal" href="#sqlalchemy.engine.Row._tuple" title="sqlalchemy.engine.Row._tuple"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Row._tuple()</span></code></a>.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 2.0.19: </span>- The <a class="reference internal" href="#sqlalchemy.engine.Row._t" title="sqlalchemy.engine.Row._t"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Row._t</span></code></a> attribute supersedes
the previous <a class="reference internal" href="#sqlalchemy.engine.Row.t" title="sqlalchemy.engine.Row.t"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Row.t</span></code></a> attribute, which is now underscored
to avoid name conflicts with column names in the same way as other
named-tuple methods on <a class="reference internal" href="#sqlalchemy.engine.Row" title="sqlalchemy.engine.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a>.</p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#sqlalchemy.engine.Result.t" title="sqlalchemy.engine.Result.t"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Result.t</span></code></a></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.Row._tuple">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.Row"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.Row.</span></code></a><span class="sig-name descname"><span class="pre">_tuple</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">_TP</span></span></span><a class="headerlink" href="#sqlalchemy.engine.Row._tuple" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a ‘tuple’ form of this <a class="reference internal" href="#sqlalchemy.engine.Row" title="sqlalchemy.engine.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a>.</p>
<p>At runtime, this method returns “self”; the <a class="reference internal" href="#sqlalchemy.engine.Row" title="sqlalchemy.engine.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a> object is
already a named tuple. However, at the typing level, if this
<a class="reference internal" href="#sqlalchemy.engine.Row" title="sqlalchemy.engine.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a> is typed, the “tuple” return type will be a <span class="target" id="index-5"></span><a class="pep reference external" href="https://peps.python.org/pep-0484/"><strong>PEP 484</strong></a>
<code class="docutils literal notranslate"><span class="pre">Tuple</span></code> datatype that contains typing information about individual
elements, supporting typed unpacking and attribute access.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 2.0.19: </span>- The <a class="reference internal" href="#sqlalchemy.engine.Row._tuple" title="sqlalchemy.engine.Row._tuple"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Row._tuple()</span></code></a> method supersedes
the previous <a class="reference internal" href="#sqlalchemy.engine.Row.tuple" title="sqlalchemy.engine.Row.tuple"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Row.tuple()</span></code></a> method, which is now underscored
to avoid name conflicts with column names in the same way as other
named-tuple methods on <a class="reference internal" href="#sqlalchemy.engine.Row" title="sqlalchemy.engine.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a>.</p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#sqlalchemy.engine.Row._t" title="sqlalchemy.engine.Row._t"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Row._t</span></code></a> - shorthand attribute notation</p>
<p><a class="reference internal" href="#sqlalchemy.engine.Result.tuples" title="sqlalchemy.engine.Result.tuples"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.tuples()</span></code></a></p>
</div>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.engine.Row.count">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.engine.Row"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.Row.</span></code></a><span class="sig-name descname"><span class="pre">count</span></span><a class="headerlink" href="#sqlalchemy.engine.Row.count" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.engine.Row.index">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.engine.Row"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.Row.</span></code></a><span class="sig-name descname"><span class="pre">index</span></span><a class="headerlink" href="#sqlalchemy.engine.Row.index" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.engine.Row.t">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.engine.Row"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.Row.</span></code></a><span class="sig-name descname"><span class="pre">t</span></span><a class="headerlink" href="#sqlalchemy.engine.Row.t" title="Permalink to this definition">¶</a></dt>
<dd><p>A synonym for <a class="reference internal" href="#sqlalchemy.engine.Row._tuple" title="sqlalchemy.engine.Row._tuple"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Row._tuple()</span></code></a>.</p>
<div class="deprecated">
<p><span class="versionmodified deprecated">Deprecated since version 2.0.19: </span>The <a class="reference internal" href="#sqlalchemy.engine.Row.t" title="sqlalchemy.engine.Row.t"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Row.t</span></code></a> attribute is deprecated in favor of <a class="reference internal" href="#sqlalchemy.engine.Row._t" title="sqlalchemy.engine.Row._t"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Row._t</span></code></a>; all <a class="reference internal" href="#sqlalchemy.engine.Row" title="sqlalchemy.engine.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a> methods and library-level attributes are intended to be underscored to avoid name conflicts.  Please use <a class="reference internal" href="#sqlalchemy.engine.Row._t" title="sqlalchemy.engine.Row._t"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Row._t</span></code></a>.</p>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 2.0.</span></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.Row.tuple">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.Row"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.Row.</span></code></a><span class="sig-name descname"><span class="pre">tuple</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">_TP</span></span></span><a class="headerlink" href="#sqlalchemy.engine.Row.tuple" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a ‘tuple’ form of this <a class="reference internal" href="#sqlalchemy.engine.Row" title="sqlalchemy.engine.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a>.</p>
<div class="deprecated">
<p><span class="versionmodified deprecated">Deprecated since version 2.0.19: </span>The <a class="reference internal" href="#sqlalchemy.engine.Row.tuple" title="sqlalchemy.engine.Row.tuple"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Row.tuple()</span></code></a> method is deprecated in favor of <a class="reference internal" href="#sqlalchemy.engine.Row._tuple" title="sqlalchemy.engine.Row._tuple"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Row._tuple()</span></code></a>; all <a class="reference internal" href="#sqlalchemy.engine.Row" title="sqlalchemy.engine.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a> methods and library-level attributes are intended to be underscored to avoid name conflicts.  Please use <a class="reference internal" href="#sqlalchemy.engine.Row._tuple" title="sqlalchemy.engine.Row._tuple"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Row._tuple()</span></code></a>.</p>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 2.0.</span></p>
</div>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.engine.RowMapping">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.engine.</span></span><span class="sig-name descname"><span class="pre">RowMapping</span></span><a class="headerlink" href="#sqlalchemy.engine.RowMapping" title="Permalink to this definition">¶</a></dt>
<dd><p>A <code class="docutils literal notranslate"><span class="pre">Mapping</span></code> that maps column names and objects to <a class="reference internal" href="#sqlalchemy.engine.Row" title="sqlalchemy.engine.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a>
values.</p>
<p>The <a class="reference internal" href="#sqlalchemy.engine.RowMapping" title="sqlalchemy.engine.RowMapping"><code class="xref py py-class docutils literal notranslate"><span class="pre">RowMapping</span></code></a> is available from a <a class="reference internal" href="#sqlalchemy.engine.Row" title="sqlalchemy.engine.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a> via the
<a class="reference internal" href="#sqlalchemy.engine.Row._mapping" title="sqlalchemy.engine.Row._mapping"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Row._mapping</span></code></a> attribute, as well as from the iterable interface
provided by the <a class="reference internal" href="#sqlalchemy.engine.MappingResult" title="sqlalchemy.engine.MappingResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">MappingResult</span></code></a> object returned by the
<a class="reference internal" href="#sqlalchemy.engine.Result.mappings" title="sqlalchemy.engine.Result.mappings"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.mappings()</span></code></a> method.</p>
<p><a class="reference internal" href="#sqlalchemy.engine.RowMapping" title="sqlalchemy.engine.RowMapping"><code class="xref py py-class docutils literal notranslate"><span class="pre">RowMapping</span></code></a> supplies Python mapping (i.e. dictionary) access to
the  contents of the row.   This includes support for testing of
containment of specific keys (string column names or objects), as well
as iteration of keys, values, and items:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
    <span class="k">if</span> <span class="s1">&#39;a&#39;</span> <span class="ow">in</span> <span class="n">row</span><span class="o">.</span><span class="n">_mapping</span><span class="p">:</span>
        <span class="n">print</span><span class="p">(</span><span class="s2">&quot;Column &#39;a&#39;: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">row</span><span class="o">.</span><span class="n">_mapping</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">])</span>

    <span class="n">print</span><span class="p">(</span><span class="s2">&quot;Column b: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">row</span><span class="o">.</span><span class="n">_mapping</span><span class="p">[</span><span class="n">table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">b</span><span class="p">])</span></pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.4: </span>The <a class="reference internal" href="#sqlalchemy.engine.RowMapping" title="sqlalchemy.engine.RowMapping"><code class="xref py py-class docutils literal notranslate"><span class="pre">RowMapping</span></code></a> object replaces the
mapping-like access previously provided by a database result row,
which now seeks to behave mostly like a named tuple.</p>
</div>
<div class="class-members docutils container">
<p><strong>Members</strong></p>
<p><a class="reference internal" href="#sqlalchemy.engine.RowMapping.items"><span class="sig-name descname">items()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.RowMapping.keys"><span class="sig-name descname">keys()</span></a>, <a class="reference internal" href="#sqlalchemy.engine.RowMapping.values"><span class="sig-name descname">values()</span></a></p>
</div>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.engine.RowMapping" title="sqlalchemy.engine.RowMapping"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.engine.RowMapping</span></code></a> (<code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.engine._py_row.BaseRow</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">collections.abc.Mapping</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">typing.Generic</span></code>)</p>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.RowMapping.items">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.RowMapping"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.RowMapping.</span></code></a><span class="sig-name descname"><span class="pre">items</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">ROMappingItemsView</span></span></span><a class="headerlink" href="#sqlalchemy.engine.RowMapping.items" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a view of key/value tuples for the elements in the
underlying <a class="reference internal" href="#sqlalchemy.engine.Row" title="sqlalchemy.engine.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a>.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.RowMapping.keys">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.RowMapping"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.RowMapping.</span></code></a><span class="sig-name descname"><span class="pre">keys</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">RMKeyView</span></span></span><a class="headerlink" href="#sqlalchemy.engine.RowMapping.keys" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a view of ‘keys’ for string column names represented
by the underlying <a class="reference internal" href="#sqlalchemy.engine.Row" title="sqlalchemy.engine.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a>.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.engine.RowMapping.values">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.engine.RowMapping"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine.RowMapping.</span></code></a><span class="sig-name descname"><span class="pre">values</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">ROMappingKeysValuesView</span></span></span><a class="headerlink" href="#sqlalchemy.engine.RowMapping.values" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a view of values for the values represented in the
underlying <a class="reference internal" href="#sqlalchemy.engine.Row" title="sqlalchemy.engine.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a>.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.engine.TupleResult">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.engine.</span></span><span class="sig-name descname"><span class="pre">TupleResult</span></span><a class="headerlink" href="#sqlalchemy.engine.TupleResult" title="Permalink to this definition">¶</a></dt>
<dd><p>A <a class="reference internal" href="#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a> that’s typed as returning plain
Python tuples instead of rows.</p>
<p>Since <a class="reference internal" href="#sqlalchemy.engine.Row" title="sqlalchemy.engine.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a> acts like a tuple in every way already,
this class is a typing only class, regular <a class="reference internal" href="#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a> is
still used at runtime.</p>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.engine.TupleResult" title="sqlalchemy.engine.TupleResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.engine.TupleResult</span></code></a> (<a class="reference internal" href="#sqlalchemy.engine.FilterResult" title="sqlalchemy.engine.FilterResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.engine.FilterResult</span></code></a>, <code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.util.langhelpers.TypingOnly</span></code>)</p>
</div>
</dd></dl>

</section>
</section>

    </div>

</div>

<div id="docs-bottom-navigation" class="docs-navigation-links, withsidebar">

    <div id="docs-copyright">
        &copy; <a href="../copyright.html">Copyright</a> 2007-2023, the SQLAlchemy authors and contributors.


    <p><b>flambé!</b> the dragon and <b><i>The Alchemist</i></b> image designs created and generously donated by <a href="https://github.com/vmalloc">Rotem Yaari</a>.</p>

        Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 7.0.1.

    Documentation last generated: 2023/8/18 18:58:41

    </div>
</div>

</div>



        
        

    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
          URL_ROOT:    '../',
          VERSION:     '2.0.19',
          COLLAPSE_MODINDEX: false,
          FILE_SUFFIX: '.html'
      };
    </script>

    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>

    <!-- begin iterate through sphinx environment script_files -->
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script type="text/javascript" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/sphinx_highlight.js"></script>
        <script type="text/javascript" src="../_static/clipboard.min.js"></script>
        <script type="text/javascript" src="../_static/copybutton.js"></script>
    <!-- end iterate through sphinx environment script_files -->

    <script type="text/javascript" src="../_static/init.js"></script>


    </body>
</html>


