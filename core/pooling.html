<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">



<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />

        <title>
            
    
    连接池
 &mdash;
    SQLAlchemy 2.0 Documentation

        </title>

        
            <!-- begin iterate through site-imported + sphinx environment css_files -->
                <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
                <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
                <link rel="stylesheet" href="../_static/default.css" type="text/css" />
                <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
                <link rel="stylesheet" href="../_static/docs.css" type="text/css" />
                <link rel="stylesheet" href="../_static/sphinx_paramlinks.css" type="text/css" />
            <!-- end iterate through site-imported + sphinx environment css_files -->
        

        

    

    <!-- begin layout.mako headers -->

    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
        <link rel="copyright" title="Copyright" href="../copyright.html" />
    <link rel="top" title="SQLAlchemy 2.0 Documentation" href="../index.html" />
    <!-- end layout.mako headers -->


    </head>
    <body>
        
















<div id="docs-container">





<div id="docs-top-navigation-container" class="body-background">
<div id="docs-header">
    <div id="docs-version-header">
        Release: <span class="version-num">2.0.19</span>


        | Release Date: July 15, 2023

    </div>

    <h1><a href="../index.html">SQLAlchemy 2.0 Documentation</a></h1>

</div>
</div>

<div id="docs-body-container">

    <div id="fixed-sidebar" class="withsidebar">



        <div id="docs-sidebar-popout">
            <h3><a href="../index.html">SQLAlchemy 2.0 Documentation</a></h3>
            <p id="sidebar-topnav">
                <a href="../index.html">Home</a>
            </p>

            <div id="sidebar-search">
                <form class="search" action="../search.html" method="get">
                  <label>
                  Search terms:
                  <input type="text" placeholder="search..." name="q" size="12" />
                  </label>
                  <input type="hidden" name="check_keywords" value="yes" />
                  <input type="hidden" name="area" value="default" />
                </form>
            </div>

        </div>

        <div id="docs-sidebar">

        <div id="sidebar-banner">
            
        </div>

        <div id="docs-sidebar-inner">

        
        <h3>
            <a href="../index.html" title="SQLAlchemy 2.0 Documentation">SQLAlchemy 2.0 Documentation</a>
        </h3>

        <ul>
<li><span class="link-container"><a class="reference external" href="../intro.html">概述</a></span></li>
<li><span class="link-container"><a class="reference external" href="../tutorial/index.html">SQLAlchemy统一教程</a></span></li>
<li><span class="link-container"><a class="reference external" href="../orm/index.html">SQLAlchemy ORM</a></span></li>
<li><span class="link-container"><a class="reference external" href="index.html">SQLAlchemy 核心</a></span></li>
<li><span class="link-container"><a class="reference external" href="../dialects/index.html">方言</a></span></li>
<li><span class="link-container"><a class="reference external" href="../faq/index.html">常见问题解答</a></span></li>
<li><span class="link-container"><a class="reference external" href="../errors.html">错误消息</a></span></li>
<li><span class="link-container"><a class="reference external" href="../changelog/index.html">变更和迁移</a></span></li>
</ul>



        </div>

        </div>

    </div>

    <div id="narrow-index-nav">
        <form class="search" action="../search.html" method="get">
            <label>
                Search terms:
            <input type="text" placeholder="search..." name="q" size="12" />
            </label>
            <input type="submit" value="Search" />
            <input type="hidden" name="check_keywords" value="yes" />
            <input type="hidden" name="area" value="default" />
        </form>

        <p>
        <a href="../index.html">Home</a>
        </p>

    </div>


        <div id="docs-narrow-top-navigation">
            <ul>

            <li><b>Up:</b> <a href="../index.html">Home</a></li>



            <li><b>On this page:</b></li>
            <ul>
<li><a class="reference internal" href="#id1">连接池</a><ul>
<li><a class="reference internal" href="#id2">连接池配置</a></li>
<li><a class="reference internal" href="#pool-switching">切换连接池实现</a></li>
<li><a class="reference internal" href="#id4">使用自定义连接函数</a></li>
<li><a class="reference internal" href="#id5">构造一个连接池</a></li>
<li><a class="reference internal" href="#pool-reset-on-return">返回后重置表单</a></li>
<li><a class="reference internal" href="#id7">自定义返回方案</a><ul>
<li><a class="reference internal" href="#id8">记录返回事件的重置表格</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id13">池活动</a></li>
<li><a class="reference internal" href="#pool-disconnects">处理断开连接</a><ul>
<li><a class="reference internal" href="#pool-disconnects-pessimistic">断开处理-悲观</a><ul>
<li><a class="reference internal" href="#ping">自定义/遗留悲观ping</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id16">断开处理-乐观</a><ul>
<li><a class="reference internal" href="#pool-setting-recycle">设置池回收站</a></li>
</ul>
</li>
<li><a class="reference internal" href="#pool-connection-invalidation">关于无效化的更多信息</a></li>
<li><a class="reference internal" href="#pool-new-disconnect-codes">为断开连接方案提供新的数据库错误代码支持</a></li>
</ul>
</li>
<li><a class="reference internal" href="#fifolifo">使用FIFO与LIFO</a></li>
<li><a class="reference internal" href="#os-fork">在使用多进程或os.fork()中使用连接池</a></li>
<li><a class="reference internal" href="#id32">直接使用池实例</a></li>
<li><a class="reference internal" href="#api">API文档 - 可用池实现</a><ul>
<li><a class="reference internal" href="#sqlalchemy.pool.Pool"><code class="docutils literal notranslate"><span class="pre">Pool</span></code></a><ul>
<li><a class="reference internal" href="#sqlalchemy.pool.Pool.__init__"><code class="docutils literal notranslate"><span class="pre">Pool.__init__()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.pool.Pool.connect"><code class="docutils literal notranslate"><span class="pre">Pool.connect()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.pool.Pool.dispose"><code class="docutils literal notranslate"><span class="pre">Pool.dispose()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.pool.Pool.recreate"><code class="docutils literal notranslate"><span class="pre">Pool.recreate()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#sqlalchemy.pool.QueuePool"><code class="docutils literal notranslate"><span class="pre">QueuePool</span></code></a><ul>
<li><a class="reference internal" href="#sqlalchemy.pool.QueuePool.__init__"><code class="docutils literal notranslate"><span class="pre">QueuePool.__init__()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.pool.QueuePool.dispose"><code class="docutils literal notranslate"><span class="pre">QueuePool.dispose()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.pool.QueuePool.recreate"><code class="docutils literal notranslate"><span class="pre">QueuePool.recreate()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#sqlalchemy.pool.SingletonThreadPool"><code class="docutils literal notranslate"><span class="pre">SingletonThreadPool</span></code></a><ul>
<li><a class="reference internal" href="#sqlalchemy.pool.SingletonThreadPool.connect"><code class="docutils literal notranslate"><span class="pre">SingletonThreadPool.connect()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.pool.SingletonThreadPool.dispose"><code class="docutils literal notranslate"><span class="pre">SingletonThreadPool.dispose()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.pool.SingletonThreadPool.recreate"><code class="docutils literal notranslate"><span class="pre">SingletonThreadPool.recreate()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#sqlalchemy.pool.AssertionPool"><code class="docutils literal notranslate"><span class="pre">AssertionPool</span></code></a><ul>
<li><a class="reference internal" href="#sqlalchemy.pool.AssertionPool.dispose"><code class="docutils literal notranslate"><span class="pre">AssertionPool.dispose()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.pool.AssertionPool.recreate"><code class="docutils literal notranslate"><span class="pre">AssertionPool.recreate()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#sqlalchemy.pool.NullPool"><code class="docutils literal notranslate"><span class="pre">NullPool</span></code></a><ul>
<li><a class="reference internal" href="#sqlalchemy.pool.NullPool.dispose"><code class="docutils literal notranslate"><span class="pre">NullPool.dispose()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.pool.NullPool.recreate"><code class="docutils literal notranslate"><span class="pre">NullPool.recreate()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#sqlalchemy.pool.StaticPool"><code class="docutils literal notranslate"><span class="pre">StaticPool</span></code></a><ul>
<li><a class="reference internal" href="#sqlalchemy.pool.StaticPool.dispose"><code class="docutils literal notranslate"><span class="pre">StaticPool.dispose()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.pool.StaticPool.recreate"><code class="docutils literal notranslate"><span class="pre">StaticPool.recreate()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#sqlalchemy.pool.ManagesConnection"><code class="docutils literal notranslate"><span class="pre">ManagesConnection</span></code></a><ul>
<li><a class="reference internal" href="#sqlalchemy.pool.ManagesConnection.dbapi_connection"><code class="docutils literal notranslate"><span class="pre">ManagesConnection.dbapi_connection</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.pool.ManagesConnection.driver_connection"><code class="docutils literal notranslate"><span class="pre">ManagesConnection.driver_connection</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.pool.ManagesConnection.info"><code class="docutils literal notranslate"><span class="pre">ManagesConnection.info</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.pool.ManagesConnection.invalidate"><code class="docutils literal notranslate"><span class="pre">ManagesConnection.invalidate()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.pool.ManagesConnection.record_info"><code class="docutils literal notranslate"><span class="pre">ManagesConnection.record_info</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#sqlalchemy.pool.ConnectionPoolEntry"><code class="docutils literal notranslate"><span class="pre">ConnectionPoolEntry</span></code></a><ul>
<li><a class="reference internal" href="#sqlalchemy.pool.ConnectionPoolEntry.close"><code class="docutils literal notranslate"><span class="pre">ConnectionPoolEntry.close()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.pool.ConnectionPoolEntry.dbapi_connection"><code class="docutils literal notranslate"><span class="pre">ConnectionPoolEntry.dbapi_connection</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.pool.ConnectionPoolEntry.driver_connection"><code class="docutils literal notranslate"><span class="pre">ConnectionPoolEntry.driver_connection</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.pool.ConnectionPoolEntry.in_use"><code class="docutils literal notranslate"><span class="pre">ConnectionPoolEntry.in_use</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.pool.ConnectionPoolEntry.info"><code class="docutils literal notranslate"><span class="pre">ConnectionPoolEntry.info</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.pool.ConnectionPoolEntry.invalidate"><code class="docutils literal notranslate"><span class="pre">ConnectionPoolEntry.invalidate()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.pool.ConnectionPoolEntry.record_info"><code class="docutils literal notranslate"><span class="pre">ConnectionPoolEntry.record_info</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#sqlalchemy.pool.PoolProxiedConnection"><code class="docutils literal notranslate"><span class="pre">PoolProxiedConnection</span></code></a><ul>
<li><a class="reference internal" href="#sqlalchemy.pool.PoolProxiedConnection.close"><code class="docutils literal notranslate"><span class="pre">PoolProxiedConnection.close()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.pool.PoolProxiedConnection.dbapi_connection"><code class="docutils literal notranslate"><span class="pre">PoolProxiedConnection.dbapi_connection</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.pool.PoolProxiedConnection.detach"><code class="docutils literal notranslate"><span class="pre">PoolProxiedConnection.detach()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.pool.PoolProxiedConnection.driver_connection"><code class="docutils literal notranslate"><span class="pre">PoolProxiedConnection.driver_connection</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.pool.PoolProxiedConnection.info"><code class="docutils literal notranslate"><span class="pre">PoolProxiedConnection.info</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.pool.PoolProxiedConnection.invalidate"><code class="docutils literal notranslate"><span class="pre">PoolProxiedConnection.invalidate()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.pool.PoolProxiedConnection.is_detached"><code class="docutils literal notranslate"><span class="pre">PoolProxiedConnection.is_detached</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.pool.PoolProxiedConnection.is_valid"><code class="docutils literal notranslate"><span class="pre">PoolProxiedConnection.is_valid</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.pool.PoolProxiedConnection.record_info"><code class="docutils literal notranslate"><span class="pre">PoolProxiedConnection.record_info</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#sqlalchemy.pool._ConnectionFairy"><code class="docutils literal notranslate"><span class="pre">_ConnectionFairy</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.pool._ConnectionRecord"><code class="docutils literal notranslate"><span class="pre">_ConnectionRecord</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>


            </ul>

        </div>



    <div id="docs-body" role="main" class="withsidebar core-pooling" >
        
<section id="id1">
<h1>连接池<a class="headerlink" href="#id1" title="Permalink to this heading">¶</a></h1>
<span class="target" id="module-sqlalchemy.pool"></span><p>连接池是一种标准技术，可用于在内存中维护长时间运行的连接，使其可以有效地重复使用，并提供管理应用程序同时可能使用的连接总数的功能。</p>
<p>特别是对于服务器端Web应用程序，连接池是在内存中维护活动数据库连接的“池”并可在请求之间重用的标准方式。</p>
<p>SQLAlchemy包括多个连接池实现，这些实现集成到 <a class="reference internal" href="connections.html#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a> 中。它们也可以直接用于希望为纯DBAPI方法添加连接池的应用程序。</p>
<section id="id2">
<h2>连接池配置<a class="headerlink" href="#id2" title="Permalink to this heading">¶</a></h2>
<blockquote>
<div><p><code class="xref py py-func docutils literal notranslate"><span class="pre">create_engine()</span></code></p>
</div></blockquote>
<p>中已经集成了一个  <a class="reference internal" href="#sqlalchemy.pool.QueuePool" title="sqlalchemy.pool.QueuePool"><code class="xref py py-class docutils literal notranslate"><span class="pre">QueuePool</span></code></a> ，并预先设置了合理的池默认值。如果您阅读本节仅了解如何启用连接池-恭喜！您已经做完了。</p>
<p>最常见的  <a class="reference internal" href="#sqlalchemy.pool.QueuePool" title="sqlalchemy.pool.QueuePool"><code class="xref py py-class docutils literal notranslate"><span class="pre">QueuePool</span></code></a> ~sqlalchemy.create_engine` ：<code class="docutils literal notranslate"><span class="pre">pool_size</span></code>、<code class="docutils literal notranslate"><span class="pre">max_overflow</span></code>、<code class="docutils literal notranslate"><span class="pre">pool_recycle``和</span>
<span class="pre">``pool_timeout</span></code>。例如:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span>
    <span class="s2">&quot;postgresql+psycopg2://me@localhost/mydb&quot;</span><span class="p">,</span> <span class="n">pool_size</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">max_overflow</span><span class="o">=</span><span class="mi">0</span>
<span class="p">)</span></pre></div>
</div>
<p>所有SQLAlchemy连接池实现都共同具有一个特点-它们都不会“预先创建”连接-在许多实现上，所有实现都会等待首次使用前等待创建连接。
此时，如果未提出更多的并发检出请求以获取更多连接，则不会创建其他连接。这就是为什么：func:<cite>_sa.create_engine`默认使用大小为5的 :class:</cite>.QueuePool` 非常适合的默认行为-无论应用程序是否真正需要队列起5个连接，池的大小只会增长到我们真正需要5个连接的情况下，如果应用程序同时使用了5个连接，那么使用小型池非常适合默认行为。</p>
</section>
<section id="pool-switching">
<span id="id3"></span><h2>切换连接池实现<a class="headerlink" href="#pool-switching" title="Permalink to this heading">¶</a></h2>
<p>使用不同类型的连接池与  <code class="xref py py-func docutils literal notranslate"><span class="pre">create_engine()</span></code> ` poolclass``参数。此参数接受从``sqlalchemy.pool``库中导入的类，并处理了为您构建池的详细信息。</p>
<p>当连接池被禁用时，通常情况下使用 <a class="reference internal" href="#sqlalchemy.pool.NullPool" title="sqlalchemy.pool.NullPool"><code class="xref py py-class docutils literal notranslate"><span class="pre">NullPool</span></code></a> 实现即可实现这一点：</p>
<blockquote>
<div><p>from sqlalchemy.pool import NullPool</p>
<dl class="simple">
<dt>engine = create_engine(</dt><dd><p>“postgresql+psycopg2://scott:tiger&#64;localhost/test”, poolclass=NullPool</p>
</dd>
</dl>
<p>)</p>
</div></blockquote>
</section>
<section id="id4">
<h2>使用自定义连接函数<a class="headerlink" href="#id4" title="Permalink to this heading">¶</a></h2>
<p>请参阅部分   <span class="xref std std-ref">custom_dbapi_args</span>  以了解各种自定义连接选项。</p>
</section>
<section id="id5">
<h2>构造一个连接池<a class="headerlink" href="#id5" title="Permalink to this heading">¶</a></h2>
<p>使用  <a class="reference internal" href="#sqlalchemy.pool.Pool" title="sqlalchemy.pool.Pool"><code class="xref py py-class docutils literal notranslate"><span class="pre">Pool</span></code></a> ` creator``函数是唯一需要的参数，并首先被传递，后跟任何附加选项：</p>
<blockquote>
<div><p>import sqlalchemy.pool as pool
import psycopg2</p>
<dl class="simple">
<dt>def getconn():</dt><dd><p>c = psycopg2.connect(user=”ed”, host=”127.0.0.1”, dbname=”test”)
return c</p>
</dd>
</dl>
<p>mypool = pool.QueuePool(getconn, max_overflow=10, pool_size=5)</p>
</div></blockquote>
<p>可以使用  <a class="reference internal" href="#sqlalchemy.pool.Pool.connect" title="sqlalchemy.pool.Pool.connect"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Pool.connect()</span></code></a>  函数从池中获取DBAPI连接。其返回值是包含在透明代理中并由DBAPI 组成的DBAPI连接：</p>
<blockquote>
<div><p># 获取连接</p>
<p>conn = mypool.connect()</p>
<p># 使用它
cursor_obj = conn.cursor()
cursor_obj.execute(“select foo”)</p>
</div></blockquote>
<p>透明代理的作用是要截取 <code class="docutils literal notranslate"><span class="pre">close</span> <span class="pre">()</span></code> 调用，以便不关闭DBAPI连接，而是将其返回到连接池中：</p>
<blockquote>
<div><p># “关闭”连接。返回它到池中。
conn.close()</p>
</div></blockquote>
<p>在使用 asyncio DBAPI驱动程序时，此代理也将包含DBAPI连接的内部返回到池中，但不推荐使用此用法。</p>
</section>
<section id="pool-reset-on-return">
<span id="id6"></span><h2>返回后重置表单<a class="headerlink" href="#pool-reset-on-return" title="Permalink to this heading">¶</a></h2>
<p>池包括“返回时重置”的行为，将在将连接返回到池时调用``rollback()``方法，并从连接中将任何现有的事务状态删除，这不仅包括未提交的数据，还包括表和行锁定。对于大多数DBAPI，对``rollback()``方法的调用是不昂贵的，如果DBAPI已经完成了事务，则它应该是一个无操作。</p>
<p>对于特定情况而言，可能不需要执行``rollback()``操作，例如在使用配置为“autocommit”的连接或使用没有ACID能力的数据库（例如MySQL的MyISAM引擎）时。通常出于性能原因而禁用重置次数。可以通过使用_pool.Pool的  <a class="reference internal" href="#sqlalchemy.pool.Pool.params.reset_on_return" title="sqlalchemy.pool.Pool"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Pool.reset_on_return</span></code></a>  将值传递为` <cite>None`</cite>。</p>
<p>以下示例演示了如何在``AUTOCOMMIT``的情况下，使用  <code class="xref py py-paramref docutils literal notranslate"><span class="pre">create_engine.isolation_level</span></code>  参数设置和  :paramref:` _pool.Pool.reset_on_return`  参数禁用重置表单：</p>
<blockquote>
<div><dl class="simple">
<dt>non_acid_engine = create_engine(</dt><dd><p>“mysql://scott:tiger&#64;host/db”,
pool_reset_on_return=None,
isolation_level=”AUTOCOMMIT”,</p>
</dd>
</dl>
<p>)</p>
</div></blockquote>
<p>上述引擎实际上在将连接返回到池时没有执行ROLLBACK；由于启用了AUTOCOMMIT，因此驱动程序也不会执行任何BEGIN操作。</p>
</section>
<section id="id7">
<h2>自定义返回方案<a class="headerlink" href="#id7" title="Permalink to this heading">¶</a></h2>
<p>“返回时重置”仅由一个``rollback()``操作组成可能不足以满足一些用例；尤其是，使用临时表的应用程序可能希望在检入连接时自动删除这些表。</p>
<p>对于其他服务器资源，例如准备好的语句句柄和服务器端语句缓存，可能会超过检入过程。这些具体取决于特定情况，可能会导致需要或不需要重置。</p>
<p>再次强调，某些后端可能提供重置的一些手段。已知有这种重置方案的两种包含在SQLAlchemy中的方言包括:微软SQL Server，其中一个名为“sp_reset_connection”的未记录但广为人知的存储过程通常用作重置方案，以及PostgreSQL，其中包含一系列明确记录的命令，包括“DISCARD”“RESET”、“DEALLOCATE”，和“UNLISTEN”。</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>下面的段落 + 示例应与 mssql/base.py 示例相匹配</p>
</div>
<p>以下示例说明如何使用 Microsoft SQL Server <code class="docutils literal notranslate"><span class="pre">sp_reset_connection``存储过程替换返回时的重置行为，使用</span>&#160; <span class="pre">:meth:`.PoolEvents.reset`</span>&#160; <span class="pre">事件挂钩。</span> <span class="pre">对于</span>&#160; <span class="pre">:paramref:`</span> <span class="pre">_sa.create_engine.pool_reset_on_return`</span>&#160;&#160; <span class="pre">我们将设置``None``值以便可以完全替换默认行为。自定义钩子的实现在所有情况下都会调用</span></code>.rollback()``，因为DBAPI的自身的跟踪提交/Rollback将与事务状态保持一致是非常重要的：</p>
<blockquote>
<div><p>from sqlalchemy import create_engine
from sqlalchemy import event</p>
<dl class="simple">
<dt>mssql_engine = create_engine(</dt><dd><p>“mssql+pyodbc://scott:tiger^5HHH&#64;mssql2017:1433/test?driver=ODBC+Driver+17+for+SQL+Server”,
# 停用默认的“返回时重置”方案
pool_reset_on_return=None,</p>
</dd>
</dl>
<p>)</p>
<p>&#64;event.listens_for(mssql_engine, “reset”)
def _reset_mssql(dbapi_connection, connection_record, reset_state):</p>
<blockquote>
<div><dl class="simple">
<dt>if not reset_state.terminate_only:</dt><dd><p>dbapi_connection.execute(“{call sys.sp_reset_connection}”)</p>
</dd>
</dl>
<p># 所以DBAPI本身知道连接已重置
dbapi_connection.rollback()</p>
</div></blockquote>
</div></blockquote>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 2.0.0b3: </span>添加了  <a class="reference internal" href="events.html#sqlalchemy.events.PoolEvents.reset" title="sqlalchemy.events.PoolEvents.reset"><code class="xref py py-meth docutils literal notranslate"><span class="pre">PoolEvents.reset()</span></code></a>  事件的附加状态参数，并确保该事件被触发了所有“重置”事件，因此它适用于自定义“重置”处理程序。以前使用  :meth:` .PoolEvents.checkin`  处理程序的方案仍然可用。</p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<ul class="simple">
<li><p><a class="reference internal" href="../dialects/mssql.html#mssql-reset-on-return"><span class="std std-ref">Temporary Table / Resource Reset for Connection Pooling</span></a>  - 在   :ref:` mssql_toplevel`  文档中</p></li>
<li><p><a class="reference internal" href="../dialects/postgresql.html#postgresql-reset-on-return"><span class="std std-ref">Temporary Table / Resource Reset for Connection Pooling</span></a>  - 在   :ref:` postgresql_toplevel`  文档中</p></li>
</ul>
</div>
<section id="id8">
<h3>记录返回事件的重置表格<a class="headerlink" href="#id8" title="Permalink to this heading">¶</a></h3>
<p>可以通过将``logging.DEBUG``日志级别与``sqlalchemy.pool``记录器一起设置，或在使用  <code class="xref py py-func docutils literal notranslate"><span class="pre">create_engine()</span></code>  设置为` <a href="#id9"><span class="problematic" id="id10">`</span></a>”debug”<a href="#id11"><span class="problematic" id="id12">``</span></a>来记录池事件，包括返回时的重置：</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">create_engine</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s2">&quot;postgresql://scott:tiger@localhost/test&quot;</span><span class="p">,</span> <span class="n">echo_pool</span><span class="o">=</span><span class="s2">&quot;debug&quot;</span><span class="p">)</span></pre></div>
</div>
<p>上面的池将显示包括返回时的重置在内的详细日志记录：</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">c1</span> <span class="o">=</span> <span class="n">engine</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
<span class="go">DEBUG sqlalchemy.pool.impl.QueuePool Created new connection &lt;connection object ...&gt;</span>
<span class="go">DEBUG sqlalchemy.pool.impl.QueuePool Connection &lt;connection object ...&gt; checked out from pool</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c1</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="go">DEBUG sqlalchemy.pool.impl.QueuePool Connection &lt;connection object ...&gt; being returned to pool</span>
<span class="go">DEBUG sqlalchemy.pool.impl.QueuePool Connection &lt;connection object ...&gt; rollback-on-return</span></pre></div>
</div>
</section>
</section>
<section id="id13">
<h2>池活动<a class="headerlink" href="#id13" title="Permalink to this heading">¶</a></h2>
<p>连接池支持事件接口，允许在首次连接、每个新连接、检出连接和检入连接时执行钩子。有关详细信息，请参见  <a class="reference internal" href="events.html#sqlalchemy.events.PoolEvents" title="sqlalchemy.events.PoolEvents"><code class="xref py py-class docutils literal notranslate"><span class="pre">PoolEvents</span></code></a> 。</p>
</section>
<section id="pool-disconnects">
<span id="id14"></span><h2>处理断开连接<a class="headerlink" href="#pool-disconnects" title="Permalink to this heading">¶</a></h2>
<p>连接池有刷新单个连接以及其所有连接集的能力，将先前的流入的连接设置为“无效”。当数据库服务器已被重新启动，并且所有先前建立的连接都不再工作时，这是一种常见用例。有两种方法可以实现这一点。</p>
<section id="pool-disconnects-pessimistic">
<span id="id15"></span><h3>断开处理-悲观<a class="headerlink" href="#pool-disconnects-pessimistic" title="Permalink to this heading">¶</a></h3>
<p>悲观方法是在每次连接池检出时，在SQL连接上发出测试语句，以测试数据库连接是否仍然可用。该实现取决于方言特定，并使用DBAPI特定的ping方法，或者通过使用简单的SQL语句，如“SELECT 1”，来测试该语句。</p>
<p>该方法会在连接检出过程中增加一些负担，但是在完全消除由于过时的连接导致的数据库错误方面是最简单且最可靠的方法。调用应用程序无需关心如何组织操作以便能够从连接池中恢复过时的连接。当支持pool pre ping时，在  <code class="xref py py-func docutils literal notranslate"><span class="pre">create_engine()</span></code>   标志可以实现对悲观检查的需求：</p>
<blockquote>
<div><p>engine = create_engine(“mysql+pymysql://user:pw&#64;host/db”, pool_pre_ping=True)</p>
</div></blockquote>
<p>“预先ping”的功能基于每个方言，通过调用DBAPI特定的“ping”方法运行，或者如果不可用，则通过发出与等效于“SELECT 1”而抓取任何错误并将错误检测为“disconnect”情况。如果ping/错误检查确定连接无法使用，则连接将立即回收，而且所有早于当前时间的池化连接都无效，因此，由于这种情况下发生的断开检测，它们在下次使用之前将被替换为新连接。</p>
<p>如果当“pre ping”运行时数据库仍不可用，则初始连接会失败，并且将正常传播连接失败的错误。对于不常见的情况，在尝试了三次但仍然不可用时，”pre_ping”将放弃，并传播最后收到的数据库错误。</p>
<p>需要注意的是，预处理方法不能适应在事务或其他SQL操作中断开的连接。如果事务正在进行时，数据库变得不可用，事务将丢失，并引发数据库错误。虽然  <a class="reference internal" href="connections.html#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a>  。</p>
<p>对于使用“SELECT 1”并通过捕获错误来检测断开连接的方言，可以通过  <a class="reference internal" href="events.html#sqlalchemy.events.DialectEvents.handle_error" title="sqlalchemy.events.DialectEvents.handle_error"><code class="xref py py-meth docutils literal notranslate"><span class="pre">DialectEvents.handle_error()</span></code></a>  钩子向新的后端特定错误消息添加支持。</p>
<section id="ping">
<span id="pool-disconnects-pessimistic-custom"></span><h4>自定义/遗留悲观ping<a class="headerlink" href="#ping" title="Permalink to this heading">¶</a></h4>
<p>在添加  <code class="xref py py-paramref docutils literal notranslate"><span class="pre">create_engine.pool_pre_ping</span></code>  之前，历史上使用  :meth:` _events.ConnectionEvents.engine_connect`  事件手动执行“pre-ping”检查。对于引擎，传统方法的最常见用法已在下面给出。</p>
<p>这是为了参考目的，以防应用程序已经在使用这样的方法，或者需要特殊的行为：</p>
<blockquote>
<div><p>from sqlalchemy import exc
from sqlalchemy import event
from sqlalchemy import select</p>
<p>some_engine = create_engine(…)</p>
<p>&#64;event.listens_for(some_engine, “engine_connect”)
def ping_connection(connection, branch):</p>
<blockquote>
<div><dl>
<dt>if branch:</dt><dd><p># 该参数始终为False，由于SQLAlchemy 2.0，但仍可由事件挂钩接受。在1.x版本中，应跳过“分支”连接。
return</p>
</dd>
<dt>try:</dt><dd><p># 运行 SELECT 1。使用核心select() 以便无表地选择标量值。
connection.scalar(select(1))</p>
</dd>
<dt>except exc.DBAPIError as err:</dt><dd><p># 转到SQLAlchemy的DBAPIError，它是包装DBAPI的例外。它包括一个.connection_invalidated属性，指定此连接是否为“disconnect”条件，它基于方言中对原始异常的检查。
if err.connection_invalidated:</p>
<blockquote>
<div><p># 再次运行相同的SELECT——连接将重新验证它自己并建立一个新的连接。在此处进行的断开连接检测还导致无效化整个连接池，以便丢弃所有过时的连接。
connection.scalar(select(1))</p>
</div></blockquote>
<dl class="simple">
<dt>else:</dt><dd><p>raise</p>
</dd>
</dl>
</dd>
</dl>
</div></blockquote>
</div></blockquote>
<p>上面的配方的优点是我们利用了SQLAlchemy的设施来检测已知可表明数据库连接已“断开”的所有DBAPI异常以及 <a class="reference internal" href="connections.html#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a> 的能力来正确使当前连接池无效化此情况发生时，允许当前 <a class="reference internal" href="connections.html#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a> 重新验证到新的DBAPI连接。</p>
</section>
</section>
<section id="id16">
<h3>断开处理-乐观<a class="headerlink" href="#id16" title="Permalink to this heading">¶</a></h3>
<p>当不使用悲观处理时，以及在引擎使用的连接在事务的使用期内在数据库关闭/重新启动时，处理过时/关闭连接的另一种方法是让SQLAlchemy在发生时处理断开连接，此时，在连接池中的所有连接都无效化，这意味着它们被认为是过时的，并在下次检出时被替换为新的连接。该行为假定  <a class="reference internal" href="#sqlalchemy.pool.Pool" title="sqlalchemy.pool.Pool"><code class="xref py py-class docutils literal notranslate"><span class="pre">Pool</span></code></a>  尝试使用DBAPI连接时，如果引发与“断开”事件相对应的异常，该连接将无效。  :class:` _engine.Connection`  然后调用  <a class="reference internal" href="#sqlalchemy.pool.Pool.recreate" title="sqlalchemy.pool.Pool.recreate"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Pool.recreate()</span></code></a>  方法，相当于无效化所有当前没有被检出的连接，以便在下次检出时使用新的连接池中的连接。在下面的代码示例中说明了该流：：</p>
<blockquote>
<div><p>from sqlalchemy import create_engine, exc</p>
<p>e = create_engine(…)
c = e.connect()</p>
<dl>
<dt>try:</dt><dd><p># 假设数据库已重新启动。
c.execute(text(“SELECT * FROM table”))
c.close()</p>
</dd>
<dt>except exc.DBAPIError as e:</dt><dd><p># 引发异常，连接无效。
if e.connection_invalidated:</p>
<blockquote>
<div><p>print(“Connection was invalidated!”)</p>
</div></blockquote>
</dd>
</dl>
<p># invalidate 事件之后，一个新的连接启动一个新的Pool。
c = e.connect()
c.execute(text(“SELECT * FROM table”))</p>
</div></blockquote>
<p>上面的示例说明，不需要特殊处理即可刷新池，在检测到断开连接事件后继续正常运行。但是，将引发一个数据库异常，每个使用过时连接的连接将被抛出，最终会导致套个请求失败并给出500错误。因此，该方法在频繁地退出数据库时是一种“乐观”的方法。</p>
<section id="pool-setting-recycle">
<span id="id17"></span><h4>设置池回收站<a class="headerlink" href="#pool-setting-recycle" title="Permalink to this heading">¶</a></h4>
<p>可以增加设置``pool recycle``参数来增强“optimistic”处理。该参数将防止使用已过时特定连接的池，对于自动关闭特定时间后已过时的连接的数据库backend，如MySQL等，是适合的。</p>
<blockquote>
<div><p>from sqlalchemy import create_engine</p>
<p>e = create_engine(“mysql+mysqldb://scott:tiger&#64;localhost/test”, pool_recycle=3600)</p>
</div></blockquote>
<p>以上，在使用了一个小时以上的任何DBAPI连接将被无效化并替换和下一次检出的新连接。请注意，无效化仅在检出时适用于 <a class="reference internal" href="#sqlalchemy.pool.Pool" title="sqlalchemy.pool.Pool"><code class="xref py py-class docutils literal notranslate"><span class="pre">Pool</span></code></a> 本身，不受是否使用 <a class="reference internal" href="connections.html#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a> 的影响。</p>
</section>
</section>
<section id="pool-connection-invalidation">
<span id="id18"></span><h3>关于无效化的更多信息<a class="headerlink" href="#pool-connection-invalidation" title="Permalink to this heading">¶</a></h3>
<blockquote>
<div><p><a class="reference internal" href="#sqlalchemy.pool.Pool" title="sqlalchemy.pool.Pool"><code class="xref py py-class docutils literal notranslate"><span class="pre">Pool</span></code></a> 提供了“连接无效化”服务，允许显式无效化连接以及基于被判断为不可用而自动无效化的连接条件。</p>
</div></blockquote>
<p>“无效化”意味着从特定的DBAPI连接中删除，并将其废弃。如果未清楚连接本身可能尚未关闭，则会调用``.close()``方法，但如果此方法失败，则将记录异常，但操作仍将继续。</p>
<p>当使用  <a class="reference internal" href="connections.html#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a>  方法是显式无效化的常规入口。一个DBAPI异常，例如  :class:` .OperationalError` ，当调用诸如 <code class="docutils literal notranslate"><span class="pre">connection.execute()</span></code> 这样的方法时被检测为指示其为断开连接事件时被检测为无效情况。由于Python DBAPI没有用于确定异常本质的标准系统，所有SQLAlchemy方言都包含一种名为 <code class="docutils literal notranslate"><span class="pre">is_disconnect()</span></code> 的系统，它将检查包括字符串消息和任何潜在错误代码在内的异常对象的内容，以确定异常是否表示连接不再可用。如果是这样，则将调用  <code class="xref py py-meth docutils literal notranslate"><span class="pre">_ConnectionFairy.invalidate()</span></code>   方法，然后丢弃DBAPI连接。</p>
<p>当连接返回到池并调用``connection.rollback()``或``connection.commit()``方法时，根据池的“return when reset”行为引发异常时，将调用create_garbage_collection_hack（）方法。将尝试最终关闭连接，并将其丢弃。</p>
<p>当实现  <a class="reference internal" href="events.html#sqlalchemy.events.PoolEvents.checkout" title="sqlalchemy.events.PoolEvents.checkout"><code class="xref py py-meth docutils literal notranslate"><span class="pre">PoolEvents.checkout()</span></code></a> ~sqlalchemy.exc.DisconnectionError` 异常时，也会使DBAPI连接失效，指示需要进行新连接尝试。</p>
<p>无效化时发生的所有无效化事件都将调用  <a class="reference internal" href="events.html#sqlalchemy.events.PoolEvents.invalidate" title="sqlalchemy.events.PoolEvents.invalidate"><code class="xref py py-meth docutils literal notranslate"><span class="pre">PoolEvents.invalidate()</span></code></a>  事件。</p>
</section>
<section id="pool-new-disconnect-codes">
<span id="id19"></span><h3>为断开连接方案提供新的数据库错误代码支持<a class="headerlink" href="#pool-new-disconnect-codes" title="Permalink to this heading">¶</a></h3>
<p>每个SQLAlchemy方言都包含一个名为``is_disconnect()``的程序，每当DBAPI异常被捕获时就会调用该程序。由于用户使用的方言的启发式将决定接收到的错误代码是否表示数据库连接已“断开”或处于其他不可用状态，导致其应转为可回收状态，可以使用``_events.DialectEvents.handle_error`` 事件钩子自定义启发式。通常，钩子通过拥有其上的所有错误传递上下文对象，称为   <a class="reference internal" href="connections.html#sqlalchemy.engine.ExceptionContext" title="sqlalchemy.engine.ExceptionContext"><code class="xref py py-class docutils literal notranslate"><span class="pre">ExceptionContext</span></code></a>  。自定义事件钩子可以控制特定错误是否应被视为“断开”情况，以及此断开是否应导致整个连接池被使无效化。</p>
<p>例如，要添加支持将Oracle错误代码``DPY-1001``和``DPY-4011``视为断开连接代码，请在创建引擎后添加事件处理程序：</p>
<blockquote>
<div><p>import re</p>
<p>from sqlalchemy import create_engine</p>
<p>engine = create_engine(“oracle://scott:tiger&#64;dnsname”)</p>
<p>&#64;event.listens_for(engine, “handle_error”)
def handle_exception(context: ExceptionContext) -&gt; None:</p>
<blockquote>
<div><dl class="simple">
<dt>if not context.is_disconnect and re.match(</dt><dd><p>r”^(?:DPI-1001|DPI-4011)”, str(context.original_exception)</p>
</dd>
<dt>):</dt><dd><p>context.is_disconnect = True</p>
</dd>
</dl>
<p>return None</p>
</div></blockquote>
</div></blockquote>
<p>上述错误处理函数将针对引发的所有Oracle错误进行调用，从而包括在使用后端所依赖的断开连接错误处理的后端上进行断开连接错误处理的后端（2.0中的新功能）。</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="events.html#sqlalchemy.events.DialectEvents.handle_error" title="sqlalchemy.events.DialectEvents.handle_error"><code class="xref py py-meth docutils literal notranslate"><span class="pre">DialectEvents.handle_error()</span></code></a></p>
</div>
</section>
</section>
<section id="fifolifo">
<h2>使用FIFO与LIFO<a class="headerlink" href="#fifolifo" title="Permalink to this heading">¶</a></h2>
<blockquote>
<div><p><a class="reference internal" href="#sqlalchemy.pool.QueuePool" title="sqlalchemy.pool.QueuePool"><code class="xref py py-class docutils literal notranslate"><span class="pre">QueuePool</span></code></a> .QueuePool.use_lifo` 的标志，这标志也可以从  :func:` _sa.create_engine`   访问。将此标志设置为True将导致池的“队列”行为变为“栈”，即返回到池的最后一个连接是用于下一次请求的第一个连接。与池的先进先出行为形成循环效应使用每个连接在池中顺序使用时不同，后进先出模式允许多余的连接保持空闲状态，从而允许服务器端超时方案关闭这些连接。这是先进先出（FIFO）和后进先出（LIFO）之间的区别，基本上取决于是否希望池在空闲期间保持完整的连接集：</p>
<blockquote>
<div><p>engine = create_engine(“postgreql://”, pool_use_lifo=True, pool_pre_ping=True)</p>
</div></blockquote>
</div></blockquote>
<p>以上，我们还使用了  <code class="xref py py-paramref docutils literal notranslate"><span class="pre">create_engine.pool_pre_ping</span></code>  标志来让从服务器端关闭的连接通过连接池优雅地处理并替换为新连接。</p>
<p>请注意，该标志仅适用于使用 <a class="reference internal" href="#sqlalchemy.pool.QueuePool" title="sqlalchemy.pool.QueuePool"><code class="xref py py-class docutils literal notranslate"><span class="pre">QueuePool</span></code></a> 的使用。</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.3.</span></p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#pool-disconnects"><span class="std std-ref">处理断开连接</span></a></p>
</div>
</section>
<section id="os-fork">
<h2>在使用多进程或os.fork()中使用连接池<a class="headerlink" href="#os-fork" title="Permalink to this heading">¶</a></h2>
<p>当使用连接池时，关键是使用连接的池**不应与多个进程共享**。 TCP连接表示为文件描述符，在通常情况下可以跨进程边界工作，这意味着这将导致用于两个或多个完全独立的Python解释器状态的文件描述符的并发访问。</p>
<p>根据驱动程序和操作系统的具体规格，这里出现的问题范围从不工作的连接到由多个进程同时使用的套接字连接，导致消息中断（后一种情况通常是最常见的）。</p>
<p>SQLAlchemy   <a class="reference internal" href="connections.html#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a>  方法，传递  :paramref:` .Engine.dispose.close`  参数值为 <code class="docutils literal notranslate"><span class="pre">False</span></code>。这是以便新进程不会触摸父进程的任何连接，并将启动新连接。</p>
<p>这是建议的方法：</p>
<p>1.使用:class：<a href="#id20"><span class="problematic" id="id21">`</span></a>。NullPool`禁用连接池。这是最简单的，一次性的系统，可以防止 :class：<a href="#id22"><span class="problematic" id="id23">`</span></a>_engine.Engine`使用任何连接超过一次.</p>
<blockquote>
<div><p>from sqlalchemy.pool import NullPool</p>
<p>engine = create_engine(“mysql+mysqldb://user:pass&#64;host/dbname”, poolclass=NullPool)</p>
</div></blockquote>
<p>2.在程序生成子进程期间，初始化程序阶段内，为给定的  <a class="reference internal" href="connections.html#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a>  传递  :paramref:` .Engine.dispose.close`  参数值为 <code class="docutils literal notranslate"><span class="pre">False</span></code>。 这是为了使新进程不会触 touch’ the parent process 的任何连接，并将开始使用新的连接集。<strong>这是建议的方法</strong>：</p>
<blockquote>
<div><p>from multiprocessing import Pool</p>
<p>engine = create_engine(“mysql+mysqldb://user:pass&#64;host/dbname”)</p>
<dl class="simple">
<dt>def run_in_process(some_data_record):</dt><dd><dl class="simple">
<dt>with engine.connect() as conn:</dt><dd><p>conn.execute(text(”…”))</p>
</dd>
</dl>
</dd>
<dt>def initializer():</dt><dd><p>“””ensure the parent proc’s database connections are not touched
in the new connection pool”””
engine.dispose(close=False)</p>
</dd>
<dt>with Pool(10, initializer=initializer) as p:</dt><dd><p>p.map(run_in_process, data)</p>
</dd>
</dl>
<p>..versionadded:: 1.4.33 添加了  <a class="reference internal" href="connections.html#sqlalchemy.engine.Engine.dispose.params.close" title="sqlalchemy.engine.Engine.dispose"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Engine.dispose.close</span></code></a>  参数，以允许在子流程中替换连接池而不干扰父进程使用的连接。</p>
</div></blockquote>
<p>3.在创建子进程之前首先  <a class="reference internal" href="connections.html#sqlalchemy.engine.Engine.dispose" title="sqlalchemy.engine.Engine.dispose"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Engine.dispose()</span></code></a>  直接调用  :meth:` .Engine.dispose` 。 这也将使子进程开始使用新的连接池，同时确保不传输父进程的连接:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s2">&quot;mysql://user:pass@host/dbname&quot;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">run_in_process</span><span class="p">():</span>
    <span class="k">with</span> <span class="n">engine</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
        <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">text</span><span class="p">(</span><span class="s2">&quot;...&quot;</span><span class="p">))</span>


<span class="c1"># before process starts, ensure engine.dispose() is called</span>
<span class="n">engine</span><span class="o">.</span><span class="n">dispose</span><span class="p">()</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">run_in_process</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">start</span><span class="p">()</span><span class="mf">4.</span><span class="n">可以应用事件处理器到连接池来测试跨进程共享的连接</span><span class="err">，</span><span class="n">并使它们失效</span><span class="err">：</span></pre></div>
</div>
<dl>
<dt><a href="#id24"><span class="problematic" id="id25">``</span></a><a href="#id26"><span class="problematic" id="id27">`</span></a></dt><dd><p>from sqlalchemy import event
from sqlalchemy import exc
import os</p>
<p>engine = create_engine(”…”)</p>
<p>&#64;event.listens_for(engine, “connect”)
def connect(dbapi_connection, connection_record):</p>
<blockquote>
<div><p>connection_record.info[“pid”] = os.getpid()</p>
</div></blockquote>
<p>&#64;event.listens_for(engine, “checkout”)
def checkout(dbapi_connection, connection_record, connection_proxy):</p>
<blockquote>
<div><p>pid = os.getpid()
if connection_record.info[“pid”] != pid:</p>
<blockquote>
<div><p>connection_record.dbapi_connection = connection_proxy.dbapi_connection = None
raise exc.DisconnectionError(</p>
<blockquote>
<div><p>“连接记录属于pid %s，试图在pid %s中进行检出” % (connection_record.info[“pid”], pid)</p>
</div></blockquote>
<p>)</p>
</div></blockquote>
</div></blockquote>
</dd>
</dl>
<p><a href="#id28"><span class="problematic" id="id29">``</span></a>`
上面，我们使用类似于``pool_disconnects_pessimistic``中所述的方法来将另一个父进程中产生的DBAPI连接视为无效连接，强制池回收连接记录以建立新的连接。</p>
<p>上述策略将适用于在进程间共享的``_engine.Engine``的情况。上述步骤本身并不足以处理跨进程边界共享特定``_engine.Connection``的情况；最好将特定``_engine.Connection``的作用域保持在单个进程（和线程）中。也没有支持直接在进程之间共享任何一种正在进行的事务状态，例如已经开始事务并引用``_orm.Connection``实例的ORM <a href="#id30"><span class="problematic" id="id31">``</span></a>_orm.Session``对象；同样最好在新进程中创建新的``_orm.Session``对象。</p>
</section>
<section id="id32">
<h2>直接使用池实例<a class="headerlink" href="#id32" title="Permalink to this heading">¶</a></h2>
<p>可以直接使用池实现而不使用引擎。这可用于只想使用池行为而不使用所有其他SQLAlchemy特性的应用程序。在下面的示例中，使用``_sa.create_pool_from_url``获取``MySQLdb``语言方言的默认池：</p>
<dl>
<dt><a href="#id33"><span class="problematic" id="id34">``</span></a><a href="#id35"><span class="problematic" id="id36">`</span></a></dt><dd><p>from sqlalchemy import create_pool_from_url</p>
<dl class="simple">
<dt>my_pool = create_pool_from_url(</dt><dd><p>“mysql+mysqldb://”, max_overflow=5, pool_size=5, pre_ping=True</p>
</dd>
</dl>
<p>)</p>
<p>con = my_pool.connect()
# use the connection
…
# then close it
con.close()</p>
</dd>
</dl>
<p><a href="#id37"><span class="problematic" id="id38">``</span></a><a href="#id39"><span class="problematic" id="id40">`</span></a></p>
<p>如果没有指定要创建的池的类型，将使用该方言的默认池。可以使用``poolclass``参数来直接指定池，如以下示例所示：</p>
<dl>
<dt><a href="#id41"><span class="problematic" id="id42">``</span></a><a href="#id43"><span class="problematic" id="id44">`</span></a></dt><dd><p>from sqlalchemy import create_pool_from_url
from sqlalchemy import NullPool</p>
<p>my_pool = create_pool_from_url(“mysql+mysqldb://”, poolclass=NullPool)</p>
</dd>
</dl>
<p><a href="#id45"><span class="problematic" id="id46">``</span></a><a href="#id47"><span class="problematic" id="id48">`</span></a></p>
</section>
<section id="api">
<h2>API文档 - 可用池实现<a class="headerlink" href="#api" title="Permalink to this heading">¶</a></h2>
<table class="longtable docutils align-default">
<thead>
<tr class="row-odd"><th class="head">Object Name</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.pool._ConnectionFairy"><span class="sig-name descname">_ConnectionFairy</span></a></p></td>
<td><p>Proxies a DBAPI connection and provides return-on-dereference
support.</p></td>
</tr>
<tr class="row-odd"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.pool._ConnectionRecord"><span class="sig-name descname">_ConnectionRecord</span></a></p></td>
<td><p>Maintains a position in a connection pool which references a pooled
connection.</p></td>
</tr>
<tr class="row-even"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.pool.AssertionPool"><span class="sig-name descname">AssertionPool</span></a></p></td>
<td><p>A <a class="reference internal" href="#sqlalchemy.pool.Pool" title="sqlalchemy.pool.Pool"><code class="xref py py-class docutils literal notranslate"><span class="pre">Pool</span></code></a> that allows at most one checked out connection at
any given time.</p></td>
</tr>
<tr class="row-odd"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.pool.ConnectionPoolEntry"><span class="sig-name descname">ConnectionPoolEntry</span></a></p></td>
<td><p>Interface for the object that maintains an individual database
connection on behalf of a <a class="reference internal" href="#sqlalchemy.pool.Pool" title="sqlalchemy.pool.Pool"><code class="xref py py-class docutils literal notranslate"><span class="pre">Pool</span></code></a> instance.</p></td>
</tr>
<tr class="row-even"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.pool.ManagesConnection"><span class="sig-name descname">ManagesConnection</span></a></p></td>
<td><p>Common base for the two connection-management interfaces
<a class="reference internal" href="#sqlalchemy.pool.PoolProxiedConnection" title="sqlalchemy.pool.PoolProxiedConnection"><code class="xref py py-class docutils literal notranslate"><span class="pre">PoolProxiedConnection</span></code></a> and <a class="reference internal" href="#sqlalchemy.pool.ConnectionPoolEntry" title="sqlalchemy.pool.ConnectionPoolEntry"><code class="xref py py-class docutils literal notranslate"><span class="pre">ConnectionPoolEntry</span></code></a>.</p></td>
</tr>
<tr class="row-odd"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.pool.NullPool"><span class="sig-name descname">NullPool</span></a></p></td>
<td><p>A Pool which does not pool connections.</p></td>
</tr>
<tr class="row-even"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.pool.Pool"><span class="sig-name descname">Pool</span></a></p></td>
<td><p>Abstract base class for connection pools.</p></td>
</tr>
<tr class="row-odd"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.pool.PoolProxiedConnection"><span class="sig-name descname">PoolProxiedConnection</span></a></p></td>
<td><p>A connection-like adapter for a <span class="target" id="index-4"></span><a class="pep reference external" href="https://peps.python.org/pep-0249/"><strong>PEP 249</strong></a> DBAPI connection, which
includes additional methods specific to the <a class="reference internal" href="#sqlalchemy.pool.Pool" title="sqlalchemy.pool.Pool"><code class="xref py py-class docutils literal notranslate"><span class="pre">Pool</span></code></a> implementation.</p></td>
</tr>
<tr class="row-even"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.pool.QueuePool"><span class="sig-name descname">QueuePool</span></a></p></td>
<td><p>A <a class="reference internal" href="#sqlalchemy.pool.Pool" title="sqlalchemy.pool.Pool"><code class="xref py py-class docutils literal notranslate"><span class="pre">Pool</span></code></a>
that imposes a limit on the number of open connections.</p></td>
</tr>
<tr class="row-odd"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.pool.SingletonThreadPool"><span class="sig-name descname">SingletonThreadPool</span></a></p></td>
<td><p>A Pool that maintains one connection per thread.</p></td>
</tr>
<tr class="row-even"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.pool.StaticPool"><span class="sig-name descname">StaticPool</span></a></p></td>
<td><p>A Pool of exactly one connection, used for all requests.</p></td>
</tr>
</tbody>
</table>
<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.pool.Pool">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.pool.</span></span><span class="sig-name descname"><span class="pre">Pool</span></span><a class="headerlink" href="#sqlalchemy.pool.Pool" title="Permalink to this definition">¶</a></dt>
<dd><p>Abstract base class for connection pools.</p>
<div class="class-members docutils container">
<p><strong>Members</strong></p>
<p><a class="reference internal" href="#sqlalchemy.pool.Pool.__init__"><span class="sig-name descname">__init__()</span></a>, <a class="reference internal" href="#sqlalchemy.pool.Pool.connect"><span class="sig-name descname">connect()</span></a>, <a class="reference internal" href="#sqlalchemy.pool.Pool.dispose"><span class="sig-name descname">dispose()</span></a>, <a class="reference internal" href="#sqlalchemy.pool.Pool.recreate"><span class="sig-name descname">recreate()</span></a></p>
</div>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.pool.Pool" title="sqlalchemy.pool.Pool"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.pool.Pool</span></code></a> (<a class="reference internal" href="internals.html#sqlalchemy.log.Identified" title="sqlalchemy.log.Identified"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.log.Identified</span></code></a>, <code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.event.registry.EventTarget</span></code>)</p>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.pool.Pool.__init__">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.pool.Pool"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.pool.Pool.</span></code></a><span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">creator</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_CreatorFnType</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">_CreatorWRecFnType</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">recycle</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">-1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">echo</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">log._EchoFlagType</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logging_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reset_on_return</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_ResetStyleArgType</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">events</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="sqlelement.html#sqlalchemy.sql.expression.Tuple" title="sqlalchemy.sql.expression.Tuple"><span class="pre">Tuple</span></a><span class="p"><span class="pre">[</span></span><span class="pre">_ListenerFnType</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dialect</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_ConnDialect</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference internal" href="internals.html#sqlalchemy.engine.Dialect" title="sqlalchemy.engine.Dialect"><span class="pre">Dialect</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pre_ping</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">_dispatch</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_DispatchCommon</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#sqlalchemy.pool.Pool" title="sqlalchemy.pool.Pool"><span class="pre">Pool</span></a><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.pool.Pool.__init__" title="Permalink to this definition">¶</a></dt>
<dd><p>Construct a Pool.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.pool.Pool.params.creator"></span><strong>creator</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.pool.Pool.params.creator">¶</a> – a callable function that returns a DB-API
connection object.  The function will be called with
parameters.</p></li>
<li><p><span class="target" id="sqlalchemy.pool.Pool.params.recycle"></span><strong>recycle</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.pool.Pool.params.recycle">¶</a> – If set to a value other than -1, number of
seconds between connection recycling, which means upon
checkout, if this timeout is surpassed the connection will be
closed and replaced with a newly opened connection. Defaults to -1.</p></li>
<li><p><span class="target" id="sqlalchemy.pool.Pool.params.logging_name"></span><strong>logging_name</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.pool.Pool.params.logging_name">¶</a> – String identifier which will be used within
the “name” field of logging records generated within the
“sqlalchemy.pool” logger. Defaults to a hexstring of the object’s
id.</p></li>
<li><p><span class="target" id="sqlalchemy.pool.Pool.params.echo"></span><strong>echo</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.pool.Pool.params.echo">¶</a> – <p>if True, the connection pool will log
informational output such as when connections are invalidated
as well as when connections are recycled to the default log handler,
which defaults to <code class="docutils literal notranslate"><span class="pre">sys.stdout</span></code> for output..   If set to the string
<code class="docutils literal notranslate"><span class="pre">&quot;debug&quot;</span></code>, the logging will include pool checkouts and checkins.</p>
<p>The <a class="reference internal" href="#sqlalchemy.pool.Pool.params.echo" title="sqlalchemy.pool.Pool"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Pool.echo</span></code></a> parameter can also be set from the
<code class="xref py py-func docutils literal notranslate"><span class="pre">create_engine()</span></code> call by using the
<code class="xref py py-paramref docutils literal notranslate"><span class="pre">create_engine.echo_pool</span></code> parameter.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><span class="xref std std-ref">dbengine_logging</span> - further detail on how to configure
logging.</p>
</div>
</p></li>
<li><p><span class="target" id="sqlalchemy.pool.Pool.params.reset_on_return"></span><strong>reset_on_return</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.pool.Pool.params.reset_on_return">¶</a> – <p>Determine steps to take on
connections as they are returned to the pool, which were
not otherwise handled by a <a class="reference internal" href="connections.html#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a>.
Available from <code class="xref py py-func docutils literal notranslate"><span class="pre">create_engine()</span></code> via the
<code class="xref py py-paramref docutils literal notranslate"><span class="pre">create_engine.pool_reset_on_return</span></code> parameter.</p>
<p><a class="reference internal" href="#sqlalchemy.pool.Pool.params.reset_on_return" title="sqlalchemy.pool.Pool"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Pool.reset_on_return</span></code></a> can have any of these values:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;rollback&quot;</span></code> - call rollback() on the connection,
to release locks and transaction resources.
This is the default value.  The vast majority
of use cases should leave this value set.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;commit&quot;</span></code> - call commit() on the connection,
to release locks and transaction resources.
A commit here may be desirable for databases that
cache query plans if a commit is emitted,
such as Microsoft SQL Server.  However, this
value is more dangerous than ‘rollback’ because
any data changes present on the transaction
are committed unconditionally.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">None</span></code> - don’t do anything on the connection.
This setting may be appropriate if the database / DBAPI
works in pure “autocommit” mode at all times, or if
a custom reset handler is established using the
<a class="reference internal" href="events.html#sqlalchemy.events.PoolEvents.reset" title="sqlalchemy.events.PoolEvents.reset"><code class="xref py py-meth docutils literal notranslate"><span class="pre">PoolEvents.reset()</span></code></a> event handler.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">True</span></code> - same as ‘rollback’, this is here for
backwards compatibility.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">False</span></code> - same as None, this is here for
backwards compatibility.</p></li>
</ul>
<p>For further customization of reset on return, the
<a class="reference internal" href="events.html#sqlalchemy.events.PoolEvents.reset" title="sqlalchemy.events.PoolEvents.reset"><code class="xref py py-meth docutils literal notranslate"><span class="pre">PoolEvents.reset()</span></code></a> event hook may be used which can perform
any connection activity desired on reset.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#pool-reset-on-return"><span class="std std-ref">返回后重置表单</span></a></p>
<p><a class="reference internal" href="events.html#sqlalchemy.events.PoolEvents.reset" title="sqlalchemy.events.PoolEvents.reset"><code class="xref py py-meth docutils literal notranslate"><span class="pre">PoolEvents.reset()</span></code></a></p>
</div>
</p></li>
<li><p><span class="target" id="sqlalchemy.pool.Pool.params.events"></span><strong>events</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.pool.Pool.params.events">¶</a> – a list of 2-tuples, each of the form
<code class="docutils literal notranslate"><span class="pre">(callable,</span> <span class="pre">target)</span></code> which will be passed to <a class="reference internal" href="event.html#sqlalchemy.event.listen" title="sqlalchemy.event.listen"><code class="xref py py-func docutils literal notranslate"><span class="pre">listen()</span></code></a>
upon construction.   Provided here so that event listeners
can be assigned via <code class="xref py py-func docutils literal notranslate"><span class="pre">create_engine()</span></code> before dialect-level
listeners are applied.</p></li>
<li><p><span class="target" id="sqlalchemy.pool.Pool.params.dialect"></span><strong>dialect</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.pool.Pool.params.dialect">¶</a> – a <a class="reference internal" href="internals.html#sqlalchemy.engine.Dialect" title="sqlalchemy.engine.Dialect"><code class="xref py py-class docutils literal notranslate"><span class="pre">Dialect</span></code></a> that will handle the job
of calling rollback(), close(), or commit() on DBAPI connections.
If omitted, a built-in “stub” dialect is used.   Applications that
make use of <code class="xref py py-func docutils literal notranslate"><span class="pre">create_engine()</span></code> should not use this parameter
as it is handled by the engine creation strategy.</p></li>
<li><p><span class="target" id="sqlalchemy.pool.Pool.params.pre_ping"></span><strong>pre_ping</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.pool.Pool.params.pre_ping">¶</a> – <p>if True, the pool will emit a “ping” (typically
“SELECT 1”, but is dialect-specific) on the connection
upon checkout, to test if the connection is alive or not.   If not,
the connection is transparently re-connected and upon success, all
other pooled connections established prior to that timestamp are
invalidated.     Requires that a dialect is passed as well to
interpret the disconnection error.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.2.</span></p>
</div>
</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.pool.Pool.connect">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.pool.Pool"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.pool.Pool.</span></code></a><span class="sig-name descname"><span class="pre">connect</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#sqlalchemy.pool.PoolProxiedConnection" title="sqlalchemy.pool.base.PoolProxiedConnection"><span class="pre">PoolProxiedConnection</span></a></span></span><a class="headerlink" href="#sqlalchemy.pool.Pool.connect" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a DBAPI connection from the pool.</p>
<p>The connection is instrumented such that when its
<code class="docutils literal notranslate"><span class="pre">close()</span></code> method is called, the connection will be returned to
the pool.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.pool.Pool.dispose">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.pool.Pool"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.pool.Pool.</span></code></a><span class="sig-name descname"><span class="pre">dispose</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.pool.Pool.dispose" title="Permalink to this definition">¶</a></dt>
<dd><p>Dispose of this pool.</p>
<p>This method leaves the possibility of checked-out connections
remaining open, as it only affects connections that are
idle in the pool.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#sqlalchemy.pool.Pool.recreate" title="sqlalchemy.pool.Pool.recreate"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Pool.recreate()</span></code></a></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.pool.Pool.recreate">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.pool.Pool"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.pool.Pool.</span></code></a><span class="sig-name descname"><span class="pre">recreate</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#sqlalchemy.pool.Pool" title="sqlalchemy.pool.base.Pool"><span class="pre">Pool</span></a></span></span><a class="headerlink" href="#sqlalchemy.pool.Pool.recreate" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a new <a class="reference internal" href="#sqlalchemy.pool.Pool" title="sqlalchemy.pool.Pool"><code class="xref py py-class docutils literal notranslate"><span class="pre">Pool</span></code></a>, of the same class as this one
and configured with identical creation arguments.</p>
<p>This method is used in conjunction with <a class="reference internal" href="#sqlalchemy.pool.Pool.dispose" title="sqlalchemy.pool.Pool.dispose"><code class="xref py py-meth docutils literal notranslate"><span class="pre">dispose()</span></code></a>
to close out an entire <a class="reference internal" href="#sqlalchemy.pool.Pool" title="sqlalchemy.pool.Pool"><code class="xref py py-class docutils literal notranslate"><span class="pre">Pool</span></code></a> and create a new one in
its place.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.pool.QueuePool">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.pool.</span></span><span class="sig-name descname"><span class="pre">QueuePool</span></span><a class="headerlink" href="#sqlalchemy.pool.QueuePool" title="Permalink to this definition">¶</a></dt>
<dd><p>A <a class="reference internal" href="#sqlalchemy.pool.Pool" title="sqlalchemy.pool.Pool"><code class="xref py py-class docutils literal notranslate"><span class="pre">Pool</span></code></a>
that imposes a limit on the number of open connections.</p>
<p><a class="reference internal" href="#sqlalchemy.pool.QueuePool" title="sqlalchemy.pool.QueuePool"><code class="xref py py-class docutils literal notranslate"><span class="pre">QueuePool</span></code></a> is the default pooling implementation used for
all <a class="reference internal" href="connections.html#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a> objects, unless the SQLite dialect is
in use with a <code class="docutils literal notranslate"><span class="pre">:memory:</span></code> database.</p>
<div class="class-members docutils container">
<p><strong>Members</strong></p>
<p><a class="reference internal" href="#sqlalchemy.pool.QueuePool.__init__"><span class="sig-name descname">__init__()</span></a>, <a class="reference internal" href="#sqlalchemy.pool.QueuePool.dispose"><span class="sig-name descname">dispose()</span></a>, <a class="reference internal" href="#sqlalchemy.pool.QueuePool.recreate"><span class="sig-name descname">recreate()</span></a></p>
</div>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.pool.QueuePool" title="sqlalchemy.pool.QueuePool"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.pool.QueuePool</span></code></a> (<a class="reference internal" href="#sqlalchemy.pool.Pool" title="sqlalchemy.pool.base.Pool"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.pool.base.Pool</span></code></a>)</p>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.pool.QueuePool.__init__">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.pool.QueuePool"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.pool.QueuePool.</span></code></a><span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">creator</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_CreatorFnType</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">_CreatorWRecFnType</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pool_size</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_overflow</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">10</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">timeout</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">30.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_lifo</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kw</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.pool.QueuePool.__init__" title="Permalink to this definition">¶</a></dt>
<dd><p>Construct a QueuePool.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.pool.QueuePool.params.creator"></span><strong>creator</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.pool.QueuePool.params.creator">¶</a> – a callable function that returns a DB-API
connection object, same as that of <a class="reference internal" href="#sqlalchemy.pool.Pool.params.creator" title="sqlalchemy.pool.Pool"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Pool.creator</span></code></a>.</p></li>
<li><p><span class="target" id="sqlalchemy.pool.QueuePool.params.pool_size"></span><strong>pool_size</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.pool.QueuePool.params.pool_size">¶</a> – The size of the pool to be maintained,
defaults to 5. This is the largest number of connections that
will be kept persistently in the pool. Note that the pool
begins with no connections; once this number of connections
is requested, that number of connections will remain.
<code class="docutils literal notranslate"><span class="pre">pool_size</span></code> can be set to 0 to indicate no size limit; to
disable pooling, use a <a class="reference internal" href="#sqlalchemy.pool.NullPool" title="sqlalchemy.pool.NullPool"><code class="xref py py-class docutils literal notranslate"><span class="pre">NullPool</span></code></a>
instead.</p></li>
<li><p><span class="target" id="sqlalchemy.pool.QueuePool.params.max_overflow"></span><strong>max_overflow</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.pool.QueuePool.params.max_overflow">¶</a> – The maximum overflow size of the
pool. When the number of checked-out connections reaches the
size set in pool_size, additional connections will be
returned up to this limit. When those additional connections
are returned to the pool, they are disconnected and
discarded. It follows then that the total number of
simultaneous connections the pool will allow is pool_size +
<cite>max_overflow</cite>, and the total number of “sleeping”
connections the pool will allow is pool_size. <cite>max_overflow</cite>
can be set to -1 to indicate no overflow limit; no limit
will be placed on the total number of concurrent
connections. Defaults to 10.</p></li>
<li><p><span class="target" id="sqlalchemy.pool.QueuePool.params.timeout"></span><strong>timeout</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.pool.QueuePool.params.timeout">¶</a> – The number of seconds to wait before giving up
on returning a connection. Defaults to 30.0. This can be a float
but is subject to the limitations of Python time functions which
may not be reliable in the tens of milliseconds.</p></li>
<li><p><span class="target" id="sqlalchemy.pool.QueuePool.params.use_lifo"></span><strong>use_lifo</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.pool.QueuePool.params.use_lifo">¶</a> – <p>use LIFO (last-in-first-out) when retrieving
connections instead of FIFO (first-in-first-out). Using LIFO, a
server-side timeout scheme can reduce the number of connections used
during non-peak periods of use.   When planning for server-side
timeouts, ensure that a recycle or pre-ping strategy is in use to
gracefully handle stale connections.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.3.</span></p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><span class="xref std std-ref">pool_use_lifo</span></p>
<p><a class="reference internal" href="#pool-disconnects"><span class="std std-ref">处理断开连接</span></a></p>
</div>
</p></li>
<li><p><span class="target" id="sqlalchemy.pool.QueuePool.params.**kw"></span><strong>**kw</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.pool.QueuePool.params.**kw">¶</a> – Other keyword arguments including
<a class="reference internal" href="#sqlalchemy.pool.Pool.params.recycle" title="sqlalchemy.pool.Pool"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Pool.recycle</span></code></a>, <a class="reference internal" href="#sqlalchemy.pool.Pool.params.echo" title="sqlalchemy.pool.Pool"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Pool.echo</span></code></a>,
<a class="reference internal" href="#sqlalchemy.pool.Pool.params.reset_on_return" title="sqlalchemy.pool.Pool"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Pool.reset_on_return</span></code></a> and others are passed to the
<a class="reference internal" href="#sqlalchemy.pool.Pool" title="sqlalchemy.pool.Pool"><code class="xref py py-class docutils literal notranslate"><span class="pre">Pool</span></code></a> constructor.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.pool.QueuePool.dispose">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.pool.QueuePool"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.pool.QueuePool.</span></code></a><span class="sig-name descname"><span class="pre">dispose</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.pool.QueuePool.dispose" title="Permalink to this definition">¶</a></dt>
<dd><p>Dispose of this pool.</p>
<p>This method leaves the possibility of checked-out connections
remaining open, as it only affects connections that are
idle in the pool.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#sqlalchemy.pool.Pool.recreate" title="sqlalchemy.pool.Pool.recreate"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Pool.recreate()</span></code></a></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.pool.QueuePool.recreate">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.pool.QueuePool"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.pool.QueuePool.</span></code></a><span class="sig-name descname"><span class="pre">recreate</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#sqlalchemy.pool.QueuePool" title="sqlalchemy.pool.impl.QueuePool"><span class="pre">QueuePool</span></a></span></span><a class="headerlink" href="#sqlalchemy.pool.QueuePool.recreate" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a new <a class="reference internal" href="#sqlalchemy.pool.Pool" title="sqlalchemy.pool.Pool"><code class="xref py py-class docutils literal notranslate"><span class="pre">Pool</span></code></a>, of the same class as this one
and configured with identical creation arguments.</p>
<p>This method is used in conjunction with <a class="reference internal" href="#sqlalchemy.pool.QueuePool.dispose" title="sqlalchemy.pool.QueuePool.dispose"><code class="xref py py-meth docutils literal notranslate"><span class="pre">dispose()</span></code></a>
to close out an entire <a class="reference internal" href="#sqlalchemy.pool.Pool" title="sqlalchemy.pool.Pool"><code class="xref py py-class docutils literal notranslate"><span class="pre">Pool</span></code></a> and create a new one in
its place.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.pool.SingletonThreadPool">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.pool.</span></span><span class="sig-name descname"><span class="pre">SingletonThreadPool</span></span><a class="headerlink" href="#sqlalchemy.pool.SingletonThreadPool" title="Permalink to this definition">¶</a></dt>
<dd><p>A Pool that maintains one connection per thread.</p>
<p>Maintains one connection per each thread, never moving a connection to a
thread other than the one which it was created in.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>the <a class="reference internal" href="#sqlalchemy.pool.SingletonThreadPool" title="sqlalchemy.pool.SingletonThreadPool"><code class="xref py py-class docutils literal notranslate"><span class="pre">SingletonThreadPool</span></code></a> will call <code class="docutils literal notranslate"><span class="pre">.close()</span></code>
on arbitrary connections that exist beyond the size setting of
<code class="docutils literal notranslate"><span class="pre">pool_size</span></code>, e.g. if more unique <strong>thread identities</strong>
than what <code class="docutils literal notranslate"><span class="pre">pool_size</span></code> states are used.   This cleanup is
non-deterministic and not sensitive to whether or not the connections
linked to those thread identities are currently in use.</p>
<p><a class="reference internal" href="#sqlalchemy.pool.SingletonThreadPool" title="sqlalchemy.pool.SingletonThreadPool"><code class="xref py py-class docutils literal notranslate"><span class="pre">SingletonThreadPool</span></code></a> may be improved in a future release,
however in its current status it is generally used only for test
scenarios using a SQLite <code class="docutils literal notranslate"><span class="pre">:memory:</span></code> database and is not recommended
for production use.</p>
</div>
<p>Options are the same as those of <a class="reference internal" href="#sqlalchemy.pool.Pool" title="sqlalchemy.pool.Pool"><code class="xref py py-class docutils literal notranslate"><span class="pre">Pool</span></code></a>, as well as:</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><span class="target" id="sqlalchemy.pool.SingletonThreadPool.params.pool_size"></span><strong>pool_size</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.pool.SingletonThreadPool.params.pool_size">¶</a> – The number of threads in which to maintain connections
at once.  Defaults to five.</p>
</dd>
</dl>
<p><a class="reference internal" href="#sqlalchemy.pool.SingletonThreadPool" title="sqlalchemy.pool.SingletonThreadPool"><code class="xref py py-class docutils literal notranslate"><span class="pre">SingletonThreadPool</span></code></a> is used by the SQLite dialect
automatically when a memory-based database is used.
See <a class="reference internal" href="../dialects/sqlite.html"><span class="std std-ref">SQLite</span></a>.</p>
<div class="class-members docutils container">
<p><strong>Members</strong></p>
<p><a class="reference internal" href="#sqlalchemy.pool.SingletonThreadPool.connect"><span class="sig-name descname">connect()</span></a>, <a class="reference internal" href="#sqlalchemy.pool.SingletonThreadPool.dispose"><span class="sig-name descname">dispose()</span></a>, <a class="reference internal" href="#sqlalchemy.pool.SingletonThreadPool.recreate"><span class="sig-name descname">recreate()</span></a></p>
</div>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.pool.SingletonThreadPool" title="sqlalchemy.pool.SingletonThreadPool"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.pool.SingletonThreadPool</span></code></a> (<a class="reference internal" href="#sqlalchemy.pool.Pool" title="sqlalchemy.pool.base.Pool"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.pool.base.Pool</span></code></a>)</p>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.pool.SingletonThreadPool.connect">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.pool.SingletonThreadPool"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.pool.SingletonThreadPool.</span></code></a><span class="sig-name descname"><span class="pre">connect</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#sqlalchemy.pool.PoolProxiedConnection" title="sqlalchemy.pool.base.PoolProxiedConnection"><span class="pre">PoolProxiedConnection</span></a></span></span><a class="headerlink" href="#sqlalchemy.pool.SingletonThreadPool.connect" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a DBAPI connection from the pool.</p>
<p>The connection is instrumented such that when its
<code class="docutils literal notranslate"><span class="pre">close()</span></code> method is called, the connection will be returned to
the pool.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.pool.SingletonThreadPool.dispose">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.pool.SingletonThreadPool"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.pool.SingletonThreadPool.</span></code></a><span class="sig-name descname"><span class="pre">dispose</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.pool.SingletonThreadPool.dispose" title="Permalink to this definition">¶</a></dt>
<dd><p>Dispose of this pool.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.pool.SingletonThreadPool.recreate">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.pool.SingletonThreadPool"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.pool.SingletonThreadPool.</span></code></a><span class="sig-name descname"><span class="pre">recreate</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#sqlalchemy.pool.SingletonThreadPool" title="sqlalchemy.pool.impl.SingletonThreadPool"><span class="pre">SingletonThreadPool</span></a></span></span><a class="headerlink" href="#sqlalchemy.pool.SingletonThreadPool.recreate" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a new <a class="reference internal" href="#sqlalchemy.pool.Pool" title="sqlalchemy.pool.Pool"><code class="xref py py-class docutils literal notranslate"><span class="pre">Pool</span></code></a>, of the same class as this one
and configured with identical creation arguments.</p>
<p>This method is used in conjunction with <a class="reference internal" href="#sqlalchemy.pool.SingletonThreadPool.dispose" title="sqlalchemy.pool.SingletonThreadPool.dispose"><code class="xref py py-meth docutils literal notranslate"><span class="pre">dispose()</span></code></a>
to close out an entire <a class="reference internal" href="#sqlalchemy.pool.Pool" title="sqlalchemy.pool.Pool"><code class="xref py py-class docutils literal notranslate"><span class="pre">Pool</span></code></a> and create a new one in
its place.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.pool.AssertionPool">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.pool.</span></span><span class="sig-name descname"><span class="pre">AssertionPool</span></span><a class="headerlink" href="#sqlalchemy.pool.AssertionPool" title="Permalink to this definition">¶</a></dt>
<dd><p>A <a class="reference internal" href="#sqlalchemy.pool.Pool" title="sqlalchemy.pool.Pool"><code class="xref py py-class docutils literal notranslate"><span class="pre">Pool</span></code></a> that allows at most one checked out connection at
any given time.</p>
<p>This will raise an exception if more than one connection is checked out
at a time.  Useful for debugging code that is using more connections
than desired.</p>
<div class="class-members docutils container">
<p><strong>Members</strong></p>
<p><a class="reference internal" href="#sqlalchemy.pool.AssertionPool.dispose"><span class="sig-name descname">dispose()</span></a>, <a class="reference internal" href="#sqlalchemy.pool.AssertionPool.recreate"><span class="sig-name descname">recreate()</span></a></p>
</div>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.pool.AssertionPool" title="sqlalchemy.pool.AssertionPool"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.pool.AssertionPool</span></code></a> (<a class="reference internal" href="#sqlalchemy.pool.Pool" title="sqlalchemy.pool.base.Pool"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.pool.base.Pool</span></code></a>)</p>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.pool.AssertionPool.dispose">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.pool.AssertionPool"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.pool.AssertionPool.</span></code></a><span class="sig-name descname"><span class="pre">dispose</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.pool.AssertionPool.dispose" title="Permalink to this definition">¶</a></dt>
<dd><p>Dispose of this pool.</p>
<p>This method leaves the possibility of checked-out connections
remaining open, as it only affects connections that are
idle in the pool.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#sqlalchemy.pool.Pool.recreate" title="sqlalchemy.pool.Pool.recreate"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Pool.recreate()</span></code></a></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.pool.AssertionPool.recreate">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.pool.AssertionPool"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.pool.AssertionPool.</span></code></a><span class="sig-name descname"><span class="pre">recreate</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#sqlalchemy.pool.AssertionPool" title="sqlalchemy.pool.impl.AssertionPool"><span class="pre">AssertionPool</span></a></span></span><a class="headerlink" href="#sqlalchemy.pool.AssertionPool.recreate" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a new <a class="reference internal" href="#sqlalchemy.pool.Pool" title="sqlalchemy.pool.Pool"><code class="xref py py-class docutils literal notranslate"><span class="pre">Pool</span></code></a>, of the same class as this one
and configured with identical creation arguments.</p>
<p>This method is used in conjunction with <a class="reference internal" href="#sqlalchemy.pool.AssertionPool.dispose" title="sqlalchemy.pool.AssertionPool.dispose"><code class="xref py py-meth docutils literal notranslate"><span class="pre">dispose()</span></code></a>
to close out an entire <a class="reference internal" href="#sqlalchemy.pool.Pool" title="sqlalchemy.pool.Pool"><code class="xref py py-class docutils literal notranslate"><span class="pre">Pool</span></code></a> and create a new one in
its place.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.pool.NullPool">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.pool.</span></span><span class="sig-name descname"><span class="pre">NullPool</span></span><a class="headerlink" href="#sqlalchemy.pool.NullPool" title="Permalink to this definition">¶</a></dt>
<dd><p>A Pool which does not pool connections.</p>
<p>Instead it literally opens and closes the underlying DB-API connection
per each connection open/close.</p>
<p>Reconnect-related functions such as <code class="docutils literal notranslate"><span class="pre">recycle</span></code> and connection
invalidation are not supported by this Pool implementation, since
no connections are held persistently.</p>
<div class="class-members docutils container">
<p><strong>Members</strong></p>
<p><a class="reference internal" href="#sqlalchemy.pool.NullPool.dispose"><span class="sig-name descname">dispose()</span></a>, <a class="reference internal" href="#sqlalchemy.pool.NullPool.recreate"><span class="sig-name descname">recreate()</span></a></p>
</div>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.pool.NullPool" title="sqlalchemy.pool.NullPool"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.pool.NullPool</span></code></a> (<a class="reference internal" href="#sqlalchemy.pool.Pool" title="sqlalchemy.pool.base.Pool"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.pool.base.Pool</span></code></a>)</p>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.pool.NullPool.dispose">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.pool.NullPool"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.pool.NullPool.</span></code></a><span class="sig-name descname"><span class="pre">dispose</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.pool.NullPool.dispose" title="Permalink to this definition">¶</a></dt>
<dd><p>Dispose of this pool.</p>
<p>This method leaves the possibility of checked-out connections
remaining open, as it only affects connections that are
idle in the pool.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#sqlalchemy.pool.Pool.recreate" title="sqlalchemy.pool.Pool.recreate"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Pool.recreate()</span></code></a></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.pool.NullPool.recreate">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.pool.NullPool"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.pool.NullPool.</span></code></a><span class="sig-name descname"><span class="pre">recreate</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#sqlalchemy.pool.NullPool" title="sqlalchemy.pool.impl.NullPool"><span class="pre">NullPool</span></a></span></span><a class="headerlink" href="#sqlalchemy.pool.NullPool.recreate" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a new <a class="reference internal" href="#sqlalchemy.pool.Pool" title="sqlalchemy.pool.Pool"><code class="xref py py-class docutils literal notranslate"><span class="pre">Pool</span></code></a>, of the same class as this one
and configured with identical creation arguments.</p>
<p>This method is used in conjunction with <a class="reference internal" href="#sqlalchemy.pool.NullPool.dispose" title="sqlalchemy.pool.NullPool.dispose"><code class="xref py py-meth docutils literal notranslate"><span class="pre">dispose()</span></code></a>
to close out an entire <a class="reference internal" href="#sqlalchemy.pool.Pool" title="sqlalchemy.pool.Pool"><code class="xref py py-class docutils literal notranslate"><span class="pre">Pool</span></code></a> and create a new one in
its place.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.pool.StaticPool">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.pool.</span></span><span class="sig-name descname"><span class="pre">StaticPool</span></span><a class="headerlink" href="#sqlalchemy.pool.StaticPool" title="Permalink to this definition">¶</a></dt>
<dd><p>A Pool of exactly one connection, used for all requests.</p>
<p>Reconnect-related functions such as <code class="docutils literal notranslate"><span class="pre">recycle</span></code> and connection
invalidation (which is also used to support auto-reconnect) are only
partially supported right now and may not yield good results.</p>
<div class="class-members docutils container">
<p><strong>Members</strong></p>
<p><a class="reference internal" href="#sqlalchemy.pool.StaticPool.dispose"><span class="sig-name descname">dispose()</span></a>, <a class="reference internal" href="#sqlalchemy.pool.StaticPool.recreate"><span class="sig-name descname">recreate()</span></a></p>
</div>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.pool.StaticPool" title="sqlalchemy.pool.StaticPool"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.pool.StaticPool</span></code></a> (<a class="reference internal" href="#sqlalchemy.pool.Pool" title="sqlalchemy.pool.base.Pool"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.pool.base.Pool</span></code></a>)</p>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.pool.StaticPool.dispose">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.pool.StaticPool"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.pool.StaticPool.</span></code></a><span class="sig-name descname"><span class="pre">dispose</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.pool.StaticPool.dispose" title="Permalink to this definition">¶</a></dt>
<dd><p>Dispose of this pool.</p>
<p>This method leaves the possibility of checked-out connections
remaining open, as it only affects connections that are
idle in the pool.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#sqlalchemy.pool.Pool.recreate" title="sqlalchemy.pool.Pool.recreate"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Pool.recreate()</span></code></a></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.pool.StaticPool.recreate">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.pool.StaticPool"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.pool.StaticPool.</span></code></a><span class="sig-name descname"><span class="pre">recreate</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#sqlalchemy.pool.StaticPool" title="sqlalchemy.pool.impl.StaticPool"><span class="pre">StaticPool</span></a></span></span><a class="headerlink" href="#sqlalchemy.pool.StaticPool.recreate" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a new <a class="reference internal" href="#sqlalchemy.pool.Pool" title="sqlalchemy.pool.Pool"><code class="xref py py-class docutils literal notranslate"><span class="pre">Pool</span></code></a>, of the same class as this one
and configured with identical creation arguments.</p>
<p>This method is used in conjunction with <a class="reference internal" href="#sqlalchemy.pool.StaticPool.dispose" title="sqlalchemy.pool.StaticPool.dispose"><code class="xref py py-meth docutils literal notranslate"><span class="pre">dispose()</span></code></a>
to close out an entire <a class="reference internal" href="#sqlalchemy.pool.Pool" title="sqlalchemy.pool.Pool"><code class="xref py py-class docutils literal notranslate"><span class="pre">Pool</span></code></a> and create a new one in
its place.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.pool.ManagesConnection">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.pool.</span></span><span class="sig-name descname"><span class="pre">ManagesConnection</span></span><a class="headerlink" href="#sqlalchemy.pool.ManagesConnection" title="Permalink to this definition">¶</a></dt>
<dd><p>Common base for the two connection-management interfaces
<a class="reference internal" href="#sqlalchemy.pool.PoolProxiedConnection" title="sqlalchemy.pool.PoolProxiedConnection"><code class="xref py py-class docutils literal notranslate"><span class="pre">PoolProxiedConnection</span></code></a> and <a class="reference internal" href="#sqlalchemy.pool.ConnectionPoolEntry" title="sqlalchemy.pool.ConnectionPoolEntry"><code class="xref py py-class docutils literal notranslate"><span class="pre">ConnectionPoolEntry</span></code></a>.</p>
<p>These two objects are typically exposed in the public facing API
via the connection pool event hooks, documented at <a class="reference internal" href="events.html#sqlalchemy.events.PoolEvents" title="sqlalchemy.events.PoolEvents"><code class="xref py py-class docutils literal notranslate"><span class="pre">PoolEvents</span></code></a>.</p>
<div class="class-members docutils container">
<p><strong>Members</strong></p>
<p><a class="reference internal" href="#sqlalchemy.pool.ManagesConnection.dbapi_connection"><span class="sig-name descname">dbapi_connection</span></a>, <a class="reference internal" href="#sqlalchemy.pool.ManagesConnection.driver_connection"><span class="sig-name descname">driver_connection</span></a>, <a class="reference internal" href="#sqlalchemy.pool.ManagesConnection.info"><span class="sig-name descname">info</span></a>, <a class="reference internal" href="#sqlalchemy.pool.ManagesConnection.invalidate"><span class="sig-name descname">invalidate()</span></a>, <a class="reference internal" href="#sqlalchemy.pool.ManagesConnection.record_info"><span class="sig-name descname">record_info</span></a></p>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 2.0.</span></p>
</div>
<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.pool.ManagesConnection.dbapi_connection">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.pool.ManagesConnection"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.pool.ManagesConnection.</span></code></a><span class="sig-name descname"><span class="pre">dbapi_connection</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference internal" href="internals.html#sqlalchemy.engine.interfaces.DBAPIConnection" title="sqlalchemy.engine.interfaces.DBAPIConnection"><span class="pre">DBAPIConnection</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></em><a class="headerlink" href="#sqlalchemy.pool.ManagesConnection.dbapi_connection" title="Permalink to this definition">¶</a></dt>
<dd><p>A reference to the actual DBAPI connection being tracked.</p>
<p>This is a <span class="target" id="index-0"></span><a class="pep reference external" href="https://peps.python.org/pep-0249/"><strong>PEP 249</strong></a>-compliant object that for traditional sync-style
dialects is provided by the third-party
DBAPI implementation in use.  For asyncio dialects, the implementation
is typically an adapter object provided by the SQLAlchemy dialect
itself; the underlying asyncio object is available via the
<a class="reference internal" href="#sqlalchemy.pool.ManagesConnection.driver_connection" title="sqlalchemy.pool.ManagesConnection.driver_connection"><code class="xref py py-attr docutils literal notranslate"><span class="pre">ManagesConnection.driver_connection</span></code></a> attribute.</p>
<p>SQLAlchemy’s interface for the DBAPI connection is based on the
<a class="reference internal" href="internals.html#sqlalchemy.engine.interfaces.DBAPIConnection" title="sqlalchemy.engine.interfaces.DBAPIConnection"><code class="xref py py-class docutils literal notranslate"><span class="pre">DBAPIConnection</span></code></a> protocol object</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#sqlalchemy.pool.ManagesConnection.driver_connection" title="sqlalchemy.pool.ManagesConnection.driver_connection"><code class="xref py py-attr docutils literal notranslate"><span class="pre">ManagesConnection.driver_connection</span></code></a></p>
<p><a class="reference internal" href="../faq/connections.html#faq-dbapi-connection"><span class="std std-ref">使用Engine时如何获取原始的DBAPI连接？</span></a></p>
</div>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.pool.ManagesConnection.driver_connection">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.pool.ManagesConnection"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.pool.ManagesConnection.</span></code></a><span class="sig-name descname"><span class="pre">driver_connection</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">Any</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></em><a class="headerlink" href="#sqlalchemy.pool.ManagesConnection.driver_connection" title="Permalink to this definition">¶</a></dt>
<dd><p>The “driver level” connection object as used by the Python
DBAPI or database driver.</p>
<p>For traditional <span class="target" id="index-1"></span><a class="pep reference external" href="https://peps.python.org/pep-0249/"><strong>PEP 249</strong></a> DBAPI implementations, this object will
be the same object as that of
<a class="reference internal" href="#sqlalchemy.pool.ManagesConnection.dbapi_connection" title="sqlalchemy.pool.ManagesConnection.dbapi_connection"><code class="xref py py-attr docutils literal notranslate"><span class="pre">ManagesConnection.dbapi_connection</span></code></a>.   For an asyncio database
driver, this will be the ultimate “connection” object used by that
driver, such as the <code class="docutils literal notranslate"><span class="pre">asyncpg.Connection</span></code> object which will not have
standard pep-249 methods.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.4.24.</span></p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#sqlalchemy.pool.ManagesConnection.dbapi_connection" title="sqlalchemy.pool.ManagesConnection.dbapi_connection"><code class="xref py py-attr docutils literal notranslate"><span class="pre">ManagesConnection.dbapi_connection</span></code></a></p>
<p><a class="reference internal" href="../faq/connections.html#faq-dbapi-connection"><span class="std std-ref">使用Engine时如何获取原始的DBAPI连接？</span></a></p>
</div>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.pool.ManagesConnection.info">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.pool.ManagesConnection"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.pool.ManagesConnection.</span></code></a><span class="sig-name descname"><span class="pre">info</span></span><a class="headerlink" href="#sqlalchemy.pool.ManagesConnection.info" title="Permalink to this definition">¶</a></dt>
<dd><p>Info dictionary associated with the underlying DBAPI connection
referred to by this <a class="reference internal" href="#sqlalchemy.pool.ManagesConnection" title="sqlalchemy.pool.ManagesConnection"><code class="xref py py-class docutils literal notranslate"><span class="pre">ManagesConnection</span></code></a> instance, allowing
user-defined data to be associated with the connection.</p>
<p>The data in this dictionary is persistent for the lifespan
of the DBAPI connection itself, including across pool checkins
and checkouts.  When the connection is invalidated
and replaced with a new one, this dictionary is cleared.</p>
<p>For a <a class="reference internal" href="#sqlalchemy.pool.PoolProxiedConnection" title="sqlalchemy.pool.PoolProxiedConnection"><code class="xref py py-class docutils literal notranslate"><span class="pre">PoolProxiedConnection</span></code></a> instance that’s not associated
with a <a class="reference internal" href="#sqlalchemy.pool.ConnectionPoolEntry" title="sqlalchemy.pool.ConnectionPoolEntry"><code class="xref py py-class docutils literal notranslate"><span class="pre">ConnectionPoolEntry</span></code></a>, such as if it were detached, the
attribute returns a dictionary that is local to that
<a class="reference internal" href="#sqlalchemy.pool.ConnectionPoolEntry" title="sqlalchemy.pool.ConnectionPoolEntry"><code class="xref py py-class docutils literal notranslate"><span class="pre">ConnectionPoolEntry</span></code></a>. Therefore the
<a class="reference internal" href="#sqlalchemy.pool.ManagesConnection.info" title="sqlalchemy.pool.ManagesConnection.info"><code class="xref py py-attr docutils literal notranslate"><span class="pre">ManagesConnection.info</span></code></a> attribute will always provide a Python
dictionary.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#sqlalchemy.pool.ManagesConnection.record_info" title="sqlalchemy.pool.ManagesConnection.record_info"><code class="xref py py-attr docutils literal notranslate"><span class="pre">ManagesConnection.record_info</span></code></a></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.pool.ManagesConnection.invalidate">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.pool.ManagesConnection"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.pool.ManagesConnection.</span></code></a><span class="sig-name descname"><span class="pre">invalidate</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">e</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">BaseException</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">soft</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.pool.ManagesConnection.invalidate" title="Permalink to this definition">¶</a></dt>
<dd><p>Mark the managed connection as invalidated.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.pool.ManagesConnection.invalidate.params.e"></span><strong>e</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.pool.ManagesConnection.invalidate.params.e">¶</a> – an exception object indicating a reason for the invalidation.</p></li>
<li><p><span class="target" id="sqlalchemy.pool.ManagesConnection.invalidate.params.soft"></span><strong>soft</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.pool.ManagesConnection.invalidate.params.soft">¶</a> – if True, the connection isn’t closed; instead, this
connection will be recycled on next checkout.</p></li>
</ul>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#pool-connection-invalidation"><span class="std std-ref">关于无效化的更多信息</span></a></p>
</div>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.pool.ManagesConnection.record_info">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.pool.ManagesConnection"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.pool.ManagesConnection.</span></code></a><span class="sig-name descname"><span class="pre">record_info</span></span><a class="headerlink" href="#sqlalchemy.pool.ManagesConnection.record_info" title="Permalink to this definition">¶</a></dt>
<dd><p>Persistent info dictionary associated with this
<a class="reference internal" href="#sqlalchemy.pool.ManagesConnection" title="sqlalchemy.pool.ManagesConnection"><code class="xref py py-class docutils literal notranslate"><span class="pre">ManagesConnection</span></code></a>.</p>
<p>Unlike the <a class="reference internal" href="#sqlalchemy.pool.ManagesConnection.info" title="sqlalchemy.pool.ManagesConnection.info"><code class="xref py py-attr docutils literal notranslate"><span class="pre">ManagesConnection.info</span></code></a> dictionary, the lifespan
of this dictionary is that of the <a class="reference internal" href="#sqlalchemy.pool.ConnectionPoolEntry" title="sqlalchemy.pool.ConnectionPoolEntry"><code class="xref py py-class docutils literal notranslate"><span class="pre">ConnectionPoolEntry</span></code></a>
which owns it; therefore this dictionary will persist across
reconnects and connection invalidation for a particular entry
in the connection pool.</p>
<p>For a <a class="reference internal" href="#sqlalchemy.pool.PoolProxiedConnection" title="sqlalchemy.pool.PoolProxiedConnection"><code class="xref py py-class docutils literal notranslate"><span class="pre">PoolProxiedConnection</span></code></a> instance that’s not associated
with a <a class="reference internal" href="#sqlalchemy.pool.ConnectionPoolEntry" title="sqlalchemy.pool.ConnectionPoolEntry"><code class="xref py py-class docutils literal notranslate"><span class="pre">ConnectionPoolEntry</span></code></a>, such as if it were detached, the
attribute returns None. Contrast to the <a class="reference internal" href="#sqlalchemy.pool.ManagesConnection.info" title="sqlalchemy.pool.ManagesConnection.info"><code class="xref py py-attr docutils literal notranslate"><span class="pre">ManagesConnection.info</span></code></a>
dictionary which is never None.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#sqlalchemy.pool.ManagesConnection.info" title="sqlalchemy.pool.ManagesConnection.info"><code class="xref py py-attr docutils literal notranslate"><span class="pre">ManagesConnection.info</span></code></a></p>
</div>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.pool.ConnectionPoolEntry">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.pool.</span></span><span class="sig-name descname"><span class="pre">ConnectionPoolEntry</span></span><a class="headerlink" href="#sqlalchemy.pool.ConnectionPoolEntry" title="Permalink to this definition">¶</a></dt>
<dd><p>Interface for the object that maintains an individual database
connection on behalf of a <a class="reference internal" href="#sqlalchemy.pool.Pool" title="sqlalchemy.pool.Pool"><code class="xref py py-class docutils literal notranslate"><span class="pre">Pool</span></code></a> instance.</p>
<p>The <a class="reference internal" href="#sqlalchemy.pool.ConnectionPoolEntry" title="sqlalchemy.pool.ConnectionPoolEntry"><code class="xref py py-class docutils literal notranslate"><span class="pre">ConnectionPoolEntry</span></code></a> object represents the long term
maintainance of a particular connection for a pool, including expiring or
invalidating that connection to have it replaced with a new one, which will
continue to be maintained by that same <a class="reference internal" href="#sqlalchemy.pool.ConnectionPoolEntry" title="sqlalchemy.pool.ConnectionPoolEntry"><code class="xref py py-class docutils literal notranslate"><span class="pre">ConnectionPoolEntry</span></code></a>
instance. Compared to <a class="reference internal" href="#sqlalchemy.pool.PoolProxiedConnection" title="sqlalchemy.pool.PoolProxiedConnection"><code class="xref py py-class docutils literal notranslate"><span class="pre">PoolProxiedConnection</span></code></a>, which is the
short-term, per-checkout connection manager, this object lasts for the
lifespan of a particular “slot” within a connection pool.</p>
<p>The <a class="reference internal" href="#sqlalchemy.pool.ConnectionPoolEntry" title="sqlalchemy.pool.ConnectionPoolEntry"><code class="xref py py-class docutils literal notranslate"><span class="pre">ConnectionPoolEntry</span></code></a> object is mostly visible to public-facing
API code when it is delivered to connection pool event hooks, such as
<a class="reference internal" href="events.html#sqlalchemy.events.PoolEvents.connect" title="sqlalchemy.events.PoolEvents.connect"><code class="xref py py-meth docutils literal notranslate"><span class="pre">PoolEvents.connect()</span></code></a> and <a class="reference internal" href="events.html#sqlalchemy.events.PoolEvents.checkout" title="sqlalchemy.events.PoolEvents.checkout"><code class="xref py py-meth docutils literal notranslate"><span class="pre">PoolEvents.checkout()</span></code></a>.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 2.0: </span><a class="reference internal" href="#sqlalchemy.pool.ConnectionPoolEntry" title="sqlalchemy.pool.ConnectionPoolEntry"><code class="xref py py-class docutils literal notranslate"><span class="pre">ConnectionPoolEntry</span></code></a> provides the public
facing interface for the <a class="reference internal" href="#sqlalchemy.pool._ConnectionRecord" title="sqlalchemy.pool._ConnectionRecord"><code class="xref py py-class docutils literal notranslate"><span class="pre">_ConnectionRecord</span></code></a> internal class.</p>
</div>
<div class="class-members docutils container">
<p><strong>Members</strong></p>
<p><a class="reference internal" href="#sqlalchemy.pool.ConnectionPoolEntry.close"><span class="sig-name descname">close()</span></a>, <a class="reference internal" href="#sqlalchemy.pool.ConnectionPoolEntry.dbapi_connection"><span class="sig-name descname">dbapi_connection</span></a>, <a class="reference internal" href="#sqlalchemy.pool.ConnectionPoolEntry.driver_connection"><span class="sig-name descname">driver_connection</span></a>, <a class="reference internal" href="#sqlalchemy.pool.ConnectionPoolEntry.in_use"><span class="sig-name descname">in_use</span></a>, <a class="reference internal" href="#sqlalchemy.pool.ConnectionPoolEntry.info"><span class="sig-name descname">info</span></a>, <a class="reference internal" href="#sqlalchemy.pool.ConnectionPoolEntry.invalidate"><span class="sig-name descname">invalidate()</span></a>, <a class="reference internal" href="#sqlalchemy.pool.ConnectionPoolEntry.record_info"><span class="sig-name descname">record_info</span></a></p>
</div>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.pool.ConnectionPoolEntry" title="sqlalchemy.pool.ConnectionPoolEntry"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.pool.ConnectionPoolEntry</span></code></a> (<a class="reference internal" href="#sqlalchemy.pool.ManagesConnection" title="sqlalchemy.pool.base.ManagesConnection"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.pool.base.ManagesConnection</span></code></a>)</p>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.pool.ConnectionPoolEntry.close">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.pool.ConnectionPoolEntry"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.pool.ConnectionPoolEntry.</span></code></a><span class="sig-name descname"><span class="pre">close</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.pool.ConnectionPoolEntry.close" title="Permalink to this definition">¶</a></dt>
<dd><p>Close the DBAPI connection managed by this connection pool entry.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.pool.ConnectionPoolEntry.dbapi_connection">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.pool.ConnectionPoolEntry"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.pool.ConnectionPoolEntry.</span></code></a><span class="sig-name descname"><span class="pre">dbapi_connection</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference internal" href="internals.html#sqlalchemy.engine.interfaces.DBAPIConnection" title="sqlalchemy.engine.interfaces.DBAPIConnection"><span class="pre">DBAPIConnection</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></em><a class="headerlink" href="#sqlalchemy.pool.ConnectionPoolEntry.dbapi_connection" title="Permalink to this definition">¶</a></dt>
<dd><p>A reference to the actual DBAPI connection being tracked.</p>
<p>This is a <span class="target" id="index-2"></span><a class="pep reference external" href="https://peps.python.org/pep-0249/"><strong>PEP 249</strong></a>-compliant object that for traditional sync-style
dialects is provided by the third-party
DBAPI implementation in use.  For asyncio dialects, the implementation
is typically an adapter object provided by the SQLAlchemy dialect
itself; the underlying asyncio object is available via the
<a class="reference internal" href="#sqlalchemy.pool.ManagesConnection.driver_connection" title="sqlalchemy.pool.ManagesConnection.driver_connection"><code class="xref py py-attr docutils literal notranslate"><span class="pre">ManagesConnection.driver_connection</span></code></a> attribute.</p>
<p>SQLAlchemy’s interface for the DBAPI connection is based on the
<a class="reference internal" href="internals.html#sqlalchemy.engine.interfaces.DBAPIConnection" title="sqlalchemy.engine.interfaces.DBAPIConnection"><code class="xref py py-class docutils literal notranslate"><span class="pre">DBAPIConnection</span></code></a> protocol object</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#sqlalchemy.pool.ManagesConnection.driver_connection" title="sqlalchemy.pool.ManagesConnection.driver_connection"><code class="xref py py-attr docutils literal notranslate"><span class="pre">ManagesConnection.driver_connection</span></code></a></p>
<p><a class="reference internal" href="../faq/connections.html#faq-dbapi-connection"><span class="std std-ref">使用Engine时如何获取原始的DBAPI连接？</span></a></p>
</div>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.pool.ConnectionPoolEntry.driver_connection">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.pool.ConnectionPoolEntry"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.pool.ConnectionPoolEntry.</span></code></a><span class="sig-name descname"><span class="pre">driver_connection</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">Any</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></em><a class="headerlink" href="#sqlalchemy.pool.ConnectionPoolEntry.driver_connection" title="Permalink to this definition">¶</a></dt>
<dd><p>The “driver level” connection object as used by the Python
DBAPI or database driver.</p>
<p>For traditional <span class="target" id="index-3"></span><a class="pep reference external" href="https://peps.python.org/pep-0249/"><strong>PEP 249</strong></a> DBAPI implementations, this object will
be the same object as that of
<a class="reference internal" href="#sqlalchemy.pool.ManagesConnection.dbapi_connection" title="sqlalchemy.pool.ManagesConnection.dbapi_connection"><code class="xref py py-attr docutils literal notranslate"><span class="pre">ManagesConnection.dbapi_connection</span></code></a>.   For an asyncio database
driver, this will be the ultimate “connection” object used by that
driver, such as the <code class="docutils literal notranslate"><span class="pre">asyncpg.Connection</span></code> object which will not have
standard pep-249 methods.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.4.24.</span></p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#sqlalchemy.pool.ManagesConnection.dbapi_connection" title="sqlalchemy.pool.ManagesConnection.dbapi_connection"><code class="xref py py-attr docutils literal notranslate"><span class="pre">ManagesConnection.dbapi_connection</span></code></a></p>
<p><a class="reference internal" href="../faq/connections.html#faq-dbapi-connection"><span class="std std-ref">使用Engine时如何获取原始的DBAPI连接？</span></a></p>
</div>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.pool.ConnectionPoolEntry.in_use">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.pool.ConnectionPoolEntry"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.pool.ConnectionPoolEntry.</span></code></a><span class="sig-name descname"><span class="pre">in_use</span></span><a class="headerlink" href="#sqlalchemy.pool.ConnectionPoolEntry.in_use" title="Permalink to this definition">¶</a></dt>
<dd><p>Return True the connection is currently checked out</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.pool.ConnectionPoolEntry.info">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.pool.ConnectionPoolEntry"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.pool.ConnectionPoolEntry.</span></code></a><span class="sig-name descname"><span class="pre">info</span></span><a class="headerlink" href="#sqlalchemy.pool.ConnectionPoolEntry.info" title="Permalink to this definition">¶</a></dt>
<dd><div class="inherited-member docutils container">
<p><em>inherited from the</em> <code class="xref py py-attr docutils literal notranslate"><span class="pre">ManagesConnection.info</span></code> <em>attribute of</em> <a class="reference internal" href="#sqlalchemy.pool.ManagesConnection" title="sqlalchemy.pool.base.ManagesConnection"><code class="xref py py-class docutils literal notranslate"><span class="pre">ManagesConnection</span></code></a></p>
</div>
<p>Info dictionary associated with the underlying DBAPI connection
referred to by this <a class="reference internal" href="#sqlalchemy.pool.ManagesConnection" title="sqlalchemy.pool.ManagesConnection"><code class="xref py py-class docutils literal notranslate"><span class="pre">ManagesConnection</span></code></a> instance, allowing
user-defined data to be associated with the connection.</p>
<p>The data in this dictionary is persistent for the lifespan
of the DBAPI connection itself, including across pool checkins
and checkouts.  When the connection is invalidated
and replaced with a new one, this dictionary is cleared.</p>
<p>For a <a class="reference internal" href="#sqlalchemy.pool.PoolProxiedConnection" title="sqlalchemy.pool.PoolProxiedConnection"><code class="xref py py-class docutils literal notranslate"><span class="pre">PoolProxiedConnection</span></code></a> instance that’s not associated
with a <a class="reference internal" href="#sqlalchemy.pool.ConnectionPoolEntry" title="sqlalchemy.pool.ConnectionPoolEntry"><code class="xref py py-class docutils literal notranslate"><span class="pre">ConnectionPoolEntry</span></code></a>, such as if it were detached, the
attribute returns a dictionary that is local to that
<a class="reference internal" href="#sqlalchemy.pool.ConnectionPoolEntry" title="sqlalchemy.pool.ConnectionPoolEntry"><code class="xref py py-class docutils literal notranslate"><span class="pre">ConnectionPoolEntry</span></code></a>. Therefore the
<a class="reference internal" href="#sqlalchemy.pool.ManagesConnection.info" title="sqlalchemy.pool.ManagesConnection.info"><code class="xref py py-attr docutils literal notranslate"><span class="pre">ManagesConnection.info</span></code></a> attribute will always provide a Python
dictionary.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#sqlalchemy.pool.ManagesConnection.record_info" title="sqlalchemy.pool.ManagesConnection.record_info"><code class="xref py py-attr docutils literal notranslate"><span class="pre">ManagesConnection.record_info</span></code></a></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.pool.ConnectionPoolEntry.invalidate">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.pool.ConnectionPoolEntry"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.pool.ConnectionPoolEntry.</span></code></a><span class="sig-name descname"><span class="pre">invalidate</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">e</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">BaseException</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">soft</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.pool.ConnectionPoolEntry.invalidate" title="Permalink to this definition">¶</a></dt>
<dd><div class="inherited-member docutils container">
<p><em>inherited from the</em> <code class="xref py py-meth docutils literal notranslate"><span class="pre">ManagesConnection.invalidate()</span></code> <em>method of</em> <a class="reference internal" href="#sqlalchemy.pool.ManagesConnection" title="sqlalchemy.pool.base.ManagesConnection"><code class="xref py py-class docutils literal notranslate"><span class="pre">ManagesConnection</span></code></a></p>
</div>
<p>Mark the managed connection as invalidated.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.pool.ConnectionPoolEntry.invalidate.params.e"></span><strong>e</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.pool.ConnectionPoolEntry.invalidate.params.e">¶</a> – an exception object indicating a reason for the invalidation.</p></li>
<li><p><span class="target" id="sqlalchemy.pool.ConnectionPoolEntry.invalidate.params.soft"></span><strong>soft</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.pool.ConnectionPoolEntry.invalidate.params.soft">¶</a> – if True, the connection isn’t closed; instead, this
connection will be recycled on next checkout.</p></li>
</ul>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#pool-connection-invalidation"><span class="std std-ref">关于无效化的更多信息</span></a></p>
</div>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.pool.ConnectionPoolEntry.record_info">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.pool.ConnectionPoolEntry"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.pool.ConnectionPoolEntry.</span></code></a><span class="sig-name descname"><span class="pre">record_info</span></span><a class="headerlink" href="#sqlalchemy.pool.ConnectionPoolEntry.record_info" title="Permalink to this definition">¶</a></dt>
<dd><div class="inherited-member docutils container">
<p><em>inherited from the</em> <code class="xref py py-attr docutils literal notranslate"><span class="pre">ManagesConnection.record_info</span></code> <em>attribute of</em> <a class="reference internal" href="#sqlalchemy.pool.ManagesConnection" title="sqlalchemy.pool.base.ManagesConnection"><code class="xref py py-class docutils literal notranslate"><span class="pre">ManagesConnection</span></code></a></p>
</div>
<p>Persistent info dictionary associated with this
<a class="reference internal" href="#sqlalchemy.pool.ManagesConnection" title="sqlalchemy.pool.ManagesConnection"><code class="xref py py-class docutils literal notranslate"><span class="pre">ManagesConnection</span></code></a>.</p>
<p>Unlike the <a class="reference internal" href="#sqlalchemy.pool.ManagesConnection.info" title="sqlalchemy.pool.ManagesConnection.info"><code class="xref py py-attr docutils literal notranslate"><span class="pre">ManagesConnection.info</span></code></a> dictionary, the lifespan
of this dictionary is that of the <a class="reference internal" href="#sqlalchemy.pool.ConnectionPoolEntry" title="sqlalchemy.pool.ConnectionPoolEntry"><code class="xref py py-class docutils literal notranslate"><span class="pre">ConnectionPoolEntry</span></code></a>
which owns it; therefore this dictionary will persist across
reconnects and connection invalidation for a particular entry
in the connection pool.</p>
<p>For a <a class="reference internal" href="#sqlalchemy.pool.PoolProxiedConnection" title="sqlalchemy.pool.PoolProxiedConnection"><code class="xref py py-class docutils literal notranslate"><span class="pre">PoolProxiedConnection</span></code></a> instance that’s not associated
with a <a class="reference internal" href="#sqlalchemy.pool.ConnectionPoolEntry" title="sqlalchemy.pool.ConnectionPoolEntry"><code class="xref py py-class docutils literal notranslate"><span class="pre">ConnectionPoolEntry</span></code></a>, such as if it were detached, the
attribute returns None. Contrast to the <a class="reference internal" href="#sqlalchemy.pool.ManagesConnection.info" title="sqlalchemy.pool.ManagesConnection.info"><code class="xref py py-attr docutils literal notranslate"><span class="pre">ManagesConnection.info</span></code></a>
dictionary which is never None.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#sqlalchemy.pool.ManagesConnection.info" title="sqlalchemy.pool.ManagesConnection.info"><code class="xref py py-attr docutils literal notranslate"><span class="pre">ManagesConnection.info</span></code></a></p>
</div>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.pool.PoolProxiedConnection">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.pool.</span></span><span class="sig-name descname"><span class="pre">PoolProxiedConnection</span></span><a class="headerlink" href="#sqlalchemy.pool.PoolProxiedConnection" title="Permalink to this definition">¶</a></dt>
<dd><p>A connection-like adapter for a <span class="target" id="index-4"></span><a class="pep reference external" href="https://peps.python.org/pep-0249/"><strong>PEP 249</strong></a> DBAPI connection, which
includes additional methods specific to the <a class="reference internal" href="#sqlalchemy.pool.Pool" title="sqlalchemy.pool.Pool"><code class="xref py py-class docutils literal notranslate"><span class="pre">Pool</span></code></a> implementation.</p>
<p><a class="reference internal" href="#sqlalchemy.pool.PoolProxiedConnection" title="sqlalchemy.pool.PoolProxiedConnection"><code class="xref py py-class docutils literal notranslate"><span class="pre">PoolProxiedConnection</span></code></a> is the public-facing interface for the
internal <a class="reference internal" href="#sqlalchemy.pool._ConnectionFairy" title="sqlalchemy.pool._ConnectionFairy"><code class="xref py py-class docutils literal notranslate"><span class="pre">_ConnectionFairy</span></code></a> implementation object; users familiar
with <a class="reference internal" href="#sqlalchemy.pool._ConnectionFairy" title="sqlalchemy.pool._ConnectionFairy"><code class="xref py py-class docutils literal notranslate"><span class="pre">_ConnectionFairy</span></code></a> can consider this object to be equivalent.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 2.0: </span><a class="reference internal" href="#sqlalchemy.pool.PoolProxiedConnection" title="sqlalchemy.pool.PoolProxiedConnection"><code class="xref py py-class docutils literal notranslate"><span class="pre">PoolProxiedConnection</span></code></a> provides the public-
facing interface for the <a class="reference internal" href="#sqlalchemy.pool._ConnectionFairy" title="sqlalchemy.pool._ConnectionFairy"><code class="xref py py-class docutils literal notranslate"><span class="pre">_ConnectionFairy</span></code></a> internal class.</p>
</div>
<div class="class-members docutils container">
<p><strong>Members</strong></p>
<p><a class="reference internal" href="#sqlalchemy.pool.PoolProxiedConnection.close"><span class="sig-name descname">close()</span></a>, <a class="reference internal" href="#sqlalchemy.pool.PoolProxiedConnection.dbapi_connection"><span class="sig-name descname">dbapi_connection</span></a>, <a class="reference internal" href="#sqlalchemy.pool.PoolProxiedConnection.detach"><span class="sig-name descname">detach()</span></a>, <a class="reference internal" href="#sqlalchemy.pool.PoolProxiedConnection.driver_connection"><span class="sig-name descname">driver_connection</span></a>, <a class="reference internal" href="#sqlalchemy.pool.PoolProxiedConnection.info"><span class="sig-name descname">info</span></a>, <a class="reference internal" href="#sqlalchemy.pool.PoolProxiedConnection.invalidate"><span class="sig-name descname">invalidate()</span></a>, <a class="reference internal" href="#sqlalchemy.pool.PoolProxiedConnection.is_detached"><span class="sig-name descname">is_detached</span></a>, <a class="reference internal" href="#sqlalchemy.pool.PoolProxiedConnection.is_valid"><span class="sig-name descname">is_valid</span></a>, <a class="reference internal" href="#sqlalchemy.pool.PoolProxiedConnection.record_info"><span class="sig-name descname">record_info</span></a></p>
</div>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.pool.PoolProxiedConnection" title="sqlalchemy.pool.PoolProxiedConnection"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.pool.PoolProxiedConnection</span></code></a> (<a class="reference internal" href="#sqlalchemy.pool.ManagesConnection" title="sqlalchemy.pool.base.ManagesConnection"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.pool.base.ManagesConnection</span></code></a>)</p>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.pool.PoolProxiedConnection.close">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.pool.PoolProxiedConnection"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.pool.PoolProxiedConnection.</span></code></a><span class="sig-name descname"><span class="pre">close</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.pool.PoolProxiedConnection.close" title="Permalink to this definition">¶</a></dt>
<dd><p>Release this connection back to the pool.</p>
<p>The <a class="reference internal" href="#sqlalchemy.pool.PoolProxiedConnection.close" title="sqlalchemy.pool.PoolProxiedConnection.close"><code class="xref py py-meth docutils literal notranslate"><span class="pre">PoolProxiedConnection.close()</span></code></a> method shadows the
<span class="target" id="index-5"></span><a class="pep reference external" href="https://peps.python.org/pep-0249/"><strong>PEP 249</strong></a> <code class="docutils literal notranslate"><span class="pre">.close()</span></code> method, altering its behavior to instead
<span class="xref std std-term">release</span> the proxied connection back to the connection pool.</p>
<p>Upon release to the pool, whether the connection stays “opened” and
pooled in the Python process, versus actually closed out and removed
from the Python process, is based on the pool implementation in use and
its configuration and current state.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.pool.PoolProxiedConnection.dbapi_connection">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.pool.PoolProxiedConnection"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.pool.PoolProxiedConnection.</span></code></a><span class="sig-name descname"><span class="pre">dbapi_connection</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference internal" href="internals.html#sqlalchemy.engine.interfaces.DBAPIConnection" title="sqlalchemy.engine.interfaces.DBAPIConnection"><span class="pre">DBAPIConnection</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></em><a class="headerlink" href="#sqlalchemy.pool.PoolProxiedConnection.dbapi_connection" title="Permalink to this definition">¶</a></dt>
<dd><p>A reference to the actual DBAPI connection being tracked.</p>
<p>This is a <span class="target" id="index-6"></span><a class="pep reference external" href="https://peps.python.org/pep-0249/"><strong>PEP 249</strong></a>-compliant object that for traditional sync-style
dialects is provided by the third-party
DBAPI implementation in use.  For asyncio dialects, the implementation
is typically an adapter object provided by the SQLAlchemy dialect
itself; the underlying asyncio object is available via the
<a class="reference internal" href="#sqlalchemy.pool.ManagesConnection.driver_connection" title="sqlalchemy.pool.ManagesConnection.driver_connection"><code class="xref py py-attr docutils literal notranslate"><span class="pre">ManagesConnection.driver_connection</span></code></a> attribute.</p>
<p>SQLAlchemy’s interface for the DBAPI connection is based on the
<a class="reference internal" href="internals.html#sqlalchemy.engine.interfaces.DBAPIConnection" title="sqlalchemy.engine.interfaces.DBAPIConnection"><code class="xref py py-class docutils literal notranslate"><span class="pre">DBAPIConnection</span></code></a> protocol object</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#sqlalchemy.pool.ManagesConnection.driver_connection" title="sqlalchemy.pool.ManagesConnection.driver_connection"><code class="xref py py-attr docutils literal notranslate"><span class="pre">ManagesConnection.driver_connection</span></code></a></p>
<p><a class="reference internal" href="../faq/connections.html#faq-dbapi-connection"><span class="std std-ref">使用Engine时如何获取原始的DBAPI连接？</span></a></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.pool.PoolProxiedConnection.detach">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.pool.PoolProxiedConnection"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.pool.PoolProxiedConnection.</span></code></a><span class="sig-name descname"><span class="pre">detach</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.pool.PoolProxiedConnection.detach" title="Permalink to this definition">¶</a></dt>
<dd><p>Separate this connection from its Pool.</p>
<p>This means that the connection will no longer be returned to the
pool when closed, and will instead be literally closed.  The
associated <a class="reference internal" href="#sqlalchemy.pool.ConnectionPoolEntry" title="sqlalchemy.pool.ConnectionPoolEntry"><code class="xref py py-class docutils literal notranslate"><span class="pre">ConnectionPoolEntry</span></code></a> is de-associated from this
DBAPI connection.</p>
<p>Note that any overall connection limiting constraints imposed by a
Pool implementation may be violated after a detach, as the detached
connection is removed from the pool’s knowledge and control.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.pool.PoolProxiedConnection.driver_connection">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.pool.PoolProxiedConnection"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.pool.PoolProxiedConnection.</span></code></a><span class="sig-name descname"><span class="pre">driver_connection</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">Any</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></em><a class="headerlink" href="#sqlalchemy.pool.PoolProxiedConnection.driver_connection" title="Permalink to this definition">¶</a></dt>
<dd><p>The “driver level” connection object as used by the Python
DBAPI or database driver.</p>
<p>For traditional <span class="target" id="index-7"></span><a class="pep reference external" href="https://peps.python.org/pep-0249/"><strong>PEP 249</strong></a> DBAPI implementations, this object will
be the same object as that of
<a class="reference internal" href="#sqlalchemy.pool.ManagesConnection.dbapi_connection" title="sqlalchemy.pool.ManagesConnection.dbapi_connection"><code class="xref py py-attr docutils literal notranslate"><span class="pre">ManagesConnection.dbapi_connection</span></code></a>.   For an asyncio database
driver, this will be the ultimate “connection” object used by that
driver, such as the <code class="docutils literal notranslate"><span class="pre">asyncpg.Connection</span></code> object which will not have
standard pep-249 methods.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.4.24.</span></p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#sqlalchemy.pool.ManagesConnection.dbapi_connection" title="sqlalchemy.pool.ManagesConnection.dbapi_connection"><code class="xref py py-attr docutils literal notranslate"><span class="pre">ManagesConnection.dbapi_connection</span></code></a></p>
<p><a class="reference internal" href="../faq/connections.html#faq-dbapi-connection"><span class="std std-ref">使用Engine时如何获取原始的DBAPI连接？</span></a></p>
</div>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.pool.PoolProxiedConnection.info">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.pool.PoolProxiedConnection"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.pool.PoolProxiedConnection.</span></code></a><span class="sig-name descname"><span class="pre">info</span></span><a class="headerlink" href="#sqlalchemy.pool.PoolProxiedConnection.info" title="Permalink to this definition">¶</a></dt>
<dd><div class="inherited-member docutils container">
<p><em>inherited from the</em> <code class="xref py py-attr docutils literal notranslate"><span class="pre">ManagesConnection.info</span></code> <em>attribute of</em> <a class="reference internal" href="#sqlalchemy.pool.ManagesConnection" title="sqlalchemy.pool.base.ManagesConnection"><code class="xref py py-class docutils literal notranslate"><span class="pre">ManagesConnection</span></code></a></p>
</div>
<p>Info dictionary associated with the underlying DBAPI connection
referred to by this <a class="reference internal" href="#sqlalchemy.pool.ManagesConnection" title="sqlalchemy.pool.ManagesConnection"><code class="xref py py-class docutils literal notranslate"><span class="pre">ManagesConnection</span></code></a> instance, allowing
user-defined data to be associated with the connection.</p>
<p>The data in this dictionary is persistent for the lifespan
of the DBAPI connection itself, including across pool checkins
and checkouts.  When the connection is invalidated
and replaced with a new one, this dictionary is cleared.</p>
<p>For a <a class="reference internal" href="#sqlalchemy.pool.PoolProxiedConnection" title="sqlalchemy.pool.PoolProxiedConnection"><code class="xref py py-class docutils literal notranslate"><span class="pre">PoolProxiedConnection</span></code></a> instance that’s not associated
with a <a class="reference internal" href="#sqlalchemy.pool.ConnectionPoolEntry" title="sqlalchemy.pool.ConnectionPoolEntry"><code class="xref py py-class docutils literal notranslate"><span class="pre">ConnectionPoolEntry</span></code></a>, such as if it were detached, the
attribute returns a dictionary that is local to that
<a class="reference internal" href="#sqlalchemy.pool.ConnectionPoolEntry" title="sqlalchemy.pool.ConnectionPoolEntry"><code class="xref py py-class docutils literal notranslate"><span class="pre">ConnectionPoolEntry</span></code></a>. Therefore the
<a class="reference internal" href="#sqlalchemy.pool.ManagesConnection.info" title="sqlalchemy.pool.ManagesConnection.info"><code class="xref py py-attr docutils literal notranslate"><span class="pre">ManagesConnection.info</span></code></a> attribute will always provide a Python
dictionary.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#sqlalchemy.pool.ManagesConnection.record_info" title="sqlalchemy.pool.ManagesConnection.record_info"><code class="xref py py-attr docutils literal notranslate"><span class="pre">ManagesConnection.record_info</span></code></a></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.pool.PoolProxiedConnection.invalidate">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.pool.PoolProxiedConnection"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.pool.PoolProxiedConnection.</span></code></a><span class="sig-name descname"><span class="pre">invalidate</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">e</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">BaseException</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">soft</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.pool.PoolProxiedConnection.invalidate" title="Permalink to this definition">¶</a></dt>
<dd><div class="inherited-member docutils container">
<p><em>inherited from the</em> <code class="xref py py-meth docutils literal notranslate"><span class="pre">ManagesConnection.invalidate()</span></code> <em>method of</em> <a class="reference internal" href="#sqlalchemy.pool.ManagesConnection" title="sqlalchemy.pool.base.ManagesConnection"><code class="xref py py-class docutils literal notranslate"><span class="pre">ManagesConnection</span></code></a></p>
</div>
<p>Mark the managed connection as invalidated.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.pool.PoolProxiedConnection.invalidate.params.e"></span><strong>e</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.pool.PoolProxiedConnection.invalidate.params.e">¶</a> – an exception object indicating a reason for the invalidation.</p></li>
<li><p><span class="target" id="sqlalchemy.pool.PoolProxiedConnection.invalidate.params.soft"></span><strong>soft</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.pool.PoolProxiedConnection.invalidate.params.soft">¶</a> – if True, the connection isn’t closed; instead, this
connection will be recycled on next checkout.</p></li>
</ul>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#pool-connection-invalidation"><span class="std std-ref">关于无效化的更多信息</span></a></p>
</div>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.pool.PoolProxiedConnection.is_detached">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.pool.PoolProxiedConnection"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.pool.PoolProxiedConnection.</span></code></a><span class="sig-name descname"><span class="pre">is_detached</span></span><a class="headerlink" href="#sqlalchemy.pool.PoolProxiedConnection.is_detached" title="Permalink to this definition">¶</a></dt>
<dd><p>Return True if this <a class="reference internal" href="#sqlalchemy.pool.PoolProxiedConnection" title="sqlalchemy.pool.PoolProxiedConnection"><code class="xref py py-class docutils literal notranslate"><span class="pre">PoolProxiedConnection</span></code></a> is detached
from its pool.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.pool.PoolProxiedConnection.is_valid">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.pool.PoolProxiedConnection"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.pool.PoolProxiedConnection.</span></code></a><span class="sig-name descname"><span class="pre">is_valid</span></span><a class="headerlink" href="#sqlalchemy.pool.PoolProxiedConnection.is_valid" title="Permalink to this definition">¶</a></dt>
<dd><p>Return True if this <a class="reference internal" href="#sqlalchemy.pool.PoolProxiedConnection" title="sqlalchemy.pool.PoolProxiedConnection"><code class="xref py py-class docutils literal notranslate"><span class="pre">PoolProxiedConnection</span></code></a> still refers
to an active DBAPI connection.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.pool.PoolProxiedConnection.record_info">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.pool.PoolProxiedConnection"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.pool.PoolProxiedConnection.</span></code></a><span class="sig-name descname"><span class="pre">record_info</span></span><a class="headerlink" href="#sqlalchemy.pool.PoolProxiedConnection.record_info" title="Permalink to this definition">¶</a></dt>
<dd><div class="inherited-member docutils container">
<p><em>inherited from the</em> <code class="xref py py-attr docutils literal notranslate"><span class="pre">ManagesConnection.record_info</span></code> <em>attribute of</em> <a class="reference internal" href="#sqlalchemy.pool.ManagesConnection" title="sqlalchemy.pool.base.ManagesConnection"><code class="xref py py-class docutils literal notranslate"><span class="pre">ManagesConnection</span></code></a></p>
</div>
<p>Persistent info dictionary associated with this
<a class="reference internal" href="#sqlalchemy.pool.ManagesConnection" title="sqlalchemy.pool.ManagesConnection"><code class="xref py py-class docutils literal notranslate"><span class="pre">ManagesConnection</span></code></a>.</p>
<p>Unlike the <a class="reference internal" href="#sqlalchemy.pool.ManagesConnection.info" title="sqlalchemy.pool.ManagesConnection.info"><code class="xref py py-attr docutils literal notranslate"><span class="pre">ManagesConnection.info</span></code></a> dictionary, the lifespan
of this dictionary is that of the <a class="reference internal" href="#sqlalchemy.pool.ConnectionPoolEntry" title="sqlalchemy.pool.ConnectionPoolEntry"><code class="xref py py-class docutils literal notranslate"><span class="pre">ConnectionPoolEntry</span></code></a>
which owns it; therefore this dictionary will persist across
reconnects and connection invalidation for a particular entry
in the connection pool.</p>
<p>For a <a class="reference internal" href="#sqlalchemy.pool.PoolProxiedConnection" title="sqlalchemy.pool.PoolProxiedConnection"><code class="xref py py-class docutils literal notranslate"><span class="pre">PoolProxiedConnection</span></code></a> instance that’s not associated
with a <a class="reference internal" href="#sqlalchemy.pool.ConnectionPoolEntry" title="sqlalchemy.pool.ConnectionPoolEntry"><code class="xref py py-class docutils literal notranslate"><span class="pre">ConnectionPoolEntry</span></code></a>, such as if it were detached, the
attribute returns None. Contrast to the <a class="reference internal" href="#sqlalchemy.pool.ManagesConnection.info" title="sqlalchemy.pool.ManagesConnection.info"><code class="xref py py-attr docutils literal notranslate"><span class="pre">ManagesConnection.info</span></code></a>
dictionary which is never None.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#sqlalchemy.pool.ManagesConnection.info" title="sqlalchemy.pool.ManagesConnection.info"><code class="xref py py-attr docutils literal notranslate"><span class="pre">ManagesConnection.info</span></code></a></p>
</div>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.pool._ConnectionFairy">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.pool.</span></span><span class="sig-name descname"><span class="pre">_ConnectionFairy</span></span><a class="headerlink" href="#sqlalchemy.pool._ConnectionFairy" title="Permalink to this definition">¶</a></dt>
<dd><p>Proxies a DBAPI connection and provides return-on-dereference
support.</p>
<p>This is an internal object used by the <a class="reference internal" href="#sqlalchemy.pool.Pool" title="sqlalchemy.pool.Pool"><code class="xref py py-class docutils literal notranslate"><span class="pre">Pool</span></code></a> implementation
to provide context management to a DBAPI connection delivered by
that <a class="reference internal" href="#sqlalchemy.pool.Pool" title="sqlalchemy.pool.Pool"><code class="xref py py-class docutils literal notranslate"><span class="pre">Pool</span></code></a>.   The public facing interface for this class
is described by the <a class="reference internal" href="#sqlalchemy.pool.PoolProxiedConnection" title="sqlalchemy.pool.PoolProxiedConnection"><code class="xref py py-class docutils literal notranslate"><span class="pre">PoolProxiedConnection</span></code></a> class.  See that
class for public API details.</p>
<p>The name “fairy” is inspired by the fact that the
<a class="reference internal" href="#sqlalchemy.pool._ConnectionFairy" title="sqlalchemy.pool._ConnectionFairy"><code class="xref py py-class docutils literal notranslate"><span class="pre">_ConnectionFairy</span></code></a> object’s lifespan is transitory, as it lasts
only for the length of a specific DBAPI connection being checked out from
the pool, and additionally that as a transparent proxy, it is mostly
invisible.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#sqlalchemy.pool.PoolProxiedConnection" title="sqlalchemy.pool.PoolProxiedConnection"><code class="xref py py-class docutils literal notranslate"><span class="pre">PoolProxiedConnection</span></code></a></p>
<p><a class="reference internal" href="#sqlalchemy.pool.ConnectionPoolEntry" title="sqlalchemy.pool.ConnectionPoolEntry"><code class="xref py py-class docutils literal notranslate"><span class="pre">ConnectionPoolEntry</span></code></a></p>
</div>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <code class="docutils literal notranslate"><span class="pre">sqlalchemy.pool._ConnectionFairy</span></code> (<a class="reference internal" href="#sqlalchemy.pool.PoolProxiedConnection" title="sqlalchemy.pool.base.PoolProxiedConnection"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.pool.base.PoolProxiedConnection</span></code></a>)</p>
</div>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.pool._ConnectionRecord">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.pool.</span></span><span class="sig-name descname"><span class="pre">_ConnectionRecord</span></span><a class="headerlink" href="#sqlalchemy.pool._ConnectionRecord" title="Permalink to this definition">¶</a></dt>
<dd><p>Maintains a position in a connection pool which references a pooled
connection.</p>
<p>This is an internal object used by the <a class="reference internal" href="#sqlalchemy.pool.Pool" title="sqlalchemy.pool.Pool"><code class="xref py py-class docutils literal notranslate"><span class="pre">Pool</span></code></a> implementation
to provide context management to a DBAPI connection maintained by
that <a class="reference internal" href="#sqlalchemy.pool.Pool" title="sqlalchemy.pool.Pool"><code class="xref py py-class docutils literal notranslate"><span class="pre">Pool</span></code></a>.   The public facing interface for this class
is described by the <a class="reference internal" href="#sqlalchemy.pool.ConnectionPoolEntry" title="sqlalchemy.pool.ConnectionPoolEntry"><code class="xref py py-class docutils literal notranslate"><span class="pre">ConnectionPoolEntry</span></code></a> class.  See that
class for public API details.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#sqlalchemy.pool.ConnectionPoolEntry" title="sqlalchemy.pool.ConnectionPoolEntry"><code class="xref py py-class docutils literal notranslate"><span class="pre">ConnectionPoolEntry</span></code></a></p>
<p><a class="reference internal" href="#sqlalchemy.pool.PoolProxiedConnection" title="sqlalchemy.pool.PoolProxiedConnection"><code class="xref py py-class docutils literal notranslate"><span class="pre">PoolProxiedConnection</span></code></a></p>
</div>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <code class="docutils literal notranslate"><span class="pre">sqlalchemy.pool._ConnectionRecord</span></code> (<a class="reference internal" href="#sqlalchemy.pool.ConnectionPoolEntry" title="sqlalchemy.pool.base.ConnectionPoolEntry"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.pool.base.ConnectionPoolEntry</span></code></a>)</p>
</div>
</dd></dl>

</section>
</section>

    </div>

</div>

<div id="docs-bottom-navigation" class="docs-navigation-links, withsidebar">

    <div id="docs-copyright">
        &copy; <a href="../copyright.html">Copyright</a> 2007-2023, the SQLAlchemy authors and contributors.


    <p><b>flambé!</b> the dragon and <b><i>The Alchemist</i></b> image designs created and generously donated by <a href="https://github.com/vmalloc">Rotem Yaari</a>.</p>

        Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 7.0.1.

    Documentation last generated: 2023/8/18 18:58:45

    </div>
</div>

</div>



        
        

    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
          URL_ROOT:    '../',
          VERSION:     '2.0.19',
          COLLAPSE_MODINDEX: false,
          FILE_SUFFIX: '.html'
      };
    </script>

    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>

    <!-- begin iterate through sphinx environment script_files -->
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script type="text/javascript" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/sphinx_highlight.js"></script>
        <script type="text/javascript" src="../_static/clipboard.min.js"></script>
        <script type="text/javascript" src="../_static/copybutton.js"></script>
    <!-- end iterate through sphinx environment script_files -->

    <script type="text/javascript" src="../_static/init.js"></script>


    </body>
</html>


